var L,S,E,E,c,S,u,d,y,i,n,ge,r0=Object.create,uo=Object.defineProperty,i0=Object.defineProperties,a0=Object.getOwnPropertyDescriptor,o0=Object.getOwnPropertyDescriptors,s0=Object.getOwnPropertyNames,mc=Object.getOwnPropertySymbols,u0=Object.getPrototypeOf,bc=Object.prototype.hasOwnProperty,c0=Object.prototype.propertyIsEnumerable,yc=(t,e,r)=>e in t?uo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ht=(t,e)=>{for(var r in e||(e={}))bc.call(e,r)&&yc(t,r,e[r]);if(mc)for(var r of mc(e))c0.call(e,r)&&yc(t,r,e[r]);return t},Cc=(t,e)=>i0(t,o0(e)),l0=(t,e)=>()=>(t&&(e=t(t=0)),e),We=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),f0=(t,e,r,o)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let a of s0(e))bc.call(t,a)||a===r||uo(t,a,{get:()=>e[a],enumerable:!(o=a0(e,a))||o.enumerable});return t},xt=(t,e,r)=>(r=null!=t?r0(u0(t)):{},f0(!e&&t&&t.__esModule?r:uo(r,"default",{value:t,enumerable:!0}),t)),et=(t,e,r)=>new Promise((o,a)=>{var s=t=>{try{f(r.next(t))}catch(e){a(e)}},l=t=>{try{f(r.throw(t))}catch(e){a(e)}},f=t=>t.done?o(t.value):Promise.resolve(t.value).then(s,l);f((r=r.apply(t,e)).next())}),oe=l0(()=>{ge={SDK_BASE_API_URL:"https://nodeapi.superviz.com",SDK_VIDEO_CONFERENCE_LAYER_URL:"https://video-conference-layer.superviz.com/15.0.0/index.html"}}),Qn=We((t,e)=>{oe();var r,o,a,s,l,f=Object.create,h=Object.defineProperty,p=Object.getOwnPropertyDescriptor,A=Object.getOwnPropertyNames,g=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,v=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),$=(t,e)=>{for(var r in e)h(t,r,{get:e[r],enumerable:!0})},b=(t,e,r,o)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let a of A(e))m.call(t,a)||a===r||h(t,a,{get:()=>e[a],enumerable:!(o=p(e,a))||o.enumerable});return t},C=(t,e,r)=>(r=null!=t?f(g(t)):{},b(!e&&t&&t.__esModule?r:h(r,"default",{value:t,enumerable:!0}),t)),_=t=>b(h({},"__esModule",{value:!0}),t),O=(r=()=>{a={}},()=>(r&&(o=r(r=0)),o)),w=v((t,e)=>{O();var r=1e3,o=60*r,a=60*o,s=24*a,l=7*s,f=365.25*s;function h(t){if(!((t=String(t)).length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var h=parseFloat(e[1]),p=(e[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*f;case"weeks":case"week":case"w":return h*l;case"days":case"day":case"d":return h*s;case"hours":case"hour":case"hrs":case"hr":case"h":return h*a;case"minutes":case"minute":case"mins":case"min":case"m":return h*o;case"seconds":case"second":case"secs":case"sec":case"s":return h*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function p(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=a?Math.round(t/a)+"h":e>=o?Math.round(t/o)+"m":e>=r?Math.round(t/r)+"s":t+"ms"}function A(t){var e=Math.abs(t);return e>=s?g(t,e,s,"day"):e>=a?g(t,e,a,"hour"):e>=o?g(t,e,o,"minute"):e>=r?g(t,e,r,"second"):t+" ms"}function g(t,e,r,o){return Math.round(t/r)+" "+o+(e>=1.5*r?"s":"")}e.exports=function(t,e){e=e||{};var r=typeof t;if("string"===r&&t.length>0)return h(t);if("number"===r&&isFinite(t))return e.long?A(t):p(t);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}),I=v((t,e)=>{function r(t){function e(t){let o,a=null,s,l;function f(...t){if(!f.enabled)return;let r=f,a=Number(new Date),s=a-(o||a);r.diff=s,r.prev=o,r.curr=a,o=a,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let l=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(o,a)=>{if("%%"===o)return"%";l++;let s=e.formatters[a];if("function"==typeof s){let f=t[l];o=s.call(r,f),t.splice(l,1),l--}return o}),e.formatArgs.call(r,t),(r.log||e.log).apply(r,t)}return f.namespace=t,f.useColors=e.useColors(),f.color=e.selectColor(t),f.extend=r,f.destroy=e.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==e.namespaces&&(s=e.namespaces,l=e.enabled(t)),l),set(t){a=t}}),"function"==typeof e.init&&e.init(f),f}function r(t,r){let o=e(this.namespace+(void 0===r?":":r)+t);return o.log=this.log,o}function o(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function t(e){return e instanceof Error?e.stack||e.message:e},e.disable=function t(){let r=[...e.names.map(o),...e.skips.map(o).map(t=>"-"+t)].join(",");return e.enable(""),r},e.enable=function t(r){e.save(r),e.namespaces=r,e.names=[],e.skips=[];let o,a=("string"==typeof r?r:"").split(/[\s,]+/),s=a.length;for(o=0;o<s;o++)a[o]&&("-"===(r=a[o].replace(/\*/g,".*?"))[0]?e.skips.push(RegExp("^"+r.slice(1)+"$")):e.names.push(RegExp("^"+r+"$")))},e.enabled=function t(r){if("*"===r[r.length-1])return!0;let o,a;for(o=0,a=e.skips.length;o<a;o++)if(e.skips[o].test(r))return!1;for(o=0,a=e.names.length;o<a;o++)if(e.names[o].test(r))return!0;return!1},e.humanize=w(),e.destroy=function t(){},Object.keys(t).forEach(r=>{e[r]=t[r]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function t(r){let o=0;for(let a=0;a<r.length;a++)o=(o<<5)-o+r.charCodeAt(a),o|=0;return e.colors[Math.abs(o)%e.colors.length]},e.enable(e.load()),e}O(),e.exports=r}),R=v((t,e)=>{function r(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let o=0,a=0;t[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(o++,"%c"===t&&(a=o))}),t.splice(a,0,r)}function s(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}}function l(){let e;try{e=t.storage.getItem("debug")}catch(r){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=a.DEBUG),e}function f(){try{return localStorage}catch(t){}}O(),t.formatArgs=o,t.save=s,t.load=l,t.useColors=r,t.storage=f(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0)}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=I()(t);var{formatters:h}=e.exports;h.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),M=v((t,e)=>{function r(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}O(),e.exports=r}),T=v((t,e)=>{O();var r="object"==typeof global&&global&&global.Object===Object&&global;e.exports=r}),P=v((t,e)=>{O();var r=T(),o="object"==typeof self&&self&&self.Object===Object&&self,a=r||o||Function("return this")();e.exports=a}),k=v((t,e)=>{O();var r=P(),o=function(){return r.Date.now()};e.exports=o}),B=v((t,e)=>{O();var r=/\s/;function o(t){for(var e=t.length;e--&&r.test(t.charAt(e)););return e}e.exports=o}),D=v((t,e)=>{O();var r=B(),o=/^\s+/;function a(t){return t&&t.slice(0,r(t)+1).replace(o,"")}e.exports=a}),x=v((t,e)=>{O();var r,o=P().Symbol;e.exports=o}),F=v((t,e)=>{O();var r=x(),o=Object.prototype,a=o.hasOwnProperty,s=o.toString,l=r?r.toStringTag:void 0;function f(t){var e=a.call(t,l),r=t[l];try{t[l]=void 0;var o=!0}catch(f){}var h=s.call(t);return o&&(e?t[l]=r:delete t[l]),h}e.exports=f}),N=v((t,e)=>{O();var r,o=Object.prototype.toString;function a(t){return o.call(t)}e.exports=a}),G=v((t,e)=>{O();var r=x(),o=F(),a=N(),s="[object Null]",l="[object Undefined]",f=r?r.toStringTag:void 0;function h(t){return null==t?void 0===t?l:s:f&&f in Object(t)?o(t):a(t)}e.exports=h}),U=v((t,e)=>{function r(t){return null!=t&&"object"==typeof t}O(),e.exports=r}),H=v((t,e)=>{O();var r=G(),o=U(),a="[object Symbol]";function s(t){return"symbol"==typeof t||o(t)&&r(t)==a}e.exports=s}),j=v((t,e)=>{O();var r=D(),o=M(),a=H(),s=0/0,l=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,h=/^0o[0-7]+$/i,p=parseInt;function A(t){if("number"==typeof t)return t;if(a(t))return s;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var A=f.test(t);return A||h.test(t)?p(t.slice(2),A?2:8):l.test(t)?s:+t}e.exports=A}),q=v((t,e)=>{O();var r=M(),o=k(),a=j(),s="Expected a function",l=Math.max,f=Math.min;function h(t,e,h){var p,A,g,m,v,$,b=0,C=!1,_=!1,O=!0;if("function"!=typeof t)throw TypeError(s);function w(e){var r=p,o=A;return p=A=void 0,b=e,m=t.apply(o,r)}function I(t){var r=t-$,o=t-b;return void 0===$||r>=e||r<0||_&&o>=g}function R(){var t,r,a,s,l=o();if(I(l))return M(l);v=setTimeout(R,(r=(t=l)-$,a=t-b,s=e-r,_?f(s,g-a):s))}function M(t){return v=void 0,O&&p?w(t):(p=A=void 0,m)}function T(){var t,r=o(),a=I(r);if(p=arguments,A=this,$=r,a){if(void 0===v)return b=t=$,v=setTimeout(R,e),C?w(t):m;if(_)return clearTimeout(v),v=setTimeout(R,e),w($)}return void 0===v&&(v=setTimeout(R,e)),m}return e=a(e)||0,r(h)&&(C=!!h.leading,g=(_="maxWait"in h)?l(a(h.maxWait)||0,e):g,O="trailing"in h?!!h.trailing:O),T.cancel=function t(){void 0!==v&&clearTimeout(v),b=0,p=$=A=v=void 0},T.flush=function t(){return void 0===v?m:M(o())},T}e.exports=h}),W=v((t,e)=>{O();var r=q(),o=M(),a="Expected a function";function s(t,e,s){var l=!0,f=!0;if("function"!=typeof t)throw TypeError(a);return o(s)&&(l="leading"in s?!!s.leading:l,f="trailing"in s?!!s.trailing:f),r(t,e,{leading:l,maxWait:e,trailing:f})}e.exports=s}),V={};$(V,{EnvironmentStateTypes:()=>te,FrameBricklayer:()=>tu,HeartBeat:()=>td,LibraryStateReasonTypes:()=>tr,LibraryStateTypes:()=>tn,Logger:()=>to,MessageBridge:()=>tf,MessageTypes:()=>Y,ObserverHelper:()=>ts,RealtimeStateReasonTypes:()=>tt,RealtimeStateTypes:()=>X}),e.exports=_(V),O(),O(),O();var z,Q,J,K,Z,Y=((l=Y||{}).COMMUNICATOR_STATE_UPDATE="communicator.state-update",l.FRAME_LOAD="frame.load",l.GOTO_USER="environment.goto-user",l.FOLLOW_USER="environment.follow-user",l.GATHER_ALL="environment.gather-all",l.REALTIME_ENTER_ROOM="realtime.enter-room",l.REALTIME_LEAVE="realtime.leave",l.REALTIME_SET_HOST="realtime.set-host",l.REALTIME_SET_ROOM_PROPERTIES="realtime.set-room-properties",l.REALTIME_HOST_UPDATE="realtime.host-update",l.REALTIME_ROOM_PROPERTIES_UPDATE="realtime.room-properties-update",l.REALTIME_USER_AMOUNT_UPDATE="realtime.amount-of-users-update",l.REALTIME_USER_LIST_UPDATE="realtime.user-list-update",l.REALTIME_USER_JOINED="realtime.user-joined",l.REALTIME_USER_LEFT="realtime.user-left",l.HEARTBEAT="heartbeat",l);O();var X=((z=X||{})[z.DISCONNECTED=0]="DISCONNECTED",z[z.INITIALIZING=1]="INITIALIZING",z[z.READY_TO_JOIN=2]="READY_TO_JOIN",z[z.CONNECTING=3]="CONNECTING",z[z.CONNECTED=4]="CONNECTED",z[z.FAILED=-1]="FAILED",z[z.RETRYING=-2]="RETRYING",z),tt=((Q=tt||{})[Q.LOBBY_SERVER_NOT_REACHEABLE=1]="LOBBY_SERVER_NOT_REACHEABLE",Q[Q.LOBBY_CONNECTION_ERROR=2]="LOBBY_CONNECTION_ERROR",Q[Q.ROOM_CONNECTION_FAILED=3]="ROOM_CONNECTION_FAILED",Q[Q.LOST_CONNECTION=4]="LOST_CONNECTION",Q),te=((J=te||{})[J.UNKNOWN=1]="UNKNOWN",J[J.LOADING=2]="LOADING",J[J.LOADED=3]="LOADED",J[J.ERROR=-1]="ERROR",J),tn=((K=tn||{})[K.INITIALIZING=1]="INITIALIZING",K[K.READY_TO_START=2]="READY_TO_START",K[K.CONNECTING=3]="CONNECTING",K[K.LOADING_MODEL=4]="LOADING_MODEL",K[K.CONNECTED=5]="CONNECTED",K[K.ERROR=-1]="ERROR",K[K.RETRYING=-2]="RETRYING",K),tr=((Z=tr||{})[Z.LOBBY_SERVER_NOT_REACHEABLE=1]="LOBBY_SERVER_NOT_REACHEABLE",Z[Z.LOBBY_CONNECTION_ERROR=2]="LOBBY_CONNECTION_ERROR",Z[Z.ROOM_CONNECTION_FAILED=3]="ROOM_CONNECTION_FAILED",Z[Z.LOST_CONNECTION=4]="LOST_CONNECTION",Z[Z.UNABLE_TO_LOAD_ROOM_INFO=5]="UNABLE_TO_LOAD_ROOM_INFO",Z[Z.UNABLE_TO_LOAD_FRAME=10]="UNABLE_TO_LOAD_FRAME",Z[Z.UNABLE_TO_LOAD_SCENE=11]="UNABLE_TO_LOAD_SCENE",Z[Z.SCENE_NOT_AVAILABLE_TO_USE=12]="SCENE_NOT_AVAILABLE_TO_USE",Z[Z.UNABLE_TO_LOAD_SCENE_RESOURCES=13]="UNABLE_TO_LOAD_SCENE_RESOURCES",Z[Z.FRAME_IS_UNRESPONSIVE=14]="FRAME_IS_UNRESPONSIVE",Z[Z.AUTHENTICATION_FAILED=20]="AUTHENTICATION_FAILED",Z);O(),O();var ti=C(R()),to=class{constructor(t){this.disable(),this.logger=(0,ti.default)(t)}log(t,...e){this.logger(t,...e)}enable(t="*"){ti.default.enable(t)}disable(){ti.default.disable()}};O();var ta,ts=class{constructor(t={}){let{throttleTime:e,logger:r=new to("@immersive/core:ObserverHelper")}=t;this.logger=r,this.throttleTime=e,this.callbacks=[],this.subscribe=this.subscribe.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.publish=this.publish.bind(this),this.reset=this.reset.bind(this),this.throttleTime&&(this.publish=(0,C(W()).default)(this.publish,this.throttleTime))}subscribe(t){if(!t)throw Error("Tried to subscribe to event using an invalid callback");this.callbacks.push(t)}unsubscribe(t){this.callbacks=this.callbacks.filter(e=>e!==t)}publish(...t){this.callbacks.forEach(e=>{this.callListener(e,t).catch(r=>{this.logger.log("core:ObserverHelper",`
            Failed to execute callback on publish value.
            Callback: ${e}
            Event: ${JSON.stringify(t)}
          `)})})}reset(){this.callbacks=[]}destroy(){delete this.logger,delete this.callbacks}callListener(t,e){return new Promise((r,o)=>{try{let a=t(...e);r(a)}catch(s){o(s)}})}};O(),O();var tu=class{build(t,e,r,o={},a={}){let s=document.querySelector(`#${t}`),l=new URL(e);if(this.wrapperId||this.element)throw Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(o).forEach(([t,e])=>{l.searchParams.set(t,e)}),Object.entries(a).forEach(([t,e])=>{this.element.setAttribute(t,e)}),this.element.src=l.toString(),this.element.id=r,s.appendChild(this.element),this.wrapperId=t}destroy(){let t=document.querySelector(`#${this.wrapperId}`);t&&t.querySelector(`#${this.element.id}`)&&t.removeChild(this.element),this.wrapperId=null,this.element=null}};O(),O(),O();var tc,tl,tf=class{constructor(t){this.observerHelpers={},this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"],this.originBlockList=["https://sketchfab.com"],this.publish=(t,e={})=>{this.logger.log("MessageBridge","Posting message to frame",t,e),this.contentWindow.postMessage({type:t,data:e},this.allowedOrigins)},this.listen=(t,e)=>{this.observerHelpers[t]||(this.observerHelpers[t]=new ts({logger:this.logger})),this.observerHelpers[t].subscribe(e)},this.onReceiveMessage=t=>{let{type:e,data:r,source:o}=t.data;if(this.sourceBlockList.includes(o)||this.originBlockList.includes(t.origin))return;let a=!!e,s=!this.domains.length||this.domains.includes(t.origin),l=this.observerHelpers.hasOwnProperty(e);if(this.logger.log("MessageBridge",`Message received - 
        TYPE: ${t.type} 
        ORIGIN: ${t.origin} 
        DATA: ${JSON.stringify(t.data)} `),!a||!s||!l){this.logger.log("MessageBridge","Message discarded");return}this.observerHelpers[e].publish(r)};let{contentWindow:e,domains:r=[],allowedOrigins:o="*",sourceBlockList:a=[],logger:s=new to("@immersive/core:MessageBridge")}=t;if(this.logger=s,this.domains=r,this.allowedOrigins=o,this.sourceBlockList.push(...a),"undefined"!=typeof window){if(this.contentWindow)throw Error("Tried to init PostMessageBridge more than one time");this.contentWindow=e,window.addEventListener("message",this.onReceiveMessage)}}destroy(){Object.entries(this.observerHelpers).forEach(([t,e])=>{e.reset(),delete this.observerHelpers[t]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observerHelpers,delete this.sourceBlockList}},td=class{constructor({context:t,interval:e,contentWindow:r}){this.emitter=()=>{this.MessageBridge.publish("heartbeat",{context:this.context,timestamp:Date.now(),timeInterval:this.interval,nextMessageTime:Date.now()+this.interval})},this.listen=t=>{this.MessageBridge.listen("heartbeat",t)},this.context=t,this.interval=e||1e4,this.MessageBridge=new tf({contentWindow:r}),this.start(),this.emitter()}start(){this.timer=setInterval(this.emitter,this.interval)}stop(){clearTimeout(this.timer)}destroy(){this.stop(),this.MessageBridge.destroy()}}}),Uc=We((t,e)=>{oe();var r=1e3,o=60*r,a=60*o,s=24*a,l=7*s,f=365.25*s;function h(t){if(!((t=String(t)).length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var h=parseFloat(e[1]),p=(e[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*f;case"weeks":case"week":case"w":return h*l;case"days":case"day":case"d":return h*s;case"hours":case"hour":case"hrs":case"hr":case"h":return h*a;case"minutes":case"minute":case"mins":case"min":case"m":return h*o;case"seconds":case"second":case"secs":case"sec":case"s":return h*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function p(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=a?Math.round(t/a)+"h":e>=o?Math.round(t/o)+"m":e>=r?Math.round(t/r)+"s":t+"ms"}function A(t){var e=Math.abs(t);return e>=s?g(t,e,s,"day"):e>=a?g(t,e,a,"hour"):e>=o?g(t,e,o,"minute"):e>=r?g(t,e,r,"second"):t+" ms"}function g(t,e,r,o){return Math.round(t/r)+" "+o+(e>=1.5*r?"s":"")}e.exports=function(t,e){e=e||{};var r=typeof t;if("string"===r&&t.length>0)return h(t);if("number"===r&&isFinite(t))return e.long?A(t):p(t);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}),Hc=We((t,e)=>{function r(t){function e(t){let o,a=null,s,l;function f(...t){if(!f.enabled)return;let r=f,a=Number(new Date),s=a-(o||a);r.diff=s,r.prev=o,r.curr=a,o=a,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let l=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(o,a)=>{if("%%"===o)return"%";l++;let s=e.formatters[a];if("function"==typeof s){let f=t[l];o=s.call(r,f),t.splice(l,1),l--}return o}),e.formatArgs.call(r,t),(r.log||e.log).apply(r,t)}return f.namespace=t,f.useColors=e.useColors(),f.color=e.selectColor(t),f.extend=r,f.destroy=e.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==e.namespaces&&(s=e.namespaces,l=e.enabled(t)),l),set(t){a=t}}),"function"==typeof e.init&&e.init(f),f}function r(t,r){let o=e(this.namespace+(void 0===r?":":r)+t);return o.log=this.log,o}function o(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function t(e){return e instanceof Error?e.stack||e.message:e},e.disable=function t(){let r=[...e.names.map(o),...e.skips.map(o).map(t=>"-"+t)].join(",");return e.enable(""),r},e.enable=function t(r){e.save(r),e.namespaces=r,e.names=[],e.skips=[];let o,a=("string"==typeof r?r:"").split(/[\s,]+/),s=a.length;for(o=0;o<s;o++)a[o]&&("-"===(r=a[o].replace(/\*/g,".*?"))[0]?e.skips.push(RegExp("^"+r.slice(1)+"$")):e.names.push(RegExp("^"+r+"$")))},e.enabled=function t(r){if("*"===r[r.length-1])return!0;let o,a;for(o=0,a=e.skips.length;o<a;o++)if(e.skips[o].test(r))return!1;for(o=0,a=e.names.length;o<a;o++)if(e.names[o].test(r))return!0;return!1},e.humanize=Uc(),e.destroy=function t(){},Object.keys(t).forEach(r=>{e[r]=t[r]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function t(r){let o=0;for(let a=0;a<r.length;a++)o=(o<<5)-o+r.charCodeAt(a),o|=0;return e.colors[Math.abs(o)%e.colors.length]},e.enable(e.load()),e}oe(),e.exports=r}),Wc=We((t,e)=>{function r(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let o=0,a=0;t[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(o++,"%c"===t&&(a=o))}),t.splice(a,0,r)}function a(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}}function s(){let e;try{e=t.storage.getItem("debug")}catch(r){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=ge.DEBUG),e}function l(){try{return localStorage}catch(t){}}oe(),t.formatArgs=o,t.save=a,t.load=s,t.useColors=r,t.storage=l(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0)}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Hc()(t);var{formatters:f}=e.exports;f.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),Qc=We((t,e)=>{oe(),function(r,o){"object"==typeof t&&"object"==typeof e?e.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof t?t.bowser=o():r.bowser=o()}(t,function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(o,a,(function(e){return t[e]}).bind(null,a));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=90)}({17:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o=r(18),a=function(){function t(){}return t.getFirstMatch=function(t,e){var r=e.match(t);return r&&r.length>0&&r[1]||""},t.getSecondMatch=function(t,e){var r=e.match(t);return r&&r.length>1&&r[2]||""},t.matchAndReturnConst=function(t,e,r){if(t.test(e))return r},t.getWindowsVersionName=function(t){switch(t){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},t.getMacOSVersionName=function(t){var e=t.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},t.getAndroidVersionName=function(t){var e=t.split(".").splice(0,2).map(function(t){return parseInt(t,10)||0});if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&e[1]>=6?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&e[1]>2?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&e[1]>=4?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},t.getVersionPrecision=function(t){return t.split(".").length},t.compareVersions=function(e,r,o){void 0===o&&(o=!1);var a=t.getVersionPrecision(e),s=t.getVersionPrecision(r),l=Math.max(a,s),f=0,h=t.map([e,r],function(e){var r=l-t.getVersionPrecision(e),o=e+Array(r+1).join(".0");return t.map(o.split("."),function(t){return Array(20-t.length).join("0")+t}).reverse()});for(o&&(f=l-Math.min(a,s)),l-=1;l>=f;){if(h[0][l]>h[1][l])return 1;if(h[0][l]===h[1][l]){if(l===f)return 0;l-=1}else if(h[0][l]<h[1][l])return -1}},t.map=function(t,e){var r,o=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(r=0;r<t.length;r+=1)o.push(e(t[r]));return o},t.find=function(t,e){var r,o;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(r=0,o=t.length;r<o;r+=1){var a=t[r];if(e(a,r))return a}},t.assign=function(t){for(var e,r,o=t,a=arguments.length,s=Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];if(Object.assign)return Object.assign.apply(Object,[t].concat(s));for(e=0,r=s.length;e<r;e+=1)(function(){var t=s[e];"object"==typeof t&&null!==t&&Object.keys(t).forEach(function(e){o[e]=t[e]})})();return t},t.getBrowserAlias=function(t){return o.BROWSER_ALIASES_MAP[t]},t.getBrowserTypeByAlias=function(t){return o.BROWSER_MAP[t]||""},t}();e.default=a,t.exports=e.default},18:function(t,e,r){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o,a=(o=r(91))&&o.__esModule?o:{default:o},s=r(18),l=function(){var t,e,r;function o(){}return o.getParser=function(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)throw Error("UserAgent should be a string");return new a.default(t,e)},o.parse=function(t){return new a.default(t).getResult()},t=o,e=null,function t(e,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(t,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}]),o}();e.default=l,t.exports=e.default},91:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o=h(r(92)),a=h(r(93)),s=h(r(94)),l=h(r(95)),f=h(r(17));function h(t){return t&&t.__esModule?t:{default:t}}var p=function(){function t(t,e){if(void 0===e&&(e=!1),null==t||""===t)throw Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==e&&this.parse()}var e=t.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=f.default.find(o.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var t=this;this.parsedResult.os={};var e=f.default.find(a.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(t){var e=this.getOS().name;return t?String(e).toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(t){void 0===t&&(t=!1);var e=this.getPlatform().type;return t?String(e).toLowerCase()||"":e||""},e.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=f.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=f.default.find(l.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return f.default.assign({},this.parsedResult)},e.satisfies=function(t){var e=this,r={},o=0,a={},s=0;if(Object.keys(t).forEach(function(e){var l=t[e];"string"==typeof l?(a[e]=l,s+=1):"object"==typeof l&&(r[e]=l,o+=1)}),o>0){var l=Object.keys(r),h=f.default.find(l,function(t){return e.isOS(t)});if(h){var p=this.satisfies(r[h]);if(void 0!==p)return p}var A=f.default.find(l,function(t){return e.isPlatform(t)});if(A){var g=this.satisfies(r[A]);if(void 0!==g)return g}}if(s>0){var m=Object.keys(a),v=f.default.find(m,function(t){return e.isBrowser(t,!0)});if(void 0!==v)return this.compareVersion(a[v])}},e.isBrowser=function(t,e){void 0===e&&(e=!1);var r=this.getBrowserName().toLowerCase(),o=t.toLowerCase(),a=f.default.getBrowserTypeByAlias(o);return e&&a&&(o=a.toLowerCase()),o===r},e.compareVersion=function(t){var e=[0],r=t,o=!1,a=this.getBrowserVersion();if("string"==typeof a)return">"===t[0]||"<"===t[0]?(r=t.substr(1),"="===t[1]?(o=!0,r=t.substr(2)):e=[],">"===t[0]?e.push(1):e.push(-1)):"="===t[0]?r=t.substr(1):"~"===t[0]&&(o=!0,r=t.substr(1)),e.indexOf(f.default.compareVersions(a,r,o))>-1},e.isOS=function(t){return this.getOSName(!0)===String(t).toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===String(t).toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===String(t).toLowerCase()},e.is=function(t,e){return void 0===e&&(e=!1),this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)},e.some=function(t){var e=this;return void 0===t&&(t=[]),t.some(function(t){return e.is(t)})},t}();e.default=p,t.exports=e.default},92:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o,a=(o=r(17))&&o.__esModule?o:{default:o},s=/version\/(\d+(\.?_?\d+)+)/i,l=[{test:[/googlebot/i],describe:function(t){var e={name:"Googlebot"},r=a.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/opera/i],describe:function(t){var e={name:"Opera"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe:function(t){var e={name:"Opera"},r=a.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe:function(t){var e={name:"Samsung Internet for Android"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Whale/i],describe:function(t){var e={name:"NAVER Whale Browser"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe:function(t){var e={name:"MZ Browser"},r=a.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/focus/i],describe:function(t){var e={name:"Focus"},r=a.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/swing/i],describe:function(t){var e={name:"Swing"},r=a.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/coast/i],describe:function(t){var e={name:"Opera Coast"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(t){var e={name:"Opera Touch"},r=a.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe:function(t){var e={name:"Yandex Browser"},r=a.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe:function(t){var e={name:"UC Browser"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe:function(t){var e={name:"Maxthon"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/epiphany/i],describe:function(t){var e={name:"Epiphany"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/puffin/i],describe:function(t){var e={name:"Puffin"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe:function(t){var e={name:"Sleipnir"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe:function(t){var e={name:"K-Meleon"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe:function(t){var e={name:"WeChat"},r=a.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe:function(t){var e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},r=a.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe:function(t){var e={name:"Internet Explorer"},r=a.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe:function(t){var e={name:"Microsoft Edge"},r=a.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe:function(t){var e={name:"Microsoft Edge"},r=a.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe:function(t){var e={name:"Vivaldi"},r=a.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe:function(t){var e={name:"SeaMonkey"},r=a.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sailfish/i],describe:function(t){var e={name:"Sailfish"},r=a.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(e.version=r),e}},{test:[/silk/i],describe:function(t){var e={name:"Amazon Silk"},r=a.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/phantom/i],describe:function(t){var e={name:"PhantomJS"},r=a.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe:function(t){var e={name:"SlimerJS"},r=a.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e={name:"BlackBerry"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e={name:"WebOS Browser"},r=a.default.getFirstMatch(s,t)||a.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/bada/i],describe:function(t){var e={name:"Bada"},r=a.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/tizen/i],describe:function(t){var e={name:"Tizen"},r=a.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe:function(t){var e={name:"QupZilla"},r=a.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var e={name:"Firefox"},r=a.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/electron/i],describe:function(t){var e={name:"Electron"},r=a.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe:function(t){var e={name:"Miui"},r=a.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/chromium/i],describe:function(t){var e={name:"Chromium"},r=a.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe:function(t){var e={name:"Chrome"},r=a.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/GSA/i],describe:function(t){var e={name:"Google Search"},r=a.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){var e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe:function(t){var e={name:"Android Browser"},r=a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe:function(t){var e={name:"PlayStation 4"},r=a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe:function(t){var e={name:"Safari"},r=a.default.getFirstMatch(s,t);return r&&(e.version=r),e}},{test:[/.*/i],describe:function(t){var e=-1!==t.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:a.default.getFirstMatch(e,t),version:a.default.getSecondMatch(e,t)}}}];e.default=l,t.exports=e.default},93:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o,a=(o=r(17))&&o.__esModule?o:{default:o},s=r(18),l=[{test:[/Roku\/DVP/],describe:function(t){var e=a.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:s.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(t){var e=a.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(t){var e=a.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=a.default.getWindowsVersionName(e);return{name:s.OS_MAP.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(t){var e={name:s.OS_MAP.iOS},r=a.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return r&&(e.version=r),e}},{test:[/macintosh/i],describe:function(t){var e=a.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),r=a.default.getMacOSVersionName(e),o={name:s.OS_MAP.MacOS,version:e};return r&&(o.versionName=r),o}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var e=a.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:e}}},{test:function(t){var e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe:function(t){var e=a.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),r=a.default.getAndroidVersionName(e),o={name:s.OS_MAP.Android,version:e};return r&&(o.versionName=r),o}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e=a.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:s.OS_MAP.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e=a.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||a.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||a.default.getFirstMatch(/\bbb(\d+)/i,t);return{name:s.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(t){var e=a.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(t){var e=a.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(t){var e=a.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:s.OS_MAP.PlayStation4,version:e}}}];e.default=l,t.exports=e.default},94:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o,a=(o=r(17))&&o.__esModule?o:{default:o},s=r(18),l=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(t){var e=a.default.getFirstMatch(/(can-l01)/i,t)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(t){var e=t.test(/ipod|iphone/i),r=t.test(/like (ipod|iphone)/i);return e&&!r},describe:function(t){var e=a.default.getFirstMatch(/(ipod|iphone)/i,t);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(t){var e=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&e>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];e.default=l,t.exports=e.default},95:function(t,e,r){"use strict";e.__esModule=!0,e.default=void 0;var o,a=(o=r(17))&&o.__esModule?o:{default:o},s=r(18),l=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){if(/\sedg\//i.test(t))return{name:s.ENGINE_MAP.Blink};var e=a.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:s.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(t){var e={name:s.ENGINE_MAP.Trident},r=a.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){return t.test(/presto/i)},describe:function(t){var e={name:s.ENGINE_MAP.Presto},r=a.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){var e=t.test(/gecko/i),r=t.test(/like gecko/i);return e&&!r},describe:function(t){var e={name:s.ENGINE_MAP.Gecko},r=a.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(t){var e={name:s.ENGINE_MAP.WebKit},r=a.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}}];e.default=l,t.exports=e.default}})})}),Il=We((t,e)=>{oe();var r,o=200,a="__lodash_hash_undefined__",s=1,l=2,f=9007199254740991,h="[object Arguments]",p="[object Array]",A="[object AsyncFunction]",g="[object Boolean]",m="[object Date]",v="[object Error]",$="[object Function]",b="[object GeneratorFunction]",C="[object Map]",_="[object Number]",O="[object Null]",w="[object Object]",I="[object Promise]",R="[object Proxy]",M="[object RegExp]",T="[object Set]",P="[object String]",k="[object Symbol]",B="[object Undefined]",D="[object WeakMap]",x="[object ArrayBuffer]",F="[object DataView]",N="[object Float64Array]",G="[object Int8Array]",U="[object Int16Array]",H="[object Int32Array]",j="[object Uint8Array]",q="[object Uint8ClampedArray]",W="[object Uint16Array]",V="[object Uint32Array]",z=/[\\^$.*+?()[\]{}|]/g,Q=/^\[object .+?Constructor\]$/,J=/^(?:0|[1-9]\d*)$/,K={};K["[object Float32Array]"]=K[N]=K[G]=K[U]=K[H]=K[j]=K[q]=K[W]=K[V]=!0,K[h]=K[p]=K[x]=K[g]=K[F]=K[m]=K[v]=K[$]=K[C]=K[_]=K[w]=K[M]=K[T]=K[P]=K[D]=!1;var Z="object"==typeof global&&global&&global.Object===Object&&global,Y="object"==typeof self&&self&&self.Object===Object&&self,X=Z||Y||Function("return this")(),tt="object"==typeof t&&t&&!t.nodeType&&t,te=tt&&"object"==typeof e&&e&&!e.nodeType&&e,tn=te&&te.exports===tt,tr=tn&&Z.process,ti=function(){try{return tr&&tr.binding&&tr.binding("util")}catch(t){}}(),to=ti&&ti.isTypedArray;function ta(t,e){for(var r=-1,o=null==t?0:t.length,a=0,s=[];++r<o;){var l=t[r];e(l,r,t)&&(s[a++]=l)}return s}function ts(t,e){for(var r=-1,o=e.length,a=t.length;++r<o;)t[a+r]=e[r];return t}function tu(t,e){for(var r=-1,o=null==t?0:t.length;++r<o;)if(e(t[r],r,t))return!0;return!1}function tc(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}function tl(t){return function(e){return t(e)}}function tf(t,e){return t.has(e)}function td(t,e){return null==t?void 0:t[e]}function th(t){var e=-1,r=Array(t.size);return t.forEach(function(t,o){r[++e]=[o,t]}),r}function tp(t,e){return function(r){return t(e(r))}}function tA(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var tg=Array.prototype,tm=Function.prototype,tv=Object.prototype,ty=X["__core-js_shared__"],t$=tm.toString,t8=tv.hasOwnProperty,tb=function(){var t=/[^.]+$/.exec(ty&&ty.keys&&ty.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),tC=tv.toString,t_=RegExp("^"+t$.call(t8).replace(z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tO=tn?X.Buffer:void 0,tE=X.Symbol,tS=X.Uint8Array,tw=tv.propertyIsEnumerable,tI=tg.splice,tR=tE?tE.toStringTag:void 0,tM=Object.getOwnPropertySymbols,tT=tO?tO.isBuffer:void 0,tP=tp(Object.keys,Object),tk=eS(X,"DataView"),t0=eS(X,"Map"),tB=eS(X,"Promise"),tL=eS(X,"Set"),t2=eS(X,"WeakMap"),tD=eS(Object,"create"),tx=eB(tk),t1=eB(t0),tF=eB(tB),tN=eB(tL),tG=eB(t2),tU=tE?tE.prototype:void 0,t4=tU?tU.valueOf:void 0;function t3(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function t6(){this.__data__=tD?tD(null):{},this.size=0}function tH(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function t7(t){var e=this.__data__;if(tD){var r=e[t];return r===a?void 0:r}return t8.call(e,t)?e[t]:void 0}function tj(t){var e=this.__data__;return tD?void 0!==e[t]:t8.call(e,t)}function tq(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=tD&&void 0===e?a:e,this}function tW(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function tV(){this.__data__=[],this.size=0}function tz(t){var e=this.__data__,r=eh(e,t);return!(r<0)&&(r==e.length-1?e.pop():tI.call(e,r,1),--this.size,!0)}function tQ(t){var e=this.__data__,r=eh(e,t);return r<0?void 0:e[r][1]}function t5(t){return eh(this.__data__,t)>-1}function tJ(t,e){var r=this.__data__,o=eh(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}function tK(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function tZ(){this.size=0,this.__data__={hash:new t3,map:new(t0||tW),string:new t3}}function tY(t){var e=eE(this,t).delete(t);return this.size-=e?1:0,e}function tX(t){return eE(this,t).get(t)}function t9(t){return eE(this,t).has(t)}function ee(t,e){var r=eE(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}function en(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new tK;++e<r;)this.add(t[e])}function er(t){return this.__data__.set(t,a),this}function ei(t){return this.__data__.has(t)}function eo(t){var e=this.__data__=new tW(t);this.size=e.size}function ea(){this.__data__=new tW,this.size=0}function es(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function eu(t){return this.__data__.get(t)}function ec(t){return this.__data__.has(t)}function el(t,e){var r=this.__data__;if(r instanceof tW){var a=r.__data__;if(!t0||a.length<o-1)return a.push([t,e]),this.size=++r.size,this;r=this.__data__=new tK(a)}return r.set(t,e),this.size=r.size,this}function ed(t,e){var r=eD(t),o=!r&&e2(t),a=!r&&!o&&e1(t),s=!r&&!o&&!a&&e3(t),l=r||o||a||s,f=l?tc(t.length,String):[],h=f.length;for(var p in t)(e||t8.call(t,p))&&!(l&&("length"==p||a&&("offset"==p||"parent"==p)||s&&("buffer"==p||"byteLength"==p||"byteOffset"==p)||eM(p,h)))&&f.push(p);return f}function eh(t,e){for(var r=t.length;r--;)if(eL(t[r][0],e))return r;return -1}function ep(t,e,r){var o=e(t);return eD(t)?o:ts(o,r(t))}function eA(t){return null==t?void 0===t?B:O:tR&&tR in Object(t)?ew(t):e0(t)}function eg(t){return e4(t)&&eA(t)==h}function em(t,e,r,o,a){return t===e||(null!=t&&null!=e&&(e4(t)||e4(e))?ev(t,e,r,o,em,a):t!=t&&e!=e)}function ev(t,e,r,o,a,l){var f=eD(t),A=eD(e),g=f?p:eR(t),m=A?p:eR(e);g=g==h?w:g,m=m==h?w:m;var v=g==w,$=m==w,b=g==m;if(b&&e1(t)){if(!e1(e))return!1;f=!0,v=!1}if(b&&!v)return l||(l=new eo),f||e3(t)?eb(t,e,r,o,a,l):eC(t,e,g,r,o,a,l);if(!(r&s)){var C=v&&t8.call(t,"__wrapped__"),_=$&&t8.call(e,"__wrapped__");if(C||_){var O=C?t.value():t,I=_?e.value():e;return l||(l=new eo),a(O,I,r,o,l)}}return!!b&&(l||(l=new eo),e_(t,e,r,o,a,l))}function ey(t){return!(!eU(t)||eP(t))&&(eN(t)?t_:Q).test(eB(t))}function e$(t){return e4(t)&&eG(t.length)&&!!K[eA(t)]}function e8(t){if(!ek(t))return tP(t);var e=[];for(var r in Object(t))t8.call(t,r)&&"constructor"!=r&&e.push(r);return e}function eb(t,e,r,o,a,f){var h=r&s,p=t.length,A=e.length;if(p!=A&&!(h&&A>p))return!1;var g=f.get(t);if(g&&f.get(e))return g==e;var m=-1,v=!0,$=r&l?new en:void 0;for(f.set(t,e),f.set(e,t);++m<p;){var b=t[m],C=e[m];if(o)var _=h?o(C,b,m,e,t,f):o(b,C,m,t,e,f);if(void 0!==_){if(_)continue;v=!1;break}if($){if(!tu(e,function(t,e){if(!tf($,e)&&(b===t||a(b,t,r,o,f)))return $.push(e)})){v=!1;break}}else if(!(b===C||a(b,C,r,o,f))){v=!1;break}}return f.delete(t),f.delete(e),v}function eC(t,e,r,o,a,f,h){switch(r){case F:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!f(new tS(t),new tS(e)));case g:case m:case _:return eL(+t,+e);case v:return t.name==e.name&&t.message==e.message;case M:case P:return t==e+"";case C:var p=th;case T:var A=o&s;if(p||(p=tA),t.size!=e.size&&!A)break;var $=h.get(t);if($)return $==e;o|=l,h.set(t,e);var b=eb(p(t),p(e),o,a,f,h);return h.delete(t),b;case k:if(t4)return t4.call(t)==t4.call(e)}return!1}function e_(t,e,r,o,a,l){var f=r&s,h=eO(t),p=h.length,A=eO(e).length;if(p!=A&&!f)return!1;for(var g=p;g--;){var m=h[g];if(!(f?m in e:t8.call(e,m)))return!1}var v=l.get(t);if(v&&l.get(e))return v==e;var $=!0;l.set(t,e),l.set(e,t);for(var b=f;++g<p;){var C=t[m=h[g]],_=e[m];if(o)var O=f?o(_,C,m,e,t,l):o(C,_,m,t,e,l);if(!(void 0===O?C===_||a(C,_,r,o,l):O)){$=!1;break}b||(b="constructor"==m)}if($&&!b){var w=t.constructor,I=e.constructor;w!=I&&"constructor"in t&&"constructor"in e&&!("function"==typeof w&&w instanceof w&&"function"==typeof I&&I instanceof I)&&($=!1)}return l.delete(t),l.delete(e),$}function eO(t){return ep(t,e6,eI)}function eE(t,e){var r=t.__data__;return eT(e)?r["string"==typeof e?"string":"hash"]:r.map}function eS(t,e){var r=td(t,e);return ey(r)?r:void 0}function ew(t){var e=t8.call(t,tR),r=t[tR];try{t[tR]=void 0;var o=!0}catch(a){}var s=tC.call(t);return o&&(e?t[tR]=r:delete t[tR]),s}t3.prototype.clear=t6,t3.prototype.delete=tH,t3.prototype.get=t7,t3.prototype.has=tj,t3.prototype.set=tq,tW.prototype.clear=tV,tW.prototype.delete=tz,tW.prototype.get=tQ,tW.prototype.has=t5,tW.prototype.set=tJ,tK.prototype.clear=tZ,tK.prototype.delete=tY,tK.prototype.get=tX,tK.prototype.has=t9,tK.prototype.set=ee,en.prototype.add=en.prototype.push=er,en.prototype.has=ei,eo.prototype.clear=ea,eo.prototype.delete=es,eo.prototype.get=eu,eo.prototype.has=ec,eo.prototype.set=el;var eI=tM?function(t){return null==t?[]:ta(tM(t=Object(t)),function(e){return tw.call(t,e)})}:eH,eR=eA;function eM(t,e){return!!(e=null==e?f:e)&&("number"==typeof t||J.test(t))&&t>-1&&t%1==0&&t<e}function eT(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function eP(t){return!!tb&&tb in t}function ek(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||tv)}function e0(t){return tC.call(t)}function eB(t){if(null!=t){try{return t$.call(t)}catch(e){}try{return t+""}catch(r){}}return""}function eL(t,e){return t===e||t!=t&&e!=e}(tk&&eR(new tk(new ArrayBuffer(1)))!=F||t0&&eR(new t0)!=C||tB&&eR(tB.resolve())!=I||tL&&eR(new tL)!=T||t2&&eR(new t2)!=D)&&(eR=function(t){var e=eA(t),r=e==w?t.constructor:void 0,o=r?eB(r):"";if(o)switch(o){case tx:return F;case t1:return C;case tF:return I;case tN:return T;case tG:return D}return e});var e2=eg(function(){return arguments}())?eg:function(t){return e4(t)&&t8.call(t,"callee")&&!tw.call(t,"callee")},eD=Array.isArray;function ex(t){return null!=t&&eG(t.length)&&!eN(t)}var e1=tT||e7;function eF(t,e){return em(t,e)}function eN(t){if(!eU(t))return!1;var e=eA(t);return e==$||e==b||e==A||e==R}function eG(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=f}function eU(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function e4(t){return null!=t&&"object"==typeof t}var e3=to?tl(to):e$;function e6(t){return ex(t)?ed(t):e8(t)}function eH(){return[]}function e7(){return!1}e.exports=eF}),Tl=We((t,e)=>{oe(),(function(){var r,o="Expected a function",a="__lodash_hash_undefined__",s="__lodash_placeholder__",l=2,f=32,h=64,p="...",A=1/0,g=0/0,m=4294967295,v=m-1,$=m>>>1,b=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",f],["partialRight",h],["rearg",256]],C="[object Arguments]",_="[object Array]",O="[object Boolean]",w="[object Date]",I="[object Error]",R="[object Function]",M="[object GeneratorFunction]",T="[object Map]",P="[object Number]",k="[object Null]",B="[object Object]",D="[object Promise]",x="[object RegExp]",F="[object Set]",N="[object String]",G="[object Symbol]",U="[object Undefined]",H="[object WeakMap]",j="[object ArrayBuffer]",q="[object DataView]",W="[object Float32Array]",V="[object Float64Array]",z="[object Int8Array]",Q="[object Int16Array]",J="[object Int32Array]",K="[object Uint8Array]",Z="[object Uint8ClampedArray]",Y="[object Uint16Array]",X="[object Uint32Array]",tt=/\b__p \+= '';/g,te=/\b(__p \+=) '' \+/g,tn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,tr=/&(?:amp|lt|gt|quot|#39);/g,ti=/[&<>"']/g,to=RegExp(tr.source),ta=RegExp(ti.source),ts=/<%-([\s\S]+?)%>/g,tu=/<%([\s\S]+?)%>/g,tc=/<%=([\s\S]+?)%>/g,tl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tf=/^\w*$/,td=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,th=/[\\^$.*+?()[\]{}|]/g,tp=RegExp(th.source),tA=/^\s+/,tg=/\s/,tm=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,tv=/\{\n\/\* \[wrapped with (.+)\] \*/,ty=/,? & /,t$=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,t8=/[()=,{}\[\]\/\s]/,tb=/\\(\\)?/g,tC=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,t_=/\w*$/,tO=/^[-+]0x[0-9a-f]+$/i,tE=/^0b[01]+$/i,tS=/^\[object .+?Constructor\]$/,tw=/^0o[0-7]+$/i,tI=/^(?:0|[1-9]\d*)$/,tR=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tM=/($^)/,tT=/['\n\r\u2028\u2029\\]/g,tP="\ud800-\udfff",tk="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",t0="\\u2700-\\u27bf",tB="a-z\\xdf-\\xf6\\xf8-\\xff",tL="A-Z\\xc0-\\xd6\\xd8-\\xde",t2="\\ufe0e\\ufe0f",tD="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tx="['’]",t1="["+tD+"]",tF="["+tk+"]",tN="["+tB+"]",tG="[^"+tP+tD+"\\d+"+t0+tB+tL+"]",tU="\ud83c[\udffb-\udfff]",t4="[^"+tP+"]",t3="(?:\ud83c[\udde6-\uddff]){2}",t6="[\ud800-\udbff][\udc00-\udfff]",tH="["+tL+"]",t7="\\u200d",tj="(?:"+tN+"|"+tG+")",tq="(?:"+tx+"(?:d|ll|m|re|s|t|ve))?",tW="(?:"+tx+"(?:D|LL|M|RE|S|T|VE))?",tV="(?:"+tF+"|"+tU+")?",tz="["+t2+"]?",tQ="(?:"+t7+"(?:"+[t4,t3,t6].join("|")+")"+tz+tV+")*",t5=tz+tV+tQ,tJ="(?:"+["["+t0+"]",t3,t6].join("|")+")"+t5,tK="(?:"+[t4+tF+"?",tF,t3,t6,"["+tP+"]"].join("|")+")",tZ=RegExp(tx,"g"),tY=RegExp(tF,"g"),tX=RegExp(tU+"(?="+tU+")|"+tK+t5,"g"),t9=RegExp([tH+"?"+tN+"+"+tq+"(?="+[t1,tH,"$"].join("|")+")","(?:"+tH+"|"+tG+")+"+tW+"(?="+[t1,tH+tj,"$"].join("|")+")",tH+"?"+tj+"+"+tq,tH+"+"+tW,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",tJ].join("|"),"g"),ee=RegExp("["+t7+tP+tk+t2+"]"),en=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,er=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ei=-1,eo={};eo[W]=eo[V]=eo[z]=eo[Q]=eo[J]=eo[K]=eo[Z]=eo[Y]=eo[X]=!0,eo[C]=eo[_]=eo[j]=eo[O]=eo[q]=eo[w]=eo[I]=eo[R]=eo[T]=eo[P]=eo[B]=eo[x]=eo[F]=eo[N]=eo[H]=!1;var ea={};ea[C]=ea[_]=ea[j]=ea[q]=ea[O]=ea[w]=ea[W]=ea[V]=ea[z]=ea[Q]=ea[J]=ea[T]=ea[P]=ea[B]=ea[x]=ea[F]=ea[N]=ea[G]=ea[K]=ea[Z]=ea[Y]=ea[X]=!0,ea[I]=ea[R]=ea[H]=!1;var es={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},eu=parseFloat,ec=parseInt,el="object"==typeof global&&global&&global.Object===Object&&global,ed="object"==typeof self&&self&&self.Object===Object&&self,eh=el||ed||Function("return this")(),ep="object"==typeof t&&t&&!t.nodeType&&t,eA=ep&&"object"==typeof e&&e&&!e.nodeType&&e,eg=eA&&eA.exports===ep,em=eg&&el.process,ev=function(){try{return eA&&eA.require&&eA.require("util").types||em&&em.binding&&em.binding("util")}catch(t){}}(),ey=ev&&ev.isArrayBuffer,e$=ev&&ev.isDate,e8=ev&&ev.isMap,eb=ev&&ev.isRegExp,eC=ev&&ev.isSet,e_=ev&&ev.isTypedArray;function eO(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function eE(t,e,r,o){for(var a=-1,s=null==t?0:t.length;++a<s;){var l=t[a];e(o,l,r(l),t)}return o}function eS(t,e){for(var r=-1,o=null==t?0:t.length;++r<o&&!1!==e(t[r],r,t););return t}function ew(t,e){for(var r=null==t?0:t.length;r--&&!1!==e(t[r],r,t););return t}function eI(t,e){for(var r=-1,o=null==t?0:t.length;++r<o;)if(!e(t[r],r,t))return!1;return!0}function eR(t,e){for(var r=-1,o=null==t?0:t.length,a=0,s=[];++r<o;){var l=t[r];e(l,r,t)&&(s[a++]=l)}return s}function eM(t,e){return!!(null==t?0:t.length)&&e1(t,e,0)>-1}function eT(t,e,r){for(var o=-1,a=null==t?0:t.length;++o<a;)if(r(e,t[o]))return!0;return!1}function eP(t,e){for(var r=-1,o=null==t?0:t.length,a=Array(o);++r<o;)a[r]=e(t[r],r,t);return a}function ek(t,e){for(var r=-1,o=e.length,a=t.length;++r<o;)t[a+r]=e[r];return t}function e0(t,e,r,o){var a=-1,s=null==t?0:t.length;for(o&&s&&(r=t[++a]);++a<s;)r=e(r,t[a],a,t);return r}function eB(t,e,r,o){var a=null==t?0:t.length;for(o&&a&&(r=t[--a]);a--;)r=e(r,t[a],a,t);return r}function eL(t,e){for(var r=-1,o=null==t?0:t.length;++r<o;)if(e(t[r],r,t))return!0;return!1}var e2=eU("length");function eD(t,e,r){var o;return r(t,function(t,r,a){if(e(t,r,a))return o=r,!1}),o}function ex(t,e,r,o){for(var a=t.length,s=r+(o?1:-1);o?s--:++s<a;)if(e(t[s],s,t))return s;return -1}function e1(t,e,r){return e==e?function t(e,r,o){for(var a=o-1,s=e.length;++a<s;)if(e[a]===r)return a;return -1}(t,e,r):ex(t,eN,r)}function eF(t,e,r,o){for(var a=r-1,s=t.length;++a<s;)if(o(t[a],e))return a;return -1}function eN(t){return t!=t}function eG(t,e){var r=null==t?0:t.length;return r?e6(t,e)/r:g}function eU(t){return function(e){return null==e?r:e[t]}}function e4(t){return function(e){return null==t?r:t[e]}}function e3(t,e,r,o,a){return a(t,function(t,a,s){r=o?(o=!1,t):e(r,t,a,s)}),r}function e6(t,e){for(var o,a=-1,s=t.length;++a<s;){var l=e(t[a]);l!==r&&(o=o===r?l:o+l)}return o}function eH(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}function e7(t){return t&&t.slice(0,nn(t)+1).replace(tA,"")}function ej(t){return function(e){return t(e)}}function eq(t,e){return eP(e,function(e){return t[e]})}function eW(t,e){return t.has(e)}function eV(t,e){for(var r=-1,o=t.length;++r<o&&e1(e,t[r],0)>-1;);return r}function ez(t,e){for(var r=t.length;r--&&e1(e,t[r],0)>-1;);return r}var eQ=e4({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),e5=e4({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function eJ(t){return"\\"+es[t]}function eK(t){return ee.test(t)}function eZ(t){var e=-1,r=Array(t.size);return t.forEach(function(t,o){r[++e]=[o,t]}),r}function eY(t,e){return function(r){return t(e(r))}}function eX(t,e){for(var r=-1,o=t.length,a=0,l=[];++r<o;){var f=t[r];(f===e||f===s)&&(t[r]=s,l[a++]=r)}return l}function e9(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function nt(t){return eK(t)?function t(e){for(var r=tX.lastIndex=0;tX.test(e);)++r;return r}(t):e2(t)}function ne(t){var e,r;return eK(t)?(r=t,r.match(tX)||[]):(e=t).split("")}function nn(t){for(var e=t.length;e--&&tg.test(t.charAt(e)););return e}var nr=e4({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),ni=function t(e){var tg,tP=(e=null==e?eh:ni.defaults(eh.Object(),e,ni.pick(eh,er))).Array,tk=e.Date,t0=e.Error,tB=e.Function,tL=e.Math,t2=e.Object,tD=e.RegExp,tx=e.String,t1=e.TypeError,tF=tP.prototype,tN=tB.prototype,tG=t2.prototype,tU=e["__core-js_shared__"],t4=tN.toString,t3=tG.hasOwnProperty,t6=0,tH=(tg=/[^.]+$/.exec(tU&&tU.keys&&tU.keys.IE_PROTO||""))?"Symbol(src)_1."+tg:"",t7=tG.toString,tj=t4.call(t2),tq=eh._,tW=tD("^"+t4.call(t3).replace(th,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tV=eg?e.Buffer:r,tz=e.Symbol,tQ=e.Uint8Array,t5=tV?tV.allocUnsafe:r,tJ=eY(t2.getPrototypeOf,t2),tK=t2.create,tX=tG.propertyIsEnumerable,ee=tF.splice,es=tz?tz.isConcatSpreadable:r,el=tz?tz.iterator:r,ed=tz?tz.toStringTag:r,ep=function(){try{var t=iD(t2,"defineProperty");return t({},"",{}),t}catch(e){}}(),eA=e.clearTimeout!==eh.clearTimeout&&e.clearTimeout,em=tk&&tk.now!==eh.Date.now&&tk.now,ev=e.setTimeout!==eh.setTimeout&&e.setTimeout,e2=tL.ceil,e4=tL.floor,no=t2.getOwnPropertySymbols,na=tV?tV.isBuffer:r,ns=e.isFinite,nu=tF.join,nc=eY(t2.keys,t2),nl=tL.max,nf=tL.min,nd=tk.now,nh=e.parseInt,np=tL.random,nA=tF.reverse,ng=iD(e,"DataView"),nm=iD(e,"Map"),nv=iD(e,"Promise"),ny=iD(e,"Set"),n$=iD(e,"WeakMap"),n8=iD(t2,"create"),nb=n$&&new n$,nC={},n_=oo(ng),nO=oo(nm),nE=oo(nv),nS=oo(ny),nw=oo(n$),nI=tz?tz.prototype:r,nR=nI?nI.valueOf:r,nM=nI?nI.toString:r;function nT(t){if(ay(t)&&!aa(t)&&!(t instanceof nB)){if(t instanceof n0)return t;if(t3.call(t,"__wrapped__"))return oa(t)}return new n0(t)}var nP=function(){function t(){}return function(e){if(!av(e))return{};if(tK)return tK(e);t.prototype=e;var o=new t;return t.prototype=r,o}}();function nk(){}function n0(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}function nB(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=m,this.__views__=[]}function nL(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function n2(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function nD(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function nx(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new nD;++e<r;)this.add(t[e])}function n1(t){var e=this.__data__=new n2(t);this.size=e.size}function nF(t,e){var r=aa(t),o=!r&&ao(t),a=!r&&!o&&al(t),s=!r&&!o&&!a&&aS(t),l=r||o||a||s,f=l?eH(t.length,tx):[],h=f.length;for(var p in t)(e||t3.call(t,p))&&!(l&&("length"==p||a&&("offset"==p||"parent"==p)||s&&("buffer"==p||"byteLength"==p||"byteOffset"==p)||i4(p,h)))&&f.push(p);return f}function nN(t){var e=t.length;return e?t[rI(0,e-1)]:r}function nG(t,e){return iX(it(t),nW(e,0,t.length))}function nU(t){return iX(it(t))}function n4(t,e,o){(o===r||an(t[e],o))&&(o!==r||e in t)||nj(t,e,o)}function n3(t,e,o){var a=t[e];t3.call(t,e)&&an(a,o)&&(o!==r||e in t)||nj(t,e,o)}function n6(t,e){for(var r=t.length;r--;)if(an(t[r][0],e))return r;return -1}function nH(t,e,r,o){return nJ(t,function(t,a,s){e(o,t,r(t),s)}),o}function n7(t,e){return t&&ie(e,a7(e),t)}function nj(t,e,r){"__proto__"==e&&ep?ep(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function nq(t,e){for(var o=-1,a=e.length,s=tP(a),l=null==t;++o<a;)s[o]=l?r:aU(t,e[o]);return s}function nW(t,e,o){return t==t&&(o!==r&&(t=t<=o?t:o),e!==r&&(t=t>=e?t:e)),t}function nV(t,e,o,a,s,l){var f,h=1&e,p=2&e;if(o&&(f=s?o(t,a,s,l):o(t)),f!==r)return f;if(!av(t))return t;var A=aa(t);if(A){if(f=(g=t,m=g.length,v=new g.constructor(m),m&&"string"==typeof g[0]&&t3.call(g,"index")&&(v.index=g.index,v.input=g.input),v),!h)return it(t,f)}else{var g,m,v,$,b,_,I,k,D,U=iF(t),H=U==R||U==M;if(al(t))return rJ(t,h);if(U==B||U==C||H&&!s){if(f=p||H?{}:iG(t),!h){return p?($=t,b=(k=f,D=t,k&&ie(D,aj(D),k)),ie($,i1($),b)):(_=t,I=n7(f,t),ie(_,ix(_),I))}}else{if(!ea[U])return s?t:{};f=function t(e,r,o){var a,s,l,f,h,p,A=e.constructor;switch(r){case j:return rK(e);case O:case w:return new A(+e);case q:return a=e,l=(s=o)?rK(a.buffer):a.buffer,new a.constructor(l,a.byteOffset,a.byteLength);case W:case V:case z:case Q:case J:case K:case Z:case Y:case X:return rZ(e,o);case T:return new A;case P:case N:return new A(e);case x:return(h=new(f=e).constructor(f.source,t_.exec(f))).lastIndex=f.lastIndex,h;case F:return new A;case G:return p=e,nR?t2(nR.call(p)):{}}}(t,U,h)}}l||(l=new n1);var tt=l.get(t);if(tt)return tt;l.set(t,f),a_(t)?t.forEach(function(r){f.add(nV(r,e,o,r,t,l))}):a$(t)&&t.forEach(function(r,a){f.set(a,nV(r,e,o,a,t,l))});var te=4&e?p?iM:iR:p?aj:a7,tn=A?r:te(t);return eS(tn||t,function(r,a){tn&&(r=t[a=r]),n3(f,a,nV(r,e,o,a,t,l))}),f}function nz(t,e,o){var a=o.length;if(null==t)return!a;for(t=t2(t);a--;){var s=o[a],l=e[s],f=t[s];if(f===r&&!(s in t)||!l(f))return!1}return!0}function nQ(t,e,a){if("function"!=typeof t)throw new t1(o);return iJ(function(){t.apply(r,a)},e)}function n5(t,e,r,o){var a=-1,s=eM,l=!0,f=t.length,h=[],p=e.length;if(!f)return h;r&&(e=eP(e,ej(r))),o?(s=eT,l=!1):e.length>=200&&(s=eW,l=!1,e=new nx(e));e:for(;++a<f;){var A=t[a],g=null==r?A:r(A);if(A=o||0!==A?A:0,l&&g==g){for(var m=p;m--;)if(e[m]===g)continue e;h.push(A)}else s(e,g,o)||h.push(A)}return h}nT.templateSettings={escape:ts,evaluate:tu,interpolate:tc,variable:"",imports:{_:nT}},nT.prototype=nk.prototype,nT.prototype.constructor=nT,n0.prototype=nP(nk.prototype),n0.prototype.constructor=n0,nB.prototype=nP(nk.prototype),nB.prototype.constructor=nB,nL.prototype.clear=function t(){this.__data__=n8?n8(null):{},this.size=0},nL.prototype.delete=function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r},nL.prototype.get=function t(e){var o=this.__data__;if(n8){var s=o[e];return s===a?r:s}return t3.call(o,e)?o[e]:r},nL.prototype.has=function t(e){var o=this.__data__;return n8?o[e]!==r:t3.call(o,e)},nL.prototype.set=function t(e,o){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=n8&&o===r?a:o,this},n2.prototype.clear=function t(){this.__data__=[],this.size=0},n2.prototype.delete=function t(e){var r=this.__data__,o=n6(r,e);return!(o<0)&&(o==r.length-1?r.pop():ee.call(r,o,1),--this.size,!0)},n2.prototype.get=function t(e){var o=this.__data__,a=n6(o,e);return a<0?r:o[a][1]},n2.prototype.has=function t(e){return n6(this.__data__,e)>-1},n2.prototype.set=function t(e,r){var o=this.__data__,a=n6(o,e);return a<0?(++this.size,o.push([e,r])):o[a][1]=r,this},nD.prototype.clear=function t(){this.size=0,this.__data__={hash:new nL,map:new(nm||n2),string:new nL}},nD.prototype.delete=function t(e){var r=iL(this,e).delete(e);return this.size-=r?1:0,r},nD.prototype.get=function t(e){return iL(this,e).get(e)},nD.prototype.has=function t(e){return iL(this,e).has(e)},nD.prototype.set=function t(e,r){var o=iL(this,e),a=o.size;return o.set(e,r),this.size+=o.size==a?0:1,this},nx.prototype.add=nx.prototype.push=function t(e){return this.__data__.set(e,a),this},nx.prototype.has=function t(e){return this.__data__.has(e)},n1.prototype.clear=function t(){this.__data__=new n2,this.size=0},n1.prototype.delete=function t(e){var r=this.__data__,o=r.delete(e);return this.size=r.size,o},n1.prototype.get=function t(e){return this.__data__.get(e)},n1.prototype.has=function t(e){return this.__data__.has(e)},n1.prototype.set=function t(e,r){var o=this.__data__;if(o instanceof n2){var a=o.__data__;if(!nm||a.length<199)return a.push([e,r]),this.size=++o.size,this;o=this.__data__=new nD(a)}return o.set(e,r),this.size=o.size,this};var nJ=io(rn),nK=io(rr,!0);function nZ(t,e){var r=!0;return nJ(t,function(t,o,a){return r=!!e(t,o,a)}),r}function nY(t,e,o){for(var a=-1,s=t.length;++a<s;){var l=t[a],f=e(l);if(null!=f&&(h===r?f==f&&!aE(f):o(f,h)))var h=f,p=l}return p}function nX(t,e){var r=[];return nJ(t,function(t,o,a){e(t,o,a)&&r.push(t)}),r}function n9(t,e,r,o,a){var s=-1,l=t.length;for(r||(r=iU),a||(a=[]);++s<l;){var f=t[s];e>0&&r(f)?e>1?n9(f,e-1,r,o,a):ek(a,f):o||(a[a.length]=f)}return a}var rt=ia(),re=ia(!0);function rn(t,e){return t&&rt(t,e,a7)}function rr(t,e){return t&&re(t,e,a7)}function ri(t,e){return eR(e,function(e){return aA(t[e])})}function ro(t,e){e=rz(e,t);for(var o=0,a=e.length;null!=t&&o<a;)t=t[oi(e[o++])];return o&&o==a?t:r}function ra(t,e,r){var o=e(t);return aa(t)?o:ek(o,r(t))}function rs(t){var e;return null==t?t===r?U:k:ed&&ed in t2(t)?function t(e){var o=t3.call(e,ed),a=e[ed];try{e[ed]=r;var s=!0}catch(l){}var f=t7.call(e);return s&&(o?e[ed]=a:delete e[ed]),f}(t):(e=t,t7.call(e))}function ru(t,e){return t>e}function rc(t,e){return null!=t&&t3.call(t,e)}function rl(t,e){return null!=t&&e in t2(t)}function rf(t,e,o){for(var a=o?eT:eM,s=t[0].length,l=t.length,f=l,h=tP(l),p=1/0,A=[];f--;){var g=t[f];f&&e&&(g=eP(g,ej(e))),p=nf(g.length,p),h[f]=!o&&(e||s>=120&&g.length>=120)?new nx(f&&g):r}g=t[0];var m=-1,v=h[0];e:for(;++m<s&&A.length<p;){var $=g[m],b=e?e($):$;if($=o||0!==$?$:0,!(v?eW(v,b):a(A,b,o))){for(f=l;--f;){var C=h[f];if(!(C?eW(C,b):a(t[f],b,o)))continue e}v&&v.push(b),A.push($)}}return A}function rd(t,e,o){e=rz(e,t);var a=null==(t=iz(t,e))?t:t[oi(om(e))];return null==a?r:eO(a,t,o)}function rh(t){return ay(t)&&rs(t)==C}function rp(t,e,o,a,s){return t===e||(null!=t&&null!=e&&(ay(t)||ay(e))?function t(e,o,a,s,f,h){var p=aa(e),A=aa(o),g=p?_:iF(e),m=A?_:iF(o);g=g==C?B:g,m=m==C?B:m;var v=g==B,$=m==B,b=g==m;if(b&&al(e)){if(!al(o))return!1;p=!0,v=!1}if(b&&!v)return h||(h=new n1),p||aS(e)?iw(e,o,a,s,f,h):function t(e,r,o,a,s,f,h){switch(o){case q:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)break;e=e.buffer,r=r.buffer;case j:return!(e.byteLength!=r.byteLength||!f(new tQ(e),new tQ(r)));case O:case w:case P:return an(+e,+r);case I:return e.name==r.name&&e.message==r.message;case x:case N:return e==r+"";case T:var p=eZ;case F:var A=1&a;if(p||(p=e9),e.size!=r.size&&!A)break;var g=h.get(e);if(g)return g==r;a|=l,h.set(e,r);var m=iw(p(e),p(r),a,s,f,h);return h.delete(e),m;case G:if(nR)return nR.call(e)==nR.call(r)}return!1}(e,o,g,a,s,f,h);if(!(1&a)){var R=v&&t3.call(e,"__wrapped__"),M=$&&t3.call(o,"__wrapped__");if(R||M){var k=R?e.value():e,D=M?o.value():o;return h||(h=new n1),f(k,D,a,s,h)}}return!!b&&(h||(h=new n1),function t(e,o,a,s,l,f){var h=1&a,p=iR(e),A=p.length,g=iR(o).length;if(A!=g&&!h)return!1;for(var m=A;m--;){var v=p[m];if(!(h?v in o:t3.call(o,v)))return!1}var $=f.get(e),b=f.get(o);if($&&b)return $==o&&b==e;var C=!0;f.set(e,o),f.set(o,e);for(var _=h;++m<A;){var O=e[v=p[m]],w=o[v];if(s)var I=h?s(w,O,v,o,e,f):s(O,w,v,e,o,f);if(!(I===r?O===w||l(O,w,a,s,f):I)){C=!1;break}_||(_="constructor"==v)}if(C&&!_){var R=e.constructor,M=o.constructor;R!=M&&"constructor"in e&&"constructor"in o&&!("function"==typeof R&&R instanceof R&&"function"==typeof M&&M instanceof M)&&(C=!1)}return f.delete(e),f.delete(o),C}(e,o,a,s,f,h))}(t,e,o,a,rp,s):t!=t&&e!=e)}function rA(t,e,o,a){var s=o.length,f=s,h=!a;if(null==t)return!f;for(t=t2(t);s--;){var p=o[s];if(h&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++s<f;){var A=(p=o[s])[0],g=t[A],m=p[1];if(h&&p[2]){if(g===r&&!(A in t))return!1}else{var v=new n1;if(a)var $=a(g,m,A,t,e,v);if(!($===r?rp(m,g,1|l,a,v):$))return!1}}return!0}function rg(t){var e;return!!av(t)&&(e=t,!tH||!(tH in e))&&(aA(t)?tW:tS).test(oo(t))}function rm(t){return"function"==typeof t?t:null==t?sd:"object"==typeof t?aa(t)?rb(t[0],t[1]):r8(t):s8(t)}function rv(t){if(!ij(t))return nc(t);var e=[];for(var r in t2(t))t3.call(t,r)&&"constructor"!=r&&e.push(r);return e}function ry(t,e){return t<e}function r$(t,e){var r=-1,o=au(t)?tP(t.length):[];return nJ(t,function(t,a,s){o[++r]=e(t,a,s)}),o}function r8(t){var e=i2(t);return 1==e.length&&e[0][2]?iW(e[0][0],e[0][1]):function(r){return r===t||rA(r,t,e)}}function rb(t,e){return i6(t)&&iq(e)?iW(oi(t),e):function(o){var a=aU(o,t);return a===r&&a===e?a4(o,t):rp(e,a,1|l)}}function rC(t,e,o,a,s){t!==e&&rt(e,function(l,f){if(s||(s=new n1),av(l))(function t(e,o,a,s,l,f,h){var p=iQ(e,a),A=iQ(o,a),g=h.get(A);if(g){n4(e,a,g);return}var m=f?f(p,A,a+"",e,o,h):r,v=m===r;if(v){var $=aa(A),b=!$&&al(A),C=!$&&!b&&aS(A);m=A,$||b||C?aa(p)?m=p:ac(p)?m=it(p):b?(v=!1,m=rJ(A,!0)):C?(v=!1,m=rZ(A,!0)):m=[]:ab(A)||ao(A)?(m=p,ao(p)?m=aB(p):(!av(p)||aA(p))&&(m=iG(A))):v=!1}v&&(h.set(A,m),l(m,A,s,f,h),h.delete(A)),n4(e,a,m)})(t,e,f,o,rC,a,s);else{var h=a?a(iQ(t,f),l,f+"",t,e,s):r;h===r&&(h=l),n4(t,f,h)}},aj)}function r_(t,e){var o=t.length;if(o)return i4(e+=e<0?o:0,o)?t[e]:r}function rO(t,e,r){e=e.length?eP(e,function(t){return aa(t)?function(e){return ro(e,1===t.length?t[0]:t)}:t}):[sd];var o=-1;return e=eP(e,ej(iB())),function t(e,r){var o=e.length;for(e.sort(r);o--;)e[o]=e[o].value;return e}(r$(t,function(t,r,a){return{criteria:eP(e,function(e){return e(t)}),index:++o,value:t}}),function(t,e){return function t(e,r,o){for(var a=-1,s=e.criteria,l=r.criteria,f=s.length,h=o.length;++a<f;){var p=rY(s[a],l[a]);if(p){if(a>=h)return p;return p*("desc"==o[a]?-1:1)}}return e.index-r.index}(t,e,r)})}function rE(t,e,r){for(var o=-1,a=e.length,s={};++o<a;){var l=e[o],f=ro(t,l);r(f,l)&&rk(s,rz(l,t),f)}return s}function rS(t,e,r,o){var a=o?eF:e1,s=-1,l=e.length,f=t;for(t===e&&(e=it(e)),r&&(f=eP(t,ej(r)));++s<l;)for(var h=0,p=e[s],A=r?r(p):p;(h=a(f,A,h,o))>-1;)f!==t&&ee.call(f,h,1),ee.call(t,h,1);return t}function rw(t,e){for(var r=t?e.length:0,o=r-1;r--;){var a=e[r];if(r==o||a!==s){var s=a;i4(a)?ee.call(t,a,1):r3(t,a)}}return t}function rI(t,e){return t+e4(np()*(e-t+1))}function rR(t,e){var r="";if(!t||e<1||e>9007199254740991)return r;do e%2&&(r+=t),(e=e4(e/2))&&(t+=t);while(e);return r}function rM(t,e){return iK(iV(t,e,sd),t+"")}function rT(t){return nN(aK(t))}function rP(t,e){var r=aK(t);return iX(r,nW(e,0,r.length))}function rk(t,e,o,a){if(!av(t))return t;e=rz(e,t);for(var s=-1,l=e.length,f=l-1,h=t;null!=h&&++s<l;){var p=oi(e[s]),A=o;if("__proto__"===p||"constructor"===p||"prototype"===p)break;if(s!=f){var g=h[p];(A=a?a(g,p,h):r)===r&&(A=av(g)?g:i4(e[s+1])?[]:{})}n3(h,p,A),h=h[p]}return t}var rB=nb?function(t,e){return nb.set(t,e),t}:sd,rL=ep?function(t,e){return ep(t,"toString",{configurable:!0,enumerable:!1,value:sc(e),writable:!0})}:sd;function r2(t){return iX(aK(t))}function rD(t,e,r){var o=-1,a=t.length;e<0&&(e=-e>a?0:a+e),(r=r>a?a:r)<0&&(r+=a),a=e>r?0:r-e>>>0,e>>>=0;for(var s=tP(a);++o<a;)s[o]=t[o+e];return s}function rx(t,e){var r;return nJ(t,function(t,o,a){return!(r=e(t,o,a))}),!!r}function r1(t,e,r){var o=0,a=null==t?o:t.length;if("number"==typeof e&&e==e&&a<=$){for(;o<a;){var s=o+a>>>1,l=t[s];null!==l&&!aE(l)&&(r?l<=e:l<e)?o=s+1:a=s}return a}return rF(t,e,sd,r)}function rF(t,e,o,a){var s=0,l=null==t?0:t.length;if(0===l)return 0;e=o(e);for(var f=e!=e,h=null===e,p=aE(e),A=e===r;s<l;){var g=e4((s+l)/2),m=o(t[g]),$=m!==r,b=null===m,C=m==m,_=aE(m);if(f)var O=a||C;else O=A?C&&(a||$):h?C&&$&&(a||!b):p?C&&$&&!b&&(a||!_):!b&&!_&&(a?m<=e:m<e);O?s=g+1:l=g}return nf(l,v)}function rN(t,e){for(var r=-1,o=t.length,a=0,s=[];++r<o;){var l=t[r],f=e?e(l):l;if(!r||!an(f,h)){var h=f;s[a++]=0===l?0:l}}return s}function rG(t){return"number"==typeof t?t:aE(t)?g:+t}function rU(t){if("string"==typeof t)return t;if(aa(t))return eP(t,rU)+"";if(aE(t))return nM?nM.call(t):"";var e=t+"";return"0"==e&&1/t==-A?"-0":e}function r4(t,e,r){var o=-1,a=eM,s=t.length,l=!0,f=[],h=f;if(r)l=!1,a=eT;else if(s>=200){var p=e?null:ib(t);if(p)return e9(p);l=!1,a=eW,h=new nx}else h=e?[]:f;e:for(;++o<s;){var A=t[o],g=e?e(A):A;if(A=r||0!==A?A:0,l&&g==g){for(var m=h.length;m--;)if(h[m]===g)continue e;e&&h.push(g),f.push(A)}else a(h,g,r)||(h!==f&&h.push(g),f.push(A))}return f}function r3(t,e){return e=rz(e,t),null==(t=iz(t,e))||delete t[oi(om(e))]}function r6(t,e,r,o){return rk(t,e,r(ro(t,e)),o)}function rH(t,e,r,o){for(var a=t.length,s=o?a:-1;(o?s--:++s<a)&&e(t[s],s,t););return r?rD(t,o?0:s,o?s+1:a):rD(t,o?s+1:0,o?a:s)}function r7(t,e){var r=t;return r instanceof nB&&(r=r.value()),e0(e,function(t,e){return e.func.apply(e.thisArg,ek([t],e.args))},r)}function rj(t,e,r){var o=t.length;if(o<2)return o?r4(t[0]):[];for(var a=-1,s=tP(o);++a<o;)for(var l=t[a],f=-1;++f<o;)f!=a&&(s[a]=n5(s[a]||l,t[f],e,r));return r4(n9(s,1),e,r)}function rq(t,e,o){for(var a=-1,s=t.length,l=e.length,f={};++a<s;){var h=a<l?e[a]:r;o(f,t[a],h)}return f}function rW(t){return ac(t)?t:[]}function rV(t){return"function"==typeof t?t:sd}function rz(t,e){return aa(t)?t:i6(t,e)?[t]:or(aL(t))}function rQ(t,e,o){var a=t.length;return o=o===r?a:o,!e&&o>=a?t:rD(t,e,o)}var r5=eA||function(t){return eh.clearTimeout(t)};function rJ(t,e){if(e)return t.slice();var r=t.length,o=t5?t5(r):new t.constructor(r);return t.copy(o),o}function rK(t){var e=new t.constructor(t.byteLength);return new tQ(e).set(new tQ(t)),e}function rZ(t,e){var r=e?rK(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function rY(t,e){if(t!==e){var o=t!==r,a=null===t,s=t==t,l=aE(t),f=e!==r,h=null===e,p=e==e,A=aE(e);if(!h&&!A&&!l&&t>e||l&&f&&p&&!h&&!A||a&&f&&p||!o&&p||!s)return 1;if(!a&&!l&&!A&&t<e||A&&o&&s&&!a&&!l||h&&o&&s||!f&&s||!p)return -1}return 0}function rX(t,e,r,o){for(var a=-1,s=t.length,l=r.length,f=-1,h=e.length,p=nl(s-l,0),A=tP(h+p),g=!o;++f<h;)A[f]=e[f];for(;++a<l;)(g||a<s)&&(A[r[a]]=t[a]);for(;p--;)A[f++]=t[a++];return A}function r9(t,e,r,o){for(var a=-1,s=t.length,l=-1,f=r.length,h=-1,p=e.length,A=nl(s-f,0),g=tP(A+p),m=!o;++a<A;)g[a]=t[a];for(var v=a;++h<p;)g[v+h]=e[h];for(;++l<f;)(m||a<s)&&(g[v+r[l]]=t[a++]);return g}function it(t,e){var r=-1,o=t.length;for(e||(e=tP(o));++r<o;)e[r]=t[r];return e}function ie(t,e,o,a){var s=!o;o||(o={});for(var l=-1,f=e.length;++l<f;){var h=e[l],p=a?a(o[h],t[h],h,o,t):r;p===r&&(p=t[h]),s?nj(o,h,p):n3(o,h,p)}return o}function ir(t,e){return function(r,o){var a=aa(r)?eE:nH,s=e?e():{};return a(r,t,iB(o,2),s)}}function ii(t){return rM(function(e,o){var a=-1,s=o.length,l=s>1?o[s-1]:r,f=s>2?o[2]:r;for(l=t.length>3&&"function"==typeof l?(s--,l):r,f&&i3(o[0],o[1],f)&&(l=s<3?r:l,s=1),e=t2(e);++a<s;){var h=o[a];h&&t(e,h,a,l)}return e})}function io(t,e){return function(r,o){if(null==r)return r;if(!au(r))return t(r,o);for(var a=r.length,s=e?a:-1,l=t2(r);(e?s--:++s<a)&&!1!==o(l[s],s,l););return r}}function ia(t){return function(e,r,o){for(var a=-1,s=t2(e),l=o(e),f=l.length;f--;){var h=l[t?f:++a];if(!1===r(s[h],h,s))break}return e}}function is(t){return function(e){e=aL(e);var o=eK(e)?ne(e):r,a=o?o[0]:e.charAt(0),s=o?rQ(o,1).join(""):e.slice(1);return a[t]()+s}}function iu(t){return function(e){return e0(sa(aX(e).replace(tZ,"")),t,"")}}function ic(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=nP(t.prototype),o=t.apply(r,e);return av(o)?o:r}}function il(t){return function(e,o,a){var s=t2(e);if(!au(e)){var l=iB(o,3);e=a7(e),o=function(t){return l(s[t],t,s)}}var f=t(e,o,a);return f>-1?s[l?e[f]:f]:r}}function id(t){return iI(function(e){var a=e.length,s=a,l=n0.prototype.thru;for(t&&e.reverse();s--;){var h=e[s];if("function"!=typeof h)throw new t1(o);if(l&&!p&&"wrapper"==iP(h))var p=new n0([],!0)}for(s=p?s:a;++s<a;){var A=iP(h=e[s]),g="wrapper"==A?iT(h):r;p=g&&iH(g[0])&&g[1]==(136|f|256)&&!g[4].length&&1==g[9]?p[iP(g[0])].apply(p,g[3]):1==h.length&&iH(h)?p[A]():p.thru(h)}return function(){var t=arguments,r=t[0];if(p&&1==t.length&&aa(r))return p.plant(r).value();for(var o=0,s=a?e[o].apply(this,t):r;++o<a;)s=e[o].call(this,s);return s}})}function ih(t,e,o,a,s,l,f,h,p,A){var g=128&e,m=1&e,v=2&e,$=24&e,b=512&e,C=v?r:ic(t);function _(){for(var O=arguments.length,w=tP(O),I=O;I--;)w[I]=arguments[I];if($)var R=ik(_),M=function t(e,r){for(var o=e.length,a=0;o--;)e[o]===r&&++a;return a}(w,R);if(a&&(w=rX(w,a,s,$)),l&&(w=r9(w,l,f,$)),O-=M,$&&O<A){var T=eX(w,R);return i$(t,e,ih,_.placeholder,o,w,T,h,p,A-O)}var P=m?o:this,k=v?P[t]:t;return O=w.length,h?w=function t(e,o){for(var a=e.length,s=nf(o.length,a),l=it(e);s--;){var f=o[s];e[s]=i4(f,a)?l[f]:r}return e}(w,h):b&&O>1&&w.reverse(),g&&p<O&&(w.length=p),this&&this!==eh&&this instanceof _&&(k=C||ic(k)),k.apply(P,w)}return _}function ip(t,e){return function(r,o){var a,s,l,f;return a=r,s=t,l=e(o),f={},rn(a,function(t,e,r){s(f,l(t),e,r)}),f}}function iA(t,e){return function(o,a){var s;if(o===r&&a===r)return e;if(o!==r&&(s=o),a!==r){if(s===r)return a;"string"==typeof o||"string"==typeof a?(o=rU(o),a=rU(a)):(o=rG(o),a=rG(a)),s=t(o,a)}return s}}function ig(t){return iI(function(e){return e=eP(e,ej(iB())),rM(function(r){var o=this;return t(e,function(t){return eO(t,o,r)})})})}function im(t,e){var o=(e=e===r?" ":rU(e)).length;if(o<2)return o?rR(e,t):e;var a=rR(e,e2(t/nt(e)));return eK(e)?rQ(ne(a),0,t).join(""):a.slice(0,t)}function iv(t){return function(e,o,a){return a&&"number"!=typeof a&&i3(e,o,a)&&(o=a=r),e=aM(e),o===r?(o=e,e=0):o=aM(o),a=a===r?e<o?1:-1:aM(a),function t(e,r,o,a){for(var s=-1,l=nl(e2((r-e)/(o||1)),0),f=tP(l);l--;)f[a?l:++s]=e,e+=o;return f}(e,o,a,t)}}function iy(t){return function(e,r){return"string"==typeof e&&"string"==typeof r||(e=ak(e),r=ak(r)),t(e,r)}}function i$(t,e,o,a,s,l,p,A,g,m){var v=8&e,$=v?p:r,b=v?r:p,C=v?l:r,_=v?r:l;e|=v?f:h,4&(e&=~(v?h:f))||(e&=-4);var O=[t,e,s,C,$,_,b,A,g,m],w=o.apply(r,O);return iH(t)&&i5(w,O),w.placeholder=a,iZ(w,t,e)}function i8(t){var e=tL[t];return function(t,r){if(t=ak(t),(r=null==r?0:nf(aT(r),292))&&ns(t)){var o=(aL(t)+"e").split("e");return+((o=(aL(e(o[0]+"e"+(+o[1]+r)))+"e").split("e"))[0]+"e"+(+o[1]-r))}return e(t)}}var ib=ny&&1/e9(new ny([,-0]))[1]==A?function(t){return new ny(t)}:sm;function iC(t){return function(e){var r,o,a,s,l,f=iF(e);return f==T?eZ(e):f==F?(r=e,o=-1,a=Array(r.size),r.forEach(function(t){a[++o]=[t,t]}),a):(s=e,l=t(e),eP(l,function(t){return[t,s[t]]}))}}function i_(t,e,a,l,p,A,g,m){var v=2&e;if(!v&&"function"!=typeof t)throw new t1(o);var $=l?l.length:0;if($||(e&=~(f|h),l=p=r),g=g===r?g:nl(aT(g),0),m=m===r?m:aT(m),$-=p?p.length:0,e&h){var b=l,C=p;l=p=r}var _=v?r:iT(t),O=[t,e,a,l,p,b,C,A,g,m];if(_&&function t(e,r){var o=e[1],a=r[1],l=o|a,f=l<131,h=128==a&&8==o||128==a&&256==o&&e[7].length<=r[8]||384==a&&r[7].length<=r[8]&&8==o;if(!(f||h))return e;1&a&&(e[2]=r[2],l|=1&o?0:4);var p=r[3];if(p){var A=e[3];e[3]=A?rX(A,p,r[4]):p,e[4]=A?eX(e[3],s):r[4]}return(p=r[5])&&(A=e[5],e[5]=A?r9(A,p,r[6]):p,e[6]=A?eX(e[5],s):r[6]),(p=r[7])&&(e[7]=p),128&a&&(e[8]=null==e[8]?r[8]:nf(e[8],r[8])),null==e[9]&&(e[9]=r[9]),e[0]=r[0],e[1]=l,e}(O,_),t=O[0],e=O[1],a=O[2],l=O[3],p=O[4],(m=O[9]=O[9]===r?v?0:t.length:nl(O[9]-$,0))||!(24&e)||(e&=-25),e&&1!=e)N=8==e||16==e?function t(e,o,a){var s=ic(e);function l(){for(var t=arguments.length,f=tP(t),h=t,p=ik(l);h--;)f[h]=arguments[h];var A=t<3&&f[0]!==p&&f[t-1]!==p?[]:eX(f,p);if((t-=A.length)<a)return i$(e,o,ih,l.placeholder,r,f,A,r,r,a-t);var g=this&&this!==eh&&this instanceof l?s:e;return eO(g,this,f)}return l}(t,e,m):e!=f&&e!=(1|f)||p.length?ih.apply(r,O):(w=t,I=e,R=a,M=l,T=1&I,P=ic(w),function t(){for(var e=-1,r=arguments.length,o=-1,a=M.length,s=tP(a+r),l=this&&this!==eh&&this instanceof t?P:w;++o<a;)s[o]=M[o];for(;r--;)s[o++]=arguments[++e];return eO(l,T?R:this,s)});else var w,I,R,M,T,P,k,B,D,x,F,N=(k=t,B=e,D=a,x=1&B,F=ic(k),function t(){return(this&&this!==eh&&this instanceof t?F:k).apply(x?D:this,arguments)});var G=_?rB:i5;return iZ(G(N,O),t,e)}function iO(t,e,o,a){return t===r||an(t,tG[o])&&!t3.call(a,o)?e:t}function iE(t,e,o,a,s,l){return av(t)&&av(e)&&(l.set(e,t),rC(t,e,r,iE,l),l.delete(e)),t}function iS(t){return ab(t)?r:t}function iw(t,e,o,a,s,f){var h=1&o,p=t.length,A=e.length;if(p!=A&&!(h&&A>p))return!1;var g=f.get(t),m=f.get(e);if(g&&m)return g==e&&m==t;var v=-1,$=!0,b=o&l?new nx:r;for(f.set(t,e),f.set(e,t);++v<p;){var C=t[v],_=e[v];if(a)var O=h?a(_,C,v,e,t,f):a(C,_,v,t,e,f);if(O!==r){if(O)continue;$=!1;break}if(b){if(!eL(e,function(t,e){if(!eW(b,e)&&(C===t||s(C,t,o,a,f)))return b.push(e)})){$=!1;break}}else if(!(C===_||s(C,_,o,a,f))){$=!1;break}}return f.delete(t),f.delete(e),$}function iI(t){return iK(iV(t,r,od),t+"")}function iR(t){return ra(t,a7,ix)}function iM(t){return ra(t,aj,i1)}var iT=nb?function(t){return nb.get(t)}:sm;function iP(t){for(var e=t.name+"",r=nC[e],o=t3.call(nC,e)?r.length:0;o--;){var a=r[o],s=a.func;if(null==s||s==t)return a.name}return e}function ik(t){return(t3.call(nT,"placeholder")?nT:t).placeholder}function iB(){var t=nT.iteratee||sh;return t=t===sh?rm:t,arguments.length?t(arguments[0],arguments[1]):t}function iL(t,e){var r,o,a=t.__data__;return(r=e,o=typeof r,"string"==o||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==r:null===r)?a["string"==typeof e?"string":"hash"]:a.map}function i2(t){for(var e=a7(t),r=e.length;r--;){var o=e[r],a=t[o];e[r]=[o,a,iq(a)]}return e}function iD(t,e){var o,a,s=(o=t,a=e,null==o?r:o[a]);return rg(s)?s:r}var ix=no?function(t){return null==t?[]:(t=t2(t),eR(no(t),function(e){return tX.call(t,e)}))}:s_,i1=no?function(t){for(var e=[];t;)ek(e,ix(t)),t=tJ(t);return e}:s_,iF=rs;function iN(t,e,r){e=rz(e,t);for(var o=-1,a=e.length,s=!1;++o<a;){var l=oi(e[o]);if(!(s=null!=t&&r(t,l)))break;t=t[l]}return s||++o!=a?s:!!(a=null==t?0:t.length)&&am(a)&&i4(l,a)&&(aa(t)||ao(t))}function iG(t){return"function"!=typeof t.constructor||ij(t)?{}:nP(tJ(t))}function iU(t){return aa(t)||ao(t)||!!(es&&t&&t[es])}function i4(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&tI.test(t))&&t>-1&&t%1==0&&t<e}function i3(t,e,r){if(!av(r))return!1;var o=typeof e;return("number"==o?!!(au(r)&&i4(e,r.length)):"string"==o&&e in r)&&an(r[e],t)}function i6(t,e){if(aa(t))return!1;var r=typeof t;return!!("number"==r||"symbol"==r||"boolean"==r||null==t||aE(t))||tf.test(t)||!tl.test(t)||null!=e&&t in t2(e)}function iH(t){var e=iP(t),r=nT[e];if("function"!=typeof r||!(e in nB.prototype))return!1;if(t===r)return!0;var o=iT(r);return!!o&&t===o[0]}(ng&&iF(new ng(new ArrayBuffer(1)))!=q||nm&&iF(new nm)!=T||nv&&iF(nv.resolve())!=D||ny&&iF(new ny)!=F||n$&&iF(new n$)!=H)&&(iF=function(t){var e=rs(t),o=e==B?t.constructor:r,a=o?oo(o):"";if(a)switch(a){case n_:return q;case nO:return T;case nE:return D;case nS:return F;case nw:return H}return e});var i7=tU?aA:sO;function ij(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||tG)}function iq(t){return t==t&&!av(t)}function iW(t,e){return function(o){return null!=o&&o[t]===e&&(e!==r||t in t2(o))}}function iV(t,e,o){return e=nl(e===r?t.length-1:e,0),function(){for(var r=arguments,a=-1,s=nl(r.length-e,0),l=tP(s);++a<s;)l[a]=r[e+a];a=-1;for(var f=tP(e+1);++a<e;)f[a]=r[a];return f[e]=o(l),eO(t,this,f)}}function iz(t,e){return e.length<2?t:ro(t,rD(e,0,-1))}function iQ(t,e){if(!("constructor"===e&&"function"==typeof t[e])&&"__proto__"!=e)return t[e]}var i5=iY(rB),iJ=ev||function(t,e){return eh.setTimeout(t,e)},iK=iY(rL);function iZ(t,e,r){var o,a,s,l,f=e+"";return iK(t,function t(e,r){var o=r.length;if(!o)return e;var a=o-1;return r[a]=(o>1?"& ":"")+r[a],r=r.join(o>2?", ":" "),e.replace(tm,`{
/* [wrapped with `+r+`] */
`)}(f,(s=(a=(o=f).match(tv))?a[1].split(ty):[],l=r,eS(b,function(t){var e="_."+t[0];l&t[1]&&!eM(s,e)&&s.push(e)}),s.sort())))}function iY(t){var e=0,o=0;return function(){var a=nd(),s=16-(a-o);if(o=a,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(r,arguments)}}function iX(t,e){var o=-1,a=t.length,s=a-1;for(e=e===r?a:e;++o<e;){var l=rI(o,s),f=t[l];t[l]=t[o],t[o]=f}return t.length=e,t}var i9,ot,on,or=(on=(ot=oZ(i9=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(td,function(t,r,o,a){e.push(o?a.replace(tb,"$1"):r||t)}),e},function(t){return 500===on.size&&on.clear(),t})).cache,ot);function oi(t){if("string"==typeof t||aE(t))return t;var e=t+"";return"0"==e&&1/t==-A?"-0":e}function oo(t){if(null!=t){try{return t4.call(t)}catch(e){}try{return t+""}catch(r){}}return""}function oa(t){if(t instanceof nB)return t.clone();var e=new n0(t.__wrapped__,t.__chain__);return e.__actions__=it(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var os=rM(function(t,e){return ac(t)?n5(t,n9(e,1,ac,!0)):[]}),ou=rM(function(t,e){var o=om(e);return ac(o)&&(o=r),ac(t)?n5(t,n9(e,1,ac,!0),iB(o,2)):[]}),oc=rM(function(t,e){var o=om(e);return ac(o)&&(o=r),ac(t)?n5(t,n9(e,1,ac,!0),r,o):[]});function ol(t,e,r){var o=null==t?0:t.length;if(!o)return -1;var a=null==r?0:aT(r);return a<0&&(a=nl(o+a,0)),ex(t,iB(e,3),a)}function of(t,e,o){var a=null==t?0:t.length;if(!a)return -1;var s=a-1;return o!==r&&(s=aT(o),s=o<0?nl(a+s,0):nf(s,a-1)),ex(t,iB(e,3),s,!0)}function od(t){return(null==t?0:t.length)?n9(t,1):[]}function oh(t){return t&&t.length?t[0]:r}var op=rM(function(t){var e=eP(t,rW);return e.length&&e[0]===t[0]?rf(e):[]}),oA=rM(function(t){var e=om(t),o=eP(t,rW);return e===om(o)?e=r:o.pop(),o.length&&o[0]===t[0]?rf(o,iB(e,2)):[]}),og=rM(function(t){var e=om(t),o=eP(t,rW);return(e="function"==typeof e?e:r)&&o.pop(),o.length&&o[0]===t[0]?rf(o,r,e):[]});function om(t){var e=null==t?0:t.length;return e?t[e-1]:r}var ov=rM(oy);function oy(t,e){return t&&t.length&&e&&e.length?rS(t,e):t}var o$=iI(function(t,e){var r=null==t?0:t.length,o=nq(t,e);return rw(t,eP(e,function(t){return i4(t,r)?+t:t}).sort(rY)),o});function o8(t){return null==t?t:nA.call(t)}function ob(t,e){return r1(t,e)}var oC=rM(function(t){return r4(n9(t,1,ac,!0))}),o_=rM(function(t){var e=om(t);return ac(e)&&(e=r),r4(n9(t,1,ac,!0),iB(e,2))}),oO=rM(function(t){var e=om(t);return e="function"==typeof e?e:r,r4(n9(t,1,ac,!0),r,e)});function oE(t){if(!(t&&t.length))return[];var e=0;return t=eR(t,function(t){if(ac(t))return e=nl(t.length,e),!0}),eH(e,function(e){return eP(t,eU(e))})}function oS(t,e){if(!(t&&t.length))return[];var o=oE(t);return null==e?o:eP(o,function(t){return eO(e,r,t)})}var ow=rM(function(t,e){return ac(t)?n5(t,e):[]}),oI=rM(function(t){return rj(eR(t,ac))}),oR=rM(function(t){var e=om(t);return ac(e)&&(e=r),rj(eR(t,ac),iB(e,2))}),oM=rM(function(t){var e=om(t);return e="function"==typeof e?e:r,rj(eR(t,ac),r,e)}),oT=rM(oE),oP=rM(function(t){var e=t.length,o=e>1?t[e-1]:r;return o="function"==typeof o?(t.pop(),o):r,oS(t,o)});function ok(t){var e=nT(t);return e.__chain__=!0,e}function oB(t,e){return e(t),t}function oL(t,e){return e(t)}var o2=iI(function(t){var e=t.length,o=e?t[0]:0,a=this.__wrapped__,s=function(e){return nq(e,t)};return!(e>1)&&!this.__actions__.length&&a instanceof nB&&i4(o)?((a=a.slice(o,+o+(e?1:0))).__actions__.push({func:oL,args:[s],thisArg:r}),new n0(a,this.__chain__).thru(function(t){return e&&!t.length&&t.push(r),t})):this.thru(s)}),oD=ir(function(t,e,r){t3.call(t,r)?++t[r]:nj(t,r,1)}),ox=il(ol),o1=il(of);function oF(t,e){return(aa(t)?eS:nJ)(t,iB(e,3))}function oN(t,e){return(aa(t)?ew:nK)(t,iB(e,3))}var oG=ir(function(t,e,r){t3.call(t,r)?t[r].push(e):nj(t,r,[e])}),oU=rM(function(t,e,r){var o=-1,a="function"==typeof e,s=au(t)?tP(t.length):[];return nJ(t,function(t){s[++o]=a?eO(e,t,r):rd(t,e,r)}),s}),o4=ir(function(t,e,r){nj(t,r,e)});function o3(t,e){return(aa(t)?eP:r$)(t,iB(e,3))}var o6=ir(function(t,e,r){t[r?0:1].push(e)},function(){return[[],[]]}),oH=rM(function(t,e){if(null==t)return[];var r=e.length;return r>1&&i3(t,e[0],e[1])?e=[]:r>2&&i3(e[0],e[1],e[2])&&(e=[e[0]]),rO(t,n9(e,1),[])}),o7=em||function(){return eh.Date.now()};function oj(t,e,o){return e=o?r:e,e=t&&null==e?t.length:e,i_(t,128,r,r,r,r,e)}function oq(t,e){var a;if("function"!=typeof e)throw new t1(o);return t=aT(t),function(){return--t>0&&(a=e.apply(this,arguments)),t<=1&&(e=r),a}}var oW=rM(function(t,e,r){var o=1;if(r.length){var a=eX(r,ik(oW));o|=f}return i_(t,o,e,r,a)}),oV=rM(function(t,e,r){var o=3;if(r.length){var a=eX(r,ik(oV));o|=f}return i_(e,o,t,r,a)});function oz(t,e,o){e=o?r:e;var a=i_(t,8,r,r,r,r,r,e);return a.placeholder=oz.placeholder,a}function oQ(t,e,o){e=o?r:e;var a=i_(t,16,r,r,r,r,r,e);return a.placeholder=oQ.placeholder,a}function o5(t,e,a){var s,l,f,h,p,A,g=0,m=!1,v=!1,$=!0;if("function"!=typeof t)throw new t1(o);function b(e){var o=s,a=l;return s=l=r,g=e,h=t.apply(a,o)}function C(t){var o=t-A,a=t-g;return A===r||o>=e||o<0||v&&a>=f}function _(){var t,r,o,a,s=o7();if(C(s))return O(s);p=iJ(_,(r=(t=s)-A,o=t-g,a=e-r,v?nf(a,f-o):a))}function O(t){return p=r,$&&s?b(t):(s=l=r,h)}function w(){var t,o=o7(),a=C(o);if(s=arguments,l=this,A=o,a){if(p===r)return g=t=A,p=iJ(_,e),m?b(t):h;if(v)return r5(p),p=iJ(_,e),b(A)}return p===r&&(p=iJ(_,e)),h}return e=ak(e)||0,av(a)&&(m=!!a.leading,f=(v="maxWait"in a)?nl(ak(a.maxWait)||0,e):f,$="trailing"in a?!!a.trailing:$),w.cancel=function t(){p!==r&&r5(p),g=0,s=A=l=p=r},w.flush=function t(){return p===r?h:O(o7())},w}var oJ=rM(function(t,e){return nQ(t,1,e)}),oK=rM(function(t,e,r){return nQ(t,ak(e)||0,r)});function oZ(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new t1(o);var r=function(){var o=arguments,a=e?e.apply(this,o):o[0],s=r.cache;if(s.has(a))return s.get(a);var l=t.apply(this,o);return r.cache=s.set(a,l)||s,l};return r.cache=new(oZ.Cache||nD),r}function oY(t){if("function"!=typeof t)throw new t1(o);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}oZ.Cache=nD;var oX=rM(function(t,e){var r=(e=1==e.length&&aa(e[0])?eP(e[0],ej(iB())):eP(n9(e,1),ej(iB()))).length;return rM(function(o){for(var a=-1,s=nf(o.length,r);++a<s;)o[a]=e[a].call(this,o[a]);return eO(t,this,o)})}),o9=rM(function(t,e){var o=eX(e,ik(o9));return i_(t,f,r,e,o)}),at=rM(function(t,e){var o=eX(e,ik(at));return i_(t,h,r,e,o)}),ae=iI(function(t,e){return i_(t,256,r,r,r,e)});function an(t,e){return t===e||t!=t&&e!=e}var ar=iy(ru),ai=iy(function(t,e){return t>=e}),ao=rh(function(){return arguments}())?rh:function(t){return ay(t)&&t3.call(t,"callee")&&!tX.call(t,"callee")},aa=tP.isArray,as=ey?ej(ey):function t(e){return ay(e)&&rs(e)==j};function au(t){return null!=t&&am(t.length)&&!aA(t)}function ac(t){return ay(t)&&au(t)}var al=na||sO,ad=e$?ej(e$):function t(e){return ay(e)&&rs(e)==w};function ah(t,e){return rp(t,e)}function ap(t){if(!ay(t))return!1;var e=rs(t);return e==I||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!ab(t)}function aA(t){if(!av(t))return!1;var e=rs(t);return e==R||e==M||"[object AsyncFunction]"==e||"[object Proxy]"==e}function ag(t){return"number"==typeof t&&t==aT(t)}function am(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function av(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ay(t){return null!=t&&"object"==typeof t}var a$=e8?ej(e8):function t(e){return ay(e)&&iF(e)==T};function a8(t){return"number"==typeof t||ay(t)&&rs(t)==P}function ab(t){if(!ay(t)||rs(t)!=B)return!1;var e=tJ(t);if(null===e)return!0;var r=t3.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&t4.call(r)==tj}var aC=eb?ej(eb):function t(e){return ay(e)&&rs(e)==x},a_=eC?ej(eC):function t(e){return ay(e)&&iF(e)==F};function aO(t){return"string"==typeof t||!aa(t)&&ay(t)&&rs(t)==N}function aE(t){return"symbol"==typeof t||ay(t)&&rs(t)==G}var aS=e_?ej(e_):function t(e){return ay(e)&&am(e.length)&&!!eo[rs(e)]},aw=iy(ry),aI=iy(function(t,e){return t<=e});function aR(t){if(!t)return[];if(au(t))return aO(t)?ne(t):it(t);if(el&&t[el])return function t(e){for(var r,o=[];!(r=e.next()).done;)o.push(r.value);return o}(t[el]());var e=iF(t);return(e==T?eZ:e==F?e9:aK)(t)}function aM(t){return t?(t=ak(t))===A||t===-A?(t<0?-1:1)*17976931348623157e292:t==t?t:0:0===t?t:0}function aT(t){var e=aM(t),r=e%1;return e==e?r?e-r:e:0}function aP(t){return t?nW(aT(t),0,m):0}function ak(t){if("number"==typeof t)return t;if(aE(t))return g;if(av(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=av(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=e7(t);var r=tE.test(t);return r||tw.test(t)?ec(t.slice(2),r?2:8):tO.test(t)?g:+t}function aB(t){return ie(t,aj(t))}function aL(t){return null==t?"":rU(t)}var a2=ii(function(t,e){if(ij(e)||au(e)){ie(e,a7(e),t);return}for(var r in e)t3.call(e,r)&&n3(t,r,e[r])}),aD=ii(function(t,e){ie(e,aj(e),t)}),ax=ii(function(t,e,r,o){ie(e,aj(e),t,o)}),a1=ii(function(t,e,r,o){ie(e,a7(e),t,o)}),aF=iI(nq),aN=rM(function(t,e){t=t2(t);var o=-1,a=e.length,s=a>2?e[2]:r;for(s&&i3(e[0],e[1],s)&&(a=1);++o<a;)for(var l=e[o],f=aj(l),h=-1,p=f.length;++h<p;){var A=f[h],g=t[A];(g===r||an(g,tG[A])&&!t3.call(t,A))&&(t[A]=l[A])}return t}),aG=rM(function(t){return t.push(r,iE),eO(aW,r,t)});function aU(t,e,o){var a=null==t?r:ro(t,e);return a===r?o:a}function a4(t,e){return null!=t&&iN(t,e,rl)}var a3=ip(function(t,e,r){null!=e&&"function"!=typeof e.toString&&(e=t7.call(e)),t[e]=r},sc(sd)),a6=ip(function(t,e,r){null!=e&&"function"!=typeof e.toString&&(e=t7.call(e)),t3.call(t,e)?t[e].push(r):t[e]=[r]},iB),aH=rM(rd);function a7(t){return au(t)?nF(t):rv(t)}function aj(t){return au(t)?nF(t,!0):function t(e){if(!av(e))return function t(e){var r=[];if(null!=e)for(var o in t2(e))r.push(o);return r}(e);var r=ij(e),o=[];for(var a in e)"constructor"==a&&(r||!t3.call(e,a))||o.push(a);return o}(t)}var aq=ii(function(t,e,r){rC(t,e,r)}),aW=ii(function(t,e,r,o){rC(t,e,r,o)}),aV=iI(function(t,e){var r={};if(null==t)return r;var o=!1;e=eP(e,function(e){return e=rz(e,t),o||(o=e.length>1),e}),ie(t,iM(t),r),o&&(r=nV(r,7,iS));for(var a=e.length;a--;)r3(r,e[a]);return r}),az=iI(function(t,e){var r,o;return null==t?{}:(r=t,rE(r,o=e,function(t,e){return a4(r,e)}))});function aQ(t,e){if(null==t)return{};var r=eP(iM(t),function(t){return[t]});return e=iB(e),rE(t,r,function(t,r){return e(t,r[0])})}var a5=iC(a7),aJ=iC(aj);function aK(t){return null==t?[]:eq(t,a7(t))}var aZ=iu(function(t,e,r){return e=e.toLowerCase(),t+(r?aY(e):e)});function aY(t){return so(aL(t).toLowerCase())}function aX(t){return(t=aL(t))&&t.replace(tR,eQ).replace(tY,"")}var a9=iu(function(t,e,r){return t+(r?"-":"")+e.toLowerCase()}),st=iu(function(t,e,r){return t+(r?" ":"")+e.toLowerCase()}),se=is("toLowerCase"),sn=iu(function(t,e,r){return t+(r?"_":"")+e.toLowerCase()}),sr=iu(function(t,e,r){return t+(r?" ":"")+so(e)}),si=iu(function(t,e,r){return t+(r?" ":"")+e.toUpperCase()}),so=is("toUpperCase");function sa(t,e,o){var a,s,l;return t=aL(t),(e=o?r:e)===r?(a=t,en.test(a))?(s=t).match(t9)||[]:(l=t).match(t$)||[]:t.match(e)||[]}var ss=rM(function(t,e){try{return eO(t,r,e)}catch(o){return ap(o)?o:new t0(o)}}),su=iI(function(t,e){return eS(e,function(e){e=oi(e),nj(t,e,oW(t[e],t))}),t});function sc(t){return function(){return t}}var sl=id(),sf=id(!0);function sd(t){return t}function sh(t){return rm("function"==typeof t?t:nV(t,1))}var sp=rM(function(t,e){return function(r){return rd(r,t,e)}}),sA=rM(function(t,e){return function(r){return rd(t,r,e)}});function sg(t,e,r){var o=a7(e),a=ri(e,o);null!=r||av(e)&&(a.length||!o.length)||(r=e,e=t,t=this,a=ri(e,a7(e)));var s=!(av(r)&&"chain"in r)||!!r.chain,l=aA(t);return eS(a,function(r){var o=e[r];t[r]=o,l&&(t.prototype[r]=function(){var e=this.__chain__;if(s||e){var r=t(this.__wrapped__);return(r.__actions__=it(this.__actions__)).push({func:o,args:arguments,thisArg:t}),r.__chain__=e,r}return o.apply(t,ek([this.value()],arguments))})}),t}function sm(){}var sv=ig(eP),sy=ig(eI),s$=ig(eL);function s8(t){var e;return i6(t)?eU(oi(t)):(e=t,function(t){return ro(t,e)})}var sb=iv(),sC=iv(!0);function s_(){return[]}function sO(){return!1}function sE(){return{}}function sS(){return""}function sw(){return!0}var sI,sR=iA(function(t,e){return t+e},0),sM=i8("ceil"),sT=iA(function(t,e){return t/e},1),sP=i8("floor"),sk=iA(function(t,e){return t*e},1),sB=i8("round"),sL=iA(function(t,e){return t-e},0);return nT.after=function t(e,r){if("function"!=typeof r)throw new t1(o);return e=aT(e),function(){if(--e<1)return r.apply(this,arguments)}},nT.ary=oj,nT.assign=a2,nT.assignIn=aD,nT.assignInWith=ax,nT.assignWith=a1,nT.at=aF,nT.before=oq,nT.bind=oW,nT.bindAll=su,nT.bindKey=oV,nT.castArray=function t(){if(!arguments.length)return[];var e=arguments[0];return aa(e)?e:[e]},nT.chain=ok,nT.chunk=function t(e,o,a){o=(a?i3(e,o,a):o===r)?1:nl(aT(o),0);var s=null==e?0:e.length;if(!s||o<1)return[];for(var l=0,f=0,h=tP(e2(s/o));l<s;)h[f++]=rD(e,l,l+=o);return h},nT.compact=function t(e){for(var r=-1,o=null==e?0:e.length,a=0,s=[];++r<o;){var l=e[r];l&&(s[a++]=l)}return s},nT.concat=function t(){var e=arguments.length;if(!e)return[];for(var r=tP(e-1),o=arguments[0],a=e;a--;)r[a-1]=arguments[a];return ek(aa(o)?it(o):[o],n9(r,1))},nT.cond=function t(e){var r=null==e?0:e.length,a=iB();return e=r?eP(e,function(t){if("function"!=typeof t[1])throw new t1(o);return[a(t[0]),t[1]]}):[],rM(function(t){for(var o=-1;++o<r;){var a=e[o];if(eO(a[0],this,t))return eO(a[1],this,t)}})},nT.conforms=function t(e){var r,o;return r=nV(e,1),o=a7(r),function(t){return nz(t,r,o)}},nT.constant=sc,nT.countBy=oD,nT.create=function t(e,r){var o=nP(e);return null==r?o:n7(o,r)},nT.curry=oz,nT.curryRight=oQ,nT.debounce=o5,nT.defaults=aN,nT.defaultsDeep=aG,nT.defer=oJ,nT.delay=oK,nT.difference=os,nT.differenceBy=ou,nT.differenceWith=oc,nT.drop=function t(e,o,a){var s=null==e?0:e.length;return s?(o=a||o===r?1:aT(o),rD(e,o<0?0:o,s)):[]},nT.dropRight=function t(e,o,a){var s=null==e?0:e.length;return s?(o=a||o===r?1:aT(o),rD(e,0,(o=s-o)<0?0:o)):[]},nT.dropRightWhile=function t(e,r){return e&&e.length?rH(e,iB(r,3),!0,!0):[]},nT.dropWhile=function t(e,r){return e&&e.length?rH(e,iB(r,3),!0):[]},nT.fill=function t(e,o,a,s){var l=null==e?0:e.length;return l?(a&&"number"!=typeof a&&i3(e,o,a)&&(a=0,s=l),function t(e,o,a,s){var l=e.length;for((a=aT(a))<0&&(a=-a>l?0:l+a),(s=s===r||s>l?l:aT(s))<0&&(s+=l),s=a>s?0:aP(s);a<s;)e[a++]=o;return e}(e,o,a,s)):[]},nT.filter=function t(e,r){return(aa(e)?eR:nX)(e,iB(r,3))},nT.flatMap=function t(e,r){return n9(o3(e,r),1)},nT.flatMapDeep=function t(e,r){return n9(o3(e,r),A)},nT.flatMapDepth=function t(e,o,a){return a=a===r?1:aT(a),n9(o3(e,o),a)},nT.flatten=od,nT.flattenDeep=function t(e){return(null==e?0:e.length)?n9(e,A):[]},nT.flattenDepth=function t(e,o){return(null==e?0:e.length)?(o=o===r?1:aT(o),n9(e,o)):[]},nT.flip=function t(e){return i_(e,512)},nT.flow=sl,nT.flowRight=sf,nT.fromPairs=function t(e){for(var r=-1,o=null==e?0:e.length,a={};++r<o;){var s=e[r];a[s[0]]=s[1]}return a},nT.functions=function t(e){return null==e?[]:ri(e,a7(e))},nT.functionsIn=function t(e){return null==e?[]:ri(e,aj(e))},nT.groupBy=oG,nT.initial=function t(e){return(null==e?0:e.length)?rD(e,0,-1):[]},nT.intersection=op,nT.intersectionBy=oA,nT.intersectionWith=og,nT.invert=a3,nT.invertBy=a6,nT.invokeMap=oU,nT.iteratee=sh,nT.keyBy=o4,nT.keys=a7,nT.keysIn=aj,nT.map=o3,nT.mapKeys=function t(e,r){var o={};return r=iB(r,3),rn(e,function(t,e,a){nj(o,r(t,e,a),t)}),o},nT.mapValues=function t(e,r){var o={};return r=iB(r,3),rn(e,function(t,e,a){nj(o,e,r(t,e,a))}),o},nT.matches=function t(e){return r8(nV(e,1))},nT.matchesProperty=function t(e,r){return rb(e,nV(r,1))},nT.memoize=oZ,nT.merge=aq,nT.mergeWith=aW,nT.method=sp,nT.methodOf=sA,nT.mixin=sg,nT.negate=oY,nT.nthArg=function t(e){return e=aT(e),rM(function(t){return r_(t,e)})},nT.omit=aV,nT.omitBy=function t(e,r){return aQ(e,oY(iB(r)))},nT.once=function t(e){return oq(2,e)},nT.orderBy=function t(e,o,a,s){return null==e?[]:(aa(o)||(o=null==o?[]:[o]),a=s?r:a,aa(a)||(a=null==a?[]:[a]),rO(e,o,a))},nT.over=sv,nT.overArgs=oX,nT.overEvery=sy,nT.overSome=s$,nT.partial=o9,nT.partialRight=at,nT.partition=o6,nT.pick=az,nT.pickBy=aQ,nT.property=s8,nT.propertyOf=function t(e){return function(t){return null==e?r:ro(e,t)}},nT.pull=ov,nT.pullAll=oy,nT.pullAllBy=function t(e,r,o){return e&&e.length&&r&&r.length?rS(e,r,iB(o,2)):e},nT.pullAllWith=function t(e,o,a){return e&&e.length&&o&&o.length?rS(e,o,r,a):e},nT.pullAt=o$,nT.range=sb,nT.rangeRight=sC,nT.rearg=ae,nT.reject=function t(e,r){return(aa(e)?eR:nX)(e,oY(iB(r,3)))},nT.remove=function t(e,r){var o=[];if(!(e&&e.length))return o;var a=-1,s=[],l=e.length;for(r=iB(r,3);++a<l;){var f=e[a];r(f,a,e)&&(o.push(f),s.push(a))}return rw(e,s),o},nT.rest=function t(e,a){if("function"!=typeof e)throw new t1(o);return a=a===r?a:aT(a),rM(e,a)},nT.reverse=o8,nT.sampleSize=function t(e,o,a){return o=(a?i3(e,o,a):o===r)?1:aT(o),(aa(e)?nG:rP)(e,o)},nT.set=function t(e,r,o){return null==e?e:rk(e,r,o)},nT.setWith=function t(e,o,a,s){return s="function"==typeof s?s:r,null==e?e:rk(e,o,a,s)},nT.shuffle=function t(e){return(aa(e)?nU:r2)(e)},nT.slice=function t(e,o,a){var s=null==e?0:e.length;return s?(a&&"number"!=typeof a&&i3(e,o,a)?(o=0,a=s):(o=null==o?0:aT(o),a=a===r?s:aT(a)),rD(e,o,a)):[]},nT.sortBy=oH,nT.sortedUniq=function t(e){return e&&e.length?rN(e):[]},nT.sortedUniqBy=function t(e,r){return e&&e.length?rN(e,iB(r,2)):[]},nT.split=function t(e,o,a){return a&&"number"!=typeof a&&i3(e,o,a)&&(o=a=r),(a=a===r?m:a>>>0)?(e=aL(e))&&("string"==typeof o||null!=o&&!aC(o))&&!(o=rU(o))&&eK(e)?rQ(ne(e),0,a):e.split(o,a):[]},nT.spread=function t(e,r){if("function"!=typeof e)throw new t1(o);return r=null==r?0:nl(aT(r),0),rM(function(t){var o=t[r],a=rQ(t,0,r);return o&&ek(a,o),eO(e,this,a)})},nT.tail=function t(e){var r=null==e?0:e.length;return r?rD(e,1,r):[]},nT.take=function t(e,o,a){return e&&e.length?(o=a||o===r?1:aT(o),rD(e,0,o<0?0:o)):[]},nT.takeRight=function t(e,o,a){var s=null==e?0:e.length;return s?(o=a||o===r?1:aT(o),rD(e,(o=s-o)<0?0:o,s)):[]},nT.takeRightWhile=function t(e,r){return e&&e.length?rH(e,iB(r,3),!1,!0):[]},nT.takeWhile=function t(e,r){return e&&e.length?rH(e,iB(r,3)):[]},nT.tap=oB,nT.throttle=function t(e,r,a){var s=!0,l=!0;if("function"!=typeof e)throw new t1(o);return av(a)&&(s="leading"in a?!!a.leading:s,l="trailing"in a?!!a.trailing:l),o5(e,r,{leading:s,maxWait:r,trailing:l})},nT.thru=oL,nT.toArray=aR,nT.toPairs=a5,nT.toPairsIn=aJ,nT.toPath=function t(e){return aa(e)?eP(e,oi):aE(e)?[e]:it(or(aL(e)))},nT.toPlainObject=aB,nT.transform=function t(e,r,o){var a=aa(e),s=a||al(e)||aS(e);if(r=iB(r,4),null==o){var l=e&&e.constructor;o=s?a?new l:[]:av(e)&&aA(l)?nP(tJ(e)):{}}return(s?eS:rn)(e,function(t,e,a){return r(o,t,e,a)}),o},nT.unary=function t(e){return oj(e,1)},nT.union=oC,nT.unionBy=o_,nT.unionWith=oO,nT.uniq=function t(e){return e&&e.length?r4(e):[]},nT.uniqBy=function t(e,r){return e&&e.length?r4(e,iB(r,2)):[]},nT.uniqWith=function t(e,o){return o="function"==typeof o?o:r,e&&e.length?r4(e,r,o):[]},nT.unset=function t(e,r){return null==e||r3(e,r)},nT.unzip=oE,nT.unzipWith=oS,nT.update=function t(e,r,o){return null==e?e:r6(e,r,rV(o))},nT.updateWith=function t(e,o,a,s){return s="function"==typeof s?s:r,null==e?e:r6(e,o,rV(a),s)},nT.values=aK,nT.valuesIn=function t(e){return null==e?[]:eq(e,aj(e))},nT.without=ow,nT.words=sa,nT.wrap=function t(e,r){return o9(rV(r),e)},nT.xor=oI,nT.xorBy=oR,nT.xorWith=oM,nT.zip=oT,nT.zipObject=function t(e,r){return rq(e||[],r||[],n3)},nT.zipObjectDeep=function t(e,r){return rq(e||[],r||[],rk)},nT.zipWith=oP,nT.entries=a5,nT.entriesIn=aJ,nT.extend=aD,nT.extendWith=ax,sg(nT,nT),nT.add=sR,nT.attempt=ss,nT.camelCase=aZ,nT.capitalize=aY,nT.ceil=sM,nT.clamp=function t(e,o,a){return a===r&&(a=o,o=r),a!==r&&(a=(a=ak(a))==a?a:0),o!==r&&(o=(o=ak(o))==o?o:0),nW(ak(e),o,a)},nT.clone=function t(e){return nV(e,4)},nT.cloneDeep=function t(e){return nV(e,5)},nT.cloneDeepWith=function t(e,o){return o="function"==typeof o?o:r,nV(e,5,o)},nT.cloneWith=function t(e,o){return o="function"==typeof o?o:r,nV(e,4,o)},nT.conformsTo=function t(e,r){return null==r||nz(e,r,a7(r))},nT.deburr=aX,nT.defaultTo=function t(e,r){return null==e||e!=e?r:e},nT.divide=sT,nT.endsWith=function t(e,o,a){e=aL(e),o=rU(o);var s=e.length,l=a=a===r?s:nW(aT(a),0,s);return(a-=o.length)>=0&&e.slice(a,l)==o},nT.eq=an,nT.escape=function t(e){return(e=aL(e))&&ta.test(e)?e.replace(ti,e5):e},nT.escapeRegExp=function t(e){return(e=aL(e))&&tp.test(e)?e.replace(th,"\\$&"):e},nT.every=function t(e,o,a){var s=aa(e)?eI:nZ;return a&&i3(e,o,a)&&(o=r),s(e,iB(o,3))},nT.find=ox,nT.findIndex=ol,nT.findKey=function t(e,r){return eD(e,iB(r,3),rn)},nT.findLast=o1,nT.findLastIndex=of,nT.findLastKey=function t(e,r){return eD(e,iB(r,3),rr)},nT.floor=sP,nT.forEach=oF,nT.forEachRight=oN,nT.forIn=function t(e,r){return null==e?e:rt(e,iB(r,3),aj)},nT.forInRight=function t(e,r){return null==e?e:re(e,iB(r,3),aj)},nT.forOwn=function t(e,r){return e&&rn(e,iB(r,3))},nT.forOwnRight=function t(e,r){return e&&rr(e,iB(r,3))},nT.get=aU,nT.gt=ar,nT.gte=ai,nT.has=function t(e,r){return null!=e&&iN(e,r,rc)},nT.hasIn=a4,nT.head=oh,nT.identity=sd,nT.includes=function t(e,r,o,a){e=au(e)?e:aK(e),o=o&&!a?aT(o):0;var s=e.length;return o<0&&(o=nl(s+o,0)),aO(e)?o<=s&&e.indexOf(r,o)>-1:!!s&&e1(e,r,o)>-1},nT.indexOf=function t(e,r,o){var a=null==e?0:e.length;if(!a)return -1;var s=null==o?0:aT(o);return s<0&&(s=nl(a+s,0)),e1(e,r,s)},nT.inRange=function t(e,o,a){var s,l,f;return o=aM(o),a===r?(a=o,o=0):a=aM(a),s=e=ak(e),s>=nf(l=o,f=a)&&s<nl(l,f)},nT.invoke=aH,nT.isArguments=ao,nT.isArray=aa,nT.isArrayBuffer=as,nT.isArrayLike=au,nT.isArrayLikeObject=ac,nT.isBoolean=function t(e){return!0===e||!1===e||ay(e)&&rs(e)==O},nT.isBuffer=al,nT.isDate=ad,nT.isElement=function t(e){return ay(e)&&1===e.nodeType&&!ab(e)},nT.isEmpty=function t(e){if(null==e)return!0;if(au(e)&&(aa(e)||"string"==typeof e||"function"==typeof e.splice||al(e)||aS(e)||ao(e)))return!e.length;var r=iF(e);if(r==T||r==F)return!e.size;if(ij(e))return!rv(e).length;for(var o in e)if(t3.call(e,o))return!1;return!0},nT.isEqual=ah,nT.isEqualWith=function t(e,o,a){var s=(a="function"==typeof a?a:r)?a(e,o):r;return s===r?rp(e,o,r,a):!!s},nT.isError=ap,nT.isFinite=function t(e){return"number"==typeof e&&ns(e)},nT.isFunction=aA,nT.isInteger=ag,nT.isLength=am,nT.isMap=a$,nT.isMatch=function t(e,r){return e===r||rA(e,r,i2(r))},nT.isMatchWith=function t(e,o,a){return a="function"==typeof a?a:r,rA(e,o,i2(o),a)},nT.isNaN=function t(e){return a8(e)&&e!=+e},nT.isNative=function t(e){if(i7(e))throw new t0("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return rg(e)},nT.isNil=function t(e){return null==e},nT.isNull=function t(e){return null===e},nT.isNumber=a8,nT.isObject=av,nT.isObjectLike=ay,nT.isPlainObject=ab,nT.isRegExp=aC,nT.isSafeInteger=function t(e){return ag(e)&&e>=-9007199254740991&&e<=9007199254740991},nT.isSet=a_,nT.isString=aO,nT.isSymbol=aE,nT.isTypedArray=aS,nT.isUndefined=function t(e){return e===r},nT.isWeakMap=function t(e){return ay(e)&&iF(e)==H},nT.isWeakSet=function t(e){return ay(e)&&"[object WeakSet]"==rs(e)},nT.join=function t(e,r){return null==e?"":nu.call(e,r)},nT.kebabCase=a9,nT.last=om,nT.lastIndexOf=function t(e,o,a){var s=null==e?0:e.length;if(!s)return -1;var l=s;return a!==r&&(l=(l=aT(a))<0?nl(s+l,0):nf(l,s-1)),o==o?function t(e,r,o){for(var a=o+1;a--&&e[a]!==r;);return a}(e,o,l):ex(e,eN,l,!0)},nT.lowerCase=st,nT.lowerFirst=se,nT.lt=aw,nT.lte=aI,nT.max=function t(e){return e&&e.length?nY(e,sd,ru):r},nT.maxBy=function t(e,o){return e&&e.length?nY(e,iB(o,2),ru):r},nT.mean=function t(e){return eG(e,sd)},nT.meanBy=function t(e,r){return eG(e,iB(r,2))},nT.min=function t(e){return e&&e.length?nY(e,sd,ry):r},nT.minBy=function t(e,o){return e&&e.length?nY(e,iB(o,2),ry):r},nT.stubArray=s_,nT.stubFalse=sO,nT.stubObject=sE,nT.stubString=sS,nT.stubTrue=sw,nT.multiply=sk,nT.nth=function t(e,o){return e&&e.length?r_(e,aT(o)):r},nT.noConflict=function t(){return eh._===this&&(eh._=tq),this},nT.noop=sm,nT.now=o7,nT.pad=function t(e,r,o){e=aL(e);var a=(r=aT(r))?nt(e):0;if(!r||a>=r)return e;var s=(r-a)/2;return im(e4(s),o)+e+im(e2(s),o)},nT.padEnd=function t(e,r,o){e=aL(e);var a=(r=aT(r))?nt(e):0;return r&&a<r?e+im(r-a,o):e},nT.padStart=function t(e,r,o){e=aL(e);var a=(r=aT(r))?nt(e):0;return r&&a<r?im(r-a,o)+e:e},nT.parseInt=function t(e,r,o){return o||null==r?r=0:r&&(r=+r),nh(aL(e).replace(tA,""),r||0)},nT.random=function t(e,o,a){if(a&&"boolean"!=typeof a&&i3(e,o,a)&&(o=a=r),a===r&&("boolean"==typeof o?(a=o,o=r):"boolean"==typeof e&&(a=e,e=r)),e===r&&o===r?(e=0,o=1):(e=aM(e),o===r?(o=e,e=0):o=aM(o)),e>o){var s=e;e=o,o=s}if(a||e%1||o%1){var l=np();return nf(e+l*(o-e+eu("1e-"+((l+"").length-1))),o)}return rI(e,o)},nT.reduce=function t(e,r,o){var a=aa(e)?e0:e3,s=arguments.length<3;return a(e,iB(r,4),o,s,nJ)},nT.reduceRight=function t(e,r,o){var a=aa(e)?eB:e3,s=arguments.length<3;return a(e,iB(r,4),o,s,nK)},nT.repeat=function t(e,o,a){return o=(a?i3(e,o,a):o===r)?1:aT(o),rR(aL(e),o)},nT.replace=function t(){var e=arguments,r=aL(e[0]);return e.length<3?r:r.replace(e[1],e[2])},nT.result=function t(e,o,a){o=rz(o,e);var s=-1,l=o.length;for(l||(l=1,e=r);++s<l;){var f=null==e?r:e[oi(o[s])];f===r&&(s=l,f=a),e=aA(f)?f.call(e):f}return e},nT.round=sB,nT.runInContext=t,nT.sample=function t(e){return(aa(e)?nN:rT)(e)},nT.size=function t(e){if(null==e)return 0;if(au(e))return aO(e)?nt(e):e.length;var r=iF(e);return r==T||r==F?e.size:rv(e).length},nT.snakeCase=sn,nT.some=function t(e,o,a){var s=aa(e)?eL:rx;return a&&i3(e,o,a)&&(o=r),s(e,iB(o,3))},nT.sortedIndex=ob,nT.sortedIndexBy=function t(e,r,o){return rF(e,r,iB(o,2))},nT.sortedIndexOf=function t(e,r){var o=null==e?0:e.length;if(o){var a=r1(e,r);if(a<o&&an(e[a],r))return a}return -1},nT.sortedLastIndex=function t(e,r){return r1(e,r,!0)},nT.sortedLastIndexBy=function t(e,r,o){return rF(e,r,iB(o,2),!0)},nT.sortedLastIndexOf=function t(e,r){if(null==e?0:e.length){var o=r1(e,r,!0)-1;if(an(e[o],r))return o}return -1},nT.startCase=sr,nT.startsWith=function t(e,r,o){return e=aL(e),o=null==o?0:nW(aT(o),0,e.length),r=rU(r),e.slice(o,o+r.length)==r},nT.subtract=sL,nT.sum=function t(e){return e&&e.length?e6(e,sd):0},nT.sumBy=function t(e,r){return e&&e.length?e6(e,iB(r,2)):0},nT.template=function t(e,o,a){var s=nT.templateSettings;a&&i3(e,o,a)&&(o=r),e=aL(e),o=ax({},o,s,iO);var l,f,h=ax({},o.imports,s.imports,iO),p=a7(h),A=eq(h,p),g=0,m=o.interpolate||tM,v="__p += '",$=tD((o.escape||tM).source+"|"+m.source+"|"+(m===tc?tC:tM).source+"|"+(o.evaluate||tM).source+"|$","g"),b="//# sourceURL="+(t3.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ei+"]")+`
`;e.replace($,function(t,r,o,a,s,h){return o||(o=a),v+=e.slice(g,h).replace(tT,eJ),r&&(l=!0,v+=`' +
__e(`+r+`) +
'`),s&&(f=!0,v+=`';
`+s+`;
__p += '`),o&&(v+=`' +
((__t = (`+o+`)) == null ? '' : __t) +
'`),g=h+t.length,t}),v+=`';
`;var C=t3.call(o,"variable")&&o.variable;if(C){if(t8.test(C))throw new t0("Invalid `variable` option passed into `_.template`")}else v=`with (obj) {
`+v+`
}
`;v=(f?v.replace(tt,""):v).replace(te,"$1").replace(tn,"$1;"),v="function("+(C||"obj")+`) {
`+(C?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(l?", __e = _.escape":"")+(f?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+v+`return __p
}`;var _=ss(function(){return tB(p,b+"return "+v).apply(r,A)});if(_.source=v,ap(_))throw _;return _},nT.times=function t(e,r){if((e=aT(e))<1||e>9007199254740991)return[];var o=m,a=nf(e,m);r=iB(r),e-=m;for(var s=eH(a,r);++o<e;)r(o);return s},nT.toFinite=aM,nT.toInteger=aT,nT.toLength=aP,nT.toLower=function t(e){return aL(e).toLowerCase()},nT.toNumber=ak,nT.toSafeInteger=function t(e){return e?nW(aT(e),-9007199254740991,9007199254740991):0===e?e:0},nT.toString=aL,nT.toUpper=function t(e){return aL(e).toUpperCase()},nT.trim=function t(e,o,a){if((e=aL(e))&&(a||o===r))return e7(e);if(!e||!(o=rU(o)))return e;var s=ne(e),l=ne(o),f=eV(s,l),h=ez(s,l)+1;return rQ(s,f,h).join("")},nT.trimEnd=function t(e,o,a){if((e=aL(e))&&(a||o===r))return e.slice(0,nn(e)+1);if(!e||!(o=rU(o)))return e;var s=ne(e),l=ez(s,ne(o))+1;return rQ(s,0,l).join("")},nT.trimStart=function t(e,o,a){if((e=aL(e))&&(a||o===r))return e.replace(tA,"");if(!e||!(o=rU(o)))return e;var s=ne(e),l=eV(s,ne(o));return rQ(s,l).join("")},nT.truncate=function t(e,o){var a=30,s=p;if(av(o)){var l="separator"in o?o.separator:l;a="length"in o?aT(o.length):a,s="omission"in o?rU(o.omission):s}var f=(e=aL(e)).length;if(eK(e)){var h=ne(e);f=h.length}if(a>=f)return e;var A=a-nt(s);if(A<1)return s;var g=h?rQ(h,0,A).join(""):e.slice(0,A);if(l===r)return g+s;if(h&&(A+=g.length-A),aC(l)){if(e.slice(A).search(l)){var m,v=g;for(l.global||(l=tD(l.source,aL(t_.exec(l))+"g")),l.lastIndex=0;m=l.exec(v);)var $=m.index;g=g.slice(0,$===r?A:$)}}else if(e.indexOf(rU(l),A)!=A){var b=g.lastIndexOf(l);b>-1&&(g=g.slice(0,b))}return g+s},nT.unescape=function t(e){return(e=aL(e))&&to.test(e)?e.replace(tr,nr):e},nT.uniqueId=function t(e){var r=++t6;return aL(e)+r},nT.upperCase=si,nT.upperFirst=so,nT.each=oF,nT.eachRight=oN,nT.first=oh,sg(nT,(sI={},rn(nT,function(t,e){t3.call(nT.prototype,e)||(sI[e]=t)}),sI),{chain:!1}),nT.VERSION="4.17.21",eS(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){nT[t].placeholder=nT}),eS(["drop","take"],function(t,e){nB.prototype[t]=function(o){o=o===r?1:nl(aT(o),0);var a=this.__filtered__&&!e?new nB(this):this.clone();return a.__filtered__?a.__takeCount__=nf(o,a.__takeCount__):a.__views__.push({size:nf(o,m),type:t+(a.__dir__<0?"Right":"")}),a},nB.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),eS(["filter","map","takeWhile"],function(t,e){var r=e+1,o=1==r||3==r;nB.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:iB(t,3),type:r}),e.__filtered__=e.__filtered__||o,e}}),eS(["head","last"],function(t,e){var r="take"+(e?"Right":"");nB.prototype[t]=function(){return this[r](1).value()[0]}}),eS(["initial","tail"],function(t,e){var r="drop"+(e?"":"Right");nB.prototype[t]=function(){return this.__filtered__?new nB(this):this[r](1)}}),nB.prototype.compact=function(){return this.filter(sd)},nB.prototype.find=function(t){return this.filter(t).head()},nB.prototype.findLast=function(t){return this.reverse().find(t)},nB.prototype.invokeMap=rM(function(t,e){return"function"==typeof t?new nB(this):this.map(function(r){return rd(r,t,e)})}),nB.prototype.reject=function(t){return this.filter(oY(iB(t)))},nB.prototype.slice=function(t,e){t=aT(t);var o=this;return o.__filtered__&&(t>0||e<0)?new nB(o):(t<0?o=o.takeRight(-t):t&&(o=o.drop(t)),e!==r&&(o=(e=aT(e))<0?o.dropRight(-e):o.take(e-t)),o)},nB.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},nB.prototype.toArray=function(){return this.take(m)},rn(nB.prototype,function(t,e){var o=/^(?:filter|find|map|reject)|While$/.test(e),a=/^(?:head|last)$/.test(e),s=nT[a?"take"+("last"==e?"Right":""):e],l=a||/^find/.test(e);s&&(nT.prototype[e]=function(){var e=this.__wrapped__,f=a?[1]:arguments,h=e instanceof nB,p=f[0],A=h||aa(e),g=function(t){var e=s.apply(nT,ek([t],f));return a&&m?e[0]:e};A&&o&&"function"==typeof p&&1!=p.length&&(h=A=!1);var m=this.__chain__,v=!!this.__actions__.length,$=l&&!m,b=h&&!v;if(!l&&A){e=b?e:new nB(this);var C=t.apply(e,f);return C.__actions__.push({func:oL,args:[g],thisArg:r}),new n0(C,m)}return $&&b?t.apply(this,f):(C=this.thru(g),$?a?C.value()[0]:C.value():C)})}),eS(["pop","push","shift","sort","splice","unshift"],function(t){var e=tF[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",o=/^(?:pop|shift)$/.test(t);nT.prototype[t]=function(){var t=arguments;if(o&&!this.__chain__){var a=this.value();return e.apply(aa(a)?a:[],t)}return this[r](function(r){return e.apply(aa(r)?r:[],t)})}}),rn(nB.prototype,function(t,e){var r=nT[e];if(r){var o=r.name+"";t3.call(nC,o)||(nC[o]=[]),nC[o].push({name:e,func:r})}}),nC[ih(r,2).name]=[{name:"wrapper",func:r}],nB.prototype.clone=function t(){var e=new nB(this.__wrapped__);return e.__actions__=it(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=it(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=it(this.__views__),e},nB.prototype.reverse=function t(){if(this.__filtered__){var e=new nB(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e},nB.prototype.value=function t(){var e=this.__wrapped__.value(),r=this.__dir__,o=aa(e),a=r<0,s=o?e.length:0,l=function t(e,r,o){for(var a=-1,s=o.length;++a<s;){var l=o[a],f=l.size;switch(l.type){case"drop":e+=f;break;case"dropRight":r-=f;break;case"take":r=nf(r,e+f);break;case"takeRight":e=nl(e,r-f)}}return{start:e,end:r}}(0,s,this.__views__),f=l.start,h=l.end,p=h-f,A=a?h:f-1,g=this.__iteratees__,m=g.length,v=0,$=nf(p,this.__takeCount__);if(!o||!a&&s==p&&$==p)return r7(e,this.__actions__);var b=[];e:for(;p--&&v<$;){A+=r;for(var C=-1,_=e[A];++C<m;){var O=g[C],w=O.iteratee,I=O.type,R=w(_);if(2==I)_=R;else if(!R){if(1==I)continue e;break e}}b[v++]=_}return b},nT.prototype.at=o2,nT.prototype.chain=function t(){return ok(this)},nT.prototype.commit=function t(){return new n0(this.value(),this.__chain__)},nT.prototype.next=function t(){this.__values__===r&&(this.__values__=aR(this.value()));var e=this.__index__>=this.__values__.length,o=e?r:this.__values__[this.__index__++];return{done:e,value:o}},nT.prototype.plant=function t(e){for(var o,a=this;a instanceof nk;){var s=oa(a);s.__index__=0,s.__values__=r,o?l.__wrapped__=s:o=s;var l=s;a=a.__wrapped__}return l.__wrapped__=e,o},nT.prototype.reverse=function t(){var e=this.__wrapped__;if(e instanceof nB){var o=e;return this.__actions__.length&&(o=new nB(this)),(o=o.reverse()).__actions__.push({func:oL,args:[o8],thisArg:r}),new n0(o,this.__chain__)}return this.thru(o8)},nT.prototype.toJSON=nT.prototype.valueOf=nT.prototype.value=function t(){return r7(this.__wrapped__,this.__actions__)},nT.prototype.first=nT.prototype.head,el&&(nT.prototype[el]=function t(){return this}),nT}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(eh._=ni,define(function(){return ni})):eA?((eA.exports=ni)._=ni,ep._=ni):eh._=ni}).call(t)}),_l=We((t,e)=>{oe(),function(r,o){"object"==typeof t&&"object"==typeof e?e.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof t?t.Ably=o():r.Ably=o()}(window,function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(o,a,(function(e){return t[e]}).bind(null,a));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=41)}([function(t,e,r){"use strict";e.__esModule=!0,e.default=function t(){}},function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",function(){return a}),r.d(e,"__assign",function(){return s}),r.d(e,"__rest",function(){return l}),r.d(e,"__decorate",function(){return f}),r.d(e,"__param",function(){return h}),r.d(e,"__metadata",function(){return p}),r.d(e,"__awaiter",function(){return A}),r.d(e,"__generator",function(){return g}),r.d(e,"__createBinding",function(){return m}),r.d(e,"__exportStar",function(){return v}),r.d(e,"__values",function(){return $}),r.d(e,"__read",function(){return b}),r.d(e,"__spread",function(){return C}),r.d(e,"__spreadArrays",function(){return _}),r.d(e,"__spreadArray",function(){return O}),r.d(e,"__await",function(){return w}),r.d(e,"__asyncGenerator",function(){return I}),r.d(e,"__asyncDelegator",function(){return R}),r.d(e,"__asyncValues",function(){return M}),r.d(e,"__makeTemplateObject",function(){return T}),r.d(e,"__importStar",function(){return k}),r.d(e,"__importDefault",function(){return B}),r.d(e,"__classPrivateFieldGet",function(){return D}),r.d(e,"__classPrivateFieldSet",function(){return x});var o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var s=function(){return(s=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function l(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&0>e.indexOf(o)&&(r[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,o=Object.getOwnPropertySymbols(t);a<o.length;a++)0>e.indexOf(o[a])&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(r[o[a]]=t[o[a]]);return r}function f(t,e,r,o){var a,s=arguments.length,l=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,r,o);else for(var f=t.length-1;f>=0;f--)(a=t[f])&&(l=(s<3?a(l):s>3?a(e,r,l):a(e,r))||l);return s>3&&l&&Object.defineProperty(e,r,l),l}function h(t,e){return function(r,o){e(r,o,t)}}function p(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function A(t,e,r,o){return new(r||(r=Promise))(function(a,s){function l(t){try{h(o.next(t))}catch(e){s(e)}}function f(t){try{h(o.throw(t))}catch(e){s(e)}}function h(t){var e;t.done?a(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(l,f)}h((o=o.apply(t,e||[])).next())})}function g(t,e){var r,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:f(0),throw:f(1),return:f(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function f(s){return function(f){return function s(f){if(r)throw TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(a=2&f[0]?o.return:f[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,f[1])).done)return a;switch(o=0,a&&(f=[2&f[0],a.value]),f[0]){case 0:case 1:a=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,o=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===f[0]||2===f[0])){l=0;continue}if(3===f[0]&&(!a||f[1]>a[0]&&f[1]<a[3])){l.label=f[1];break}if(6===f[0]&&l.label<a[1]){l.label=a[1],a=f;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(f);break}a[2]&&l.ops.pop(),l.trys.pop();continue}f=e.call(t,l)}catch(h){f=[6,h],o=0}finally{r=a=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([s,f])}}}var m=Object.create?function(t,e,r,o){void 0===o&&(o=r),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]};function v(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||m(e,t,r)}function $(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,a,s=r.call(t),l=[];try{for(;(void 0===e||e-- >0)&&!(o=s.next()).done;)l.push(o.value)}catch(f){a={error:f}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(a)throw a.error}}return l}function C(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(b(arguments[e]));return t}function _(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var o=Array(t),a=0,e=0;e<r;e++)for(var s=arguments[e],l=0,f=s.length;l<f;l++,a++)o[a]=s[l];return o}function O(t,e,r){if(r||2===arguments.length)for(var o,a=0,s=e.length;a<s;a++)!o&&a in e||(o||(o=Array.prototype.slice.call(e,0,a)),o[a]=e[a]);return t.concat(o||Array.prototype.slice.call(e))}function w(t){return this instanceof w?(this.v=t,this):new w(t)}function I(t,e,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var o,a=r.apply(t,e||[]),s=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(t){a[t]&&(o[t]=function(e){return new Promise(function(r,o){s.push([t,e,r,o])>1||f(t,e)})})}function f(t,e){try{var r;r=a[t](e),r.value instanceof w?Promise.resolve(r.value.v).then(h,p):A(s[0][2],r)}catch(o){A(s[0][3],o)}}function h(t){f("next",t)}function p(t){f("throw",t)}function A(t,e){t(e),s.shift(),s.length&&f(s[0][0],s[0][1])}}function R(t){var e,r;return e={},o("next"),o("throw",function(t){throw t}),o("return"),e[Symbol.iterator]=function(){return this},e;function o(o,a){e[o]=t[o]?function(e){return(r=!r)?{value:w(t[o](e)),done:"return"===o}:a?a(e):e}:a}}function M(t){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=$(t),e={},o("next"),o("throw"),o("return"),e[Symbol.asyncIterator]=function(){return this},e);function o(r){e[r]=t[r]&&function(e){return new Promise(function(o,a){(function t(e,r,o,a){Promise.resolve(a).then(function(t){e({value:t,done:o})},r)})(o,a,(e=t[r](e)).done,e.value)})}}}function T(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var P=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function k(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&m(e,t,r);return P(e,t),e}function B(t){return t&&t.__esModule?t:{default:t}}function D(t,e,r,o){if("a"===r&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?o:"a"===r?o.call(t):o?o.value:e.get(t)}function x(t,e,r,o,a){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!a:!e.has(t))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?a.call(t,r):a?a.value=r:e.set(t,r),r}},function(t,e,r){"use strict";(function(t){e.__esModule=!0,e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.getGlobalObject=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var o,a,s=r(1),l=s.__importDefault(r(0)),f=s.__importDefault(r(8));function h(t){return Math.floor(Math.random()*t.length)}function p(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var o=0;o<e.length;o++){var a=e[o];if(!a)break;var s=Object.prototype.hasOwnProperty;for(var l in a)(!s||s.call(a,l))&&(t[l]=a[l])}return t}function A(t){return null==t}function g(t,e){var r=function t(){};r.prototype=t;var o=new r;return e&&p(o,e),o}e.mixin=p,e.copy=function t(e){return p({},e)},e.isArray=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},e.ensureArray=function t(r){return A(r)?[]:e.isArray(r)?r:[r]},e.isObject=function t(e){return"[object Object]"==Object.prototype.toString.call(e)},e.isEmpty=function t(e){for(var r in e)return!1;return!0},e.isOnlyPropIn=function t(e,r){for(var o in e)if(o!==r)return!1;return!0},e.isEmptyArg=A,e.shallowClone=function t(e){var r={};for(var o in e)r[o]=e[o];return r},e.prototypicalClone=g;var m=function(t,e){if(l.default.Config.inherits){l.default.Config.inherits(t,e);return}t.super_=e,t.prototype=g(e.prototype,{constructor:t})};function v(t,r){for(var o=[],a=0;a<t.length;a++){var s=t[a];-1!=e.arrIndexOf(r,s)&&o.push(s)}return o}function $(t,e){for(var r=[],o=0;o<t.length;o++){var a=t[o];a in e&&r.push(a)}return r}function b(t,r){var o=e.arrIndexOf(t,r),a=-1!=o;return a&&t.splice(o,1),a}e.inherits=m,e.containsValue=function t(e,r){for(var o in e)if(e[o]==r)return!0;return!1},e.intersect=function t(r,o){return e.isArray(o)?v(r,o):$(r,o)},e.arrIntersect=v,e.arrIntersectOb=$,e.arrSubtract=function t(r,o){for(var a=[],s=0;s<r.length;s++){var l=r[s];-1==e.arrIndexOf(o,l)&&a.push(l)}return a},e.arrIndexOf=Array.prototype.indexOf?function(t,e,r){return t.indexOf(e,r)}:function(t,e,r){r=r||0;for(var o=t.length;r<o;r++)if(t[r]===e)return r;return -1},e.arrIn=function t(r,o){return -1!==e.arrIndexOf(r,o)},e.arrDeleteValue=b,e.arrWithoutValue=function t(e,r){var o=e.slice();return b(o,r),o},e.keysArray=function t(e,r){var o=[];for(var a in e)r&&!Object.prototype.hasOwnProperty.call(e,a)||o.push(a);return o},e.valuesArray=function t(e,r){var o=[];for(var a in e)r&&!Object.prototype.hasOwnProperty.call(e,a)||o.push(e[a]);return o},e.forInOwnNonNullProperties=function t(e,r){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&e[o]&&r(o)},e.arrForEach=Array.prototype.forEach?function(t,e){t.forEach(e)}:function(t,e){for(var r=t.length,o=0;o<r;o++)e(t[o],o,t)},e.safeArrForEach=function t(r,o){return e.arrForEach(r.slice(),o)},e.arrMap=Array.prototype.map?function(t,e){return t.map(e)}:function(t,e){for(var r=[],o=t.length,a=0;a<o;a++)r.push(e(t[a],a,t));return r},e.arrFilter=Array.prototype.filter?function(t,e){return t.filter(e)}:function(t,e){for(var r=[],o=t.length,a=0;a<o;a++)e(t[a])&&r.push(t[a]);return r},e.arrEvery=Array.prototype.every?function(t,e){return t.every(e)}:function(t,e){for(var r=t.length,o=0;o<r;o++)if(!e(t[o],o,t))return!1;return!0},e.allSame=function t(r,o){if(0===r.length)return!0;var a=r[0][o];return e.arrEvery(r,function(t){return t[o]===a})};var C={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function _(t){return t.splice(h(t),1)[0]}e.defaultGetHeaders=function t(e){return{accept:C[e||a.json],"X-Ably-Version":f.default.apiVersion,"Ably-Agent":f.default.agent}},e.defaultPostHeaders=function t(e){var r;return{accept:r=C[e||a.json],"content-type":r,"X-Ably-Version":f.default.apiVersion,"Ably-Agent":f.default.agent}},e.arrPopRandomElement=_,e.toQueryString=function t(e){var r=[];if(e)for(var o in e)r.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return r.length?"?"+r.join("&"):""},e.parseQueryString=function t(e){for(var r,o=/([^?&=]+)=?([^&]*)/g,a={};r=o.exec(e);)a[decodeURIComponent(r[1])]=decodeURIComponent(r[2]);return a},e.now=Date.now||function(){return new Date().getTime()},e.isErrorInfo=function t(e){return"ErrorInfo"==e.constructor.name},e.inspectError=function t(e){var r,o;return e instanceof Error||(null===(o=null===(r=e)||void 0===r?void 0:r.constructor)||void 0===o?void 0:o.name)==="ErrorInfo"?l.default.Config.inspect(e):e.toString()},e.inspectBody=function t(e){return l.default.BufferUtils.isBuffer(e)?e.toString():"string"==typeof e?e:l.default.Config.inspect(e)},e.dataSizeBytes=function t(e){if(l.default.BufferUtils.isBuffer(e))return l.default.BufferUtils.byteLength(e);if("string"==typeof e)return l.default.Config.stringByteSize(e);throw Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof e)},e.cheapRandStr=function t(){return String(Math.random()).substr(2)};var O=function(t){if(l.default.Config.getRandomValues&&"undefined"!=typeof Uint8Array){var e=new Uint8Array(t);return l.default.Config.getRandomValues(e),l.default.BufferUtils.base64Encode(e)}for(var r=l.default.BufferUtils.base64CharSet,o=Math.round(4*t/3),a="",s=0;s<o;s++)a+=r[h(r)];return a};e.randomString=O;var w=function(t){if(l.default.Config.getRandomValues&&"undefined"!=typeof Uint8Array){var e=new Uint8Array(t);return l.default.Config.getRandomValues(e),l.default.BufferUtils.hexEncode(e)}for(var r=l.default.BufferUtils.hexCharSet,o=2*t,a="",s=0;s<o;s++)a+=r[h(r)];return a};e.randomHexString=w,e.arrChooseN=function t(e,r){for(var o=Math.min(r,e.length),a=e.slice(),s=[],l=0;l<o;l++)s.push(_(a));return s},e.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},e.promisify=function t(e,r,o){return new Promise(function(t,a){e[r].apply(e,s.__spreadArray(s.__spreadArray([],o),[function(e,r){e?a(e):t(r)}]))})},(o=a=e.Format||(e.Format={})).msgpack="msgpack",o.json="json",e.decodeBody=function t(e,r){return"msgpack"==r?l.default.Config.msgpack.decode(e):JSON.parse(String(e))},e.encodeBody=function t(e,r){return"msgpack"==r?l.default.Config.msgpack.encode(e,!0):JSON.stringify(e)},e.allToLowerCase=function t(e){return e.map(function(t){return t&&t.toLowerCase()})},e.allToUpperCase=function t(e){return e.map(function(t){return t&&t.toUpperCase()})},e.getBackoffCoefficient=function t(e){return Math.min((e+2)/3,2)},e.getJitterCoefficient=function t(){return 1-.2*Math.random()},e.getGlobalObject=function e(){return t||("undefined"!=typeof window?window:self)}}).call(this,r(12))},function(t,e,r){"use strict";(function(t){e.__esModule=!0;var o,a,s=r(1).__importDefault(r(0)),l=t||("undefined"!=typeof window?window:self);function f(t,e){return(""+t).padStart(e?3:2,"0")}function h(t){return s.default.Config.logTimestamps?function(e){var r=new Date;t(f(r.getHours())+":"+f(r.getMinutes())+":"+f(r.getSeconds())+"."+f(r.getMilliseconds(),1)+" "+e)}:t}(a=o||(o={}))[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro";var p=function(){var t,e,r,o;return"undefined"==typeof Window&&"undefined"==typeof WorkerGlobalScope||"function"==typeof(null===(e=null===(t=null==l?void 0:l.console)||void 0===t?void 0:t.log)||void 0===e?void 0:e.apply)?(r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},o=console.warn?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}:r):r=o=null!=l&&l.console.log?function(){Function.prototype.apply.call(console.log,console,arguments)}:function(){},[r,o].map(h)},A=function(){function t(){t.logLevel=t.LOG_DEFAULT}return t.initLogHandlers=function(){var t=p(),e=t[0],r=t[1];this.logHandler=e,this.logErrorHandler=r},t.logLevel=o.Error,t.LOG_NONE=o.None,t.LOG_ERROR=o.Error,t.LOG_MAJOR=o.Major,t.LOG_MINOR=o.Minor,t.LOG_MICRO=o.Micro,t.LOG_DEFAULT=o.Error,t.LOG_DEBUG=o.Micro,t.logAction=function(e,r,a){t.shouldLog(e)&&(e===o.Error?t.logErrorHandler:t.logHandler)("Ably: "+r+": "+a)},t.deprecated=function(e,r){t.deprecatedWithMsg(e,"Please use '"+r+"' instead.")},t.deprecatedWithMsg=function(e,r){t.shouldLog(o.Error)&&t.logErrorHandler("Ably: Deprecation warning - '"+e+"' is deprecated and will be removed from a future version. "+r)},t.shouldLog=function(e){return e<=t.logLevel},t.setLog=function(e,r){void 0!==e&&(t.logLevel=e),void 0!==r&&(t.logHandler=t.logErrorHandler=r)},t}();e.default=A}).call(this,r(12))},function(t,e,r){var o,a;a=function(t){return function(){if("function"==typeof ArrayBuffer){var e=t.lib.WordArray,r=e.init;(e.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,o=[],a=0;a<e;a++)o[a>>>2]|=t[a]<<24-a%4*8;r.call(this,o,e)}else r.apply(this,arguments)}).prototype=e}}(),t.lib.WordArray},t.exports=e=a(r(6))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(0)),s=o.__importStar(r(2)),l=function(){function t(t,e,r,o){this.message=t,this.code=e,this.statusCode=r,this.cause=o}return t.prototype.toString=function(){var t="["+this.constructor.name;return this.message&&(t+=": "+this.message),this.statusCode&&(t+="; statusCode="+this.statusCode),this.code&&(t+="; code="+this.code),this.cause&&(t+="; cause="+s.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(t+="; see "+this.href+" "),t+="]"},t.fromValues=function(e){var r=e,o=r.message,s=r.code,l=r.statusCode;if("string"!=typeof o||"number"!=typeof s||"number"!=typeof l)throw Error("ErrorInfo.fromValues(): invalid values: "+a.default.Config.inspect(e));var f=Object.assign(new t(o,s,l),e);return f.code&&!f.href&&(f.href="https://help.ably.io/error/"+f.code),f},t}();e.default=l},function(t,e,r){(function(o){var a,s;s=function(){var t=t||function(t,e){if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==o&&o.crypto&&(s=o.crypto),!s)try{s=r(44)}catch(a){}var s,l=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},f=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),h={},p=h.lib={},A=p.Base={extend:function(t){var e=f(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},g=p.WordArray=A.extend({init:function(t,e){t=this.words=t||[],void 0!=e?this.sigBytes=e:this.sigBytes=4*t.length},toString:function(t){return(t||v).stringify(this)},concat:function(t){var e=this.words,r=t.words,o=this.sigBytes,a=t.sigBytes;if(this.clamp(),o%4)for(var s=0;s<a;s++){var l=r[s>>>2]>>>24-s%4*8&255;e[o+s>>>2]|=l<<24-(o+s)%4*8}else for(var s=0;s<a;s+=4)e[o+s>>>2]=r[s>>>2];return this.sigBytes+=a,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=A.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(l());return new g.init(e,t)}}),m=h.enc={},v=m.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,o=[],a=0;a<r;a++){var s=e[a>>>2]>>>24-a%4*8&255;o.push((s>>>4).toString(16)),o.push((15&s).toString(16))}return o.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o+=2)r[o>>>3]|=parseInt(t.substr(o,2),16)<<24-o%8*4;return new g.init(r,e/2)}},$=m.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,o=[],a=0;a<r;a++){var s=e[a>>>2]>>>24-a%4*8&255;o.push(String.fromCharCode(s))}return o.join("")},parse:function(t){for(var e=t.length,r=[],o=0;o<e;o++)r[o>>>2]|=(255&t.charCodeAt(o))<<24-o%4*8;return new g.init(r,e)}},b=m.Utf8={stringify:function(t){try{return decodeURIComponent(escape($.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return $.parse(unescape(encodeURIComponent(t)))}},C=p.BufferedBlockAlgorithm=A.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=b.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,o=this._data,a=o.words,s=o.sigBytes,l=this.blockSize,f=s/(4*l),h=(f=e?t.ceil(f):t.max((0|f)-this._minBufferSize,0))*l,p=t.min(4*h,s);if(h){for(var A=0;A<h;A+=l)this._doProcessBlock(a,A);r=a.splice(0,h),o.sigBytes-=p}return new g.init(r,p)},clone:function(){var t=A.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),_=(p.Hasher=C.extend({cfg:A.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){C.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new _.HMAC.init(t,r).finalize(e)}}}),h.algo={});return h}(Math);return t},t.exports=e=s()}).call(this,r(12))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(3)),l=o.__importDefault(r(0));function f(t,e,r){try{e.apply(t,r)}catch(o){s.default.logAction(s.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+o+"; stack = "+(o&&o.stack))}}function h(t,e,r){for(var o,s,l,f=0;f<t.length;f++)if(o=t[f],r&&(o=o[r]),a.isArray(o)){for(;-1!==(s=a.arrIndexOf(o,e));)o.splice(s,1);r&&0===o.length&&delete t[f][r]}else if(a.isObject(o))for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&a.isArray(o[l])&&h([o],e,l)}var p=function(){function t(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return t.prototype.on=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1===e.length){var o=e[0];if("function"==typeof o)this.any.push(o);else throw Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(e))}if(2===e.length){var s=e[0],f=e[1];if("function"!=typeof f)throw Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(e));if(a.isEmptyArg(s))this.any.push(f);else if(a.isArray(s))s.forEach(function(e){t.on(e,f)});else{if("string"!=typeof s)throw Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(e));(this.events[s]||(this.events[s]=[])).push(f)}}},t.prototype.off=function(){for(var t,e=this,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];if(0==r.length||a.isEmptyArg(r[0])&&a.isEmptyArg(r[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var s=r[0],f=r[1],p=null,A=null;if(1!==r.length&&f){if("function"!=typeof f)throw Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(r));A=(t=[s,f])[0],p=t[1]}else"function"==typeof s?p=s:A=s;if(p&&a.isEmptyArg(A)){h([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(a.isArray(A)){A.forEach(function(t){e.off(t,p)});return}if("string"!=typeof A)throw Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(r));p?h([this.events,this.eventsOnce],p,A):(delete this.events[A],delete this.eventsOnce[A])},t.prototype.listeners=function(t){if(t){var e=this.events[t]||[];return this.eventsOnce[t]&&Array.prototype.push.apply(e,this.eventsOnce[t]),e.length?e:null}return this.any.length?this.any:null},t.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var o={event:t},s=[];this.anyOnce.length&&(Array.prototype.push.apply(s,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(s,this.any);var l=this.eventsOnce[t];l&&(Array.prototype.push.apply(s,l),delete this.eventsOnce[t]);var h=this.events[t];h&&Array.prototype.push.apply(s,h),a.arrForEach(s,function(t){f(o,t,e)})},t.prototype.once=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=e.length;if((0===o||1===o&&"function"!=typeof e[0])&&l.default.Config.Promise){var s=e[0];if("string"!=typeof s)throw Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(e));return new l.default.Config.Promise(function(e){t.once(s,e)})}var f=e[0],h=e[1];if(1===e.length&&"function"==typeof f)this.anyOnce.push(f);else if(a.isEmptyArg(f)){if("function"!=typeof h)throw Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(e));this.anyOnce.push(h)}else if(a.isArray(f)){var p=this,A=function(){var t=Array.prototype.slice.call(arguments);if(a.arrForEach(f,function(t){p.off(t,A)}),"function"!=typeof h)throw Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(e));h.apply(this,t)};a.arrForEach(f,function(t){p.on(t,A)})}else{if("string"!=typeof f)throw Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(e));var g=this.eventsOnce[f]||(this.eventsOnce[f]=[]);if(h){if("function"!=typeof h)throw Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(e));g.push(h)}}},t.prototype.whenState=function(e,r,o){for(var a=this,s=[],h=3;h<arguments.length;h++)s[h-3]=arguments[h];if("string"!=typeof e||"string"!=typeof r)throw"whenState requires a valid event String argument";if("function"!=typeof o&&l.default.Config.Promise)return new l.default.Config.Promise(function(o){t.prototype.whenState.apply(a,[e,r,o].concat(s))});e===r?f({event:e},o,s):this.once(e,o)},t}();e.default=p},function(t,e,r){"use strict";e.__esModule=!0,e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var o=r(1),a=o.__importDefault(r(0)),s=o.__importStar(r(2)),l=o.__importDefault(r(3)),f=o.__importDefault(r(5)),h=r(42),p="ably-js/"+h.version,A={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:h.version,apiVersion:"1.2",agent:p,getHost:g,getPort:m,getHttpScheme:v,environmentFallbackHosts:$,getFallbackHosts:b,getHosts:C,checkHost:_,objectifyOptions:O,normaliseOptions:w};function g(t,e,r){return e=r?e==t.restHost&&t.realtimeHost||e||t.realtimeHost:e||t.restHost}function m(t,e){return e||t.tls?t.tlsPort:t.port}function v(t){return t.tls?"https://":"http://"}function $(t){return[t+"-a-fallback.ably-realtime.com",t+"-b-fallback.ably-realtime.com",t+"-c-fallback.ably-realtime.com",t+"-d-fallback.ably-realtime.com",t+"-e-fallback.ably-realtime.com"]}function b(t){var e=t.fallbackHosts,r=void 0!==t.httpMaxRetryCount?t.httpMaxRetryCount:A.httpMaxRetryCount;return e?s.arrChooseN(e,r):[]}function C(t){return[t.restHost].concat(b(t))}function _(t){if("string"!=typeof t)throw new f.default("host must be a string; was a "+typeof t,4e4,400);if(!t.length)throw new f.default("host must not be zero-length",4e4,400)}function O(t){return"string"==typeof t?-1==t.indexOf(":")?{token:t}:{key:t}:t}function w(t){if(t.host&&(l.default.deprecated("host","restHost"),t.restHost=t.host),t.wsHost&&(l.default.deprecated("wsHost","realtimeHost"),t.realtimeHost=t.wsHost),t.queueEvents&&(l.default.deprecated("queueEvents","queueMessages"),t.queueMessages=t.queueEvents),t.fallbackHostsUseDefault){if(t.fallbackHosts){var e="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",e),new f.default(e,4e4,400)}if(t.port||t.tlsPort){var e="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",e),new f.default(e,4e4,400)}t.environment?l.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):l.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),t.fallbackHosts=A.FALLBACK_HOSTS}!0===t.recover&&(l.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),t.recover=function(t,e){e(!0)}),"function"==typeof t.recover&&!0===t.closeOnUnload&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),t.recover=void 0),"closeOnUnload"in t||(t.closeOnUnload=!t.recover),t.transports&&s.arrIn(t.transports,"xhr")&&(l.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),s.arrDeleteValue(t.transports,"xhr"),t.transports.push("xhr_streaming")),"queueMessages"in t||(t.queueMessages=!0);var r,h,p,g=t.environment&&String(t.environment).toLowerCase()||A.ENVIRONMENT,m=!g||"production"===g;t.fallbackHosts||t.restHost||t.realtimeHost||t.port||t.tlsPort||(t.fallbackHosts=m?A.FALLBACK_HOSTS:$(g));var v=t.restHost||(m?A.REST_HOST:g+"-"+A.REST_HOST),b=(r=t,h=m,p=g,r.realtimeHost?r.realtimeHost:r.restHost?(l.default.logAction(l.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+r.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+r.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),r.restHost):h?A.REALTIME_HOST:p+"-"+A.REALTIME_HOST);s.arrForEach((t.fallbackHosts||[]).concat(v,b),_),t.port=t.port||A.PORT,t.tlsPort=t.tlsPort||A.TLS_PORT,"tls"in t||(t.tls=!0);var C=function t(e){var r={};for(var o in A.TIMEOUTS)r[o]=e[o]||A.TIMEOUTS[o];return r}(t);if("useBinaryProtocol"in t?t.useBinaryProtocol=a.default.Config.supportsBinary&&t.useBinaryProtocol:t.useBinaryProtocol=a.default.Config.preferBinary,t.clientId&&((t.headers=t.headers||{})["X-Ably-ClientId"]=a.default.BufferUtils.base64Encode(a.default.BufferUtils.utf8Encode(t.clientId))),"idempotentRestPublishing"in t||(t.idempotentRestPublishing=!0),t.promises&&!a.default.Config.Promise&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),t.promises=!1),t.agents)for(var O in t.agents)A.agent+=" "+O+"/"+t.agents[O];return o.__assign(o.__assign({},t),{useBinaryProtocol:"useBinaryProtocol"in t?a.default.Config.supportsBinary&&t.useBinaryProtocol:a.default.Config.preferBinary,realtimeHost:b,restHost:v,maxMessageSize:t.maxMessageSize||A.maxMessageSize,timeouts:C})}e.getHost=g,e.getPort=m,e.getHttpScheme=v,e.environmentFallbackHosts=$,e.getFallbackHosts=b,e.getHosts=C,e.objectifyOptions=O,e.normaliseOptions=w,e.default=A,e.getDefaults=function t(e){return Object.assign(A,e)}},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(0)),s=o.__importDefault(r(3)),l=o.__importDefault(r(5)),f=o.__importStar(r(2));function h(t){if(t&&t.cipher&&!t.cipher.channelCipher){if(!a.default.Crypto)throw Error("Encryption not enabled; use ably.encryption.js instead");var e=a.default.Crypto.getCipher(t.cipher);return{cipher:e.cipherParams,channelCipher:e.cipher}}return t}function p(t){var e=0;return t.name&&(e+=t.name.length),t.clientId&&(e+=t.clientId.length),t.extras&&(e+=JSON.stringify(t.extras).length),t.data&&(e+=f.dataSizeBytes(t.data)),e}var A=function(){function t(){}return t.prototype.toJSON=function(){var t=this.encoding,e=this.data;return e&&a.default.BufferUtils.isBuffer(e)&&(arguments.length>0?(t=t?t+"/base64":"base64",e=a.default.BufferUtils.base64Encode(e)):e=a.default.BufferUtils.toBuffer(e)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:t,data:e}},t.prototype.toString=function(){var t="[Message";return this.name&&(t+="; name="+this.name),this.id&&(t+="; id="+this.id),this.timestamp&&(t+="; timestamp="+this.timestamp),this.clientId&&(t+="; clientId="+this.clientId),this.connectionId&&(t+="; connectionId="+this.connectionId),this.encoding&&(t+="; encoding="+this.encoding),this.extras&&(t+="; extras ="+JSON.stringify(this.extras)),this.data&&("string"==typeof this.data?t+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?t+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):t+="; data (json)="+JSON.stringify(this.data)),this.extras&&(t+="; extras="+JSON.stringify(this.extras)),t+="]"},t.encrypt=function(t,e,r){var o=t.data,s=t.encoding,l=e.channelCipher;s=s?s+"/":"",a.default.BufferUtils.isBuffer(o)||(o=a.default.BufferUtils.utf8Encode(String(o)),s+="utf-8/"),l.encrypt(o,function(e,o){if(e){r(e);return}t.data=o,t.encoding=s+"cipher+"+l.algorithm,r(null,t)})},t.encode=function(e,r,o){var s=e.data;if(!("string"==typeof s||a.default.BufferUtils.isBuffer(s)||null==s)){if(f.isObject(s)||f.isArray(s))e.data=JSON.stringify(s),e.encoding=e.encoding?e.encoding+"/json":"json";else throw new l.default("Data type is unsupported",40013,400)}null!=r&&r.cipher?t.encrypt(e,r,o):o(null,e)},t.encodeArray=function(e,r,o){for(var a=0,s=0;s<e.length;s++)t.encode(e[s],r,function(t){if(t){o(t);return}++a==e.length&&o(null,e)})},t.decode=function(t,e){var r,o=(r=e)&&r.channelOptions?r:{channelOptions:r,plugins:{},baseEncodedPreviousPayload:void 0},s=t.data,f=t.encoding;if(f){var h=f.split("/"),p=void 0,A=h.length,g=t.data,m="";try{for(;(p=A)>0;){var v=h[--A].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(m=v[1]){case"base64":g=a.default.BufferUtils.base64Decode(String(g)),p==h.length&&(s=g);continue;case"utf-8":g=a.default.BufferUtils.utf8Decode(g);continue;case"json":g=JSON.parse(g);continue;case"cipher":if(null!=o.channelOptions&&o.channelOptions.cipher&&o.channelOptions.channelCipher){var $=v[3],b=o.channelOptions.channelCipher;if($!=b.algorithm)throw Error("Unable to decrypt message with given cipher; incompatible cipher params");g=b.decrypt(g);continue}throw Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!o.plugins||!o.plugins.vcdiff)throw new l.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if("undefined"==typeof Uint8Array)throw new l.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var C=o.baseEncodedPreviousPayload;"string"==typeof C&&(C=a.default.BufferUtils.utf8Encode(C)),C=a.default.BufferUtils.toBuffer(C),g=a.default.BufferUtils.toBuffer(g),s=g=a.default.BufferUtils.typedArrayToBuffer(o.plugins.vcdiff.decode(g,C))}catch(_){throw new l.default("Vcdiff delta decode failed with "+_,40018,400)}continue;default:throw Error("Unknown encoding")}}}catch(O){var w=O;throw new l.default("Error processing the "+m+" encoding, decoder returned ‘"+w.message+"’",w.code||40013,400)}finally{t.encoding=p<=0?null:h.slice(0,p).join("/"),t.data=g}}o.baseEncodedPreviousPayload=s},t.fromResponseBody=function(e,r,o){o&&(e=f.decodeBody(e,o));for(var a=0;a<e.length;a++){var l=e[a]=t.fromValues(e[a]);try{t.decode(l,r)}catch(h){s.default.logAction(s.default.LOG_ERROR,"Message.fromResponseBody()",h.toString())}}return e},t.fromValues=function(e){return Object.assign(new t,e)},t.fromValuesArray=function(e){for(var r=e.length,o=Array(r),a=0;a<r;a++)o[a]=t.fromValues(e[a]);return o},t.fromEncoded=function(e,r){var o=t.fromValues(e),a=h(r);try{t.decode(o,a)}catch(l){s.default.logAction(s.default.LOG_ERROR,"Message.fromEncoded()",l.toString())}return o},t.fromEncodedArray=function(e,r){return h(r),e.map(function(e){return t.fromEncoded(e,r)})},t.getMessagesSize=function(t){for(var e,r=0,o=0;o<t.length;o++)r+=(e=t[o]).size||(e.size=p(e));return r},t.serialize=f.encodeBody,t}();e.default=A},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(5)),l=o.__importDefault(r(9)),f=o.__importDefault(r(14)),h={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},p=[];Object.keys(h).forEach(function(t){p[h[t]]=t});var A={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:131072,SUBSCRIBE:262144,PRESENCE_SUBSCRIBE:524288},g=Object.keys(A);function m(t){var e=[];if(t)for(var r=0;r<t.length;r++)e.push(t[r].toString());return"[ "+e.join(", ")+" ]"}A.MODE_ALL=A.PRESENCE|A.PUBLISH|A.SUBSCRIBE|A.PRESENCE_SUBSCRIBE;var v="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),$=function(){function t(){var t=this;this.hasFlag=function(e){return(t.flags&A[e])>0}}return t.prototype.setFlag=function(t){return this.flags=this.flags|A[t]},t.prototype.getMode=function(){return this.flags&&this.flags&A.MODE_ALL},t.prototype.encodeModesToFlags=function(t){var e=this;t.forEach(function(t){return e.setFlag(t)})},t.prototype.decodeModesFromFlags=function(){var e=this,r=[];return t.channelModes.forEach(function(t){e.hasFlag(t)&&r.push(t)}),r.length>0?r:void 0},t.fromValues=function(e){return Object.assign(new t,e)},t.Action=h,t.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],t.ActionName=p,t.serialize=a.encodeBody,t.deserialize=function(e,r){var o=a.decodeBody(e,r);return t.fromDeserialized(o)},t.fromDeserialized=function(e){var r=e.error;r&&(e.error=s.default.fromValues(r));var o=e.messages;if(o)for(var a=0;a<o.length;a++)o[a]=l.default.fromValues(o[a]);var h=e.presence;if(h)for(var a=0;a<h.length;a++)h[a]=f.default.fromValues(h[a],!0);return Object.assign(new t,e)},t.stringify=function(e){var r="[ProtocolMessage";void 0!==e.action&&(r+="; action="+t.ActionName[e.action]);for(var o,h=0;h<v.length;h++)void 0!==e[o=v[h]]&&(r+="; "+o+"="+e[o]);if(e.messages&&(r+="; messages="+m(l.default.fromValuesArray(e.messages))),e.presence&&(r+="; presence="+m(f.default.fromValuesArray(e.presence))),e.error&&(r+="; error="+s.default.fromValues(e.error).toString()),e.auth&&e.auth.accessToken&&(r+="; token="+e.auth.accessToken),e.flags&&(r+="; flags="+g.filter(e.hasFlag).join(",")),e.params){var p="";a.forInOwnNonNullProperties(e.params,function(t){p.length>0&&(p+="; "),p+=t+"="+e.params[t]}),p.length>0&&(r+="; params=["+p+"]")}return r+"]"},t.isDuplicate=function(t,e){if(t&&e&&(t.action===h.MESSAGE||t.action===h.PRESENCE)&&t.action===e.action&&t.channel===e.channel&&t.id===e.id){if(t.action===h.PRESENCE)return!0;if(t.messages.length===e.messages.length){for(var r=0;r<t.messages.length;r++){var o=t.messages[r],a=e.messages[r];if((o.extras&&o.extras.delta&&o.extras.delta.format)!==(a.extras&&a.extras.delta&&a.extras.delta.format))return!1}return!0}}return!1},t}();e.default=$},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(10)),l=o.__importDefault(r(26)),f=o.__importDefault(r(3)),h=o.__importDefault(r(8)),p=o.__importDefault(r(19)),A=o.__importDefault(r(16)),g=o.__importDefault(r(5)),m=o.__importDefault(r(20)),v=o.__importDefault(r(0));function $(t){var e;return(e=t).code&&!A.default.isTokenErr(e)&&(a.arrIn([80015,80017,80030],e.code)||e.code>=4e4&&e.code<5e4)?[s.default.fromValues({action:s.default.Action.ERROR,error:t})]:[s.default.fromValues({action:s.default.Action.DISCONNECTED,error:t})]}var b=function(t){function e(e,r,o){var a=t.call(this,e,r,o,!0)||this;return a.onAuthUpdated=function(t){a.authParams={access_token:t.token}},a.stream=!("stream"in o)||o.stream,a.sendRequest=null,a.recvRequest=null,a.pendingCallback=null,a.pendingItems=null,a}return o.__extends(e,t),e.prototype.connect=function(){var t=this;f.default.logAction(f.default.LOG_MINOR,"CometTransport.connect()","starting"),l.default.prototype.connect.call(this);var e=this.params,r=e.options,o=h.default.getHost(r,e.host),s=h.default.getPort(r),p=r.tls?"https://":"http://";this.baseUri=p+o+":"+s+"/comet/";var A=this.baseUri+"connect";f.default.logAction(f.default.LOG_MINOR,"CometTransport.connect()","uri: "+A),this.auth.getAuthParams(function(e,r){if(e){t.disconnect(e);return}if(!t.isDisposed){t.authParams=r;var o=t.params.getConnectParams(r);"stream"in o&&(t.stream=o.stream),f.default.logAction(f.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+a.toQueryString(o));var s=!1,l=t.recvRequest=t.createRequest(A,null,o,null,t.stream?m.default.REQ_RECV_STREAM:m.default.REQ_RECV);l.on("data",function(e){t.recvRequest&&(s||(s=!0,t.emit("preconnect")),t.onData(e))}),l.on("complete",function(e){if(t.recvRequest||(e=e||new g.default("Request cancelled",80003,400)),t.recvRequest=null,s||e||(s=!0,t.emit("preconnect")),t.onActivity(),e){e.code?t.onData($(e)):t.disconnect(e);return}v.default.Config.nextTick(function(){t.recv()})}),l.exec()}})},e.prototype.requestClose=function(){f.default.logAction(f.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},e.prototype.requestDisconnect=function(){f.default.logAction(f.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},e.prototype._requestCloseOrDisconnect=function(t){var e=this,r=t?this.closeUri:this.disconnectUri;if(r){var o=this.createRequest(r,null,this.authParams,null,m.default.REQ_SEND);o.on("complete",function(r){r&&(f.default.logAction(f.default.LOG_ERROR,"CometTransport.request"+(t?"Close()":"Disconnect()"),"request returned err = "+a.inspectError(r)),e.finish("disconnected",r))}),o.exec()}},e.prototype.dispose=function(){var t=this;f.default.logAction(f.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(f.default.logAction(f.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",p.default.disconnected),v.default.Config.nextTick(function(){t.emit("disposed")}))},e.prototype.onConnect=function(t){if(!this.isDisposed){var e=t.connectionKey;l.default.prototype.onConnect.call(this,t);var r=this.baseUri+e;f.default.logAction(f.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+r+"; connectionKey = "+t.connectionKey),this.sendUri=r+"/send",this.recvUri=r+"/recv",this.closeUri=r+"/close",this.disconnectUri=r+"/disconnect"}},e.prototype.send=function(t){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(t);return}var e=this.pendingItems||[];e.push(t),this.pendingItems=null,this.sendItems(e)},e.prototype.sendAnyPending=function(){var t=this.pendingItems;t&&(this.pendingItems=null,this.sendItems(t))},e.prototype.sendItems=function(t){var e=this,r=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(t),m.default.REQ_SEND);r.on("complete",function(t,r){if(t&&f.default.logAction(f.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+a.inspectError(t)),e.sendRequest=null,t){t.code?e.onData($(t)):e.disconnect(t);return}r&&e.onData(r),e.pendingItems&&v.default.Config.nextTick(function(){e.sendRequest||e.sendAnyPending()})}),r.exec()},e.prototype.recv=function(){var t=this;if(!this.recvRequest&&this.isConnected){var e=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?m.default.REQ_RECV_STREAM:m.default.REQ_RECV_POLL);e.on("data",function(e){t.onData(e)}),e.on("complete",function(e){if(t.recvRequest=null,t.onActivity(),e){e.code?t.onData($(e)):t.disconnect(e);return}v.default.Config.nextTick(function(){t.recv()})}),e.exec()}},e.prototype.onData=function(t){try{var e=this.decodeResponse(t);if(e&&e.length)for(var r=0;r<e.length;r++)this.onProtocolMessage(s.default.fromDeserialized(e[r]))}catch(o){f.default.logAction(f.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+o.stack)}},e.prototype.encodeRequest=function(t){return JSON.stringify(t)},e.prototype.decodeResponse=function(t){return"string"==typeof t?JSON.parse(t):t},e}(l.default);e.default=b},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()}catch(o){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){var o,a;a=function(t){var e,r;return r=(e=t).lib.WordArray,e.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.clamp();for(var a=[],s=0;s<r;s+=3)for(var l=e[s>>>2]>>>24-s%4*8&255,f=e[s+1>>>2]>>>24-(s+1)%4*8&255,h=e[s+2>>>2]>>>24-(s+2)%4*8&255,p=l<<16|f<<8|h,A=0;A<4&&s+.75*A<r;A++)a.push(o.charAt(p>>>6*(3-A)&63));var g=o.charAt(64);if(g)for(;a.length%4;)a.push(g);return a.join("")},parse:function(t){var e=t.length,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var s=0;s<o.length;s++)a[o.charCodeAt(s)]=s}var l=o.charAt(64);if(l){var f=t.indexOf(l);-1!==f&&(e=f)}return function t(e,o,a){for(var s=[],l=0,f=0;f<o;f++)if(f%4){var h,p=a[e.charCodeAt(f-1)]<<f%4*2|a[e.charCodeAt(f)]>>>6-f%4*2;s[l>>>2]|=p<<24-l%4*8,l++}return r.create(s,l)}(t,e,a)}},t.enc.Base64},t.exports=e=a(r(6))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(3)),s=o.__importDefault(r(0)),l=o.__importDefault(r(9)),f=o.__importStar(r(2)),h=function(){function t(){}return t.prototype.isSynthesized=function(){return!this.id||!this.connectionId||this.id.substring(this.connectionId.length,0)!==this.connectionId},t.prototype.parseId=function(){if(!this.id)throw Error("parseId(): Presence message does not contain an id");var t=this.id.split(":");return{connectionId:t[0],msgSerial:parseInt(t[1],10),index:parseInt(t[2],10)}},t.prototype.toJSON=function(){var t,e=this.data,r=this.encoding;return e&&s.default.BufferUtils.isBuffer(e)&&(arguments.length>0?(r=r?r+"/base64":"base64",e=s.default.BufferUtils.base64Encode(e)):e=s.default.BufferUtils.toBuffer(e)),{clientId:this.clientId,action:(t=this.action,h.Actions.indexOf(t)),data:e,encoding:r}},t.prototype.toString=function(){var t="[PresenceMessage";return t+="; action="+this.action,this.id&&(t+="; id="+this.id),this.timestamp&&(t+="; timestamp="+this.timestamp),this.clientId&&(t+="; clientId="+this.clientId),this.connectionId&&(t+="; connectionId="+this.connectionId),this.encoding&&(t+="; encoding="+this.encoding),this.data&&("string"==typeof this.data?t+="; data="+this.data:s.default.BufferUtils.isBuffer(this.data)?t+="; data (buffer)="+s.default.BufferUtils.base64Encode(this.data):t+="; data (json)="+JSON.stringify(this.data)),t+="]"},t.fromResponseBody=function(e,r,o){var s=[];o&&(e=f.decodeBody(e,o));for(var l=0;l<e.length;l++){var h=s[l]=t.fromValues(e[l],!0);try{t.decode(h,r)}catch(p){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",p.toString())}}return s},t.fromValues=function(e,r){return r&&(e.action=t.Actions[e.action]),Object.assign(new t,e)},t.fromValuesArray=function(e){for(var r=e.length,o=Array(r),a=0;a<r;a++)o[a]=t.fromValues(e[a]);return o},t.fromEncoded=function(e,r){var o=t.fromValues(e,!0);try{t.decode(o,r)}catch(s){a.default.logAction(a.default.LOG_ERROR,"PresenceMessage.fromEncoded()",s.toString())}return o},t.fromEncodedArray=function(e,r){return e.map(function(e){return t.fromEncoded(e,r)})},t.Actions=["absent","present","enter","leave","update"],t.encode=l.default.encode,t.decode=l.default.decode,t.getMessagesSize=l.default.getMessagesSize,t}();e.default=h},function(t,e,r){"use strict";(function(t){e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(7)),l=o.__importDefault(r(5)),f=o.__importDefault(r(3)),h=o.__importDefault(r(8)),p=o.__importDefault(r(20)),A=o.__importDefault(r(0)),g=function(){},m=0,v={},$=void 0!==t&&t.XDomainRequest,b=function(t){function e(e,r,o,s,l,f,h){var p,A,g=t.call(this)||this;return(o=o||{}).rnd=a.cheapRandStr(),$&&(p=(A=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/))&&Number(A[1]))&&10===p&&!o.envelope&&(o.envelope="json"),g.uri=e+a.toQueryString(o),g.headers=r||{},g.body=s,g.method=h?h.toUpperCase():a.isEmptyArg(s)?"GET":"POST",g.requestMode=l,g.timeouts=f,g.timedOut=!1,g.requestComplete=!1,g.id=String(++m),v[g.id]=g,g}return o.__extends(e,t),e.createRequest=function(t,r,o,s,l,f,p){var A=f||h.default.TIMEOUTS;return new e(t,r,a.copy(o),s,l,A,p)},e.prototype.complete=function(t,e,r,o,a){this.requestComplete||(this.requestComplete=!0,!t&&e&&this.emit("data",e),this.emit("complete",t,e,r,o,a),this.dispose())},e.prototype.abort=function(){this.dispose()},e.prototype.exec=function(){var t=this,e=this.headers,r=this.requestMode==p.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,o=this.timer=setTimeout(function(){t.timedOut=!0,h.abort()},r),s=this.method,h=this.xhr=new XMLHttpRequest,g=e.accept,m=this.body,v="text";for(var $ in g?0===g.indexOf("application/x-msgpack")&&(v="arraybuffer"):e.accept="application/json",m&&(e["content-type"]||(e["content-type"]="application/json")).indexOf("application/json")>-1&&"string"!=typeof m&&(m=JSON.stringify(m)),h.open(s,this.uri,!0),h.responseType=v,"authorization"in e&&(h.withCredentials=!0),e)h.setRequestHeader($,e[$]);var b=function(e,r,o,a){var s,h=r+" (event type: "+e.type+")";!(null===(s=null==t?void 0:t.xhr)||void 0===s)&&s.statusText&&(h+=", current statusText is "+t.xhr.statusText),f.default.logAction(f.default.LOG_ERROR,"Request.on"+e.type+"()",h),t.complete(new l.default(h,o,a))};h.onerror=function(t){b(t,"XHR error occurred",null,400)},h.onabort=function(e){t.timedOut?b(e,"Request aborted due to request timeout expiring",null,408):b(e,"Request cancelled",null,400)},h.ontimeout=function(t){b(t,"Request timed out",null,408)};var C,_,O,w=0,I=!1,R=function(){var e;if(clearTimeout(o),O=_<400,204==_){t.complete(null,null,null,null,_);return}C=t.requestMode==p.default.REQ_RECV_STREAM&&O&&(e=h).getResponseHeader&&(e.getResponseHeader("transfer-encoding")||!e.getResponseHeader("content-length"))},M=function(){try{var r,o,s=(r=h).getResponseHeader&&r.getResponseHeader("content-type");if(s?s.indexOf("application/json")>=0:"text"==h.responseType){var f="arraybuffer"===h.responseType?A.default.BufferUtils.utf8Decode(h.response):String(h.responseText);o=f.length?JSON.parse(f):f,I=!0}else o=h.response;void 0!==o.response?(O=(_=o.statusCode)<400,e=o.headers,o=o.response):e=function t(e){for(var r=a.trim(e.getAllResponseHeaders()).split(`\r
`),o={},s=0;s<r.length;s++){var l=r[s].split(":").map(a.trim);o[l[0].toLowerCase()]=l[1]}return o}(h)}catch(p){t.complete(new l.default("Malformed response body from server: "+p.message,null,400));return}if(O||a.isArray(o)){t.complete(null,o,e,I,_);return}var g=function t(e,r){var o,s;if(s=r,a.arrIn(a.allToLowerCase(a.keysArray(s)),"x-ably-errorcode"))return e.error&&l.default.fromValues(e.error)}(o,e);g||(g=new l.default("Error response received from server: "+_+" body was: "+A.default.Config.inspect(o),null,_)),t.complete(g,o,e,I,_)};function T(){for(var t,e,r=h.responseText,o=r.length-1;w<o&&(t=r.indexOf(`
`,w))>-1;)e=r.slice(w,t),w=t+1,P(e)}var P=function(e){try{e=JSON.parse(e)}catch(r){t.complete(new l.default("Malformed response body from server: "+r.message,null,400));return}t.emit("data",e)},k=function(){T(),t.streamComplete=!0,A.default.Config.nextTick(function(){t.complete()})};h.onreadystatechange=function(){var t=h.readyState;t<3||0!==h.status&&(void 0===_&&(1223===(_=h.status)&&(_=204),R()),3==t&&C?T():4==t&&(C?k():M()))},h.send(m)},e.prototype.dispose=function(){var t=this.xhr;if(t){t.onreadystatechange=t.onerror=t.onabort=t.ontimeout=g,this.xhr=null;var e=this.timer;e&&(clearTimeout(e),this.timer=null),this.requestComplete||t.abort()}delete v[this.id]},e}(s.default);e.default=b}).call(this,r(12))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(3)),s=o.__importStar(r(2)),l=o.__importDefault(r(22)),f=o.__importDefault(r(5)),h=o.__importDefault(r(43)),p=r(13),A=r(32),g=o.__importDefault(r(17)),m=o.__importDefault(r(0));function v(){}function $(t){return s.isErrorInfo(t)?(t.code||(403===t.statusCode?t.code=40300:(t.code=40170,t.statusCode=401)),t):new f.default(s.inspectError(t),t.code||40170,t.statusCode||401)}var b=function(t){return m.default.Config.createHmac?Buffer.from(t,"ascii").toString("base64"):p.stringify(A.parse(t))},C=function(t,e){if(m.default.Config.createHmac){var r=m.default.Config.createHmac("SHA256",e);return r.update(t),r.digest("base64")}return p.stringify(h.default(t,e))};function _(t){if(!t)return"";"string"==typeof t&&(t=JSON.parse(t));var e={},r=s.keysArray(t,!0);if(!r)return"";r.sort();for(var o=0;o<r.length;o++)e[r[o]]=t[r[o]].sort();return JSON.stringify(e)}function O(t){if(t.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(t.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(t.key)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(t.tokenDetails)a.default.logAction(a.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var e="authOptions must include valid authentication parameters";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",e),Error(e)}}var w=0,I=function(){function t(t,e){var r,o;if(this.authOptions={},this.client=t,this.tokenParams=e.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,(r=e).useTokenAuth||(!("useTokenAuth"in(o=r))||o.useTokenAuth)&&(r.authCallback||r.authUrl||r.token||r.tokenDetails)){if(e.key&&!C){var s,l="client-side token request signing not supported";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",l),Error(l)}(s=e).key||s.authCallback||s.authUrl||a.default.logAction(a.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(e.defaultTokenParams,e),O(this.authOptions)}else{if(!e.key){var l="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw a.default.logAction(a.default.LOG_ERROR,"Auth()",l),new f.default(l,40160,401)}a.default.logAction(a.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(e)}}return t.prototype.authorize=function(t,e,r){var o,l=this;if("function"!=typeof t||r?"function"!=typeof e||r?o=e:(r=e,o=null):(r=t,o=t=null),!r&&this.client.options.promises)return s.promisify(this,"authorize",arguments);if(o&&o.key&&this.authOptions.key!==o.key)throw new f.default("Unable to update auth options with incompatible key",40102,401);o&&"force"in o&&(a.default.logAction(a.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),s.isOnlyPropIn(o,"force")&&(o=null)),this._forceNewToken(t,o,function(t,e){var o;if(t){l.client.connection&&l.client.connection.connectionManager.actOnErrorFromAuthorize(t),null==r||r(t);return}(o=l.client).connection?l.client.connection.connectionManager.onAuthUpdated(e,r||v):null==r||r(null,e)})},t.prototype.authorise=function(t,e,r){a.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(t,e,r)},t.prototype._forceNewToken=function(t,e,r){var o=this;this.tokenDetails=null,this._saveTokenOptions(t,e),O(this.authOptions),this._ensureValidAuthCredentials(!0,function(t,e){delete o.tokenParams.timestamp,delete o.authOptions.queryTime,r(t,e)})},t.prototype.requestToken=function(t,e,r){var o=this;if("function"!=typeof t||r?"function"!=typeof e||r||(r=e,e=null):(r=t,e=t=null),!r&&this.client.options.promises)return s.promisify(this,"requestToken",arguments);e=e||this.authOptions,t=t||s.copy(this.tokenParams);var l,h=r||v,p=this.client;if(e.authCallback)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),l=e.authCallback;else if(e.authUrl)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),l=function(t,r){var l,h=s.mixin({accept:"application/json, text/plain"},e.authHeaders),A=e.authMethod&&"post"===e.authMethod.toLowerCase(),v=e.authUrl.indexOf("?");v>-1&&(l=s.parseQueryString(e.authUrl.slice(v)),e.authUrl=e.authUrl.slice(0,v),A||(e.authParams=s.mixin(l,e.authParams)));var $=s.mixin({},e.authParams||{},t),b=function(t,e,o,l){if(t?a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+s.inspectError(t)):(h=o["content-type"],a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+h+"; body: "+s.inspectBody(e))),t||l)return r(t,e);if(m.default.BufferUtils.isBuffer(e)&&(e=e.toString()),!h){r(new f.default("authUrl response is missing a content-type header",40170,401));return}var h,p=h.indexOf("application/json")>-1,A=h.indexOf("text/plain")>-1||h.indexOf("application/jwt")>-1;if(!p&&!A){r(new f.default("authUrl responded with unacceptable content-type "+h+", should be either text/plain, application/jwt or application/json",40170,401));return}if(p){if(e.length>131072){r(new f.default("authUrl response exceeded max permitted length",40170,401));return}try{e=JSON.parse(e)}catch(g){r(new f.default("Unexpected error processing authURL response; err = "+g.message,40170,401));return}}r(null,e,h)};if(a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+e.authUrl+"; Params: "+JSON.stringify($)+"; method: "+(A?"POST":"GET")),A){var C=h||{};C["content-type"]="application/x-www-form-urlencoded";var _=s.toQueryString($).slice(1);o.client.http.doUri(g.default.Post,p,e.authUrl,C,_,l,b)}else o.client.http.doUri(g.default.Get,p,e.authUrl,h||{},null,$,b)};else if(e.key)a.default.logAction(a.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),l=function(t,r){o.createTokenRequest(t,e,r)};else{a.default.logAction(a.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),h(new f.default("Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)",40171,403));return}"capability"in t&&(t.capability=_(t.capability));var A=function(t,r){var l="/keys/"+t.keyName+"/requestToken",f=function(t){return p.baseUri(t)+l},h=s.defaultPostHeaders();e.requestHeaders&&s.mixin(h,e.requestHeaders),a.default.logAction(a.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+l+"; Token params: "+JSON.stringify(t)),o.client.http.do(g.default.Post,p,f,h,JSON.stringify(t),null,r)},b=!1,C=this.client.options.timeouts.realtimeRequestTimeout,O=setTimeout(function(){b=!0;var t="Token request callback timed out after "+C/1e3+" seconds";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",t),h(new f.default(t,40170,401))},C);l(t,function(t,r,o){if(!b){if(clearTimeout(O),t){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+s.inspectError(t)),h($(t));return}if("string"==typeof r){0===r.length?h(new f.default("Token string is empty",40170,401)):r.length>131072?h(new f.default("Token string exceeded max permitted length (was "+r.length+" bytes)",40170,401)):"undefined"===r||"null"===r?h(new f.default("Token string was literal null/undefined",40170,401)):"{"!==r[0]||o&&o.indexOf("application/jwt")>-1?h(null,{token:r}):h(new f.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401));return}if("object"!=typeof r){var l="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof r;a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",l),h(new f.default(l,40170,401));return}var p=JSON.stringify(r).length;if(p>131072&&!e.suppressMaxLengthCheck){h(new f.default("Token request/details object exceeded max permitted stringified size (was "+p+" bytes)",40170,401));return}if("issued"in r){h(null,r);return}if(!("keyName"in r)){var l="Expected token request callback to call back with a token string, token request object, or token details object";a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()",l),h(new f.default(l,40170,401));return}A(r,function(t,e,r,o){if(t){a.default.logAction(a.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+s.inspectError(t)),h($(t));return}o||(e=JSON.parse(e)),a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","token received"),h(null,e)})}})},t.prototype.createTokenRequest=function(t,e,r){var o=this;if("function"!=typeof t||r?"function"!=typeof e||r||(r=e,e=null):(r=t,e=t=null),!r&&this.client.options.promises)return s.promisify(this,"createTokenRequest",arguments);e=e||this.authOptions,t=t||s.copy(this.tokenParams);var l=e.key;if(!l){r(new f.default("No key specified",40101,403));return}var h=l.split(":"),p=h[0],A=h[1];if(!A){r(new f.default("Invalid key specified",40101,403));return}if(""===t.clientId){r(new f.default("clientId can’t be an empty string",40012,400));return}"capability"in t&&(t.capability=_(t.capability));var g=s.mixin({keyName:p},t),m=t.clientId||"",v=t.ttl||"",$=t.capability||"";(function(t){if(g.timestamp){t();return}o.getTimestamp(e&&e.queryTime,function(e,o){if(e){r(e);return}g.timestamp=o,t()})})(function(){var t=g.nonce||(g.nonce=("000000"+Math.floor(1e16*Math.random())).slice(-16)),e=g.timestamp,o=g.keyName+`
`+v+`
`+$+`
`+m+`
`+e+`
`+t+`
`;g.mac=g.mac||C(o,A),a.default.logAction(a.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),r(null,g)})},t.prototype.getAuthParams=function(t){"basic"==this.method?t(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(e,r){if(e){t(e);return}if(!r)throw Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");t(null,{access_token:r.token})})},t.prototype.getAuthHeaders=function(t){"basic"==this.method?t(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(e,r){if(e){t(e);return}if(!r)throw Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");t(null,{authorization:"Bearer "+b(r.token)})})},t.prototype.getTimestamp=function(t,e){!this.isTimeOffsetSet()&&(t||this.authOptions.queryTime)?this.client.time(e):e(null,this.getTimestampUsingOffset())},t.prototype.getTimestampUsingOffset=function(){return s.now()+(this.client.serverTimeOffset||0)},t.prototype.isTimeOffsetSet=function(){return null!==this.client.serverTimeOffset},t.prototype._saveBasicOptions=function(t){this.method="basic",this.key=t.key,this.basicKey=b(t.key),this.authOptions=t||{},"clientId"in t&&this._userSetClientId(t.clientId)},t.prototype._saveTokenOptions=function(t,e){this.method="token",t&&(this.tokenParams=t),e&&(e.token&&(e.tokenDetails="string"==typeof e.token?{token:e.token}:e.token),e.tokenDetails&&(this.tokenDetails=e.tokenDetails),"clientId"in e&&this._userSetClientId(e.clientId),this.authOptions=e)},t.prototype._ensureValidAuthCredentials=function(t,e){var r=this,o=this.tokenDetails;if(o){if(this._tokenClientIdMismatch(o.clientId)){e(new f.default("Mismatch between clientId in token ("+o.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!o.expires||o.expires>=this.getTimestampUsingOffset()){a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+o.expires),e(null,o);return}a.default.logAction(a.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=l.default.create())).push(e),!(null!==this.currentTokenRequestId&&!t)){var s=this.currentTokenRequestId=w++;this.requestToken(this.tokenParams,this.authOptions,function(t,e){if(r.currentTokenRequestId>s){a.default.logAction(a.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}r.currentTokenRequestId=null;var o=r.waitingForTokenRequest||v;if(r.waitingForTokenRequest=null,t){o(t);return}o(null,r.tokenDetails=e)})}},t.prototype._userSetClientId=function(t){if("string"==typeof t||null===t){if("*"===t)throw new f.default('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var e=this._uncheckedSetClientId(t);if(e)throw e}else throw new f.default("clientId must be either a string or null",40012,400)},t.prototype._uncheckedSetClientId=function(t){if(!this._tokenClientIdMismatch(t))return this.clientId=this.tokenParams.clientId=t,null;var e="Unexpected clientId mismatch: client has "+this.clientId+", requested "+t,r=new f.default(e,40102,401);return a.default.logAction(a.default.LOG_ERROR,"Auth._uncheckedSetClientId()",e),r},t.prototype._tokenClientIdMismatch=function(t){return!!(this.clientId&&"*"!==this.clientId&&t&&"*"!==t&&this.clientId!==t)},t.isTokenErr=function(t){return t.code&&t.code>=40140&&t.code<40150},t}();e.default=I},function(t,e,r){"use strict";var o,a;e.__esModule=!0,(a=o||(o={})).Get="get",a.Delete="delete",a.Post="post",a.Put="put",a.Patch="patch",e.default=o},function(t,e,r){"use strict";e.__esModule=!0,e.HttpPaginatedResponse=e.PaginatedResult=void 0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(3)),l=o.__importDefault(r(24));function f(t){var e=t.match(/^\.\/(\w+)\?(.*)$/);return e&&e[2]&&a.parseQueryString(e[2])}var h=function(){function t(t,e,r,o,a,s){this.rest=t,this.path=e,this.headers=r,this.envelope=null!=o?o:null,this.bodyHandler=a,this.useHttpPaginatedResponse=s||!1}return t.prototype.get=function(t,e){var r=this;l.default.get(this.rest,this.path,this.headers,t,this.envelope,function(t,o,a,s,l){r.handlePage(t,o,a,s,l,e)})},t.prototype.delete=function(t,e){var r=this;l.default.delete(this.rest,this.path,this.headers,t,this.envelope,function(t,o,a,s,l){r.handlePage(t,o,a,s,l,e)})},t.prototype.post=function(t,e,r){var o=this;l.default.post(this.rest,this.path,e,this.headers,t,this.envelope,function(t,e,a,s,l){r&&o.handlePage(t,e,a,s,l,r)})},t.prototype.put=function(t,e,r){var o=this;l.default.put(this.rest,this.path,e,this.headers,t,this.envelope,function(t,e,a,s,l){r&&o.handlePage(t,e,a,s,l,r)})},t.prototype.patch=function(t,e,r){var o=this;l.default.patch(this.rest,this.path,e,this.headers,t,this.envelope,function(t,e,a,s,l){r&&o.handlePage(t,e,a,s,l,r)})},t.prototype.handlePage=function(t,e,r,o,l,h){var g,m,v,$,b,C;if(t&&($=t,b=e,!((C=this.useHttpPaginatedResponse)&&(b||"number"==typeof $.code)))){s.default.logAction(s.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+a.inspectError(t)),null==h||h(t);return}try{g=this.bodyHandler(e,r||{},o)}catch(_){null==h||h(t||_);return}r&&(m=r.Link||r.link)&&(v=function t(e){"string"==typeof e&&(e=e.split(","));for(var r={},o=0;o<e.length;o++){var a=e[o].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(a){var s=f(a[1]);s&&(r[a[2]]=s)}}return r}(m)),h(null,this.useHttpPaginatedResponse?new A(this,g,r||{},l,v,t):new p(this,g,v))},t}(),p=function(){function t(t,e,r){var o=this;this.resource=t,this.items=e;var s=this;r&&("first"in r&&(this.first=function(t){if(!t&&s.resource.rest.options.promises)return a.promisify(s,"first",[]);s.get(r.first,t)}),"current"in r&&(this.current=function(t){if(!t&&s.resource.rest.options.promises)return a.promisify(s,"current",[]);s.get(r.current,t)}),this.next=function(t){if(!t&&s.resource.rest.options.promises)return a.promisify(s,"next",[]);"next"in r?s.get(r.next,t):t(null)},this.hasNext=function(){return"next"in r},this.isLast=function(){var t;return!(!(null===(t=o.hasNext)||void 0===t)&&t.call(o))})}return t.prototype.get=function(t,e){var r=this.resource;l.default.get(r.rest,r.path,r.headers,t,r.envelope,function(t,o,a,s,l){r.handlePage(t,o,a,s,l,e)})},t}();e.PaginatedResult=p;var A=function(t){function e(e,r,o,a,s,l){var f=t.call(this,e,r,s)||this;return f.statusCode=a,f.success=a<300&&a>=200,f.headers=o,f.errorCode=l&&l.code,f.errorMessage=l&&l.message,f}return o.__extends(e,t),e.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},e}(p);e.HttpPaginatedResponse=A,e.default=h},function(t,e,r){"use strict";e.__esModule=!0,e.isRetriable=void 0;var o=r(1).__importDefault(r(5)),a={disconnected:o.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:o.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:o.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:o.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:o.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:o.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:o.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};e.isRetriable=function t(e){if(!e.statusCode||!e.code||e.statusCode>=500)return!0;var r=!1;return Object.values(a).forEach(function(t){t.code&&t.code==e.code&&(r=!0)}),r},e.default=a},function(t,e,r){"use strict";var o,a;e.__esModule=!0,(a=o||(o={}))[a.REQ_SEND=0]="REQ_SEND",a[a.REQ_RECV=1]="REQ_RECV",a[a.REQ_RECV_POLL=2]="REQ_RECV_POLL",a[a.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",e.default=o},function(t,e,r){var o,a;a=function(t){return t},t.exports=e=a(r(6),r(4),r(58),r(13),r(39),r(31),r(23),r(27),r(28),r(59),r(60))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1).__importDefault(r(3)),a=function(){function t(t){this.members=t||[]}return t.prototype.call=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0,a=this.members;r<a.length;r++){var s=a[r];if(s)try{s.apply(void 0,t)}catch(l){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+l+"; stack = "+l.stack)}}},t.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this.members).push.apply(t,e)},t.create=function(e){var r=new t(e);return Object.assign(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.call.apply(r,t)},{push:function(t){return r.push(t)}})},t}();e.default=a},function(t,e,r){var o,a;a=function(t){var e,r,o;r=(e=t).lib.Base,o=e.enc.Utf8,e.algo.HMAC=r.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=o.parse(e));var r=t.blockSize,a=4*r;e.sigBytes>a&&(e=t.finalize(e)),e.clamp();for(var s=this._oKey=e.clone(),l=this._iKey=e.clone(),f=s.words,h=l.words,p=0;p<r;p++)f[p]^=1549556828,h[p]^=909522486;s.sigBytes=l.sigBytes=a,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,r=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(r))}})},t.exports=e=a(r(6))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(0)),s=o.__importStar(r(2)),l=o.__importDefault(r(3)),f=o.__importDefault(r(16)),h=o.__importDefault(r(17)),p=o.__importDefault(r(5));function A(t,e,r,o,a){t.http.supportsAuthHeaders?t.auth.getAuthHeaders(function(t,l){t?o(t):a(s.mixin(l,e),r)}):t.auth.getAuthParams(function(t,l){t?o(t):a(e,s.mixin(l,r))})}function g(t){var e=[];if(t)for(var r in t)e.push(r+"="+t[r]);return e.join("&")}function m(t,e){return t+(e?"?":"")+g(e)}var v=function(){function t(){}return t.get=function(e,r,o,a,s,l){t.do(h.default.Get,e,r,null,o,a,s,l)},t.delete=function(e,r,o,a,s,l){t.do(h.default.Delete,e,r,null,o,a,s,l)},t.post=function(e,r,o,a,s,l,f){t.do(h.default.Post,e,r,o,a,s,l,f)},t.patch=function(e,r,o,a,s,l,f){t.do(h.default.Patch,e,r,o,a,s,l,f)},t.put=function(e,r,o,a,s,l,f){t.do(h.default.Put,e,r,o,a,s,l,f)},t.do=function(t,e,r,o,h,v,$,b){var C,_,O,w,I,R;function M(h,p){var g;if(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Resource."+t+"()","Sending; "+m(r,p)),l.default.shouldLog(l.default.LOG_MICRO)){var v=o;if((null===(g=h["content-type"])||void 0===g?void 0:g.indexOf("msgpack"))>0)try{v=a.default.Config.msgpack.decode(o)}catch($){l.default.logAction(l.default.LOG_MICRO,"Resource."+t+"()","Sending MsgPack Decoding Error: "+s.inspectError($))}l.default.logAction(l.default.LOG_MICRO,"Resource."+t+"()","Sending; "+m(r,p)+"; Body: "+v)}e.http.do(t,e,r,h,o,p,function(t,r,o,a,s){if(t&&f.default.isTokenErr(t)){e.auth.authorize(null,null,function(t){if(t){b(t);return}A(e,o,p,b,M)});return}b(t,r,o,a,s)})}l.default.shouldLog(l.default.LOG_MICRO)&&(b=(C=b,_=t,O=r,w=v,function(t,e,r,o,f){t?l.default.logAction(l.default.LOG_MICRO,"Resource."+_+"()","Received Error; "+m(O,w)+"; Error: "+s.inspectError(t)):l.default.logAction(l.default.LOG_MICRO,"Resource."+_+"()","Received; "+m(O,w)+"; Headers: "+g(r)+"; StatusCode: "+f+"; Body: "+(a.default.BufferUtils.isBuffer(e)?e.toString():e)),C&&C(t,e,r,o,f)})),$&&(b=b&&(I=b,R=$,function(t,e,r,o,a){if(t&&!e){I(t);return}if(!o)try{e=s.decodeBody(e,R)}catch(l){I(l);return}if(!e){I(new p.default("unenvelope(): Response body is missing",null));return}var f=e,h=f.statusCode,A=f.response,g=f.headers;if(void 0===h){I(t,e,r,!0,a);return}if(h<200||h>=300){var m=A&&A.error||t;m||((m=Error("Error in unenveloping "+e)).statusCode=h),I(m,A,g,!0,h);return}I(t,A,g,!0,h)}),(v=v||{}).envelope=$),A(e,h,v,b,M)},t}();e.default=v},function(t,e,r){"use strict";(function(t){e.__esModule=!0,e.TransportParams=void 0;var o=r(1),a=o.__importDefault(r(10)),s=o.__importStar(r(2)),l=o.__importStar(r(51)),f=o.__importDefault(r(8)),h=o.__importDefault(r(0)),p=o.__importDefault(r(7)),A=o.__importDefault(r(35)),g=o.__importDefault(r(3)),m=o.__importDefault(r(36)),v=o.__importStar(r(19)),$=o.__importDefault(r(5)),b=o.__importDefault(r(16)),C=o.__importDefault(r(9)),_=o.__importDefault(r(22)),O=o.__importDefault(r(52)),w=o.__importDefault(r(26)),I=o.__importDefault(r(53)),R=function(){var t;return void 0!==h.default.WebStorage&&(null===(t=h.default.WebStorage)||void 0===t?void 0:t.localSupported)},M=function(){var t;return void 0!==h.default.WebStorage&&(null===(t=h.default.WebStorage)||void 0===t?void 0:t.sessionSupported)},T=a.default.Action,P=function(){},k="ably-transport-preference",B="ably-connection-recovery",D=function(){function t(t,e,r,o){this.options=t,this.host=e,this.mode=r,this.connectionKey=o,this.format=t.useBinaryProtocol?s.Format.msgpack:s.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return t.prototype.getConnectParams=function(t){var e=t?s.copy(t):{},r=this.options;switch(this.mode){case"upgrade":e.upgrade=this.connectionKey;break;case"resume":e.resume=this.connectionKey,void 0!==this.timeSerial?e.timeSerial=this.timeSerial:void 0!==this.connectionSerial&&(e.connectionSerial=this.connectionSerial);break;case"recover":var o=r.recover.split(":");if(o){e.recover=o[0];var a=o[1];isNaN(Number(a))?e.timeSerial=a:e.connectionSerial=a}}return void 0!==r.clientId&&(e.clientId=r.clientId),!1===r.echoMessages&&(e.echo="false"),void 0!==this.format&&(e.format=this.format),void 0!==this.stream&&(e.stream=this.stream),void 0!==this.heartbeats&&(e.heartbeats=this.heartbeats),e.v=f.default.apiVersion,e.agent=encodeURIComponent(f.default.agent),void 0!==r.transportParams&&s.mixin(e,r.transportParams),e},t.prototype.toString=function(){var t="[mode="+this.mode;return this.host&&(t+=",host="+this.host),this.connectionKey&&(t+=",connectionKey="+this.connectionKey),void 0!==this.connectionSerial&&(t+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(t+=",timeSerial="+this.timeSerial),this.format&&(t+=",format="+this.format),t+="]"},t}();e.TransportParams=D;var x=function(e){function r(t,o){var a=e.call(this)||this;a.disconnectedRetryCount=0,r.initTransports(),a.realtime=t,a.options=o;var l=o.timeouts,p=l.preferenceConnectTimeout+l.realtimeRequestTimeout;if(a.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:p,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:l.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:l.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:l.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},a.state=a.states.initialized,a.errorReason=null,a.queuedMessages=new A.default,a.msgSerial=0,a.connectionDetails=void 0,a.connectionId=void 0,a.connectionKey=void 0,a.timeSerial=void 0,a.connectionSerial=void 0,a.connectionStateTtl=l.connectionStateTtl,a.maxIdleInterval=null,a.transports=s.intersect(o.transports||f.default.defaultTransports,r.supportedTransports),a.baseTransport=s.intersect(f.default.baseTransportOrder,a.transports)[0],a.upgradeTransports=s.intersect(a.transports,f.default.upgradeTransports),a.transportPreference=null,a.httpHosts=f.default.getHosts(o),a.activeProtocol=null,a.proposedTransports=[],a.pendingTransports=[],a.host=null,a.lastAutoReconnectAttempt=null,a.lastActivity=null,a.mostRecentMsg=null,a.forceFallbackHost=!1,a.connectCounter=0,g.default.logAction(g.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),g.default.logAction(g.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(o.transports||f.default.defaultTransports)+"]"),g.default.logAction(g.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+a.transports+"]"),g.default.logAction(g.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+a.httpHosts+"]"),!a.transports.length){var m="no requested transports available";throw g.default.logAction(g.default.LOG_ERROR,"realtime.ConnectionManager()",m),Error(m)}var v=h.default.Config.addEventListener;return v&&(M()&&"function"==typeof o.recover&&v("beforeunload",a.persistConnection.bind(a)),!0===o.closeOnUnload&&v("beforeunload",function(){g.default.logAction(g.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),a.requestState({state:"closing"})}),v("online",function(){(a.state==a.states.disconnected||a.state==a.states.suspended)&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager caught browser ‘online’ event","reattempting connection"),a.requestState({state:"connecting"}))}),v("offline",function(){a.state==a.states.connected&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager caught browser ‘offline’ event","disconnecting active transport"),a.disconnectAllTransports())})),a}return o.__extends(r,e),r.initTransports=function(){O.default(r),s.arrForEach(h.default.Transports,function(t){t(r)})},r.prototype.createTransportParams=function(t,e){var r=new D(this.options,t,e,this.connectionKey);return this.timeSerial?r.timeSerial=String(this.timeSerial):void 0!==this.connectionSerial&&(r.connectionSerial=this.connectionSerial),r},r.prototype.getTransportParams=function(t){var e=this;(function(t){if(e.connectionKey){t("resume");return}if("string"==typeof e.options.recover){t("recover");return}var r,o,a=e.options.recover,s=M()&&(null===(o=null===(r=h.default.WebStorage)||void 0===r?void 0:r.getSession)||void 0===o?void 0:o.call(r,B));if(s&&"function"==typeof a){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),a(s,function(r){r?(e.options.recover=s.recoveryKey,t("recover")):t("clean")});return}t("clean")})(function(r){var o=e.createTransportParams(null,r);if("recover"===r){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+e.options.recover);var a=e.options.recover.split(":");a&&a[2]&&(e.msgSerial=Number(a[2]))}else g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+o.toString());t(o)})},r.prototype.tryATransport=function(t,e,o){var a=this;g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+e),w.default.tryConnect(r.supportedTransports[e],this,this.realtime.auth,t,function(r,s){var l=a.state;if(l==a.states.closing||l==a.states.closed||l==a.states.failed){s&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+l.state+" while we were attempting the transport; closing "+s),s.close()),o(!0);return}if(r){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+e+" "+r.event+", err: "+r.error.toString()),b.default.isTokenErr(r.error)&&!(a.errorReason&&b.default.isTokenErr(a.errorReason))?(a.errorReason=r.error,a.realtime.auth._forceNewToken(null,null,function(r){if(r){a.actOnErrorFromAuthorize(r);return}a.tryATransport(t,e,o)})):"failed"===r.event?(a.notifyState({state:"failed",error:r.error}),o(!0)):"disconnected"===r.event&&(v.isRetriable(r.error)?o(!1):(a.notifyState({state:a.states.connecting.failState,error:r.error}),o(!0)));return}g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+e+"; setting pending"),a.setTransportPending(s,t),o(null,s)})},r.prototype.setTransportPending=function(t,e){var r=this,o=e.mode;g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+t+"; mode = "+o),s.arrDeleteValue(this.proposedTransports,t),this.pendingTransports.push(t);var a=h.default.Defaults.transportPreferenceOrder[h.default.Defaults.transportPreferenceOrder.length-1];t.once("connected",function(l,f,p,A){"upgrade"==o?t.shortName!==a&&s.arrIn(r.getUpgradePossibilities(),a)&&r.activeProtocol?setTimeout(function(){r.scheduleTransportActivation(l,t,f,p,A)},r.options.timeouts.parallelUpgradeDelay):r.scheduleTransportActivation(l,t,f,p,A):(r.activateTransport(l,t,f,p,A),h.default.Config.nextTick(function(){r.connectImpl(e)})),"recover"===o&&r.options.recover&&(r.options.recover=null,r.unpersistConnection())});var l=this;t.on(["disconnected","closed","failed"],function(e){l.deactivateTransport(t,this.event,e)}),this.emit("transport.pending",t)},r.prototype.scheduleTransportActivation=function(t,e,r,o,a){var l,f,p=this,A=this.activeProtocol&&this.activeProtocol.getTransport(),m=function(){e.disconnect(),s.arrDeleteValue(p.pendingTransports,e)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+e.shortName),m();return}if(A&&(l=e,f=A,!(s.arrIndexOf(h.default.Defaults.transportPreferenceOrder,l.shortName)>s.arrIndexOf(h.default.Defaults.transportPreferenceOrder,f.shortName)))){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+e.shortName+" is no better than current active transport "+A.shortName+" - abandoning upgrade"),m();return}g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+e);var v=function(s){if(s){g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+e+"; err = "+s);return}if(!e.isConnected){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+e.shortName+"is no longer connected; abandoning upgrade"),m();return}if(p.state===p.states.connected)g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),p.state=p.states.synchronizing,l=p.activeProtocol;else if(p.state!==p.states.connecting){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+p.state.state+(p.state===p.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+e.shortName),m();return}var l,f=r!==p.connectionId,h=f?a:p;f&&g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(p.timeSerial||p.connectionSerial)+" to "+(h.timeSerial||h.connectionSerial)+"; upgrade error was "+t),g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+e),p.sync(e,h,function(r,a,s){if(r){p.state===p.states.synchronizing&&(g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+e+"; err = "+r),p.disconnectAllTransports());return}var f=function(){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+e),p.activateTransport(t,e,a,o,s),p.state===p.states.synchronizing?(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+e),p.state=p.states.connected):g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+p.state.state+", so leaving unchanged"),p.state.sendEvents&&p.sendQueuedMessages()};l?l.onceIdle(f):f()})};A?this.realtime.channels.onceNopending(v):v()},r.prototype.activateTransport=function(t,e,r,o,a){var f=this;g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+e),t&&g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+t),r&&g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+r),o&&g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(o)),a&&g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(a.timeSerial||a.connectionSerial)),this.persistTransportPreference(e);var p=this.state,A=this.states.connected.state;if(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+p.state),p.state==this.states.closing.state||p.state==this.states.closed.state||p.state==this.states.failed.state)return g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),e.disconnect(),!1;if(s.arrDeleteValue(this.pendingTransports,e),!e.isConnected)return g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+e+" since it appears to no longer be connected"),!1;var v=this.activeProtocol;this.activeProtocol=new l.default(e),this.host=e.params.host;var $=o.connectionKey;if($&&this.connectionKey!=$&&this.setConnection(r,o,a,!!t),this.onConnectionDetailsUpdate(o,e),h.default.Config.nextTick(function(){e.on("connected",function(t,r,o){f.onConnectionDetailsUpdate(o,e),f.emit("update",new m.default(A,A,null,t))})}),p.state===this.states.connected.state?t&&(this.errorReason=this.realtime.connection.errorReason=t,this.emit("update",new m.default(A,A,null,t))):(this.notifyState({state:"connected",error:t}),this.errorReason=this.realtime.connection.errorReason=t||null),this.emit("transport.active",e),v){if(v.messageQueue.count()>0&&g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+v.transport.shortName+", new one is "+e.shortName+") finishing with "+v.messageQueue.count()+" messages still pending"),v.transport===e){var b="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+e.shortName+"; stack = "+Error().stack;g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.activateTransport()",b)}else v.finish()}return s.safeArrForEach(this.pendingTransports,function(t){if(t===e){var r="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+e.shortName+"; stack = "+Error().stack;g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.activateTransport()",r),s.arrDeleteValue(f.pendingTransports,e)}else t.disconnect()}),s.safeArrForEach(this.proposedTransports,function(t){t===e?(g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+e.shortName+"; stack = "+Error().stack),s.arrDeleteValue(f.proposedTransports,e)):t.dispose()}),!0},r.prototype.deactivateTransport=function(t,e,r){var o=this.activeProtocol,a=o&&o.getTransport()===t,l=s.arrDeleteValue(this.pendingTransports,t),f=s.arrDeleteValue(this.proposedTransports,t),p=this.noTransportsScheduledForActivation();if(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+t),g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+e+(a?"; was active":l?"; was pending":f?"; was proposed":"")+(p?"":"; another transport is scheduled for activation")),r&&r.message&&g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+r.message),a&&(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(o.getPendingMessages()),h.default.Config.nextTick(function(){o.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",t),a&&p||a&&"failed"===e||"closed"===e||null===o&&l&&0===this.pendingTransports.length){if("disconnected"===e&&r&&r.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:e,error:r,retryImmediately:!0});return}var A="failed"===e&&b.default.isTokenErr(r)?"disconnected":e;this.notifyState({state:A,error:r});return}a&&"disconnected"===e&&this.state!==this.states.synchronizing&&(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:r}))},r.prototype.noTransportsScheduledForActivation=function(){return s.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(t){return!t.isConnected})},r.prototype.sync=function(t,e,r){var o=setTimeout(function(){t.off("sync"),r(new $.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),s=a.default.fromValues({action:T.SYNC,connectionKey:this.connectionKey});e.timeSerial?s.timeSerial=e.timeSerial:void 0!==e.connectionSerial&&(s.connectionSerial=e.connectionSerial),t.send(s),t.once("sync",function(t,e){clearTimeout(o),r(null,t,e)})},r.prototype.setConnection=function(t,e,r,o){var a=this,s=this.connectionId,l=s&&s!==t;(l||!s&&o)&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==t?(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),h.default.Config.nextTick(function(){a.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){a.realtime.channels.checkAttachedMsgIndicators(t)},3e4)),this.realtime.connection.id=this.connectionId=t,this.realtime.connection.key=this.connectionKey=e.connectionKey,this.setConnectionSerial(r,l||!s,!1)},r.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},r.prototype.setConnectionSerial=function(t,e,r){var o=t.timeSerial,a=t.connectionSerial;if(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+a+"; timeSerial = "+o+"; force = "+e+"; previous = "+this.connectionSerial),void 0!==o)return o<=this.timeSerial&&!e?(r&&g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+o+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0):(this.realtime.connection.timeSerial=this.timeSerial=o,void this.setRecoveryKey());if(void 0!==a){if(a<=this.connectionSerial&&!e)return r&&g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+a+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=a,this.setRecoveryKey()}},r.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},r.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},r.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},r.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var t=s.now()-this.lastActivity;t>this.connectionStateTtl+this.maxIdleInterval&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+t+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},r.prototype.persistConnection=function(){if(M()){var e,r,o,a=this.realtime.connection.recoveryKey;a&&(e={recoveryKey:a,disconnectedAt:s.now(),location:t.location,clientId:this.realtime.auth.clientId},M()&&(null===(o=null===(r=h.default.WebStorage)||void 0===r?void 0:r.setSession)||void 0===o||o.call(r,B,e)))}},r.prototype.unpersistConnection=function(){var t,e;M()&&(null===(e=null===(t=h.default.WebStorage)||void 0===t?void 0:t.removeSession)||void 0===e||e.call(t,B))},r.prototype.getError=function(){return this.errorReason||this.getStateError()},r.prototype.getStateError=function(){return v.default[this.state.state]},r.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},r.prototype.enactStateChange=function(t){var e="failed"===t.current?g.default.LOG_ERROR:g.default.LOG_MAJOR;g.default.logAction(e,"Connection state",t.current+(t.reason?"; reason: "+t.reason:"")),g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+t.current+"; reason = "+(t.reason&&t.reason.message));var r=this.state=this.states[t.current];t.reason&&(this.errorReason=t.reason,this.realtime.connection.errorReason=t.reason),(r.terminal||"suspended"===r.state)&&this.clearConnection(),this.emit("connectionstate",t)},r.prototype.startTransitionTimer=function(t){var e=this;g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+t.state),this.transitionTimer&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){e.transitionTimer&&(e.transitionTimer=null,g.default.logAction(g.default.LOG_MINOR,"ConnectionManager "+t.state+" timer expired","requesting new state: "+t.failState),e.notifyState({state:t.failState}))},t.retryDelay)},r.prototype.cancelTransitionTimer=function(){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},r.prototype.startSuspendTimer=function(){var t=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){t.suspendTimer&&(t.suspendTimer=null,g.default.logAction(g.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),t.states.connecting.failState="suspended",t.notifyState({state:"suspended"}))},this.connectionStateTtl))},r.prototype.checkSuspendTimer=function(t){"disconnected"!==t&&"suspended"!==t&&"connecting"!==t&&this.cancelSuspendTimer()},r.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},r.prototype.startRetryTimer=function(t){var e=this;this.retryTimer=setTimeout(function(){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),e.retryTimer=null,e.requestState({state:"connecting"})},t)},r.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},r.prototype.notifyState=function(t){var e=this,r=t.state,o="disconnected"===r&&(this.state===this.states.connected||this.state===this.states.synchronizing||t.retryImmediately||this.state===this.states.connecting&&t.error&&b.default.isTokenErr(t.error)&&!(this.errorReason&&b.default.isTokenErr(this.errorReason)));if(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+r+(o?"; will retry connection immediately":"")),r!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(t.state),("suspended"===r||"connected"===r)&&(this.disconnectedRetryCount=0),!this.state.terminal)){var a=this.states[t.state],l=a.retryDelay;"disconnected"===a.state&&(this.disconnectedRetryCount++,l=a.retryDelay*s.getBackoffCoefficient(this.disconnectedRetryCount)*s.getJitterCoefficient());var f=new m.default(this.state.state,a.state,l,t.error||v.default[a.state]);if(o){var p=function(){e.state===e.states.disconnected&&(e.lastAutoReconnectAttempt=s.now(),e.requestState({state:"connecting"}))},A=this.lastAutoReconnectAttempt&&s.now()-this.lastAutoReconnectAttempt+1;A&&A<1e3?(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+A+"ms ago, waiting another "+(1e3-A)+"ms before trying again"),setTimeout(p,1e3-A)):h.default.Config.nextTick(p)}else("disconnected"===r||"suspended"===r)&&this.startRetryTimer(l);("disconnected"===r&&!o||"suspended"===r||a.terminal)&&h.default.Config.nextTick(function(){e.disconnectAllTransports()}),"connected"!=r||this.activeProtocol||g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(f),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(r,f.reason),this.failQueuedMessages(f.reason))}},r.prototype.requestState=function(t){var e=this,r=t.state;if(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+r+"; current state: "+this.state.state),r!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(r),!("connecting"==r&&"connected"==this.state.state)&&!("closing"==r&&"closed"==this.state.state))){var o=this.states[r],a=new m.default(this.state.state,o.state,null,t.error||v.default[o.state]);this.enactStateChange(a),"connecting"==r&&h.default.Config.nextTick(function(){e.startConnect()}),"closing"==r&&this.closeImpl()}},r.prototype.startConnect=function(){var t=this;if(this.state!==this.states.connecting){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var e=this.realtime.auth,r=++this.connectCounter,o=function(){t.checkConnectionStateFreshness(),t.getTransportParams(function(e){r===t.connectCounter&&t.connectImpl(e,r)})};if(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),"basic"===e.method)o();else{var a=function(e){r===t.connectCounter&&(e?t.actOnErrorFromAuthorize(e):o())};this.errorReason&&b.default.isTokenErr(this.errorReason)?e._forceNewToken(null,null,a):e._ensureValidAuthCredentials(!1,a)}},r.prototype.connectImpl=function(t,e){var r=this.state.state;r!==this.states.connecting.state&&r!==this.states.connected.state?g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+r):this.pendingTransports.length?g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):r==this.states.connected.state?this.upgradeIfNeeded(t):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(t):this.connectBase(t,e)},r.prototype.connectPreference=function(t){var e=this,r=this.getTransportPreference(),o=!1;s.arrIn(this.transports,r)||(this.unpersistTransportPreference(),this.connectImpl(t)),g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+r);var a=setTimeout(function(){o=!0,e.state.state!==e.states.connected.state&&(g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+r+" failed; clearing preference and trying from scratch"),e.disconnectAllTransports(),e.unpersistTransportPreference()),e.connectImpl(t)},this.options.timeouts.preferenceConnectTimeout);t.host=this.httpHosts[0],this.tryATransport(t,r,function(r,l){clearTimeout(a),o&&l?(l.off(),l.disconnect(),s.arrDeleteValue(e.pendingTransports,l)):l||r||(e.unpersistTransportPreference(),e.connectImpl(t))})},r.prototype.connectBase=function(t,e){var r=this,o=function(t){r.notifyState({state:r.states.connecting.failState,error:t})},a=this.httpHosts.slice(),l=function(t,o){e!==r.connectCounter||o||t||h()};g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var f=a.shift();if(!f){o(new $.default("Unable to connect (no available host)",80003,404));return}t.host=f;var h=function(){if(!a.length){o(new $.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!r.realtime.http.checkConnectivity){o(new $.default("Internal error: Http.checkConnectivity not set",null,500));return}r.realtime.http.checkConnectivity(function(f,h){if(e===r.connectCounter){if(f){o(f);return}if(!h){o(new $.default("Unable to connect (network unreachable)",80003,404));return}t.host=s.arrPopRandomElement(a),r.tryATransport(t,r.baseTransport,l)}})};if(this.forceFallbackHost&&a.length){this.forceFallbackHost=!1,h();return}this.tryATransport(t,this.baseTransport,l)},r.prototype.getUpgradePossibilities=function(){var t=this.activeProtocol.getTransport().shortName,e=s.arrIndexOf(this.upgradeTransports,t);return this.upgradeTransports.slice(e+1)},r.prototype.upgradeIfNeeded=function(t){var e=this,r=this.getUpgradePossibilities();g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+h.default.Config.inspect(r)),r.length&&s.arrForEach(r,function(r){var o=e.createTransportParams(t.host,"upgrade");e.tryATransport(o,r,P)})},r.prototype.closeImpl=function(){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),s.safeArrForEach(this.pendingTransports,function(t){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+t),t&&t.close()}),s.safeArrForEach(this.proposedTransports,function(t){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+t),t&&t.dispose()}),this.activeProtocol&&(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},r.prototype.onAuthUpdated=function(t,e){var r,o=this;switch(this.state.state){case"connected":if(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var s=this.activeProtocol.getTransport().params;h.default.Config.nextTick(function(){"connected"===o.state.state&&o.upgradeIfNeeded(s)})}var l=null===(r=this.activeProtocol)||void 0===r?void 0:r.getTransport();l&&l.onAuthUpdated&&l.onAuthUpdated(t);var f=a.default.fromValues({action:T.AUTH,auth:{accessToken:t.token}});this.send(f);var p=function(){o.off(A),e(null,t)},A=function(t){"failed"===t.current&&(o.off(p),o.off(A),e(t.reason||o.getStateError()))};this.once("connectiondetails",p),this.on("connectionstate",A);break;case"connecting":g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var m=function(r){switch(r.current){case"connected":o.off(m),e(null,t);break;case"failed":case"closed":case"suspended":o.off(m),e(r.reason||o.getStateError())}};this.on("connectionstate",m),"connecting"===this.state.state?this.startConnect():this.requestState({state:"connecting"})}},r.prototype.disconnectAllTransports=function(t){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(t?" except the active transport":"")),this.connectCounter++,s.safeArrForEach(this.pendingTransports,function(t){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+t),t&&t.disconnect()}),this.pendingTransports=[],s.safeArrForEach(this.proposedTransports,function(t){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+t),t&&t.dispose()}),this.proposedTransports=[],this.activeProtocol&&!t&&(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},r.prototype.send=function(t,e,r){r=r||P;var o=this.state;if(o.sendEvents){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new l.PendingMessage(t,r));return}if(!(e&&o.queueEvents||o.forceQueueEvents)){var s="rejecting event, queueEvent was "+e+", state was "+o.state;g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.send()",s),r(this.errorReason||new $.default(s,9e4,400));return}g.default.shouldLog(g.default.LOG_MICRO)&&g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+a.default.stringify(t)),this.queue(t,r)},r.prototype.sendImpl=function(t){var e=t.message;t.ackRequired&&!t.sendAttempted&&(e.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(t)}catch(r){g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+r.stack)}},r.prototype.queue=function(t,e){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var r=this.queuedMessages.last(),o=this.options.maxMessageSize;r&&!r.sendAttempted&&function t(e,r,o){if(e.channel!==r.channel||(a=e.action)!==T.PRESENCE&&a!==T.MESSAGE||a!==r.action)return!1;var a,l=a===T.PRESENCE?"presence":"messages",f=e[l].concat(r[l]);return!!(!(C.default.getMessagesSize(f)>o)&&s.allSame(f,"clientId")&&s.arrEvery(f,function(t){return!t.id}))&&(e[l]=f,!0)}(r.message,t,o)?(r.merged||(r.callback=_.default.create([r.callback]),r.merged=!0),r.callback.push(e)):this.queuedMessages.push(new l.PendingMessage(t,e))},r.prototype.sendQueuedMessages=function(){g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var t;t=this.queuedMessages.shift();)this.sendImpl(t)},r.prototype.queuePendingMessages=function(t){t&&t.length&&(g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+t.length+" pending messages"),this.queuedMessages.prepend(t))},r.prototype.failQueuedMessages=function(t){var e=this.queuedMessages.count();e>0&&(g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+e+" queued messages, err = "+s.inspectError(t)),this.queuedMessages.completeAllMessages(t))},r.prototype.onChannelMessage=function(t,e){var r=this.activeProtocol&&e===this.activeProtocol.getTransport(),o=s.arrIn(this.pendingTransports,e)&&this.state==this.states.synchronizing,l=t.action===T.MESSAGE||t.action===T.PRESENCE;if(r||o){if(l){if(this.setConnectionSerial(t,!1,!0))return;if(a.default.isDuplicate(t,this.mostRecentMsg)){g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+t.id);return}this.mostRecentMsg=t}this.realtime.channels.onChannelMessage(t)}else s.arrIndexOf([T.ACK,T.NACK,T.ERROR],t.action)>-1?this.realtime.channels.onChannelMessage(t):g.default.logAction(g.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(t)+"on defunct transport; discarding")},r.prototype.ping=function(t,e){var r=this;if(t){g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+t);var o=function(){t.off("heartbeat",f),e(new $.default("Timeout waiting for heartbeat response",5e4,500))},a=s.now(),l=s.cheapRandStr(),f=function(r){r===l&&(t.off("heartbeat",f),clearTimeout(p),e(null,s.now()-a))},p=setTimeout(o,this.options.timeouts.realtimeRequestTimeout);t.on("heartbeat",f),t.ping(l);return}if("connected"!==this.state.state){e(new $.default("Unable to ping service; not connected",4e4,400));return}var A=!1,m=function(t,o){r.off("transport.active",v),A||(A=!0,e(t,o))},v=function(){A||(A=!0,h.default.Config.nextTick(function(){r.ping(null,e)}))};this.on("transport.active",v),this.ping(this.activeProtocol.getTransport(),m)},r.prototype.abort=function(t){this.activeProtocol.getTransport().fail(t)},r.prototype.registerProposedTransport=function(t){this.proposedTransports.push(t)},r.prototype.getTransportPreference=function(){var t,e;return this.transportPreference||R()&&(null===(e=null===(t=h.default.WebStorage)||void 0===t?void 0:t.get)||void 0===e?void 0:e.call(t,k))},r.prototype.persistTransportPreference=function(t){var e,r;s.arrIn(f.default.upgradeTransports,t.shortName)&&(this.transportPreference=t.shortName,R()&&(null===(r=null===(e=h.default.WebStorage)||void 0===e?void 0:e.set)||void 0===r||r.call(e,k,t.shortName)))},r.prototype.unpersistTransportPreference=function(){var t,e;this.transportPreference=null,R()&&(null===(e=null===(t=h.default.WebStorage)||void 0===t?void 0:t.remove)||void 0===e||e.call(t,k))},r.prototype.actOnErrorFromAuthorize=function(t){if(40171===t.code)this.notifyState({state:"failed",error:t});else if(t.statusCode===I.default.Forbidden){var e="Client configured authentication provider returned 403; failing the connection";g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",e),this.notifyState({state:"failed",error:new $.default(e,80019,403,t)})}else{var e="Client configured authentication provider request failed";g.default.logAction(g.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",e),this.notifyState({state:this.state.failState,error:new $.default(e,80019,401,t)})}},r.prototype.onConnectionDetailsUpdate=function(t,e){if(t){this.connectionDetails=t,t.maxMessageSize&&(this.options.maxMessageSize=t.maxMessageSize);var r=t.clientId;if(r){var o=this.realtime.auth._uncheckedSetClientId(r);if(o){g.default.logAction(g.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",o.message),e.fail(o);return}}var a=t.connectionStateTtl;a&&(this.connectionStateTtl=a),this.maxIdleInterval=t.maxIdleInterval,this.emit("connectiondetails",t)}},r.supportedTransports={},r}(p.default);e.default=x}).call(this,r(12))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(10)),s=o.__importStar(r(2)),l=o.__importDefault(r(7)),f=o.__importDefault(r(3)),h=o.__importDefault(r(19)),p=o.__importDefault(r(5)),A=o.__importDefault(r(0)),g=a.default.Action,m=a.default.fromValues({action:g.CLOSE}),v=a.default.fromValues({action:g.DISCONNECT}),$=function(t){function e(e,r,o,a){var s=t.call(this)||this;return a&&(o.format=void 0,o.heartbeats=!0),s.connectionManager=e,e.registerProposedTransport(s),s.auth=r,s.params=o,s.timeouts=o.options.timeouts,s.format=o.format,s.isConnected=!1,s.isFinished=!1,s.isDisposed=!1,s.maxIdleInterval=null,s.idleTimer=null,s.lastActivity=null,s}return o.__extends(e,t),e.prototype.connect=function(){},e.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",h.default.closed)},e.prototype.disconnect=function(t){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",t||h.default.disconnected)},e.prototype.fail=function(t){this.isConnected&&this.requestDisconnect(),this.finish("failed",t||h.default.failed)},e.prototype.finish=function(t,e){var r;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout(null!==(r=this.idleTimer)&&void 0!==r?r:void 0),this.idleTimer=null,this.emit(t,e),this.dispose())},e.prototype.onProtocolMessage=function(t){switch(f.default.shouldLog(f.default.LOG_MICRO)&&f.default.logAction(f.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+a.default.stringify(t)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),t.action){case g.HEARTBEAT:f.default.logAction(f.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",t.id);break;case g.CONNECTED:this.onConnect(t),this.emit("connected",t.error,t.connectionId,t.connectionDetails,t);break;case g.CLOSED:this.onClose(t);break;case g.DISCONNECTED:this.onDisconnect(t);break;case g.ACK:this.emit("ack",t.msgSerial,t.count);break;case g.NACK:this.emit("nack",t.msgSerial,t.count,t.error);break;case g.SYNC:if(void 0!==t.connectionId){this.emit("sync",t.connectionId,t);break}this.connectionManager.onChannelMessage(t,this);break;case g.AUTH:this.auth.authorize(function(t){t&&f.default.logAction(f.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+s.inspectError(t))});break;case g.ERROR:if(f.default.logAction(f.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+A.default.Config.inspect(t.error)+(t.channel?", channel: "+t.channel:"")),void 0===t.channel){this.onFatalError(t);break}this.connectionManager.onChannelMessage(t,this);break;default:this.connectionManager.onChannelMessage(t,this)}},e.prototype.onConnect=function(t){if(this.isConnected=!0,!t.connectionDetails)throw Error("Transport.onConnect(): Connect message recieved without connectionDetails");var e=t.connectionDetails.maxIdleInterval;e&&(this.maxIdleInterval=e+this.timeouts.realtimeRequestTimeout,this.onActivity())},e.prototype.onDisconnect=function(t){var e=t&&t.error;f.default.logAction(f.default.LOG_MINOR,"Transport.onDisconnect()","err = "+s.inspectError(e)),this.finish("disconnected",e)},e.prototype.onFatalError=function(t){var e=t&&t.error;f.default.logAction(f.default.LOG_MINOR,"Transport.onFatalError()","err = "+s.inspectError(e)),this.finish("failed",e)},e.prototype.onClose=function(t){var e=t&&t.error;f.default.logAction(f.default.LOG_MINOR,"Transport.onClose()","err = "+s.inspectError(e)),this.finish("closed",e)},e.prototype.requestClose=function(){f.default.logAction(f.default.LOG_MINOR,"Transport.requestClose()",""),this.send(m)},e.prototype.requestDisconnect=function(){f.default.logAction(f.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(v)},e.prototype.ping=function(t){var e={action:a.default.Action.HEARTBEAT};t&&(e.id=t),this.send(a.default.fromValues(e))},e.prototype.dispose=function(){f.default.logAction(f.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},e.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=s.now(),this.setIdleTimer(this.maxIdleInterval+100))},e.prototype.setIdleTimer=function(t){var e=this;this.idleTimer||(this.idleTimer=setTimeout(function(){e.onIdleTimerExpire()},t))},e.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var t=s.now()-this.lastActivity,e=this.maxIdleInterval-t;if(e<=0){var r="No activity seen from realtime in "+t+"ms; assuming connection has dropped";f.default.logAction(f.default.LOG_ERROR,"Transport.onIdleTimerExpire()",r),this.disconnect(new p.default(r,80003,408))}else this.setIdleTimer(e+100)},e.tryConnect=function(t,e,r,o,a){var s,l=new t(e,r,o),h=function(t){clearTimeout(s),a({event:this.event,error:t})};s=setTimeout(function(){l.off(["preconnect","disconnected","failed"]),l.dispose(),h.call({event:"disconnected"},new p.default("Timeout waiting for transport to indicate itself viable",5e4,500))},e.options.timeouts.realtimeRequestTimeout),l.on(["failed","disconnected"],h),l.on("preconnect",function(){f.default.logAction(f.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+l),clearTimeout(s),l.off(["failed","disconnected"],h),a(null,l)}),l.connect()},e}(l.default);e.default=$},function(t,e,r){var o,a;a=function(t){var e,r,o,a,s,l,f;return o=(r=(e=t).lib).Base,a=r.WordArray,l=(s=e.algo).MD5,f=s.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:l,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r,o=this.cfg,s=o.hasher.create(),l=a.create(),f=l.words,h=o.keySize,p=o.iterations;f.length<h;){r&&s.update(r),r=s.update(t).finalize(e),s.reset();for(var A=1;A<p;A++)r=s.finalize(r),s.reset();l.concat(r)}return l.sigBytes=4*h,l}}),e.EvpKDF=function(t,e,r){return f.create(r).compute(t,e)},t.EvpKDF},t.exports=e=a(r(6),r(39),r(23))},function(t,e,r){var o,a;a=function(t){var e,r,o,a,s,l,f,h,p,A,g,m,v,$,b,C,_,O;t.lib.Cipher||(o=(r=(e=t).lib).Base,a=r.WordArray,s=r.BufferedBlockAlgorithm,f=((l=e.enc).Utf8,l.Base64),h=e.algo.EvpKDF,p=r.Cipher=s.extend({cfg:o.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?O:C}return function(e){return{encrypt:function(r,o,a){return t(o).encrypt(e,r,o,a)},decrypt:function(r,o,a){return t(o).decrypt(e,r,o,a)}}}}()}),A=(r.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),e.mode={}),g=r.BlockCipherMode=o.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),m=A.CBC=function(){var t=g.extend();function e(t,e,r){var o,a=this._iv;a?(o=a,this._iv=void 0):o=this._prevBlock;for(var s=0;s<r;s++)t[e+s]^=o[s]}return t.Encryptor=t.extend({processBlock:function(t,r){var o=this._cipher,a=o.blockSize;e.call(this,t,r,a),o.encryptBlock(t,r),this._prevBlock=t.slice(r,r+a)}}),t.Decryptor=t.extend({processBlock:function(t,r){var o=this._cipher,a=o.blockSize,s=t.slice(r,r+a);o.decryptBlock(t,r),e.call(this,t,r,a),this._prevBlock=s}}),t}(),v=(e.pad={}).Pkcs7={pad:function(t,e){for(var r=4*e,o=r-t.sigBytes%r,s=o<<24|o<<16|o<<8|o,l=[],f=0;f<o;f+=4)l.push(s);var h=a.create(l,o);t.concat(h)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},$=(r.BlockCipher=p.extend({cfg:p.cfg.extend({mode:m,padding:v}),reset:function(){p.reset.call(this);var t,e=this.cfg,r=e.iv,o=e.mode;this._xformMode==this._ENC_XFORM_MODE?t=o.createEncryptor:(t=o.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,r&&r.words):(this._mode=t.call(o,this,r&&r.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4}),r.CipherParams=o.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),b=(e.format={}).OpenSSL={stringify:function(t){var e,r=t.ciphertext,o=t.salt;return(e=o?a.create([1398893684,1701076831]).concat(o).concat(r):r).toString(f)},parse:function(t){var e,r=f.parse(t),o=r.words;return 1398893684==o[0]&&1701076831==o[1]&&(e=a.create(o.slice(2,4)),o.splice(0,4),r.sigBytes-=16),$.create({ciphertext:r,salt:e})}},C=r.SerializableCipher=o.extend({cfg:o.extend({format:b}),encrypt:function(t,e,r,o){o=this.cfg.extend(o);var a=t.createEncryptor(r,o),s=a.finalize(e),l=a.cfg;return $.create({ciphertext:s,key:r,iv:l.iv,algorithm:t,mode:l.mode,padding:l.padding,blockSize:t.blockSize,formatter:o.format})},decrypt:function(t,e,r,o){return o=this.cfg.extend(o),e=this._parse(e,o.format),t.createDecryptor(r,o).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),_=(e.kdf={}).OpenSSL={execute:function(t,e,r,o){o||(o=a.random(8));var s=h.create({keySize:e+r}).compute(t,o),l=a.create(s.words.slice(e),4*r);return s.sigBytes=4*e,$.create({key:s,iv:l,salt:o})}},O=r.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:_}),encrypt:function(t,e,r,o){var a=(o=this.cfg.extend(o)).kdf.execute(r,t.keySize,t.ivSize);o.iv=a.iv;var s=C.encrypt.call(this,t,e,a.key,o);return s.mixIn(a),s},decrypt:function(t,e,r,o){o=this.cfg.extend(o),e=this._parse(e,o.format);var a=o.kdf.execute(r,t.keySize,t.ivSize,e.salt);return o.iv=a.iv,C.decrypt.call(this,t,e,a.key,o)}}))},t.exports=e=a(r(6),r(27))},function(t,e,r){"use strict";e.__esModule=!0,e.Request=e.createRequest=void 0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(11)),l=o.__importDefault(r(0)),f=o.__importDefault(r(7)),h=o.__importDefault(r(5)),p=o.__importDefault(r(8)),A=o.__importDefault(r(3)),g=o.__importDefault(r(20)),m=a.getGlobalObject(),v=function(){},$=m._ablyjs_jsonp={};$._=function(t){return $["_"+t]||v};var b=1,C="jsonp";function _(t,e,r,o,s,l,f){return l=l||p.default.TIMEOUTS,new w(void 0,t,e,a.copy(r),o,s,l,f)}e.createRequest=_;var O=function(t){function e(e,r,o){var a=t.call(this,e,r,o)||this;return a.shortName=C,o.stream=!1,a}return o.__extends(e,t),e.isAvailable=function(){return l.default.Config.jsonpSupported&&l.default.Config.allowComet},e.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},e.prototype.createRequest=function(t,e,r,o,a,s,l){return _(t,e,r,o,a,s=(this===null||void 0===this?void 0:this.timeouts)||s||p.default.TIMEOUTS,l)},e}(s.default),w=function(t){function e(e,r,o,s,l,f,h,p){var A=t.call(this)||this;return void 0===e&&(e=b++),A.id=e,A.uri=r,A.params=s||{},A.params.rnd=a.cheapRandStr(),o&&(o["X-Ably-Version"]&&(A.params.v=o["X-Ably-Version"]),o["X-Ably-Lib"]&&(A.params.lib=o["X-Ably-Lib"])),A.body=l,A.method=p,A.requestMode=f,A.timeouts=h,A.requestComplete=!1,A}return o.__extends(e,t),e.prototype.exec=function(){var t=this,e=this.id,r=this.body,o=this.method,s=this.uri,f=this.params;f.callback="_ablyjs_jsonp._("+e+")",f.envelope="jsonp",r&&(f.body=r),o&&"get"!==o&&(f.method=o);var p=this.script=document.createElement("script"),m=s+a.toQueryString(f);p.src=m,p.src.split("/").slice(-1)[0]!==m.split("/").slice(-1)[0]&&A.default.logAction(A.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),p.async=!0,p.type="text/javascript",p.charset="UTF-8",p.onerror=function(e){t.complete(new h.default("JSONP script error (event: "+l.default.Config.inspect(e)+")",null,400))},$["_"+e]=function(e){if(e.statusCode){var r=e.response;if(204==e.statusCode)t.complete(null,null,null,e.statusCode);else if(r){if(e.statusCode<400||a.isArray(r))t.complete(null,r,e.headers,e.statusCode);else{var o=r.error||new h.default("Error response received from server",null,e.statusCode);t.complete(o)}}else t.complete(new h.default("Invalid server response: no envelope detected",null,500))}else t.complete(null,e)};var v=this.requestMode==g.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),v);var b=document.getElementsByTagName("head")[0];b.insertBefore(p,b.firstChild)},e.prototype.complete=function(t,e,r,o){if(r=r||{},!this.requestComplete){this.requestComplete=!0;var a=void 0;e&&(a="string"==typeof e?"text/plain":"application/json",r["content-type"]=a,this.emit("data",e)),this.emit("complete",t,e,r,!0,o),this.dispose()}},e.prototype.abort=function(){this.dispose()},e.prototype.dispose=function(){var t=this.timer;t&&(clearTimeout(t),this.timer=null);var e=this.script;e.parentNode&&e.parentNode.removeChild(e),delete $[this.id],this.emit("disposed")},e}(f.default);e.Request=w,e.default=function t(e){return m.JSONPTransport=O,O.isAvailable()&&(e.supportedTransports[C]=O),O}},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(3)),l=o.__importDefault(r(8)),f=o.__importDefault(r(16)),h=o.__importDefault(r(45)),p=o.__importDefault(r(18)),A=o.__importDefault(r(33)),g=o.__importDefault(r(5)),m=o.__importDefault(r(48)),v=o.__importDefault(r(17)),$=o.__importDefault(r(0)),b=function(){},C=function(){function t(t){if(!t){var e="no options provided";throw s.default.logAction(s.default.LOG_ERROR,"Rest()",e),Error(e)}var r=l.default.objectifyOptions(t);r.log&&s.default.setLog(r.log.level,r.log.handler),s.default.logAction(s.default.LOG_MICRO,"Rest()","initialized with clientOptions "+$.default.Config.inspect(t));var o=this.options=l.default.normaliseOptions(r);if(o.key){var a=o.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!a){var e="invalid key parameter";throw s.default.logAction(s.default.LOG_ERROR,"Rest()",e),new g.default(e,40400,404)}o.keyName=a[1],o.keySecret=a[2]}if("clientId"in o){if("string"==typeof o.clientId||null===o.clientId){if("*"===o.clientId)throw new g.default('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new g.default("clientId must be either a string or null",40012,400)}s.default.logAction(s.default.LOG_MINOR,"Rest()","started; version = "+l.default.version),this.baseUri=this.authority=function(t){return l.default.getHttpScheme(o)+t+":"+l.default.getPort(o,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new $.default.Http,this.auth=new f.default(this,o),this.channels=new _(this),this.push=new h.default(this)}return t.prototype.stats=function(t,e){if(void 0===e){if("function"==typeof t)e=t,t=null;else{if(this.options.promises)return a.promisify(this,"stats",arguments);e=b}}var r=a.defaultGetHeaders(),o=this.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=this.http.supportsLinkHeaders?void 0:o;this.options.headers&&a.mixin(r,this.options.headers),new p.default(this,"/stats",r,s,function(t,e,r){for(var o=r?t:JSON.parse(t),a=0;a<o.length;a++)o[a]=m.default.fromValues(o[a]);return o}).get(t,e)},t.prototype.time=function(t,e){var r=this;if(void 0===e){if("function"==typeof t)e=t,t=null;else if(this.options.promises)return a.promisify(this,"time",arguments)}var o=e||b,s=a.defaultGetHeaders();this.options.headers&&a.mixin(s,this.options.headers);var l=function(t){return r.authority(t)+"/time"};this.http.do(v.default.Get,this,l,s,null,t,function(t,e,s,l){if(t){o(t);return}l||(e=JSON.parse(e));var f=e[0];if(!f){o(new g.default("Internal error (unexpected result type from GET /time)",5e4,500));return}r.serverTimeOffset=f-a.now(),o(null,f)})},t.prototype.request=function(t,e,r,o,s,l){var f=this.options.useBinaryProtocol,h=f?$.default.Config.msgpack.encode:JSON.stringify,A=f?$.default.Config.msgpack.decode:JSON.parse,m=f?a.Format.msgpack:a.Format.json,v=this.http.supportsLinkHeaders?void 0:m;r=r||{};var C=t.toLowerCase(),_="get"==C?a.defaultGetHeaders(m):a.defaultPostHeaders(m);if(void 0===l){if(this.options.promises)return a.promisify(this,"request",arguments);l=b}"string"!=typeof o&&(o=h(o)),this.options.headers&&a.mixin(_,this.options.headers),s&&a.mixin(_,s);var O=new p.default(this,e,_,v,function(t,e,r){return a.ensureArray(r?t:A(t))},!0);if(!a.arrIn($.default.Http.methods,C))throw new g.default("Unsupported method "+C,40500,405);a.arrIn($.default.Http.methodsWithBody,C)?O[C](r,o,l):O[C](r,l)},t.prototype.setLog=function(t){s.default.setLog(t.level,t.handler)},t.Promise=function(e){return(e=l.default.objectifyOptions(e)).promises=!0,new t(e)},t.Callbacks=t,t.Platform=$.default,t}(),_=function(){function t(t){this.rest=t,this.all={}}return t.prototype.get=function(t,e){t=String(t);var r=this.all[t];return r?e&&r.setOptions(e):this.all[t]=r=new A.default(this.rest,t,e),r},t.prototype.release=function(t){delete this.all[String(t)]},t}();e.default=C},function(t,e,r){var o,a;a=function(t){return function(e){var r=t,o=r.lib,a=o.WordArray,s=o.Hasher,l=r.algo,f=[],h=[];(function(){function t(t){for(var r=e.sqrt(t),o=2;o<=r;o++)if(!(t%o))return!1;return!0}function r(t){return(t-(0|t))*4294967296|0}for(var o=2,a=0;a<64;)t(o)&&(a<8&&(f[a]=r(e.pow(o,.5))),h[a]=r(e.pow(o,1/3)),a++),o++})();var p=[],A=l.SHA256=s.extend({_doReset:function(){this._hash=new a.init(f.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,o=r[0],a=r[1],s=r[2],l=r[3],f=r[4],A=r[5],g=r[6],m=r[7],v=0;v<64;v++){if(v<16)p[v]=0|t[e+v];else{var $=p[v-15],b=($<<25|$>>>7)^($<<14|$>>>18)^$>>>3,C=p[v-2],_=(C<<15|C>>>17)^(C<<13|C>>>19)^C>>>10;p[v]=b+p[v-7]+_+p[v-16]}var O=f&A^~f&g,w=o&a^o&s^a&s,I=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),R=m+((f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25))+O+h[v]+p[v],M=I+w;m=g,g=A,A=f,f=l+R|0,l=s,s=a,a=o,o=R+M|0}r[0]=r[0]+o|0,r[1]=r[1]+a|0,r[2]=r[2]+s|0,r[3]=r[3]+l|0,r[4]=r[4]+f|0,r[5]=r[5]+A|0,r[6]=r[6]+g|0,r[7]=r[7]+m|0},_doFinalize:function(){var t=this._data,r=t.words,o=8*this._nDataBytes,a=8*t.sigBytes;return r[a>>>5]|=128<<24-a%32,r[(a+64>>>9<<4)+14]=e.floor(o/4294967296),r[(a+64>>>9<<4)+15]=o,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});r.SHA256=s._createHelper(A),r.HmacSHA256=s._createHmacHelper(A)}(Math),t.SHA256},t.exports=e=a(r(6))},function(t,e,r){var o,a;a=function(t){return t.enc.Utf8},t.exports=e=a(r(6))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(7)),l=o.__importDefault(r(3)),f=o.__importDefault(r(34)),h=o.__importDefault(r(9)),p=o.__importDefault(r(5)),A=o.__importDefault(r(18)),g=o.__importDefault(r(24)),m=o.__importDefault(r(0));function v(){}function $(t){var e=t||{};if(e.cipher){if(!m.default.Crypto)throw Error("Encryption not enabled; use ably.encryption.js instead");var r=m.default.Crypto.getCipher(e.cipher);e.cipher=r.cipherParams,e.channelCipher=r.cipher}else"cipher"in e&&(e.cipher=void 0,e.channelCipher=null);return e}var b=function(t){function e(e,r,o){var a=t.call(this)||this;return l.default.logAction(l.default.LOG_MINOR,"Channel()","started; name = "+r),a.rest=e,a.name=r,a.basePath="/channels/"+encodeURIComponent(r),a.presence=new f.default(a),a.channelOptions=$(o),a}return o.__extends(e,t),e.prototype.setOptions=function(t){this.channelOptions=$(t)},e.prototype.history=function(t,e){if(l.default.logAction(l.default.LOG_MICRO,"Channel.history()","channel = "+this.name),void 0===e){if("function"==typeof t)e=t,t=null;else{if(this.rest.options.promises)return a.promisify(this,"history",arguments);e=v}}this._history(t,e)},e.prototype._history=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=this.rest.http.supportsLinkHeaders?void 0:o,l=a.defaultGetHeaders(o);r.options.headers&&a.mixin(l,r.options.headers);var f=this.channelOptions;new A.default(r,this.basePath+"/messages",l,s,function(t,e,r){return h.default.fromResponseBody(t,f,r?void 0:o)}).get(t,e)},e.prototype.publish=function(){var t,e,r=this,o=arguments.length,s=arguments[0],l=arguments[1],f=arguments[o-1];if("function"!=typeof f){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);f=v}if("string"==typeof s||null===s)t=[h.default.fromValues({name:s,data:l})],e=arguments[2];else if(a.isObject(s))t=[h.default.fromValues(s)],e=arguments[1];else if(a.isArray(s))t=h.default.fromValuesArray(s),e=arguments[1];else throw new p.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);"object"==typeof e&&e||(e={});var A,g=this.rest,m=g.options,$=m.useBinaryProtocol?a.Format.msgpack:a.Format.json,b=g.options.idempotentRestPublishing,C=a.defaultPostHeaders($);if(m.headers&&a.mixin(C,m.headers),b&&(A=t,a.arrEvery(A,function(t){return!t.id}))){var _=a.randomString(9);a.arrForEach(t,function(t,e){t.id=_+":"+e.toString()})}h.default.encodeArray(t,this.channelOptions,function(o){if(o){f(o);return}var a=h.default.getMessagesSize(t),s=m.maxMessageSize;if(a>s){f(new p.default("Maximum size of messages that can be published at once exceeded ( was "+a+" bytes; limit is "+s+" bytes)",40009,400));return}r._publish(h.default.serialize(t,$),C,e,f)})},e.prototype._publish=function(t,e,r,o){g.default.post(this.rest,this.basePath+"/messages",t,e,r,null,o)},e.prototype.status=function(t){if("function"!=typeof t&&this.rest.options.promises)return a.promisify(this,"status",[]);var e=this.rest.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,r=a.defaultPostHeaders(e);g.default.get(this.rest,this.basePath,r,{},e,t||v)},e}(s.default);e.default=b},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(7)),l=o.__importDefault(r(3)),f=o.__importDefault(r(18)),h=o.__importDefault(r(14));function p(){}var A=function(t){function e(e){var r=t.call(this)||this;return r.channel=e,r.basePath=e.basePath+"/presence",r}return o.__extends(e,t),e.prototype.get=function(t,e){if(l.default.logAction(l.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),void 0===e){if("function"==typeof t)e=t,t=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"get",arguments);e=p}}var r=this.channel.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=this.channel.rest.http.supportsLinkHeaders?void 0:o,A=a.defaultGetHeaders(o);r.options.headers&&a.mixin(A,r.options.headers);var g=this.channel.channelOptions;new f.default(r,this.basePath,A,s,function(t,e,r){return h.default.fromResponseBody(t,g,r?void 0:o)}).get(t,e)},e.prototype.history=function(t,e){l.default.logAction(l.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(t,e)},e.prototype._history=function(t,e){if(void 0===e){if("function"==typeof t)e=t,t=null;else{if(this.channel.rest.options.promises)return a.promisify(this,"_history",arguments);e=p}}var r=this.channel.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=this.channel.rest.http.supportsLinkHeaders?void 0:o,l=a.defaultGetHeaders(o);r.options.headers&&a.mixin(l,r.options.headers);var A=this.channel.channelOptions;new f.default(r,this.basePath+"/history",l,s,function(t,e,r){return h.default.fromResponseBody(t,A,r?void 0:o)}).get(t,e)},e}(s.default);e.default=A},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(7)),s=o.__importDefault(r(3)),l=function(t){function e(){var e=t.call(this)||this;return e.messages=[],e}return o.__extends(e,t),e.prototype.count=function(){return this.messages.length},e.prototype.push=function(t){this.messages.push(t)},e.prototype.shift=function(){return this.messages.shift()},e.prototype.last=function(){return this.messages[this.messages.length-1]},e.prototype.copyAll=function(){return this.messages.slice()},e.prototype.append=function(t){this.messages.push.apply(this.messages,t)},e.prototype.prepend=function(t){this.messages.unshift.apply(this.messages,t)},e.prototype.completeMessages=function(t,e,r){s.default.logAction(s.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+t+"; count = "+e),r=r||null;var o=this.messages;if(0===o.length)throw Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var a=o[0];if(a){var l=a.message.msgSerial,f=t+e;if(f>l)for(var h=o.splice(0,f-l),p=0,A=h;p<A.length;p++)A[p].callback(r);0==o.length&&this.emit("idle")}},e.prototype.completeAllMessages=function(t){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,t)},e.prototype.clear=function(){s.default.logAction(s.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},e}(a.default);e.default=l},function(t,e,r){"use strict";e.__esModule=!0,e.default=function t(e,r,o,a){this.previous=e,this.current=r,o&&(this.retryIn=o),a&&(this.reason=a)}},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(10)),s=o.__importDefault(r(7)),l=o.__importStar(r(2)),f=o.__importDefault(r(33)),h=o.__importDefault(r(3)),p=o.__importDefault(r(54)),A=o.__importDefault(r(9)),g=o.__importDefault(r(38)),m=o.__importDefault(r(5)),v=o.__importDefault(r(14)),$=o.__importDefault(r(19)),b=a.default.Action,C=function(){},_="statechange",O="sync",w=function(t){function e(e,r,o){var a=t.call(this,e,r,o)||this;return a.retryCount=0,a.history=function(t,e){if(h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),void 0===e){if("function"==typeof t)e=t,t=null;else{if(this.rest.options.promises)return l.promisify(this,"history",arguments);e=C}}if(t&&t.untilAttach){if("attached"!==this.state){e(new m.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){e(new m.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete t.untilAttach,t.from_serial=this.properties.attachSerial}f.default.prototype._history.call(this,t,e)},a.whenState=function(t,e){return s.default.prototype.whenState.call(a,t,a.state,e)},h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel()","started; name = "+r),a.realtime=e,a.presence=new p.default(a),a.connectionManager=e.connection.connectionManager,a.state="initialized",a.subscriptions=new s.default,a.syncChannelSerial=void 0,a.properties={attachSerial:void 0},a.setOptions(o),a.errorReason=null,a._requestedFlags=null,a._mode=null,a._attachedMsgIndicator=!1,a._attachResume=!1,a._decodingContext={channelOptions:a.channelOptions,plugins:e.options.plugins||{},baseEncodedPreviousPayload:void 0},a._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},a._allChannelChanges=new s.default,a}return o.__extends(e,t),e.invalidStateError=function(t){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+t}},e.processListenerArgs=function(t){return"function"==typeof(t=Array.prototype.slice.call(t))[0]&&t.unshift(null),null==t[t.length-1]&&t.pop(),t},e.prototype.setOptions=function(t,e){if(!e&&this.rest.options.promises)return l.promisify(this,"setOptions",arguments);var r=e||function(t){t&&h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+t.toString())},o=function t(e){if(e&&"params"in e&&!l.isObject(e.params))return new m.default("options.params must be an object",4e4,400);if(e&&"modes"in e){if(!l.isArray(e.modes))return new m.default("options.modes must be an array",4e4,400);for(var r=0;r<e.modes.length;r++){var o=e.modes[r];if(!o||"string"!=typeof o||!l.arrIn(a.default.channelModes,String.prototype.toUpperCase.call(o)))return new m.default("Invalid channel mode: "+o,4e4,400)}}}(t);if(o){r(o);return}f.default.prototype.setOptions.call(this,t),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(t)?(this.attachImpl(),this._allChannelChanges.once(function(t){switch(this.event){case"update":case"attached":null==r||r(null);return;default:null==r||r(t.reason);return}})):r()},e.prototype._shouldReattachToSetOptions=function(t){return("attached"===this.state||"attaching"===this.state)&&(t.params||t.modes)},e.prototype.publish=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=e[0],a=e.length,s=e[a-1];if("function"!=typeof s){if(this.realtime.options.promises)return l.promisify(this,"publish",arguments);s=C,++a}if(!this.connectionManager.activeState()){s(this.connectionManager.getError());return}if(2==a){if(l.isObject(o))o=[A.default.fromValues(o)];else if(l.isArray(o))o=A.default.fromValuesArray(o);else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400)}else o=[A.default.fromValues({name:e[0],data:e[1]})];var f=this.realtime.options.maxMessageSize;A.default.encodeArray(o,this.channelOptions,function(e){if(e){s(e);return}var r=A.default.getMessagesSize(o);if(r>f){s(new m.default("Maximum size of messages that can be published at once exceeded ( was "+r+" bytes; limit is "+f+" bytes)",40009,400));return}t.__publish(o,s)})},e.prototype.__publish=function(t,r){h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+t.length);var o=this.state;switch(o){case"failed":case"suspended":r(m.default.fromValues(e.invalidStateError(o)));break;default:h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+o);var s=new a.default;s.action=b.MESSAGE,s.channel=this.name,s.messages=t,this.sendMessage(s,r)}},e.prototype.onEvent=function(t){h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var e=this.subscriptions,r=0;r<t.length;r++){var o=t[r];e.emit(o.name,o)}},e.prototype.attach=function(t,e){var r;if("function"==typeof t?(e=t,r=null):r=t,!e){if(this.realtime.options.promises)return l.promisify(this,"attach",arguments);e=function(t){t&&h.default.logAction(h.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+t.toString())}}if(r)h.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=r;else if("attached"===this.state){e();return}this._attach(!1,null,e)},e.prototype._attach=function(t,e,r){r||(r=function(t){t&&h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+t.toString())});var o=this.connectionManager;if(!o.activeState()){r(o.getError());return}("attaching"!==this.state||t)&&this.requestState("attaching",e),this.once(function(t){switch(this.event){case"attached":null==r||r();break;case"detached":case"suspended":case"failed":null==r||r(t.reason||o.getError()||new m.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":null==r||r(new m.default("Attach request superseded by a subsequent detach request",9e4,409))}})},e.prototype.attachImpl=function(){h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(_,!0);var t=a.default.fromValues({action:b.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?t.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&t.encodeModesToFlags(l.allToUpperCase(this.channelOptions.modes)),this._attachResume&&t.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(t.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(t,C)},e.prototype.detach=function(t){if(!t){if(this.realtime.options.promises)return l.promisify(this,"detach",arguments);t=C}var e=this.connectionManager;if(!e.activeState()){t(e.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),t();break;case"detached":t();break;case"failed":t(new m.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(r){switch(this.event){case"detached":t();break;case"attached":case"suspended":case"failed":t(r.reason||e.getError()||new m.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":t(new m.default("Detach request superseded by a subsequent attach request",9e4,409))}})}},e.prototype.detachImpl=function(t){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(_,!0);var e=a.default.fromValues({action:b.DETACH,channel:this.name});this.sendMessage(e,t||C)},e.prototype.subscribe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=e.processListenerArgs(t),a=o[0],s=o[1],f=o[2];if(!f&&this.realtime.options.promises)return l.promisify(this,"subscribe",[a,s]);if("failed"===this.state){null==f||f(m.default.fromValues(e.invalidStateError("failed")));return}return a&&"object"==typeof a&&!Array.isArray(a)?this._subscribeFilter(a,s):this.subscriptions.on(a,s),this.attach(f||C)},e.prototype._subscribeFilter=function(t,e){var r=function(r){var o,a,s,l,f,h,p={name:r.name,refTimeserial:null===(a=null===(o=r.extras)||void 0===o?void 0:o.ref)||void 0===a?void 0:a.timeserial,refType:null===(l=null===(s=r.extras)||void 0===s?void 0:s.ref)||void 0===l?void 0:l.type,isRef:!!(!(null===(h=null===(f=r.extras)||void 0===f?void 0:f.ref)||void 0===h)&&h.timeserial),clientId:r.clientId};Object.entries(t).find(function(t){var e=t[0],r=t[1];return void 0!==r&&p[e]!==r})||e(r)};this._addFilteredSubscription(t,e,r),this.subscriptions.on(r)},e.prototype._addFilteredSubscription=function(t,e,r){var o;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(e)){var a=this.filteredSubscriptions.get(e);a.set(t,(null===(o=null==a?void 0:a.get(t))||void 0===o?void 0:o.concat(r))||[r])}else this.filteredSubscriptions.set(e,new Map([[t,[r]]]))},e.prototype._getAndDeleteFilteredSubscriptions=function(t,e){var r=this;if(!this.filteredSubscriptions)return[];if(!e&&t)return Array.from(this.filteredSubscriptions.entries()).map(function(e){var o,a=e[0],s=e[1],l=s.get(t);return s.delete(t),0===s.size&&(null===(o=r.filteredSubscriptions)||void 0===o||o.delete(a)),l}).reduce(function(t,e){var r;return e?(r=t).concat.apply(r,e):t},[]);if(!e||!this.filteredSubscriptions.has(e))return[];var o=this.filteredSubscriptions.get(e);if(!t){var a=Array.from(o.values()).reduce(function(t,e){return t.concat.apply(t,e)},[]);return this.filteredSubscriptions.delete(e),a}var s=o.get(t);return o.delete(t),s||[]},e.prototype.unsubscribe=function(){for(var t,r=this,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var s=e.processListenerArgs(o),l=s[0],f=s[1];if("object"==typeof l&&!f||(null===(t=this.filteredSubscriptions)||void 0===t?void 0:t.has(f))){this._getAndDeleteFilteredSubscriptions(l,f).forEach(function(t){return r.subscriptions.off(t)});return}this.subscriptions.off(l,f)},e.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new m.default("Unable to sync to channel; not attached",4e4)}var t=this.connectionManager;if(!t.activeState())throw t.getError();var e=a.default.fromValues({action:b.SYNC,channel:this.name});this.syncChannelSerial&&(e.channelSerial=this.syncChannelSerial),t.send(e)},e.prototype.sendMessage=function(t,e){this.connectionManager.send(t,this.realtime.options.queueMessages,e)},e.prototype.sendPresence=function(t,e){var r=a.default.fromValues({action:b.PRESENCE,channel:this.name,presence:l.isArray(t)?v.default.fromValuesArray(t):[v.default.fromValues(t)]});this.sendMessage(r,e)},e.prototype.onMessage=function(t){var e,r=!1;switch(t.action){case b.ATTACHED:this._attachedMsgIndicator=!0,this.properties.attachSerial=t.channelSerial,this._mode=t.getMode(),this.params=t.params||{};var o=t.decodeModesFromFlags();this.modes=o&&l.allToLowerCase(o)||void 0;var a=t.hasFlag("RESUMED"),s=t.hasFlag("HAS_PRESENCE");if("attached"===this.state){this.setInProgress(_,!1),a||this.presence.onAttached(s);var f=new g.default(this.state,this.state,a,t.error);this._allChannelChanges.emit("update",f),(!a||this.channelOptions.updateOnAttached)&&this.emit("update",f)}else"detaching"===this.state?this.checkPendingState():this.notifyState("attached",t.error,a,s);break;case b.DETACHED:var p=t.error?m.default.fromValues(t.error):new m.default("Channel detached",90001,404);"detaching"===this.state?this.notifyState("detached",p):"attaching"===this.state?this.notifyState("suspended",p):this.requestState("attaching",p);break;case b.SYNC:if(r=!0,e=this.syncChannelSerial=t.channelSerial,!t.presence)break;case b.PRESENCE:for(var C=t.presence,O=t.id,w=t.connectionId,I=t.timestamp,R=this.channelOptions,M=void 0,T=0;T<C.length;T++)try{M=C[T],v.default.decode(M,R),M.connectionId||(M.connectionId=w),M.timestamp||(M.timestamp=I),M.id||(M.id=O+":"+T)}catch(P){h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()",P.toString())}this.presence.setPresence(C,r,e);break;case b.MESSAGE:if("attached"!==this.state){h.default.logAction(h.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+t.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var k=t.messages,B=k[0],D=k[k.length-1],O=t.id,w=t.connectionId,I=t.timestamp;if(B.extras&&B.extras.delta&&B.extras.delta.from!==this._lastPayload.messageId){var x='Delta message decode failure - previous message not available for message "'+t.id+'" on this channel "'+this.name+'".';h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()",x),this._startDecodeFailureRecovery(new m.default(x,40018,400));break}for(var T=0;T<k.length;T++){var x=k[T];try{A.default.decode(x,this._decodingContext)}catch(F){switch(h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()",F.toString()),F.code){case 40018:this._startDecodeFailureRecovery(F);return;case 40019:case 40021:this.notifyState("failed",F);return}}x.connectionId||(x.connectionId=w),x.timestamp||(x.timestamp=I),x.id||(x.id=O+":"+T)}this._lastPayload.messageId=D.id,this._lastPayload.protocolMessageChannelSerial=t.channelSerial,this.onEvent(k);break;case b.ERROR:var N=t.error;N&&80016==N.code?this.checkPendingState():this.notifyState("failed",m.default.fromValues(N));break;default:h.default.logAction(h.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+t.action+")"),this.connectionManager.abort($.default.unknownChannelErr)}},e.prototype._startDecodeFailureRecovery=function(t){var e=this;this._lastPayload.decodeFailureRecoveryInProgress||(h.default.logAction(h.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,t,function(){e._lastPayload.decodeFailureRecoveryInProgress=!1}))},e.prototype.onAttached=function(){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},e.prototype.notifyState=function(t,e,r,o){if(h.default.logAction(h.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+t),this.clearStateTimer(),t!==this.state){this.presence.actOnChannelState(t,o,e),"suspended"===t&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),e&&(this.errorReason=e);var a=new g.default(this.state,t,r,e),s="failed"===t?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(s,'Channel state for channel "'+this.name+'"',t+(e?"; reason: "+e:"")),"attaching"!==t&&"suspended"!==t&&(this.retryCount=0),"attached"===t?(this.onAttached(),this.setInProgress(O,o),this.setInProgress(_,!1)):("detached"===t||"failed"===t||"suspended"===t)&&(this.setInProgress(_,!1),this.setInProgress(O,!1)),"attached"===t?this._attachResume=!0:("detaching"===t||"failed"===t)&&(this._attachResume=!1),this.state=t,this._allChannelChanges.emit(t,a),this.emit(t,a)}},e.prototype.requestState=function(t,e){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+t),this.notifyState(t,e),this.checkPendingState()},e.prototype.checkPendingState=function(){var t=this.connectionManager.state;if(!(t.sendEvents||t.forceQueueEvents)){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync()}},e.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":var t=new m.default("Channel attach timed out",90007,408);this.notifyState("suspended",t);break;case"detaching":var t=new m.default("Channel detach timed out",90007,408);this.notifyState("attached",t);break;default:this.checkPendingState()}},e.prototype.startStateTimerIfNotRunning=function(){var t=this;this.stateTimer||(this.stateTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),t.stateTimer=null,t.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},e.prototype.clearStateTimer=function(){var t=this.stateTimer;t&&(clearTimeout(t),this.stateTimer=null)},e.prototype.startRetryTimer=function(){var t=this;if(!this.retryTimer){this.retryCount++;var e=this.realtime.options.timeouts.channelRetryTimeout*l.getJitterCoefficient()*l.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){"suspended"===t.state&&t.connectionManager.state.sendEvents&&(t.retryTimer=null,h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),t.requestState("attaching"))},e)}},e.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},e.prototype.setInProgress=function(t,e){this.rest.channels.setInProgress(this,t,e)},e.prototype.getReleaseErr=function(){var t=this.state;return"initialized"===t||"detached"===t||"failed"===t?null:new m.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+t,90001,400)},e.progressOps={statechange:_,sync:O},e}(f.default);e.default=w},function(t,e,r){"use strict";e.__esModule=!0,e.default=function t(e,r,o,a){this.previous=e,this.current=r,"attached"===r&&(this.resumed=o),a&&(this.reason=a)}},function(t,e,r){var o,a;a=function(t){var e,r,o,a,s,l,f;return o=(r=(e=t).lib).WordArray,a=r.Hasher,s=e.algo,l=[],f=s.SHA1=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,o=r[0],a=r[1],s=r[2],f=r[3],h=r[4],p=0;p<80;p++){if(p<16)l[p]=0|t[e+p];else{var A=l[p-3]^l[p-8]^l[p-14]^l[p-16];l[p]=A<<1|A>>>31}var g=(o<<5|o>>>27)+h+l[p];p<20?g+=(a&s|~a&f)+1518500249:p<40?g+=(a^s^f)+1859775393:p<60?g+=(a&s|a&f|s&f)-1894007588:g+=(a^s^f)-899497514,h=f,f=s,s=a<<30|a>>>2,a=o,o=g}r[0]=r[0]+o|0,r[1]=r[1]+a|0,r[2]=r[2]+s|0,r[3]=r[3]+f|0,r[4]=r[4]+h|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return e[o>>>5]|=128<<24-o%32,e[(o+64>>>9<<4)+14]=Math.floor(r/4294967296),e[(o+64>>>9<<4)+15]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}}),e.SHA1=a._createHelper(f),e.HmacSHA1=a._createHmacHelper(f),t.SHA1},t.exports=e=a(r(6))},function(t,e,r){"use strict";function o(t,e,r){for(var o=0,a=r.length;o<a;o++){var s=r.charCodeAt(o);if(s<128){t.setUint8(e++,s>>>0&127|0);continue}if(s<2048){t.setUint8(e++,s>>>6&31|192),t.setUint8(e++,s>>>0&63|128);continue}if(s<65536){t.setUint8(e++,s>>>12&15|224),t.setUint8(e++,s>>>6&63|128),t.setUint8(e++,s>>>0&63|128);continue}if(s<1114112){t.setUint8(e++,s>>>18&7|240),t.setUint8(e++,s>>>12&63|128),t.setUint8(e++,s>>>6&63|128),t.setUint8(e++,s>>>0&63|128);continue}throw Error("bad codepoint "+s)}}function a(t,e,r){for(var o="",a=e,s=e+r;a<s;a++){var l=t.getUint8(a);if((128&l)==0){o+=String.fromCharCode(l);continue}if((224&l)==192){o+=String.fromCharCode((15&l)<<6|63&t.getUint8(++a));continue}if((240&l)==224){o+=String.fromCharCode((15&l)<<12|(63&t.getUint8(++a))<<6|(63&t.getUint8(++a))<<0);continue}if((248&l)==240){o+=String.fromCharCode((7&l)<<18|(63&t.getUint8(++a))<<12|(63&t.getUint8(++a))<<6|(63&t.getUint8(++a))<<0);continue}throw Error("Invalid byte "+l.toString(16))}return o}function s(t){for(var e=0,r=0,o=t.length;r<o;r++){var a=t.charCodeAt(r);if(a<128){e+=1;continue}if(a<2048){e+=2;continue}if(a<65536){e+=3;continue}if(a<1114112){e+=4;continue}throw Error("bad codepoint "+a)}return e}e.__esModule=!0;var l=function t(e,r){var o=this;this.map=function(t){for(var e={},r=0;r<t;r++)e[o.parse()]=o.parse();return e},this.bin=function(t){var e=new ArrayBuffer(t);return new Uint8Array(e).set(new Uint8Array(o.view.buffer,o.offset,t),0),o.offset+=t,e},this.buf=this.bin,this.str=function(t){var e=a(o.view,o.offset,t);return o.offset+=t,e},this.array=function(t){for(var e=Array(t),r=0;r<t;r++)e[r]=o.parse();return e},this.ext=function(t){return o.offset+=t,{type:o.view.getInt8(o.offset),data:o.buf(t)}},this.parse=function(){var t,e,r,a,s,l,f=o.view.getUint8(o.offset);if((128&f)==0)return o.offset++,f;if((240&f)==128)return l=15&f,o.offset++,o.map(l);if((240&f)==144)return l=15&f,o.offset++,o.array(l);if((224&f)==160)return l=31&f,o.offset++,o.str(l);if((224&f)==224)return s=o.view.getInt8(o.offset),o.offset++,s;switch(f){case 192:return o.offset++,null;case 193:o.offset++;return;case 194:return o.offset++,!1;case 195:return o.offset++,!0;case 196:return l=o.view.getUint8(o.offset+1),o.offset+=2,o.bin(l);case 197:return l=o.view.getUint16(o.offset+1),o.offset+=3,o.bin(l);case 198:return l=o.view.getUint32(o.offset+1),o.offset+=5,o.bin(l);case 199:return l=o.view.getUint8(o.offset+1),o.offset+=2,o.ext(l);case 200:return l=o.view.getUint16(o.offset+1),o.offset+=3,o.ext(l);case 201:return l=o.view.getUint32(o.offset+1),o.offset+=5,o.ext(l);case 202:return s=o.view.getFloat32(o.offset+1),o.offset+=5,s;case 203:return s=o.view.getFloat64(o.offset+1),o.offset+=9,s;case 204:return s=o.view.getUint8(o.offset+1),o.offset+=2,s;case 205:return s=o.view.getUint16(o.offset+1),o.offset+=3,s;case 206:return s=o.view.getUint32(o.offset+1),o.offset+=5,s;case 207:return s=(t=o.view,e=(e=o.offset+1)||0,4294967296*t.getUint32(e)+t.getUint32(e+4)),o.offset+=9,s;case 208:return s=o.view.getInt8(o.offset+1),o.offset+=2,s;case 209:return s=o.view.getInt16(o.offset+1),o.offset+=3,s;case 210:return s=o.view.getInt32(o.offset+1),o.offset+=5,s;case 211:return s=(r=o.view,a=(a=o.offset+1)||0,4294967296*r.getInt32(a)+r.getUint32(a+4)),o.offset+=9,s;case 212:return l=1,o.offset++,o.ext(l);case 213:return l=2,o.offset++,o.ext(l);case 214:return l=4,o.offset++,o.ext(l);case 215:return l=8,o.offset++,o.ext(l);case 216:return l=16,o.offset++,o.ext(l);case 217:return l=o.view.getUint8(o.offset+1),o.offset+=2,o.str(l);case 218:return l=o.view.getUint16(o.offset+1),o.offset+=3,o.str(l);case 219:return l=o.view.getUint32(o.offset+1),o.offset+=5,o.str(l);case 220:return l=o.view.getUint16(o.offset+1),o.offset+=3,o.array(l);case 221:return l=o.view.getUint32(o.offset+1),o.offset+=5,o.array(l);case 222:return l=o.view.getUint16(o.offset+1),o.offset+=3,o.map(l);case 223:return l=o.view.getUint32(o.offset+1),o.offset+=5,o.map(l)}throw Error("Unknown type 0x"+f.toString(16))},this.offset=r||0,this.view=e};function f(t,e){return Object.keys(t).filter(function(r){var o=t[r];return(!e||null!=o)&&("function"!=typeof o||!!o.toJSON)})}e.default={encode:function t(e,r){var a=function t(e,r){var o=typeof e;if("string"===o){var a=s(e);if(a<32)return 1+a;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){var l=e.byteLength;if(l<256)return 2+l;if(l<65536)return 3+l;if(l<4294967296)return 5+l}if("number"==typeof e){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;if(e<18446744073709552e3)return 9;throw Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;if(e>=0x8000000000000000)return 9;throw Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===o)return 1;if(null===e)return r?0:1;if(void 0===e)return r?0:3;if("function"==typeof e.toJSON)return t(e.toJSON(),r);if("object"===o){var h,p=0;if(Array.isArray(e)){h=e.length;for(var A=0;A<h;A++)p+=t(e[A],r)}else{var g=f(e,r);h=g.length;for(var A=0;A<h;A++){var m=g[A];p+=t(m)+t(e[m],r)}}if(h<16)return 1+p;if(h<65536)return 3+p;if(h<4294967296)return 5+p;throw Error("Array or object too long 0x"+h.toString(16))}if("function"===o)return 0;throw Error("Unknown type "+o)}(e,r);if(0!==a){var l=new ArrayBuffer(a),h=new DataView(l);return function t(e,r,a,l){var h=typeof e;if("string"==typeof e){var p=s(e);if(p<32)return r.setUint8(a,160|p),o(r,a+1,e),1+p;if(p<256)return r.setUint8(a,217),r.setUint8(a+1,p),o(r,a+2,e),2+p;if(p<65536)return r.setUint8(a,218),r.setUint16(a+1,p),o(r,a+3,e),3+p;if(p<4294967296)return r.setUint8(a,219),r.setUint32(a+1,p),o(r,a+5,e),5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){var A=e.byteLength;if(A<256)return r.setUint8(a,196),r.setUint8(a+1,A),new Uint8Array(r.buffer).set(new Uint8Array(e),a+2),2+A;if(A<65536)return r.setUint8(a,197),r.setUint16(a+1,A),new Uint8Array(r.buffer).set(new Uint8Array(e),a+3),3+A;if(A<4294967296)return r.setUint8(a,198),r.setUint32(a+1,A),new Uint8Array(r.buffer).set(new Uint8Array(e),a+5),5+A}if("number"==typeof e){if(Math.floor(e)!==e)return r.setUint8(a,203),r.setFloat64(a+1,e),9;if(e>=0){if(e<128)return r.setUint8(a,e),1;if(e<256)return r.setUint8(a,204),r.setUint8(a+1,e),2;if(e<65536)return r.setUint8(a,205),r.setUint16(a+1,e),3;if(e<4294967296)return r.setUint8(a,206),r.setUint32(a+1,e),5;if(e<18446744073709552e3)return r.setUint8(a,207),g=r,m=a+1,(v=e)<18446744073709552e3?(g.setUint32(m,Math.floor(23283064365386963e-26*v)),g.setInt32(m+4,-1&v)):(g.setUint32(m,4294967295),g.setUint32(m+4,4294967295)),9;throw Error("Number too big 0x"+e.toString(16))}if(e>=-32)return r.setInt8(a,e),1;if(e>=-128)return r.setUint8(a,208),r.setInt8(a+1,e),2;if(e>=-32768)return r.setUint8(a,209),r.setInt16(a+1,e),3;if(e>=-2147483648)return r.setUint8(a,210),r.setInt32(a+1,e),5;if(e>=0x8000000000000000)return r.setUint8(a,211),$=r,b=a+1,(C=e)<0x7fffffffffffffff?($.setInt32(b,Math.floor(23283064365386963e-26*C)),$.setInt32(b+4,-1&C)):($.setUint32(b,2147483647),$.setUint32(b+4,2147483647)),9;throw Error("Number too small -0x"+(-e).toString(16).substr(1))}if("undefined"===h)return l?0:(r.setUint8(a,212),r.setUint8(a+1,0),r.setUint8(a+2,0),3);if(null===e)return l?0:(r.setUint8(a,192),1);if("boolean"===h)return r.setUint8(a,e?195:194),1;if("function"==typeof e.toJSON)return t(e.toJSON(),r,a,l);if("object"===h){var g,m,v,$,b,C,_,O=0,w=void 0,I=Array.isArray(e);if((_=I?e.length:(w=f(e,l)).length)<16?(r.setUint8(a,_|(I?144:128)),O=1):_<65536?(r.setUint8(a,I?220:222),r.setUint16(a+1,_),O=3):_<4294967296&&(r.setUint8(a,I?221:223),r.setUint32(a+1,_),O=5),I)for(var R=0;R<_;R++)O+=t(e[R],r,a+O,l);else if(w)for(var R=0;R<_;R++){var M=w[R];O+=t(M,r,a+O),O+=t(e[M],r,a+O,l)}return O}if("function"===h)return 0;throw Error("Unknown type "+h)}(e,h,0,r),l}},decode:function t(e){var r=new DataView(e),o=new l(r),a=o.parse();if(o.offset!==e.byteLength)throw Error(e.byteLength-o.offset+" trailing bytes");return a},inspect:function t(e){if(void 0===e)return"undefined";if(e instanceof ArrayBuffer?(o="ArrayBuffer",r=new DataView(e)):e instanceof DataView&&(o="DataView",r=e),!r)return JSON.stringify(e);for(var r,o,a=[],s=0;s<e.byteLength;s++){if(s>20){a.push("...");break}var l=r.getUint8(s).toString(16);1===l.length&&(l="0"+l),a.push(l)}return"<"+o+" "+a.join(" ")+">"},utf8Write:o,utf8Read:a,utf8ByteCount:s}},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(30)),s=o.__importDefault(r(49)),l=o.__importDefault(r(0)),f=o.__importDefault(r(55)),h=o.__importDefault(r(57)),p=o.__importDefault(r(62)),A=o.__importDefault(r(63)),g=o.__importDefault(r(67)),m=o.__importDefault(r(3)),v=r(8),$=o.__importDefault(r(25)),b=o.__importDefault(r(64)),C=o.__importDefault(r(65)),_=o.__importDefault(r(40)),O=o.__importDefault(r(9)),w=o.__importDefault(r(14));l.default.Crypto=h.default,l.default.BufferUtils=f.default,l.default.Http=p.default,l.default.Config=A.default,l.default.Transports=g.default,l.default.WebStorage=b.default,a.default.Crypto=h.default,s.default.Crypto=h.default,a.default.Message=O.default,s.default.Message=O.default,a.default.PresenceMessage=w.default,s.default.PresenceMessage=w.default,s.default.ConnectionManager=$.default,m.default.initLogHandlers(),l.default.Defaults=v.getDefaults(C.default),l.default.Config.agent&&(l.default.Defaults.agent+=" "+l.default.Config.agent),l.default.Config.noUpgrade&&(l.default.Defaults.upgradeTransports=[]),e.default={Rest:a.default,Realtime:s.default,msgpack:_.default}},function(t){t.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(t,e,r){var o,a;a=function(t){return t.HmacSHA256},t.exports=e=a(r(6),r(31),r(23))},function(t,e){},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(46)),l=o.__importDefault(r(24)),f=o.__importDefault(r(18)),h=o.__importDefault(r(5)),p=o.__importDefault(r(47)),A=function(){},g=function(){function t(t){this.rest=t,this.deviceRegistrations=new m(t),this.channelSubscriptions=new v(t)}return t.prototype.publish=function(t,e,r){var o=this.rest,s=o.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,f=a.defaultPostHeaders(s),h={},p=a.mixin({recipient:t},e);if("function"!=typeof r){if(this.rest.options.promises)return a.promisify(this,"publish",arguments);r=A}o.options.headers&&a.mixin(f,o.options.headers),o.options.pushFullWait&&a.mixin(h,{fullWait:"true"});var g=a.encodeBody(p,s);l.default.post(o,"/push/publish",g,f,h,null,function(t){return r(t)})},t}(),m=function(){function t(t){this.rest=t}return t.prototype.save=function(t,e){var r=this.rest,o=s.default.fromValues(t),f=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,h=a.defaultPostHeaders(f),p={};if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"save",arguments);e=A}r.options.headers&&a.mixin(h,r.options.headers),r.options.pushFullWait&&a.mixin(p,{fullWait:"true"});var g=a.encodeBody(o,f);l.default.put(r,"/push/deviceRegistrations/"+encodeURIComponent(t.id),g,h,p,null,function(t,r,o,a){e(t,t?void 0:s.default.fromResponseBody(r,a?void 0:f))})},t.prototype.get=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,f=a.defaultGetHeaders(o),p=t.id||t;if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"get",arguments);e=A}if("string"!=typeof p||!p.length){e(new h.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}r.options.headers&&a.mixin(f,r.options.headers),l.default.get(r,"/push/deviceRegistrations/"+encodeURIComponent(p),f,{},null,function(t,r,a,l){e(t,t?void 0:s.default.fromResponseBody(r,l?void 0:o))})},t.prototype.list=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,l=this.rest.http.supportsLinkHeaders?void 0:o,h=a.defaultGetHeaders(o);if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"list",arguments);e=A}r.options.headers&&a.mixin(h,r.options.headers),new f.default(r,"/push/deviceRegistrations",h,l,function(t,e,r){return s.default.fromResponseBody(t,r?void 0:o)}).get(t,e)},t.prototype.remove=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultGetHeaders(o),f={},p=t.id||t;if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"remove",arguments);e=A}if("string"!=typeof p||!p.length){e(new h.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}r.options.headers&&a.mixin(s,r.options.headers),r.options.pushFullWait&&a.mixin(f,{fullWait:"true"}),l.default.delete(r,"/push/deviceRegistrations/"+encodeURIComponent(p),s,f,null,function(t){return e(t)})},t.prototype.removeWhere=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultGetHeaders(o);if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);e=A}r.options.headers&&a.mixin(s,r.options.headers),r.options.pushFullWait&&a.mixin(t,{fullWait:"true"}),l.default.delete(r,"/push/deviceRegistrations",s,t,null,function(t){return e(t)})},t}(),v=function(){function t(e){this.remove=t.prototype.removeWhere,this.rest=e}return t.prototype.save=function(t,e){var r=this.rest,o=p.default.fromValues(t),s=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,f=a.defaultPostHeaders(s),h={};if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"save",arguments);e=A}r.options.headers&&a.mixin(f,r.options.headers),r.options.pushFullWait&&a.mixin(h,{fullWait:"true"});var g=a.encodeBody(o,s);l.default.post(r,"/push/channelSubscriptions",g,f,h,null,function(t,r,o,a){e(t,!t&&p.default.fromResponseBody(r,a?void 0:s))})},t.prototype.list=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=this.rest.http.supportsLinkHeaders?void 0:o,l=a.defaultGetHeaders(o);if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"list",arguments);e=A}r.options.headers&&a.mixin(l,r.options.headers),new f.default(r,"/push/channelSubscriptions",l,s,function(t,e,r){return p.default.fromResponseBody(t,r?void 0:o)}).get(t,e)},t.prototype.removeWhere=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=a.defaultGetHeaders(o);if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"removeWhere",arguments);e=A}r.options.headers&&a.mixin(s,r.options.headers),r.options.pushFullWait&&a.mixin(t,{fullWait:"true"}),l.default.delete(r,"/push/channelSubscriptions",s,t,null,function(t){return e(t)})},t.prototype.listChannels=function(t,e){var r=this.rest,o=r.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,s=this.rest.http.supportsLinkHeaders?void 0:o,l=a.defaultGetHeaders(o);if("function"!=typeof e){if(this.rest.options.promises)return a.promisify(this,"listChannels",arguments);e=A}r.options.headers&&a.mixin(l,r.options.headers),r.options.pushFullWait&&a.mixin(t,{fullWait:"true"}),new f.default(r,"/push/channels",l,s,function(t,e,r){for(var s=!r&&o?a.decodeBody(t,o):t,l=0;l<s.length;l++)s[l]=String(s[l]);return s}).get(t,e)},t}();e.default=function t(e){this.rest=e,this.admin=new g(e)}},function(t,e,r){"use strict";e.__esModule=!0;var o,a,s,l,f=r(1),h=f.__importStar(r(2)),p=f.__importDefault(r(5));(s=a||(a={})).Phone="phone",s.Tablet="tablet",s.Desktop="desktop",s.TV="tv",s.Watch="watch",s.Car="car",s.Embedded="embedded",s.Other="other",(l=o||(o={})).Android="android",l.IOS="ios",l.Browser="browser";var A=function(){function t(){}return t.prototype.toJSON=function(){var t,e,r;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:null===(t=this.push)||void 0===t?void 0:t.recipient,state:null===(e=this.push)||void 0===e?void 0:e.state,error:null===(r=this.push)||void 0===r?void 0:r.error}}},t.prototype.toString=function(){var t,e,r,o,a="[DeviceDetails";return this.id&&(a+="; id="+this.id),this.platform&&(a+="; platform="+this.platform),this.formFactor&&(a+="; formFactor="+this.formFactor),this.clientId&&(a+="; clientId="+this.clientId),this.metadata&&(a+="; metadata="+this.metadata),this.deviceIdentityToken&&(a+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!(null===(t=this.push)||void 0===t)&&t.recipient&&(a+="; push.recipient="+JSON.stringify(this.push.recipient)),!(null===(e=this.push)||void 0===e)&&e.state&&(a+="; push.state="+this.push.state),!(null===(r=this.push)||void 0===r)&&r.error&&(a+="; push.error="+JSON.stringify(this.push.error)),!(null===(o=this.push)||void 0===o)&&o.metadata&&(a+="; push.metadata="+this.push.metadata),a+="]"},t.fromResponseBody=function(e,r){return r&&(e=h.decodeBody(e,r)),h.isArray(e)?t.fromValuesArray(e):t.fromValues(e)},t.fromValues=function(e){return e.error=e.error&&p.default.fromValues(e.error),Object.assign(new t,e)},t.fromValuesArray=function(e){for(var r=e.length,o=Array(r),a=0;a<r;a++)o[a]=t.fromValues(e[a]);return o},t.toRequestBody=h.encodeBody,t}();e.default=A},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1).__importStar(r(2)),a=function(){function t(){}return t.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},t.prototype.toString=function(){var t="[PushChannelSubscription";return this.channel&&(t+="; channel="+this.channel),this.deviceId&&(t+="; deviceId="+this.deviceId),this.clientId&&(t+="; clientId="+this.clientId),t+="]"},t.fromResponseBody=function(e,r){return r&&(e=o.decodeBody(e,r)),o.isArray(e)?t.fromValuesArray(e):t.fromValues(e)},t.fromValues=function(e){return Object.assign(new t,e)},t.fromValuesArray=function(e){for(var r=e.length,o=Array(r),a=0;a<r;a++)o[a]=t.fromValues(e[a]);return o},t.toRequestBody=o.encodeBody,t}();e.default=a},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=function t(e){this.count=e&&e.count||0,this.data=e&&e.data||0,this.uncompressedData=e&&e.uncompressedData||0,this.failed=e&&e.failed||0,this.refused=e&&e.refused||0},l=function(t){function e(e){var r=t.call(this,e)||this;return e&&e.category&&(r.category={},a.forInOwnNonNullProperties(e.category,function(t){r.category[t]=new s(e.category[t])})),r}return o.__extends(e,t),e}(s),f=function t(e){this.peak=e&&e.peak||0,this.min=e&&e.min||0,this.mean=e&&e.mean||0,this.opened=e&&e.opened||0,this.refused=e&&e.refused||0},h=function t(e){this.succeeded=e&&e.succeeded||0,this.failed=e&&e.failed||0,this.refused=e&&e.refused||0},p=function t(e){this.plain=new f(e&&e.plain),this.tls=new f(e&&e.tls),this.all=new f(e&&e.all)},A=function t(e){this.messages=new l(e&&e.messages),this.presence=new l(e&&e.presence),this.all=new l(e&&e.all)},g=function t(e){this.realtime=new A(e&&e.realtime),this.rest=new A(e&&e.rest),this.webhook=new A(e&&e.webhook),this.sharedQueue=new A(e&&e.sharedQueue),this.externalQueue=new A(e&&e.externalQueue),this.httpEvent=new A(e&&e.httpEvent),this.push=new A(e&&e.push),this.all=new A(e&&e.all)},m=function t(e){this.all=new A(e&&e.all),this.inbound=new g(e&&e.inbound),this.outbound=new g(e&&e.outbound)},v=function t(e){this.all=new A(e&&e.all),this.producerPaid=new m(e&&e.producerPaid),this.consumerPaid=new m(e&&e.consumerPaid)},$=function t(e){this.messages=e&&e.messages||0;var r=e&&e.notifications;this.notifications={invalid:r&&r.invalid||0,attempted:r&&r.attempted||0,successful:r&&r.successful||0,failed:r&&r.failed||0},this.directPublishes=e&&e.directPublishes||0},b=function t(e){this.succeeded=e&&e.succeeded||0,this.skipped=e&&e.skipped||0,this.failed=e&&e.failed||0},C=function t(e){var r=this;this.delta=void 0,e&&e.delta&&(this.delta={},a.forInOwnNonNullProperties(e.delta,function(t){r.delta[t]=new b(e.delta[t])}))},_=function(t){function e(e){var r=t.call(this,e)||this;return r.persisted=new A(e&&e.persisted),r.connections=new p(e&&e.connections),r.channels=new f(e&&e.channels),r.apiRequests=new h(e&&e.apiRequests),r.tokenRequests=new h(e&&e.tokenRequests),r.xchgProducer=new v(e&&e.xchgProducer),r.xchgConsumer=new v(e&&e.xchgConsumer),r.push=new $(e&&e.pushStats),r.processed=new C(e&&e.processed),r.inProgress=e&&e.inProgress||void 0,r.unit=e&&e.unit||void 0,r.intervalId=e&&e.intervalId||void 0,r}return o.__extends(e,t),e.fromValues=function(t){return new e(t)},e}(m);e.default=_},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(30)),l=o.__importDefault(r(7)),f=o.__importDefault(r(3)),h=o.__importDefault(r(50)),p=o.__importDefault(r(37)),A=o.__importDefault(r(8)),g=o.__importDefault(r(5)),m=o.__importDefault(r(10)),v=o.__importDefault(r(25)),$=o.__importDefault(r(0)),b=o.__importDefault(r(9)),C=function(t){function e(e){var r=t.call(this,e)||this;return f.default.logAction(f.default.LOG_MINOR,"Realtime()",""),r.connection=new h.default(r,r.options),r.channels=new _(r),!1!==e.autoConnect&&r.connect(),r}return o.__extends(e,t),e.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},e.prototype.close=function(){f.default.logAction(f.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},e.Promise=function(t){return(t=A.default.objectifyOptions(t)).promises=!0,new e(t)},e.Callbacks=e,e.Utils=a,e.ConnectionManager=v.default,e.Platform=$.default,e.ProtocolMessage=m.default,e.Message=b.default,e}(s.default),_=function(t){function e(e){var r=t.call(this)||this;return r.realtime=e,r.all={},r.inProgress={},e.connection.connectionManager.on("transport.active",function(){r.onTransportActive()}),r}return o.__extends(e,t),e.prototype.onChannelMessage=function(t){var e=t.channel;if(void 0===e){f.default.logAction(f.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+t.action);return}var r=this.all[e];if(!r){f.default.logAction(f.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+e);return}r.onMessage(t)},e.prototype.onTransportActive=function(){for(var t in this.all){var e=this.all[t];"attaching"===e.state||"detaching"===e.state?e.checkPendingState():"suspended"===e.state&&e.attach()}},e.prototype.reattach=function(t){for(var e in this.all){var r=this.all[e];"attached"===r.state&&r.requestState("attaching",t)}},e.prototype.resetAttachedMsgIndicators=function(){for(var t in this.all){var e=this.all[t];"attached"===e.state&&(e._attachedMsgIndicator=!1)}},e.prototype.checkAttachedMsgIndicators=function(t){for(var e in this.all){var r=this.all[e];if("attached"===r.state&&!1===r._attachedMsgIndicator){var o="30s after a resume, found channel which has not received an attached; channelId = "+e+"; connectionId = "+t;f.default.logAction(f.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",o),r.requestState("attaching")}}},e.prototype.propogateConnectionInterruption=function(t,e){var r=["attaching","attached","detaching","suspended"],o={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"}[t];for(var s in this.all){var l=this.all[s];a.arrIn(r,l.state)&&l.notifyState(o,e)}},e.prototype.get=function(t,e){t=String(t);var r=this.all[t];if(r){if(e){if(r._shouldReattachToSetOptions(e))throw new g.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);r.setOptions(e)}}else r=this.all[t]=new p.default(this.realtime,t,e);return r},e.prototype.release=function(t){t=String(t);var e=this.all[t];if(e){var r=e.getReleaseErr();if(r)throw r;delete this.all[t],delete this.inProgress[t]}},e.prototype.setInProgress=function(t,e,r){this.inProgress[t.name]=this.inProgress[t.name]||{},this.inProgress[t.name][e]=r,!r&&this.hasNopending()&&this.emit("nopending")},e.prototype.onceNopending=function(t){if(this.hasNopending()){t();return}this.once("nopending",t)},e.prototype.hasNopending=function(){return a.arrEvery(a.valuesArray(this.inProgress,!0),function(t){return!a.containsValue(t,!0)})},e}(l.default);e.default=C},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(7)),l=o.__importDefault(r(25)),f=o.__importDefault(r(3)),h=o.__importDefault(r(36)),p=o.__importDefault(r(0));function A(){}var g=function(t){function e(e,r){var o=t.call(this)||this;return o.whenState=function(t,e){return s.default.prototype.whenState.call(o,t,o.state,e,new h.default(void 0,t))},o.ably=e,o.connectionManager=new l.default(e,r),o.state=o.connectionManager.state.state,o.key=void 0,o.id=void 0,o.serial=void 0,o.timeSerial=void 0,o.recoveryKey=void 0,o.errorReason=null,o.connectionManager.on("connectionstate",function(t){var e=o.state=t.current;p.default.Config.nextTick(function(){o.emit(e,t)})}),o.connectionManager.on("update",function(t){p.default.Config.nextTick(function(){o.emit("update",t)})}),o}return o.__extends(e,t),e.prototype.connect=function(){f.default.logAction(f.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},e.prototype.ping=function(t){if(f.default.logAction(f.default.LOG_MINOR,"Connection.ping()",""),!t){if(this.ably.options.promises)return a.promisify(this,"ping",arguments);t=A}this.connectionManager.ping(null,t)},e.prototype.close=function(){f.default.logAction(f.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},e}(s.default);e.default=g},function(t,e,r){"use strict";e.__esModule=!0,e.PendingMessage=void 0;var o=r(1),a=o.__importDefault(r(10)),s=o.__importStar(r(2)),l=o.__importDefault(r(7)),f=o.__importDefault(r(3)),h=o.__importDefault(r(35)),p=o.__importDefault(r(5)),A=a.default.Action;e.PendingMessage=function t(e,r){this.message=e,this.callback=r,this.merged=!1;var o=e.action;this.sendAttempted=!1,this.ackRequired=o==A.MESSAGE||o==A.PRESENCE};var g=function(t){function e(e){var r=t.call(this)||this;return r.transport=e,r.messageQueue=new h.default,e.on("ack",function(t,e){r.onAck(t,e)}),e.on("nack",function(t,e,o){r.onNack(t,e,o)}),r}return o.__extends(e,t),e.prototype.onAck=function(t,e){f.default.logAction(f.default.LOG_MICRO,"Protocol.onAck()","serial = "+t+"; count = "+e),this.messageQueue.completeMessages(t,e)},e.prototype.onNack=function(t,e,r){f.default.logAction(f.default.LOG_ERROR,"Protocol.onNack()","serial = "+t+"; count = "+e+"; err = "+s.inspectError(r)),r||(r=new p.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(t,e,r)},e.prototype.onceIdle=function(t){var e=this.messageQueue;if(0===e.count()){t();return}e.once("idle",t)},e.prototype.send=function(t){t.ackRequired&&this.messageQueue.push(t),f.default.shouldLog(f.default.LOG_MICRO)&&f.default.logAction(f.default.LOG_MICRO,"Protocol.send()","sending msg; "+a.default.stringify(t.message)),t.sendAttempted=!0,this.transport.send(t.message)},e.prototype.getTransport=function(){return this.transport},e.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},e.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},e.prototype.finish=function(){var t=this.transport;this.onceIdle(function(){t.disconnect()})},e}(l.default);e.default=g},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importDefault(r(0)),s=o.__importStar(r(2)),l=o.__importDefault(r(26)),f=o.__importDefault(r(8)),h=o.__importDefault(r(3)),p=o.__importDefault(r(10)),A=o.__importDefault(r(5)),g="web_socket",m=function(t){function e(e,r,o){var s=t.call(this,e,r,o)||this;return s.shortName=g,o.heartbeats=a.default.Config.useProtocolHeartbeats,s.wsHost=f.default.getHost(o.options,o.host,!0),s}return o.__extends(e,t),e.isAvailable=function(){return!!a.default.Config.WebSocket},e.prototype.createWebSocket=function(t,e){var r=0;if(e)for(var o in e)t+=(r++?"&":"?")+o+"="+e[o];return this.uri=t,new a.default.Config.WebSocket(t)},e.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},e.prototype.connect=function(){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),l.default.prototype.connect.call(this);var t=this,e=this.params,r=e.options,o=(r.tls?"wss://":"ws://")+this.wsHost+":"+f.default.getPort(r)+"/";h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+o),this.auth.getAuthParams(function(r,s){if(!t.isDisposed){var l="";for(var f in s)l+=" "+f+": "+s[f]+";";if(h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+l+" err: "+r),r){t.disconnect(r);return}var p=e.getConnectParams(s);try{var A,g=t.wsConnection=t.createWebSocket(o,p);g.binaryType=a.default.Config.binaryType,g.onopen=function(){t.onWsOpen()},g.onclose=function(e){t.onWsClose(e)},g.onmessage=function(e){t.onWsData(e.data)},g.onerror=function(e){t.onWsError(e)},(A=g).on&&g.on("ping",function(){t.onActivity()})}catch(m){h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(m.stack||m.message)),t.disconnect(m)}}})},e.prototype.send=function(t){var e=this.wsConnection;if(!e){h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{e.send(p.default.serialize(t,this.params.format))}catch(r){var o="Exception from ws connection when trying to send: "+s.inspectError(r);h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.send()",o),this.finish("disconnected",new A.default(o,5e4,500))}},e.prototype.onWsData=function(t){h.default.logAction(h.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+t.length+"; type = "+typeof t);try{this.onProtocolMessage(p.default.deserialize(t,this.format))}catch(e){h.default.logAction(h.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+e.stack)}},e.prototype.onWsOpen=function(){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},e.prototype.onWsClose=function(t){var e,r;if("object"==typeof t?(r=t.code,e=t.wasClean||1e3===r):e=1e3==(r=t),delete this.wsConnection,e){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var o=new A.default("Websocket closed",80003,400);this.finish("disconnected",o)}else{var a="Unclean disconnection of WebSocket ; code = "+r,o=new A.default(a,80003,400);h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onWsClose()",a),this.finish("disconnected",o)}this.emit("disposed")},e.prototype.onWsError=function(t){var e=this;h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+t.message),a.default.Config.nextTick(function(){e.disconnect(Error(t.message))})},e.prototype.dispose=function(){h.default.logAction(h.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var t=this.wsConnection;t&&(t.onmessage=function(){},delete this.wsConnection,a.default.Config.nextTick(function(){if(h.default.logAction(h.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!t)throw Error("WebSocketTransport.dispose(): wsConnection is not defined");t.close()}))},e}(l.default);e.default=function t(e){return m.isAvailable()&&(e.supportedTransports[g]=m),m}},function(t,e,r){"use strict";var o,a;e.__esModule=!0,e.isSuccessCode=void 0,(a=o||(o={}))[a.Success=200]="Success",a[a.NoContent=204]="NoContent",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.RequestTimeout=408]="RequestTimeout",a[a.InternalServerError=500]="InternalServerError",e.isSuccessCode=function t(e){return e>=o.Success&&e<o.BadRequest},e.default=o},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=o.__importStar(r(2)),s=o.__importDefault(r(34)),l=o.__importDefault(r(7)),f=o.__importDefault(r(3)),h=o.__importDefault(r(14)),p=o.__importDefault(r(5)),A=o.__importDefault(r(37)),g=o.__importDefault(r(22)),m=o.__importDefault(r(38)),v=function(){};function $(t){return t.clientId+":"+t.connectionId}function b(t){var e=t.channel.realtime,r=e.auth.clientId;return(!r||"*"===r)&&"connected"===e.connection.state}function C(t,e){if(t.isSynthesized()||e.isSynthesized())return t.timestamp>e.timestamp;var r=t.parseId(),o=e.parseId();return r.msgSerial===o.msgSerial?r.index>o.index:r.msgSerial>o.msgSerial}var _=function(t){function e(e){var r=t.call(this,e)||this;return r.channel=e,r.syncComplete=!1,r.members=new O(r),r._myMembers=new O(r),r.subscriptions=new l.default,r.pendingPresence=[],r}return o.__extends(e,t),e.prototype.enter=function(t,e){if(b(this))throw new p.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,t,"enter",e)},e.prototype.update=function(t,e){if(b(this))throw new p.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,t,"update",e)},e.prototype.enterClient=function(t,e,r){return this._enterOrUpdateClient(t,e,"enter",r)},e.prototype.updateClient=function(t,e,r){return this._enterOrUpdateClient(t,e,"update",r)},e.prototype._enterOrUpdateClient=function(t,e,r,o){var s,l=this;if(!o){if("function"==typeof e)o=e,e=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"_enterOrUpdateClient",[t,e,r]);o=v}}var A=this.channel;if(!A.connectionManager.activeState()){o(A.connectionManager.getError());return}f.default.logAction(f.default.LOG_MICRO,"RealtimePresence."+r+"Client()","channel = "+A.name+", client = "+(t||"(implicit) "+(s=this,s.channel.realtime.auth.clientId)));var g=h.default.fromValues({action:r,data:e});t&&(g.clientId=t),h.default.encode(g,A.channelOptions,function(t){if(t){o(t);return}switch(A.state){case"attached":A.sendPresence(g,o);break;case"initialized":case"detached":A.attach();case"attaching":l.pendingPresence.push({presence:g,callback:o});break;default:(t=new p.default("Unable to "+r+" presence channel while in "+A.state+" state",90001)).code=90001,o(t)}})},e.prototype.leave=function(t,e){if(b(this))throw new p.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,t,e)},e.prototype.leaveClient=function(t,e,r){if(!r){if("function"==typeof e)r=e,e=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"leaveClient",[t,e]);r=v}}var o=this.channel;if(!o.connectionManager.activeState()){null==r||r(o.connectionManager.getError());return}f.default.logAction(f.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+t);var s=h.default.fromValues({action:"leave",data:e});switch(t&&(s.clientId=t),o.state){case"attached":o.sendPresence(s,r);break;case"attaching":this.pendingPresence.push({presence:s,callback:r});break;case"initialized":case"failed":var l=new p.default("Unable to leave presence channel (incompatible state)",90001);null==r||r(l);break;default:null==r||r(A.default.invalidStateError(o.state))}},e.prototype.get=function(t,e){var r=this,o=Array.prototype.slice.call(arguments);1==o.length&&"function"==typeof o[0]&&o.unshift(null),t=o[0],e=o[1];var s=!t||!("waitForSync"in t)||t.waitForSync;if(!e){if(this.channel.realtime.options.promises)return a.promisify(this,"get",o);e=v}function l(r){e(null,t?r.list(t):r.values())}if("suspended"===this.channel.state){s?e(p.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):l(this.members);return}(function t(e,r,o){switch(e.state){case"attached":case"suspended":o();break;case"initialized":case"detached":case"detaching":case"attaching":e.attach(function(t){t?r(t):o()});break;default:r(p.default.fromValues(A.default.invalidStateError(e.state)))}})(this.channel,e,function(){var t=r.members;s?t.waitSync(function(){l(t)}):l(t)})},e.prototype.history=function(t,e){if(f.default.logAction(f.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),void 0===e){if("function"==typeof t)e=t,t=null;else{if(this.channel.realtime.options.promises)return a.promisify(this,"history",arguments);e=v}}t&&t.untilAttach&&("attached"===this.channel.state?(delete t.untilAttach,t.from_serial=this.channel.properties.attachSerial):e(new p.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),s.default.prototype._history.call(this,t,e)},e.prototype.setPresence=function(t,e,r){f.default.logAction(f.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+t.length+" participants; syncChannelSerial = "+r);var o,a,s=this.members,l=this._myMembers,p=[],g=this.channel.connectionManager.connectionId;e&&(this.members.startSync(),r&&(a=r.match(/^[\w-]+:(.*)$/))&&(o=a[1]));for(var m=0;m<t.length;m++){var v=h.default.fromValues(t[m]);switch(v.action){case"leave":s.remove(v)&&p.push(v),v.connectionId!==g||v.isSynthesized()||l.remove(v);break;case"enter":case"present":case"update":s.put(v)&&p.push(v),v.connectionId===g&&l.put(v)}}e&&!o&&(s.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(A.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var m=0;m<p.length;m++){var v=p[m];this.subscriptions.emit(v.action,v)}},e.prototype.onAttached=function(t){f.default.logAction(f.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+t),t?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var e=this.pendingPresence,r=e.length;if(r){this.pendingPresence=[];var o=[],a=g.default.create();f.default.logAction(f.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+r+" queued presence messages");for(var s=0;s<r;s++){var l=e[s];o.push(l.presence),a.push(l.callback)}this.channel.sendPresence(o,a)}},e.prototype.actOnChannelState=function(t,e,r){switch(t){case"attached":this.onAttached(e);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(r)}},e.prototype.failPendingPresence=function(t){if(this.pendingPresence.length){f.default.logAction(f.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+a.inspectError(t));for(var e=0;e<this.pendingPresence.length;e++)try{this.pendingPresence[e].callback(t)}catch(r){}this.pendingPresence=[]}},e.prototype._clearMyMembers=function(){this._myMembers.clear()},e.prototype._ensureMyMembersPresent=function(){var t=this,e=this.members,r=this._myMembers,o=function(e){if(e){var r="Presence auto-re-enter failed: "+e.toString(),o=new p.default(r,91004,400);f.default.logAction(f.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",r);var a=new m.default(t.channel.state,t.channel.state,!0,o);t.channel.emit("update",a)}};for(var a in r.map)if(!(a in e.map)){var s=r.map[a];f.default.logAction(f.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+s.clientId+'" into the presence set'),this._enterOrUpdateClient(s.clientId,s.data,"enter",o),delete r.map[a]}},e.prototype._synthesizeLeaves=function(t){var e=this.subscriptions;a.arrForEach(t,function(t){var r=h.default.fromValues({action:"leave",connectionId:t.connectionId,clientId:t.clientId,data:t.data,encoding:t.encoding,timestamp:a.now()});e.emit("leave",r)})},e.prototype.on=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];f.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,t)},e.prototype.off=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];f.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,t)},e.prototype.subscribe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=A.default.processListenerArgs(t),o=r[0],s=r[1],l=r[2],f=this.channel;if(!l){if(this.channel.realtime.options.promises)return a.promisify(this,"subscribe",[o,s]);l=v}if("failed"===f.state){l(p.default.fromValues(A.default.invalidStateError("failed")));return}this.subscriptions.on(o,s),f.attach(l)},e.prototype.unsubscribe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=A.default.processListenerArgs(t),o=r[0],a=r[1];this.subscriptions.off(o,a)},e}(s.default),O=function(t){function e(e){var r=t.call(this)||this;return r.presence=e,r.map={},r.syncInProgress=!1,r.residualMembers=null,r}return o.__extends(e,t),e.prototype.get=function(t){return this.map[t]},e.prototype.getClient=function(t){var e=this.map,r=[];for(var o in e){var a=e[o];a.clientId==t&&"absent"!=a.action&&r.push(a)}return r},e.prototype.list=function(t){var e=this.map,r=t&&t.clientId,o=t&&t.connectionId,a=[];for(var s in e){var l=e[s];"absent"!==l.action&&(r&&r!=l.clientId||o&&o!=l.connectionId||a.push(l))}return a},e.prototype.put=function(t){("enter"===t.action||"update"===t.action)&&((t=h.default.fromValues(t)).action="present");var e=this.map,r=$(t);this.residualMembers&&delete this.residualMembers[r];var o=e[r];return(!o||!!C(t,o))&&(e[r]=t,!0)},e.prototype.values=function(){var t=this.map,e=[];for(var r in t){var o=t[r];"absent"!=o.action&&e.push(o)}return e},e.prototype.remove=function(t){var e=this.map,r=$(t),o=e[r];return(!o||!!C(t,o))&&(this.syncInProgress?((t=h.default.fromValues(t)).action="absent",e[r]=t):delete e[r],!0)},e.prototype.startSync=function(){var t=this.map,e=this.syncInProgress;f.default.logAction(f.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+e),this.syncInProgress||(this.residualMembers=a.copy(t),this.setInProgress(!0))},e.prototype.endSync=function(){var t=this.map,e=this.syncInProgress;if(f.default.logAction(f.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+e),e){for(var r in t)"absent"===t[r].action&&delete t[r];for(var o in this.presence._synthesizeLeaves(a.valuesArray(this.residualMembers)),this.residualMembers)delete t[o];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},e.prototype.waitSync=function(t){var e=this.syncInProgress;if(f.default.logAction(f.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+e),!e){t();return}this.once("sync",t)},e.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},e.prototype.setInProgress=function(t){f.default.logAction(f.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+t),this.syncInProgress=t,this.presence.syncComplete=!t},e}(l.default);e.default=_},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1),a=r(56),s=r(32),l=r(13),f=o.__importDefault(r(4)),h=o.__importDefault(r(0)),p=function(){function t(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return t.prototype.isWordArray=function(t){return null!=t&&void 0!==t.sigBytes},t.prototype.isArrayBuffer=function(t){return null!=t&&t.constructor===ArrayBuffer},t.prototype.isTypedArray=function(t){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(t)},t.prototype.uint8ViewToBase64=function(t){for(var e,r,o,a,s,l="",f=this.base64CharSet,h=t.byteLength,p=h%3,A=h-p,g=0;g<A;g+=3)e=(16515072&(s=t[g]<<16|t[g+1]<<8|t[g+2]))>>18,r=(258048&s)>>12,o=(4032&s)>>6,a=63&s,l+=f[e]+f[r]+f[o]+f[a];return 1==p?(e=(252&(s=t[A]))>>2,r=(3&s)<<4,l+=f[e]+f[r]+"=="):2==p&&(e=(64512&(s=t[A]<<8|t[A+1]))>>10,r=(1008&s)>>4,o=(15&s)<<2,l+=f[e]+f[r]+f[o]+"="),l},t.prototype.base64ToArrayBuffer=function(t){for(var e=null==atob?void 0:atob(t),r=e.length,o=new Uint8Array(r),a=0;a<r;a++){var s=e.charCodeAt(a);o[a]=s}return o.buffer},t.prototype.isBuffer=function(t){return this.isArrayBuffer(t)||this.isWordArray(t)||this.isTypedArray(t)},t.prototype.toBuffer=function(t){if(!ArrayBuffer)throw Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(t))return new Uint8Array(t);if(this.isTypedArray(t))return new Uint8Array(t.buffer);if(this.isWordArray(t)){for(var e=new ArrayBuffer(t.sigBytes),r=new Uint8Array(e),o=0;o<t.sigBytes;o++)r[o]=t.words[o>>>2]>>>24-o%4*8&255;return r}throw Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},t.prototype.toArrayBuffer=function(t){return this.isArrayBuffer(t)?t:this.toBuffer(t).buffer},t.prototype.toWordArray=function(t){return this.isTypedArray(t)&&(t=t.buffer),this.isWordArray(t)?t:f.default.create(t)},t.prototype.base64Encode=function(t){return this.isWordArray(t)?l.stringify(t):this.uint8ViewToBase64(this.toBuffer(t))},t.prototype.base64Decode=function(t){return ArrayBuffer&&h.default.Config.atob?this.base64ToArrayBuffer(t):l.parse(t)},t.prototype.hexEncode=function(t){return a.stringify(this.toWordArray(t))},t.prototype.hexDecode=function(t){var e=a.parse(t);return ArrayBuffer?this.toArrayBuffer(e):e},t.prototype.utf8Encode=function(t){return TextEncoder?new TextEncoder().encode(t).buffer:s.parse(t)},t.prototype.utf8Decode=function(t){if(!this.isBuffer(t))throw Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(t)?new TextDecoder().decode(t):(t=this.toWordArray(t),s.stringify(t))},t.prototype.bufferCompare=function(t,e){if(!t)return -1;if(!e)return 1;var r=this.toWordArray(t),o=this.toWordArray(e);r.clamp(),o.clamp();var a=r.sigBytes-o.sigBytes;if(0!=a)return a;for(var s=r.words,l=o.words,f=0;f<s.length;f++)if(0!=(a=s[f]-l[f]))return a;return 0},t.prototype.byteLength=function(t){return this.isArrayBuffer(t)||this.isTypedArray(t)?t.byteLength:this.isWordArray(t)?t.sigBytes:-1},t.prototype.typedArrayToBuffer=function(t){return t.buffer},t}();e.default=new p},function(t,e,r){var o,a;a=function(t){return t.enc.Hex},t.exports=e=a(r(6))},function(t,e,r){"use strict";r.r(e);var o=r(4),a=r.n(o),s=r(13),l=(r.n(s),r(21)),f=r.n(l),h=r(0),p=r.n(h),A=r(3),g=r.n(A),m=function(){if(p.a.getRandomWordArray)t=p.a.getRandomWordArray;else if("undefined"!=typeof Uint32Array&&p.a.getRandomValues){var t,e=new Uint32Array(4);t=function(t,r){var o=t/4,a=4==o?e:new Uint32Array(o);p.a.getRandomValues(a,function(t){r(t,p.a.BufferUtils.toWordArray(a))})}}else t=function(t,e){g.a.logAction(g.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var r=t/4,o=Array(r),s=0;s<r;s++)o[s]=Math.floor(4294967296*Math.random())-2147483648;e(null,a.a.create(o))};var r=[a.a.create([269488144,269488144,269488144,269488144],16),a.a.create([16777216],1),a.a.create([33685504],2),a.a.create([50529024],3),a.a.create([67372036],4),a.a.create([84215045,83886080],5),a.a.create([101058054,101056512],6),a.a.create([117901063,117901056],7),a.a.create([134744072,134744072],8),a.a.create([151587081,151587081,150994944],9),a.a.create([168430090,168430090,168427520],10),a.a.create([185273099,185273099,185273088],11),a.a.create([202116108,202116108,202116108],12),a.a.create([218959117,218959117,218959117,218103808],13),a.a.create([235802126,235802126,235802126,235798528],14),a.a.create([252645135,252645135,252645135,252645135],15),a.a.create([269488144,269488144,269488144,269488144],16)];function o(){}function l(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}function h(t,e,r){this.algorithm=t.algorithm+"-"+String(t.keyLength)+"-"+t.mode,this.cjsAlgorithm=t.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=p.a.BufferUtils.toWordArray(t.key),r&&(this.iv=p.a.BufferUtils.toWordArray(r).clone()),this.blockLengthWords=e}return o.CipherParams=l,o.getDefaultParams=function(t){if("function"==typeof t||"string"==typeof t){if(g.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),"function"==typeof t)o.generateRandomKey(function(e){t(null,o.getDefaultParams({key:e}))});else if("function"==typeof arguments[1])arguments[1](null,o.getDefaultParams({key:t}));else throw Error("Invalid arguments for Crypto.getDefaultParams");return}if(!t.key)throw Error("Crypto.getDefaultParams: a key is required");r="string"==typeof t.key?Object(s.parse)((e=t.key).replace("_","/").replace("-","+")):p.a.BufferUtils.toWordArray(t.key);var e,r,a=new l;if(a.key=r,a.algorithm=t.algorithm||"aes",a.keyLength=32*r.words.length,a.mode=t.mode||"cbc",t.keyLength&&t.keyLength!==a.keyLength)throw Error("Crypto.getDefaultParams: a keyLength of "+t.keyLength+" was specified, but the key actually has length "+a.keyLength);return function t(e){if("aes"===e.algorithm&&"cbc"===e.mode&&128!==e.keyLength&&256!==e.keyLength)throw Error("Unsupported key length "+e.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}(a),a},o.generateRandomKey=function(e,r){1==arguments.length&&"function"==typeof e&&(r=e,e=void 0),t((e||256)/8,r)},o.getCipher=function(t){var e=t instanceof l?t:o.getDefaultParams(t);return{cipherParams:e,cipher:new h(e,4,t.iv)}},h.prototype.encrypt=function(e,o){g.a.logAction(g.a.LOG_MICRO,"CBCCipher.encrypt()","");var a,s=(e=p.a.BufferUtils.toWordArray(e)).sigBytes,l=(a=s)+16&-16,h=this,A=function(){h.getIv(function(t,a){if(t){o(t);return}var f=h.encryptCipher.process(e.concat(r[l-s]));o(null,a.concat(f))})};this.encryptCipher?A():this.iv?(this.encryptCipher=f.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),A()):t(16,function(t,e){if(t){o(t);return}h.encryptCipher=f.a.algo[h.cjsAlgorithm].createEncryptor(h.key,{iv:e}),h.iv=e,A()})},h.prototype.decrypt=function(t){g.a.logAction(g.a.LOG_MICRO,"CBCCipher.decrypt()",""),t=p.a.BufferUtils.toWordArray(t);var e=this.blockLengthWords,r=t.words,o=a.a.create(r.slice(0,e)),s=a.a.create(r.slice(e)),l=f.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:o}),h=l.process(s),A=l.finalize();return l.reset(),A&&A.sigBytes&&h.concat(A),h},h.prototype.getIv=function(e){if(this.iv){var r=this.iv;this.iv=null,e(null,r);return}var o=this;t(16,function(t,r){if(t){e(t);return}e(null,o.encryptCipher.process(r))})},o}();e.default=m},function(t,e,r){var o,a;a=function(t){return function(){var e=t,r=e.lib.WordArray,o=e.enc;function a(t){return t<<8&4278255360|t>>>8&16711935}o.Utf16=o.Utf16BE={stringify:function(t){for(var e=t.words,r=t.sigBytes,o=[],a=0;a<r;a+=2){var s=e[a>>>2]>>>16-a%4*8&65535;o.push(String.fromCharCode(s))}return o.join("")},parse:function(t){for(var e=t.length,o=[],a=0;a<e;a++)o[a>>>1]|=t.charCodeAt(a)<<16-a%2*16;return r.create(o,2*e)}},o.Utf16LE={stringify:function(t){for(var e=t.words,r=t.sigBytes,o=[],s=0;s<r;s+=2){var l=a(e[s>>>2]>>>16-s%4*8&65535);o.push(String.fromCharCode(l))}return o.join("")},parse:function(t){for(var e=t.length,o=[],s=0;s<e;s++)o[s>>>1]|=a(t.charCodeAt(s)<<16-s%2*16);return r.create(o,2*e)}}}(),t.enc.Utf16},t.exports=e=a(r(6))},function(t,e,r){var o,a;a=function(t){var e,r,o;return r=(e=t).lib.CipherParams,o=e.enc.Hex,e.format.Hex={stringify:function(t){return t.ciphertext.toString(o)},parse:function(t){var e=o.parse(t);return r.create({ciphertext:e})}},t.format.Hex},t.exports=e=a(r(6),r(28))},function(t,e,r){var o,a;a=function(t){var e,r,o,a,s,l,f,h,p,A,g,m,v,$,b;return r=(e=t).lib.BlockCipher,o=e.algo,a=[],s=[],l=[],f=[],h=[],p=[],A=[],g=[],m=[],v=[],function(){for(var t=[],e=0;e<256;e++)e<128?t[e]=e<<1:t[e]=e<<1^283;for(var r=0,o=0,e=0;e<256;e++){var $=o^o<<1^o<<2^o<<3^o<<4;$=$>>>8^255&$^99,a[r]=$,s[$]=r;var b=t[r],C=t[b],_=t[C],O=257*t[$]^16843008*$;l[r]=O<<24|O>>>8,f[r]=O<<16|O>>>16,h[r]=O<<8|O>>>24,p[r]=O;var O=16843009*_^65537*C^257*b^16843008*r;A[$]=O<<24|O>>>8,g[$]=O<<16|O>>>16,m[$]=O<<8|O>>>24,v[$]=O,r?(r=b^t[t[t[_^b]]],o^=t[t[o]]):r=o=1}}(),$=[0,1,2,4,8,16,32,64,128,27,54],b=o.AES=r.extend({_doReset:function(){var t;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var e=this._keyPriorReset=this._key,r=e.words,o=e.sigBytes/4,s=this._nRounds=o+6,l=(s+1)*4,f=this._keySchedule=[],h=0;h<l;h++)h<o?f[h]=r[h]:(t=f[h-1],h%o?o>6&&h%o==4&&(t=a[t>>>24]<<24|a[t>>>16&255]<<16|a[t>>>8&255]<<8|a[255&t]):(t=a[(t=t<<8|t>>>24)>>>24]<<24|a[t>>>16&255]<<16|a[t>>>8&255]<<8|a[255&t],t^=$[h/o|0]<<24),f[h]=f[h-o]^t);for(var p=this._invKeySchedule=[],b=0;b<l;b++){var h=l-b;if(b%4)var t=f[h];else var t=f[h-4];b<4||h<=4?p[b]=t:p[b]=A[a[t>>>24]]^g[a[t>>>16&255]]^m[a[t>>>8&255]]^v[a[255&t]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,l,f,h,p,a)},decryptBlock:function(t,e){var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r,this._doCryptBlock(t,e,this._invKeySchedule,A,g,m,v,s);var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r},_doCryptBlock:function(t,e,r,o,a,s,l,f){for(var h=this._nRounds,p=t[e]^r[0],A=t[e+1]^r[1],g=t[e+2]^r[2],m=t[e+3]^r[3],v=4,$=1;$<h;$++){var b=o[p>>>24]^a[A>>>16&255]^s[g>>>8&255]^l[255&m]^r[v++],C=o[A>>>24]^a[g>>>16&255]^s[m>>>8&255]^l[255&p]^r[v++],_=o[g>>>24]^a[m>>>16&255]^s[p>>>8&255]^l[255&A]^r[v++],O=o[m>>>24]^a[p>>>16&255]^s[A>>>8&255]^l[255&g]^r[v++];p=b,A=C,g=_,m=O}var b=(f[p>>>24]<<24|f[A>>>16&255]<<16|f[g>>>8&255]<<8|f[255&m])^r[v++],C=(f[A>>>24]<<24|f[g>>>16&255]<<16|f[m>>>8&255]<<8|f[255&p])^r[v++],_=(f[g>>>24]<<24|f[m>>>16&255]<<16|f[p>>>8&255]<<8|f[255&A])^r[v++],O=(f[m>>>24]<<24|f[p>>>16&255]<<16|f[A>>>8&255]<<8|f[255&g])^r[v++];t[e]=b,t[e+1]=C,t[e+2]=_,t[e+3]=O},keySize:8}),e.AES=r._createHelper(b),t.AES},t.exports=e=a(r(6),r(13),r(61),r(27),r(28))},function(t,e,r){var o,a;a=function(t){return function(e){var r=t,o=r.lib,a=o.WordArray,s=o.Hasher,l=r.algo,f=[];(function(){for(var t=0;t<64;t++)f[t]=4294967296*e.abs(e.sin(t+1))|0})();var h=l.MD5=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var o=e+r,a=t[o];t[o]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360}var s=this._hash.words,l=t[e+0],h=t[e+1],v=t[e+2],$=t[e+3],b=t[e+4],C=t[e+5],_=t[e+6],O=t[e+7],w=t[e+8],I=t[e+9],R=t[e+10],M=t[e+11],T=t[e+12],P=t[e+13],k=t[e+14],B=t[e+15],D=s[0],x=s[1],F=s[2],N=s[3];D=p(D,x,F,N,l,7,f[0]),N=p(N,D,x,F,h,12,f[1]),F=p(F,N,D,x,v,17,f[2]),x=p(x,F,N,D,$,22,f[3]),D=p(D,x,F,N,b,7,f[4]),N=p(N,D,x,F,C,12,f[5]),F=p(F,N,D,x,_,17,f[6]),x=p(x,F,N,D,O,22,f[7]),D=p(D,x,F,N,w,7,f[8]),N=p(N,D,x,F,I,12,f[9]),F=p(F,N,D,x,R,17,f[10]),x=p(x,F,N,D,M,22,f[11]),D=p(D,x,F,N,T,7,f[12]),N=p(N,D,x,F,P,12,f[13]),F=p(F,N,D,x,k,17,f[14]),x=p(x,F,N,D,B,22,f[15]),D=A(D,x,F,N,h,5,f[16]),N=A(N,D,x,F,_,9,f[17]),F=A(F,N,D,x,M,14,f[18]),x=A(x,F,N,D,l,20,f[19]),D=A(D,x,F,N,C,5,f[20]),N=A(N,D,x,F,R,9,f[21]),F=A(F,N,D,x,B,14,f[22]),x=A(x,F,N,D,b,20,f[23]),D=A(D,x,F,N,I,5,f[24]),N=A(N,D,x,F,k,9,f[25]),F=A(F,N,D,x,$,14,f[26]),x=A(x,F,N,D,w,20,f[27]),D=A(D,x,F,N,P,5,f[28]),N=A(N,D,x,F,v,9,f[29]),F=A(F,N,D,x,O,14,f[30]),x=A(x,F,N,D,T,20,f[31]),D=g(D,x,F,N,C,4,f[32]),N=g(N,D,x,F,w,11,f[33]),F=g(F,N,D,x,M,16,f[34]),x=g(x,F,N,D,k,23,f[35]),D=g(D,x,F,N,h,4,f[36]),N=g(N,D,x,F,b,11,f[37]),F=g(F,N,D,x,O,16,f[38]),x=g(x,F,N,D,R,23,f[39]),D=g(D,x,F,N,P,4,f[40]),N=g(N,D,x,F,l,11,f[41]),F=g(F,N,D,x,$,16,f[42]),x=g(x,F,N,D,_,23,f[43]),D=g(D,x,F,N,I,4,f[44]),N=g(N,D,x,F,T,11,f[45]),F=g(F,N,D,x,B,16,f[46]),x=g(x,F,N,D,v,23,f[47]),D=m(D,x,F,N,l,6,f[48]),N=m(N,D,x,F,O,10,f[49]),F=m(F,N,D,x,k,15,f[50]),x=m(x,F,N,D,C,21,f[51]),D=m(D,x,F,N,T,6,f[52]),N=m(N,D,x,F,$,10,f[53]),F=m(F,N,D,x,R,15,f[54]),x=m(x,F,N,D,h,21,f[55]),D=m(D,x,F,N,w,6,f[56]),N=m(N,D,x,F,B,10,f[57]),F=m(F,N,D,x,_,15,f[58]),x=m(x,F,N,D,P,21,f[59]),D=m(D,x,F,N,b,6,f[60]),N=m(N,D,x,F,M,10,f[61]),F=m(F,N,D,x,v,15,f[62]),x=m(x,F,N,D,I,21,f[63]),s[0]=s[0]+D|0,s[1]=s[1]+x|0,s[2]=s[2]+F|0,s[3]=s[3]+N|0},_doFinalize:function(){var t=this._data,r=t.words,o=8*this._nDataBytes,a=8*t.sigBytes;r[a>>>5]|=128<<24-a%32;var s=e.floor(o/4294967296),l=o;r[(a+64>>>9<<4)+15]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360,r[(a+64>>>9<<4)+14]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360,t.sigBytes=(r.length+1)*4,this._process();for(var f=this._hash,h=f.words,p=0;p<4;p++){var A=h[p];h[p]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}return f},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});function p(t,e,r,o,a,s,l){var f=t+(e&r|~e&o)+a+l;return(f<<s|f>>>32-s)+e}function A(t,e,r,o,a,s,l){var f=t+(e&o|r&~o)+a+l;return(f<<s|f>>>32-s)+e}function g(t,e,r,o,a,s,l){var f=t+(e^r^o)+a+l;return(f<<s|f>>>32-s)+e}function m(t,e,r,o,a,s,l){var f=t+(r^(e|~o))+a+l;return(f<<s|f>>>32-s)+e}r.MD5=s._createHelper(h),r.HmacMD5=s._createHmacHelper(h)}(Math),t.MD5},t.exports=e=a(r(6))},function(t,e,r){"use strict";e.__esModule=!0;var o,a=r(1),s=a.__importDefault(r(0)),l=a.__importStar(r(2)),f=a.__importDefault(r(8)),h=a.__importDefault(r(5)),p=a.__importDefault(r(17)),A=a.__importDefault(r(15)),g=a.__importDefault(r(20)),m=a.__importDefault(r(3)),v=r(29);function $(t){var e=t.statusCode;return 408===e&&!t.code||400===e&&!t.code||e>=500&&e<=504}function b(t){var e=t.connection,r=e&&e.connectionManager.host;return r?[r].concat(f.default.getFallbackHosts(t.options)):f.default.getHosts(t.options)}var C=((o=function(){function t(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=b,s.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(t,e,r,o,a,s,l){var f=A.default.createRequest(r,o,a,s,g.default.REQ_SEND,e&&e.options.timeouts,t);return f.once("complete",l),f.exec(),f},this.checkConnectivity=function(t){var e=f.default.internetUpUrl;m.default.logAction(m.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+e),this.doUri(p.default.Get,null,e,null,null,null,function(e,r){var o,a=!e&&(null===(o=r)||void 0===o?void 0:o.replace(/\n/,""))=="yes";m.default.logAction(m.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+a),t(null,a)})}):s.default.Config.jsonpSupported&&(this.Request=function(t,e,r,o,a,l,f){var h=v.createRequest(r,o,a,l,g.default.REQ_SEND,e&&e.options.timeouts,t);return h.once("complete",f),s.default.Config.nextTick(function(){h.exec()}),h},this.checkConnectivity=function(t){var e=this,r=f.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(t);return}this.checksInProgress=[t],m.default.logAction(m.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+r);var o=new v.Request("isTheInternetUp",r,null,null,null,g.default.REQ_SEND,f.default.TIMEOUTS);o.once("complete",function(t,r){var o=!t&&r;m.default.logAction(m.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+o);for(var a=0;a<e.checksInProgress.length;a++)e.checksInProgress[a](null,o);e.checksInProgress=null}),s.default.Config.nextTick(function(){o.exec()})})}return t.prototype.do=function(t,e,r,o,s,f,p){var A=this,g="function"==typeof r?r:function(t){return e.baseUri(t)+r},m=e._currentFallback;if(m){if(m.validUntil>l.now()){if(!this.Request){null==p||p(new h.default("Request invoked before assigned to",null,500));return}this.Request(t,e,g(m.host),o,f,s,function(l){for(var h=[],g=1;g<arguments.length;g++)h[g-1]=arguments[g];if(l&&$(l)){e._currentFallback=null,A.do(t,e,r,o,s,f,p);return}null==p||p.apply(void 0,a.__spreadArray([l],h))});return}e._currentFallback=null}var v=b(e);if(1===v.length){this.doUri(t,e,g(v[0]),o,s,f,p);return}var C=function(r,h){var m=r.shift();A.doUri(t,e,g(m),o,s,f,function(t){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];if(t&&$(t)&&r.length){C(r,!0);return}h&&(e._currentFallback={host:m,validUntil:l.now()+e.options.timeouts.fallbackRetryTimeout}),null==p||p.apply(void 0,a.__spreadArray([t],o))})};C(v)},t.prototype.doUri=function(t,e,r,o,a,s,l){if(!this.Request){l(new h.default("Request invoked before assigned to",null,500));return}this.Request(t,e,r,o,s,a,l)},t}()).methods=[p.default.Get,p.default.Delete,p.default.Post,p.default.Put,p.default.Patch],o.methodsWithoutBody=[p.default.Get,p.default.Delete],o.methodsWithBody=[p.default.Post,p.default.Put,p.default.Patch],o);e.default=C},function(t,e,r){"use strict";e.__esModule=!0;var o,a=r(1),s=a.__importDefault(r(40)),l=a.__importStar(r(2)).getGlobalObject(),f=l.navigator&&l.navigator.userAgent.toString(),h={agent:"browser",logTimestamps:!0,userAgent:f,currentUrl:l.location&&l.location.href,noUpgrade:f&&!!f.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:l.WebSocket,xhrSupported:l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:"undefined"!=typeof document,allowComet:(o=l.location,!l.WebSocket||!o||!o.origin||o.origin.indexOf("http")>-1),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:s.default,supportsBinary:!!l.TextDecoder,preferBinary:!1,ArrayBuffer:l.ArrayBuffer,atob:l.atob,nextTick:void 0!==l.setImmediate?l.setImmediate.bind(l):function(t){setTimeout(t,0)},addEventListener:l.addEventListener,inspect:JSON.stringify,stringByteSize:function(t){return l.TextDecoder&&new l.TextEncoder().encode(t).length||t.length},TextEncoder:l.TextEncoder,TextDecoder:l.TextDecoder,Promise:l.Promise,getRandomValues:function(t){if(void 0!==t)return function(e,r){t.getRandomValues(e),r&&r(null)}}(l.crypto||msCrypto)};e.default=h},function(t,e,r){"use strict";(function(t){e.__esModule=!0;var o=r(1).__importStar(r(2)),a="ablyjs-storage-test",s=function(){function e(){try{t.sessionStorage.setItem(a,a),t.sessionStorage.removeItem(a),this.sessionSupported=!0}catch(e){this.sessionSupported=!1}try{t.localStorage.setItem(a,a),t.localStorage.removeItem(a),this.localSupported=!0}catch(r){this.localSupported=!1}}return e.prototype.get=function(t){return this._get(t,!1)},e.prototype.getSession=function(t){return this._get(t,!0)},e.prototype.remove=function(t){return this._remove(t,!1)},e.prototype.removeSession=function(t){return this._remove(t,!0)},e.prototype.set=function(t,e,r){return this._set(t,e,r,!1)},e.prototype.setSession=function(t,e,r){return this._set(t,e,r,!0)},e.prototype._set=function(t,e,r,a){var s={value:e};return r&&(s.expires=o.now()+r),this.storageInterface(a).setItem(t,JSON.stringify(s))},e.prototype._get=function(t,e){if(e&&!this.sessionSupported)throw Error("Session Storage not supported");if(!e&&!this.localSupported)throw Error("Local Storage not supported");var r=this.storageInterface(e).getItem(t);if(!r)return null;var a=JSON.parse(r);return a.expires&&a.expires<o.now()?(this.storageInterface(e).removeItem(t),null):a.value},e.prototype._remove=function(t,e){return this.storageInterface(e).removeItem(t)},e.prototype.storageInterface=function(e){return e?t.sessionStorage:t.localStorage},e}();e.default=new s}).call(this,r(12))},function(t,e,r){"use strict";e.__esModule=!0;var o=r(1).__importDefault(r(66)),a={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};e.default=a},function(t,e,r){"use strict";var o,a;e.__esModule=!0,(a=o||(o={})).WebSocket="web_socket",a.Comet="comet",a.XhrStreaming="xhr_streaming",a.XhrPolling="xhr_polling",a.JsonP="jsonp",e.default=o},function(t,e,r){"use strict";r.r(e);var o=r(29),a=r.n(o),s=r(2),l=r(0),f=r.n(l),h=r(11),p=r.n(h),A=r(15),g=r.n(A),m=function(t){var e="xhr_polling";function r(t,r,o){o.stream=!1,p.a.call(this,t,r,o),this.shortName=e}return s.inherits(r,p.a),r.isAvailable=function(){return f.a.Config.xhrSupported&&f.a.Config.allowComet},r.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},r.prototype.createRequest=function(t,e,r,o,a){return g.a.createRequest(t,e,r,o,a,this.timeouts)},void 0!==t&&r.isAvailable()&&(t.supportedTransports[e]=r),r},v=function(t){var e="xhr_streaming";function r(t,r,o){p.a.call(this,t,r,o),this.shortName=e}return s.inherits(r,p.a),r.isAvailable=function(){return f.a.Config.xhrSupported&&f.a.Config.streamingSupported&&f.a.Config.allowComet},r.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},r.prototype.createRequest=function(t,e,r,o,a){return g.a.createRequest(t,e,r,o,a,this.timeouts)},void 0!==t&&r.isAvailable()&&(t.supportedTransports[e]=r),r};e.default=[a.a,m,v]}]).default})}),Ui=We((t,e)=>{function r(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}oe(),e.exports=r}),xl=We((t,e)=>{oe();var r="object"==typeof global&&global&&global.Object===Object&&global;e.exports=r}),Po=We((t,e)=>{oe();var r=xl(),o="object"==typeof self&&self&&self.Object===Object&&self,a=r||o||Function("return this")();e.exports=a}),Dl=We((t,e)=>{oe();var r=Po(),o=function(){return r.Date.now()};e.exports=o}),Fl=We((t,e)=>{oe();var r=/\s/;function o(t){for(var e=t.length;e--&&r.test(t.charAt(e)););return e}e.exports=o}),Gl=We((t,e)=>{oe();var r=Fl(),o=/^\s+/;function a(t){return t&&t.slice(0,r(t)+1).replace(o,"")}e.exports=a}),wo=We((t,e)=>{oe();var r,o=Po().Symbol;e.exports=o}),Ql=We((t,e)=>{oe();var r=wo(),o=Object.prototype,a=o.hasOwnProperty,s=o.toString,l=r?r.toStringTag:void 0;function f(t){var e=a.call(t,l),r=t[l];try{t[l]=void 0;var o=!0}catch(f){}var h=s.call(t);return o&&(e?t[l]=r:delete t[l]),h}e.exports=f}),jl=We((t,e)=>{oe();var r,o=Object.prototype.toString;function a(t){return o.call(t)}e.exports=a}),Yl=We((t,e)=>{oe();var r=wo(),o=Ql(),a=jl(),s="[object Null]",l="[object Undefined]",f=r?r.toStringTag:void 0;function h(t){return null==t?void 0===t?l:s:f&&f in Object(t)?o(t):a(t)}e.exports=h}),Xl=We((t,e)=>{function r(t){return null!=t&&"object"==typeof t}oe(),e.exports=r}),ef=We((t,e)=>{oe();var r=Yl(),o=Xl(),a="[object Symbol]";function s(t){return"symbol"==typeof t||o(t)&&r(t)==a}e.exports=s}),af=We((t,e)=>{oe();var r=Gl(),o=Ui(),a=ef(),s=0/0,l=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,h=/^0o[0-7]+$/i,p=parseInt;function A(t){if("number"==typeof t)return t;if(a(t))return s;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var A=f.test(t);return A||h.test(t)?p(t.slice(2),A?2:8):l.test(t)?s:+t}e.exports=A}),uf=We((t,e)=>{oe();var r=Ui(),o=Dl(),a=af(),s="Expected a function",l=Math.max,f=Math.min;function h(t,e,h){var p,A,g,m,v,$,b=0,C=!1,_=!1,O=!0;if("function"!=typeof t)throw TypeError(s);function w(e){var r=p,o=A;return p=A=void 0,b=e,m=t.apply(o,r)}function I(t){var r=t-$,o=t-b;return void 0===$||r>=e||r<0||_&&o>=g}function R(){var t,r,a,s,l=o();if(I(l))return M(l);v=setTimeout(R,(r=(t=l)-$,a=t-b,s=e-r,_?f(s,g-a):s))}function M(t){return v=void 0,O&&p?w(t):(p=A=void 0,m)}function T(){var t,r=o(),a=I(r);if(p=arguments,A=this,$=r,a){if(void 0===v)return b=t=$,v=setTimeout(R,e),C?w(t):m;if(_)return clearTimeout(v),v=setTimeout(R,e),w($)}return void 0===v&&(v=setTimeout(R,e)),m}return e=a(e)||0,r(h)&&(C=!!h.leading,g=(_="maxWait"in h)?l(a(h.maxWait)||0,e):g,O="trailing"in h?!!h.trailing:O),T.cancel=function t(){void 0!==v&&clearTimeout(v),b=0,p=$=A=v=void 0},T.flush=function t(){return void 0===v?m:M(o())},T}e.exports=h}),lf=We((t,e)=>{oe();var r=uf(),o=Ui(),a="Expected a function";function s(t,e,s){var l=!0,f=!0;if("function"!=typeof t)throw TypeError(a);return o(s)&&(l="leading"in s?!!s.leading:l,f="trailing"in s?!!s.trailing:f),r(t,e,{leading:l,maxWait:e,trailing:f})}e.exports=s}),hf=We((t,e)=>{oe(),e.exports={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}}),pf=We((t,e)=>{oe();var{webm:r,mp4:o}=hf(),a=()=>"undefined"!=typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream,s=()=>"wakeLock"in navigator,l=class{constructor(){if(this.enabled=!1,s()){this._wakeLock=null;let t=()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable()};document.addEventListener("visibilitychange",t),document.addEventListener("fullscreenchange",t)}else a()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",r),this._addSourceToVideo(this.noSleepVideo,"mp4",o),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(t,e,r){var o=document.createElement("source");o.src=r,o.type=`video/${e}`,t.appendChild(o)}get isEnabled(){return this.enabled}enable(){return s()?navigator.wakeLock.request("screen").then(t=>{this._wakeLock=t,this.enabled=!0,this._wakeLock.addEventListener("release",()=>{})}).catch(t=>{throw this.enabled=!1,t}):a()?(this.disable(),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(t=>(this.enabled=!0,t)).catch(t=>{throw this.enabled=!1,t})}disable(){s()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):a()?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}};e.exports=l}),yf=We((t,e)=>{e.exports={name:"@superviz/sdk",version:"0.0.0-development",description:"SuperViz SDK",main:"dist/index.js",scripts:{prepare:"husky install",build:"node ./.esbuild/build.js",postbuild:"tsc --emitDeclarationOnly --declaration",watch:'concurrently -n code,types "yarn watch:code" "yarn watch:types"',"watch:code":"node ./.esbuild/watch.js","watch:types":"tsc --watch",test:"jest","test:e2e":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright test ./e2e","test:e2e:pt-br":"E2E_LOCALE=pt-BR yarn test:e2e","test:e2e:en":"E2E_LOCALE=en yarn test:e2e","test:e2e:all":"yarn test:e2e:pt-br && yarn test:e2e:en","test:e2e:install":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright install","test:e2e:generate":"eval $(cat .env | xargs) && npx playwright codegen $E2E_BASE_URL","test:e2e:debug":"eval $(cat .env | xargs) && PWDEBUG=1 yarn test:e2e","test:e2e:headed":"eval $(cat .env | xargs) && yarn test:e2e --headed","semantic-release":"semantic-release",commit:"git-cz"},publishConfig:{access:"public",scope:"@superviz"},repository:{type:"git",url:"https://github.com/SuperViz/sdk.git"},author:"",license:"ISC",bugs:{url:"https://github.com/SuperViz/sdk/issues"},homepage:"https://github.com/SuperViz/sdk#readme",devDependencies:{"@commitlint/cli":"^17.4.2","@commitlint/config-conventional":"^17.4.2","@playwright/test":"^1.28.1","@typescript-eslint/eslint-plugin":"^5.27.0","@typescript-eslint/parser":"^5.27.0",concurrently:"^7.2.2","cz-conventional-changelog":"^3.3.0",dotenv:"^16.0.1",esbuild:"^0.14.48",eslint:"^7.32.0 || ^8.2.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.25.2",husky:"^8.0.3",jest:"^28.1.2","jest-environment-jsdom":"^28.1.2","semantic-release":"19.0.5","ts-jest":"^28.0.5",tsc:"^2.0.4",typescript:"^4.7.4",yargs:"^17.5.1"},dependencies:{"@superviz/immersive-core":"^0.3.1","@types/jest":"^28.1.3","@types/lodash.isequal":"^4.5.6","@types/node":"^18.7.15",ably:"^1.2.29",bowser:"^2.11.0","bowser-jr":"^1.0.4",debug:"^4.3.4",lodash:"^4.17.21","lodash.debounce":"^4.0.8","lodash.isequal":"^4.5.0","nosleep.js":"^0.12.0"},config:{commitizen:{path:"./node_modules/cz-conventional-changelog"}},husky:{hooks:{"pre-commit":"lint-staged","commit-msg":"commitlint -E HUSKY_GIT_PARAMS"}}}});oe(),oe();var gr=((L=gr||{}).FRAME_LOAD="frame.load",L.FRAME_SIZE_UPDATE="frame.size-update",L.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",L.FRAME_PARENT_SIZE_UPDATE="frame.parante-window-size-update",L.FRAME_LOCALE_UPDATE="frame.locales-update",L.MEETING_START="meeting.start",L.MEETING_LEAVE="meeting.leave",L.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",L.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",L.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",L.MEETING_PARTICIPANT_LEFT="meeting.participant-left",L.MEETING_JOIN="meeting.join",L.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",L.MEETING_HOST_CHANGE="meeting.host-change",L.MEETING_GRID_MODE_CHANGE="meeting.grid-mode-change",L.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",L.MEETING_DEVICES_CHANGE="meeting.devices-change",L.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",L.MEETING_STATE_UPDATE="meeting.state-update",L.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",L.MEETING_AVATAR_LIST_UPDATE="meeting.avatar-list-update",L.MY_PARTICIPANT_UPDATED="my-participant.update",L.MY_PARTICIPANT_LEFT="my-participant.left",L.MY_PARTICIPANT_JOINED="my-participant.joined",L.HEARTBEAT="heartbeat",L.DESTROY="destroy",L),gi=((S=gi||{}).TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",S.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",S.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",S.TOGGLE_CAM="meeting-controls.toggle-cam",S.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",S.HANG_UP="hang-up",S),Vn=((E=Vn||{}).REALTIME_JOIN="realtime.join",E.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",E.REALTIME_HOST_CHANGE="realtime.host-change",E.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",E.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",E.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",E.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",E.REALTIME_GATHER="realtime.gather",E.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",E.REALTIME_SET_AVATAR="realtime.set-avatar",E),vi=((E=vi||{})[E.MEETING_FAILED=-1]="MEETING_FAILED",E[E.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",E[E.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",E[E.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",E[E.MEETING_CONNECTING=3]="MEETING_CONNECTING",E[E.MEETING_CONNECTED=4]="MEETING_CONNECTED",E[E.MEETING_RECONNECT=5]="MEETING_RECONNECT",E[E.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",E[E.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",E[E.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",E),vr=((c=vr||{})[c.NOT_AVAILABLE=0]="NOT_AVAILABLE",c[c.GOOD=1]="GOOD",c[c.BAD=2]="BAD",c[c.POOR=3]="POOR",c[c.DISCONNECTED=4]="DISCONNECTED",c[c.RECONNECTING=5]="RECONNECTING",c[c.LOST_CONNECTION=6]="LOST_CONNECTION",c),co=((S=co||{}).NO_CAM="devices.no-cam",S.NO_DEVICES="devices.no-devices",S.DEVICES_BLOCKED="devices.blocked",S.DEVICES_CAM_BLOCKED="devices.cam-blocked",S.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",S.DEVICES_UNKNOWN_ERROR="devices.unknown-error",S);oe();var lo=((u=lo||{}).HOST="host",u.GUEST="guest",u.AUDIENCE="audience",u);oe(),oe(),oe();var kc=xt(Qn()),Ci=xt(Wc()),po=class extends kc.Logger{constructor(t){super(t),this.disable(),this.debug=(0,Ci.default)(t)}log(t,...e){this.debug(t,...e)}enable(t="*"){Ci.default.enable(t)}disable(){Ci.default.disable()}},me=new po("@superviz/sdk");oe();var go=class{static doRequest(t,e,r){return et(this,null,function*(){let o=yield fetch(`${go.baseUrl}${t}`,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok)throw o;return o.json()})}static validateApiKey(t){return this.doRequest("/user/checkapikey","POST",{apiKey:t})}static fetchConfig(t){return this.doRequest("/immersive-config","POST",{apiKey:t})}},Wt=go;Wt.baseUrl=ge.SDK_BASE_API_URL,oe();var Vc=t=>et(void 0,null,function*(){try{return(yield Wt.validateApiKey(t))===!0}catch(e){if(404===e.status)return!1;throw Error("Unable to validate API key")}});oe();var kt=xt(Qc()),yr=class{constructor(){this.browser=kt.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(kt.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(kt.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(kt.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(kt.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(kt.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(kt.default.PLATFORMS_MAP.mobile)||this.browser.is(kt.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(kt.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};oe(),oe();var bf=xt(Qn()),Cf=xt(Il());oe();var Rl=xt(Qn()),Li=class{constructor(){this.connectionStatusObserver=new Rl.ObserverHelper({logger:me}),this.updateMeetingConnectionStatus=t=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=t,this.connectionStatusObserver.publish(t),me.log("CONNECTION STATUS CHANGE",t)},this.onUpdateBrowserOnlineStatus=t=>{let{type:e}=t;if("online"===e){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)},this.connectionStatus=0}addListerners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};oe();var Ml=xt(Tl());oe();var Bi=class{constructor({isAvatarsEnabled:t,isMouseEnabled:e,isLaserEnabled:r,isNameEnabled:o,renderLocalAvatar:a,plugin:s,RealtimeService:l,localParticipant:f}){this.enableAvatars=()=>{this._isAvatarsEnabled=!0},this.disableAvatars=()=>{this._isAvatarsEnabled=!1},this.enableMouse=()=>{this._isMouseEnabled=!0},this.disableMouse=()=>{this._isMouseEnabled=!1},this.enableLaser=()=>{this._isLaserEnabled=!0},this.disableLaser=()=>{this._isLaserEnabled=!1},this.createAvatar=t=>et(this,null,function*(){if(!t.avatarConfig||t.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled)return;this.destroyAvatar(t);let e=yield this.plugin.createAvatar(t);this._isNameEnabled&&this.plugin.createName&&this.plugin.createName(t,e)}),this.destroyAvatar=t=>{this.plugin.destroyAvatar(t)},this.createMouse=t=>{t.avatarConfig&&(t.id!==this._localParticipant.id||this._renderLocalAvatar)&&this._isAvatarsEnabled&&this._isMouseEnabled&&(this.destroyMouse(t),this.plugin.createMouse(t))},this.destroyMouse=t=>{this.plugin.destroyMouse(t)},this.createLaser=t=>{t.avatarConfig&&(t.id!==this._localParticipant.id||this._renderLocalAvatar)&&this._isAvatarsEnabled&&this._isLaserEnabled&&(this.destroyLaser(t),this.plugin.createLaser(t))},this.destroyLaser=t=>{this.plugin.destroyLaser(t)},this.goToParticipant=t=>{this.plugin.goToParticipant(t)},this._isAvatarsEnabled=t,this._isMouseEnabled=e,this._isLaserEnabled=r,this._renderLocalAvatar=a,this._isNameEnabled=o,this.plugin=s,this._localParticipant=f,this.RealtimeService=l,this.plugin.init({setSyncProperty(t,e){l.setSyncProperty(t,e)},subscribeToParticipantUpdate(t,e){l.subscribeToParticipantUpdate(t,e)},unsubscribeToParticipantUpdate(t,e){l.unsubscribeFromParticipantUpdate(t,e)},updateMyProperties(t){l.updateMyProperties(t)},subscribe:l.syncPropertiesObserver.subscribe,unsubscribe:l.syncPropertiesObserver.unsubscribe,getParticipantSlot:l.getParticipantSlot},f)}get isAvatarsEnabled(){return this._isAvatarsEnabled}get isMouseEnabled(){return this._isMouseEnabled}get isLaserEnabled(){return this._isLaserEnabled}};oe();var Di=class{constructor(){this.addParticipantToList=t=>{this._participants||(this._participants=[]),this._participants=[...this._participants,t]},this.setLocalParticipant=t=>{this._participant=t},this.createParticipantOn3D=({id:t,name:e,avatar:r,avatarConfig:o,isAudience:a})=>({id:t,name:e,avatar:r,isAudience:a,avatarConfig:o,position:{x:0,y:0,z:0},rotation:{x:0,y:0}}),this.removeParticipant=t=>{this._participants=this._participants.filter(e=>e.id!==t.id)}}get participant(){return this._participant}get participants(){return this._participants}},Ni=class extends Bi{constructor({isAvatarsEnabled:t,isMouseEnabled:e,isLaserEnabled:r,isNameEnabled:o,renderLocalAvatar:a,plugin:s,RealtimeService:l,avatarConfig:f,localParticipant:h,participantList:p}){super({plugin:s,RealtimeService:l,isAvatarsEnabled:null==t||t,isMouseEnabled:null==e||e,isLaserEnabled:null==r||r,isNameEnabled:o,renderLocalAvatar:a,localParticipant:h,avatarConfig:f}),this.followParticipantId=null,this.addParticipant=t=>{if(!t||!t.id||t.isAudience)return;let e=this.IntegrationParticipantsService.createParticipantOn3D(t);this.IntegrationParticipantsService.addParticipantToList(e),this.RealtimeService.subscribeToParticipantUpdate(e.id,this.onParticipantUpdated),this.createAvatar(e),this.createMouse(e),this.createLaser(e)},this.removeParticipant=(t,e)=>{this.IntegrationParticipantsService.removeParticipant(t),this.destroyAvatar(t),this.destroyMouse(t),this.destroyLaser(t),e&&this.RealtimeService.unsubscribeFromParticipantUpdate(t.id,this.onParticipantUpdated)},this.updateParticipant=t=>{var e,r;if(!this.participants||0===this.participants.length||!t||!t.id)return;let o=this.participants.find(e=>e.id===t.id);if(!o){this.addParticipant(t);return}let a=!1;if((null==(e=o.avatar)?void 0:e.model)===(null==(r=t.avatar)?void 0:r.model)&&(0,Ml.isEqual)(o.avatarConfig,t.avatarConfig)||(a=!0),a){this.removeParticipant(t,!1);let s=this.IntegrationParticipantsService.createParticipantOn3D(t);this.IntegrationParticipantsService.addParticipantToList(s),this.createAvatar(s),this.createMouse(s),this.createLaser(s)}else{let l=this.IntegrationParticipantsService.participants.findIndex(e=>e.id===t.id);-1!==l&&(this.IntegrationParticipantsService.participants[l]=t)}},this.createLocalParticipant=t=>{let e=this.IntegrationParticipantsService.createParticipantOn3D(t);this.IntegrationParticipantsService.setLocalParticipant(e)},this.createParticipantList=t=>{t.map(t=>this.IntegrationParticipantsService.createParticipantOn3D(t)).forEach(t=>{this.addParticipant(t)})},this.onParticipantJoined=t=>{let{participantId:e,name:r,avatar:o,avatarConfig:a,isAudience:s}=t.data;this.addParticipant({id:e,name:r,avatar:o,avatarConfig:a,isAudience:s})},this.onParticipantLeave=t=>{var e;if(!(null!=(e=this.participants)&&e.length))return;let r=this.participants.find(e=>e.id===t.clientId);r&&this.removeParticipant(r,!0)},this.onParticipantUpdated=t=>{let{participantId:e,name:r,avatar:o,avatarConfig:a,position:s,rotation:l}=t.data;this.updateParticipant({position:s,rotation:l,id:e,name:r,avatar:o,avatarConfig:a}),this.followParticipantId&&this.plugin.goToParticipant(this.followParticipantId)},this.onRoomInfoUpdate=t=>{if(!t)return;let{gather:e,hostClientId:r,followParticipantId:o}=t;this.followParticipantId=o,e&&this.plugin.goToParticipant(r)},this.IntegrationParticipantsService=new Di,this.createLocalParticipant(h),this.createParticipantList(p),this.RealtimeService.participantJoinedObserver.subscribe(this.onParticipantJoined),this.RealtimeService.participantLeaveObserver.subscribe(this.onParticipantLeave),this.RealtimeService.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdate),this.onRoomInfoUpdate(this.RealtimeService.roomProperties)}get participants(){return this.IntegrationParticipantsService.participants}get getAvatars(){var t;return null==(t=this.plugin)?void 0:t.getAvatars()}get localParticipant(){return this.IntegrationParticipantsService.participant}};oe(),oe();var Fo=xt(_l()),Xn=xt(lf());oe();var Lo=((d=Lo||{})[d.DISCONNECTED=0]="DISCONNECTED",d[d.INITIALIZING=1]="INITIALIZING",d[d.READY_TO_JOIN=2]="READY_TO_JOIN",d[d.CONNECTING=3]="CONNECTING",d[d.CONNECTED=4]="CONNECTED",d[d.JOINED=5]="JOINED",d[d.FAILED=-1]="FAILED",d[d.RETRYING=-2]="RETRYING",d);oe();var gt=xt(Qn());oe();var Bo=((y=Bo||{})[y.yellow=0]="yellow",y[y.turquoise=1]="turquoise",y[y.orange=2]="orange",y[y.blue=3]="blue",y[y.pink=4]="pink",y[y.purple=5]="purple",y[y.green=6]="green",y[y.red=7]="red",y[y.bluedark=8]="bluedark",y[y.pinklight=9]="pinklight",y[y.purplelight=10]="purplelight",y[y.greenlight=11]="greenlight",y[y.orangelight=12]="orangelight",y[y.bluelight=13]="bluelight",y[y.redlight=14]="redlight",y[y.brown=15]="brown",y[y.gray=16]="gray",y),Do=((i=Do||{})[i["#FFEF33"]=0]="#FFEF33",i[i["#31E0B0"]=1]="#31E0B0",i[i["#FF5E10"]=2]="#FF5E10",i[i["#00ABF7"]=3]="#00ABF7",i[i["#FF00BB"]=4]="#FF00BB",i[i["#9C29FF"]=5]="#9C29FF",i[i["#6FDD00"]=6]="#6FDD00",i[i["#E30000"]=7]="#E30000",i[i["#304AFF"]=8]="#304AFF",i[i["#FF89C4"]=9]="#FF89C4",i[i["#D597FF"]=10]="#D597FF",i[i["#C6EC5C"]=11]="#C6EC5C",i[i["#FFA115"]=12]="#FFA115",i[i["#75DEFE"]=13]="#75DEFE",i[i["#FAA291"]=14]="#FAA291",i[i["#BB813F"]=15]="#BB813F",i[i["#878291"]=16]="#878291",i),Gi=class{constructor(){this.participantObservers=[],this.participantsObserver=new gt.ObserverHelper({logger:me}),this.participantJoinedObserver=new gt.ObserverHelper({logger:me}),this.participantLeaveObserver=new gt.ObserverHelper({logger:me}),this.joinRoomObserver=new gt.ObserverHelper({logger:me}),this.syncPropertiesObserver=new gt.ObserverHelper({logger:me}),this.reconnectObserver=new gt.ObserverHelper({logger:me}),this.roomInfoUpdatedObserver=new gt.ObserverHelper({logger:me}),this.roomListUpdatedObserver=new gt.ObserverHelper({logger:me}),this.masterParticipantObserver=new gt.ObserverHelper({logger:me}),this.realtimeStateObserver=new gt.ObserverHelper({logger:me}),this.kickAllParticipantsObserver=new gt.ObserverHelper({logger:me}),this.authenticationObserver=new gt.ObserverHelper({logger:me})}subscribeToParticipantUpdate(t,e){this.participantObservers[t]||(this.participantObservers[t]=new gt.ObserverHelper({logger:me})),this.participantObservers[t].subscribe(e)}unsubscribeFromParticipantUpdate(t,e){this.participantObservers[t]&&this.participantObservers[t].unsubscribe(e)}getSlotColor(t){let e=null!=t?t:16;return{color:Do[e],name:Bo[e]}}},CC=6e4,OC=2e3,ff=1e3,No=null,$n=class extends Gi{constructor(t){super(),this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.localParticipantId=null,this.isBroadcast=!1,this.roomChannel=null,this.roomSyncChannel=null,this.roomBroadcastChannel=null,this.isReconnecting=!1,this.isJoinedRoom=!1,this.currentReconnecAttempt=0,this.localRoomProperties=null,this.enableSync=!0,this.isSyncFreezed=!1,this.left=!1,this.state=0,this.setHost=t=>et(this,null,function*(){if(t)yield this.updateRoomProperties({hostClientId:this.participants[t].clientId})}),this.setSyncProperty=(0,Xn.default)((t,e)=>{this.isMessageTooBig(e)||this.isSyncFreezed||this.roomSyncChannel.publish(t,e,t=>{t&&me.log(`publish failed with error ${t}`)})},ff),this.freezeSync=t=>{var e,r;if(this.isSyncFreezed=t,t){this.roomChannel.detach(),this.roomSyncChannel.detach(),null==(e=this.roomBroadcastChannel)||e.detach(),this.roomChannel.unsubscribe(),this.roomSyncChannel.unsubscribe(),null==(r=this.roomBroadcastChannel)||r.unsubscribe();return}this.join(this.myParticipant.data)},this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t)},this.updateLocalRoomState=t=>{this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),t.hostClientId?this.updateHostInfo(t.hostClientId):this.hostPassingHandle(),this.updateParticipants()},this.updateMyProperties=(0,Xn.default)(t=>{let e=t;if(!(this.isMessageTooBig(t)||this.left||!this.enableSync||this.isSyncFreezed)&&(void 0===e.avatar&&delete e.avatar,this.myParticipant.data=Ht(Ht({},this.myParticipant.data),t),this.isJoinedRoom))return this.roomChannel.presence.update(this.myParticipant.data)},ff),this.updateRoomProperties=t=>et(this,null,function*(){if(!this.isMessageTooBig(t)&&!this.isSyncFreezed&&!this.left)yield this.roomChannel.publish("update",Ht(Ht({},this.localRoomProperties),t))}),this.updateParticipants=()=>et(this,null,function*(){let t={};yield this.roomChannel.presence.get((e,r)=>{r.forEach(e=>{t[e.clientId]=Ht({},e)}),this.participants=t,this.participantsObserver.publish(this.participants)})}),this.updateHostInfo=t=>et(this,null,function*(){let e=[];if(yield this.roomChannel.presence.get((t,r)=>{r.forEach(r=>{t||e.push(r.clientId)})}),!t||!e.includes(t)){this.hostPassingHandle();return}No&&clearTimeout(No);let r=this.hostParticipantId;this.hostParticipantId=t,this.masterParticipantObserver.publish({oldMasterParticipantParticipantId:r,newMasterParticipantParticipantId:this.hostParticipantId}),me.log("RELTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)}),this.initializeRoomProperties=(t,...e)=>et(this,[t,...e],function*(t,e={}){var r;let o=Ht({isGridModeEnable:!1},e);null!=(r=this.myParticipant)&&r.data.type&&(o.hostClientId=this.myParticipant.data.participantId),yield this.updateParticipants(),yield this.updateRoomProperties(o)}),this.hostPassingHandle=(0,Xn.default)(()=>et(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.roomChannel.presence.get((t,e)=>{let r=e.filter(t=>"host"===t.data.type).map(t=>t.clientId);if(this.shouldKickParticipantsOnHostLeave&&0===r.length){No=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},CC);return}let o=r[0];o===this.localParticipantId&&this.setHost(o)})}),1e3),this.findSlotIndex=t=>et(this,null,function*(){let e=t,r=Array.apply(null,{length:15}).map(Number.call,Number);if(yield this.roomChannel.presence.get((t,o)=>{t||o.forEach(t=>{t.connectionId===e.connectionId&&(e=t),t.connectionId!==e.connectionId&&t.data.hasOwnProperty("slotIndex")&&r.splice(r.indexOf(t.data.slotIndex),1)})}),0===r.length)return;let o=r[0];this.myParticipant.data.slotIndex=o,yield this.updateMyProperties({slotIndex:r[0]}),setTimeout(()=>{this.confirmSlot(e)},Math.floor(500*Math.random()))}),this.confirmSlot=(0,Xn.default)(t=>et(this,null,function*(){let e=[],r=t;if(yield this.roomChannel.presence.get((t,o)=>{o.forEach(t=>{t.connectionId===r.connectionId&&(r=t),t.connectionId!==r.connectionId&&void 0!==t.data.slotIndex&&e.push(t.data.slotIndex)})}),void 0===this.myParticipant.data.slotIndex||e.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(r);else{let o=yield this.fetchRoomProperties();this.updateRoomProperties(o)}}),1e3),this.onParticipantJoin=t=>et(this,null,function*(){this.participantJoinedObserver.publish(t),yield this.updateParticipants(),this.updateMyProperties({})}),this.syncBroadcast=(0,Xn.default)(()=>{let t=btoa(this.ablyKey);fetch(`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`,{headers:{Authorization:`Basic ${t}`}}).then(t=>t.json()).then(t=>{this.roomBroadcastChannel.publish("update",t)})},1e3),this.isMessageTooBig=t=>{let e=JSON.stringify(t);return new TextEncoder().encode(e).length>OC},this.ablyKey=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onAblySyncChannelUpdate=this.onAblySyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var t;return null==(t=this.roomProperties)?void 0:t.hostClientId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}start({initialParticipantData:t,roomId:e,apiKey:r,shouldKickParticipantsOnHostLeave:o,isBroadcast:a}){this.myParticipant={data:t,timestamp:null,action:null,clientId:t.participantId,connectionId:null,encoding:null,id:null},this.isBroadcast=a,this.enableSync="audience"!==t.type,this.roomId=`superviz:${e.toLowerCase()}-${r}`,this.localParticipantId=this.myParticipant.data.participantId,this.shouldKickParticipantsOnHostLeave=o,this.apiKey=r,this.client||this.buildClient()}auth(t,e){let r=new Fo.default.Rest({key:this.ablyKey}),{origin:o}=window.location;r.auth.requestToken(t,{authUrl:`${Wt.baseUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:o,apiKey:this.apiKey}},(t,r)=>{t&&this.authenticationObserver.publish("realtime.authentication-failed"),e(t,r)})}join(t){me.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(t),this.roomSyncChannel=this.client.channels.get(`${this.roomId}:sync`),this.roomSyncChannel.subscribe(this.onAblySyncChannelUpdate),this.isBroadcast&&(this.roomBroadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.roomBroadcastChannel.subscribe("update",this.onReceiveBroadcastSync)),this.roomChannel=this.client.channels.get(this.roomId),this.roomChannel.on(this.onAblyChannelStateChange),this.roomChannel.subscribe("update",this.onAblyRoomUpdate),this.roomChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.roomChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.roomChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.roomChannel.presence.enter(this.myParticipant.data)}leave(){me.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.roomChannel=null,this.roomSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let e=this.localRoomProperties;this.updateRoomProperties(Object.assign({},e,{isGridModeEnable:t}))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var e,r;if(t){let o=t.toString();return this.participants&&this.participants[o]?null==(r=null==(e=this.participants[t])?void 0:e.data)?void 0:r.slotIndex:16}return 16}onAblyPresenceEnter(t){t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){if(!this.isJoinedRoom)return;let{clientId:e}=t,r=Object.assign({},t,{participantId:t.clientId});this.publishParticipantUpdate(r),this.participants&&this.participants[e]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onAblySyncChannelUpdate(t){let{name:e,data:r}=t,o={};o[e]=r,this.syncPropertiesObserver.publish(o)}onReceiveBroadcastSync(t){t.data.forEach(t=>{var e;let r=t.clientId;this.participants[r]=t,null!=(e=t.data)&&e.isAudience||(this.participants[r].data=JSON.parse(this.participants[r].data),this.publishParticipantUpdate(this.participants[r]))})}onAblyRoomUpdate(t){this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Fo.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(me.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnecAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),2===this.state){me.log("REALTIME","Rejoining room since client aready connected to ably servers."),this.join(this.myParticipant.data);return}me.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw me.log(t),Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,me.log("REALTIME",`Realtime state did change. New state: ${Lo[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,e)=>{this.roomChannel.history((r,o)=>{var a;r&&e(r);t((null==(a=o.items[0])?void 0:a.data)||null)})})}onStateChange(){var t,e,r;let o=null==(t=this.roomChannelState)?void 0:t.current,a=null==(e=this.connectionState)?void 0:e.current,s="connected"===a,l=["initialized","connecting"].includes(a),f=Number(Object.entries({0:["closed","closing"].includes(a)||["detaching","detached"].includes(o),1:l,2:!o&&s,3:"attaching"===o,4:"attached"===o&&s,[-1]:"failed"===o||"failed"===a,[-2]:"suspended"===a||"suspended"===o}).find(([t,e])=>e&&t)[0]);2===f&&(this.currentReconnecAttempt=0),s&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(-2===f||-1===f)&&this.forceReconnect(),null!=(r=this.connectionState)&&r.retryIn&&(this.currentReconnecAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnecAttempt)),this.publishStateUpdate(f)}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.roomChannelState=t,this.onStateChange()}onJoinRoom(t){return et(this,null,function*(){var e,r;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&(yield this.findSlotIndex(t)),this.localRoomProperties?(yield this.updateParticipants(),null!=(e=this.localRoomProperties)&&e.hostClientId?yield this.updateHostInfo(null==(r=this.localRoomProperties)?void 0:r.hostClientId):"host"===this.myParticipant.data.type&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):yield this.initializeRoomProperties(t),this.isReconnecting=!1,this.joinRoomObserver.publish(this.roomChannel),this.publishStateUpdate(4),me.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(2===this.state)return;let e=t.data.participantId===this.hostParticipantId;this.participantLeaveObserver.publish(t),e&&this.onHostLeft(t),this.updateParticipants()}onHostLeft(t){this.updateRoomProperties({hostClientId:null})}};oe(),oe();var Ke=xt(Qn()),mf=xt(pf());oe();var IC=`
  html, body { 
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  #sv-video-wrapper iframe {
    position: fixed;
    
    border: none;

    margin: 0; 
    padding: 0; 
    overflow: hidden;
  }

  #sv-video-wrapper iframe.sv-video-frame--right { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
  }

  #sv-video-wrapper iframe.sv-video-frame--left { 
    top: var(--superviz-offset-top);
    left: var(--superviz-offset-left);
  }

  #sv-video-wrapper iframe.sv-video-frame--bottom { 
    bottom: var(--superviz-offset-bottom);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--expansive-mode {
    bottom: var(--superviz-offset-bottom); 
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--settings-view {
    width: 370px;
  }
`,gf=IC;oe();var Hi=((n=Hi||{}).SMALL="SMALL",n.LARGE="LARGE",n),Wo="sv-video-frame",vf="sv-video-frame--expansive-mode",Tr=class{constructor(t){this.frameStateObserver=new Ke.ObserverHelper({logger:me}),this.frameSizeObserver=new Ke.ObserverHelper({logger:me}),this.realtimeObserver=new Ke.ObserverHelper({logger:me}),this.hostChangeObserver=new Ke.ObserverHelper({logger:me}),this.gridModeChangeObserver=new Ke.ObserverHelper({logger:me}),this.followParticipantObserver=new Ke.ObserverHelper({logger:me}),this.goToParticipantObserver=new Ke.ObserverHelper({logger:me}),this.gatherParticipantsObserver=new Ke.ObserverHelper({logger:me}),this.sameAccountErrorObserver=new Ke.ObserverHelper({logger:me}),this.devicesObserver=new Ke.ObserverHelper({logger:me}),this.meetingStateObserver=new Ke.ObserverHelper({logger:me}),this.meetingConnectionObserver=new Ke.ObserverHelper({logger:me}),this.participantAmountUpdateObserver=new Ke.ObserverHelper({logger:me}),this.participantJoinedObserver=new Ke.ObserverHelper({logger:me}),this.participantAvatarObserver=new Ke.ObserverHelper({logger:me}),this.participantLeftObserver=new Ke.ObserverHelper({logger:me}),this.participantListObserver=new Ke.ObserverHelper({logger:me}),this.frameState=0,this.onFrameLoad=()=>{if(this.messageBridge=new Ke.MessageBridge({logger:me,contentWindow:this.bricklayer.element.contentWindow}),this.browserService.isMobileDevice){let t=new mf.default,e=()=>{t.enable(),this.bricklayer.element.removeEventListener("click",e,!1)};this.bricklayer.element.addEventListener("click",e,!1)}this.messageBridge.listen("meeting.amount-of-participants-update",this.onParticipantAmountUpdate),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("frame.size-update",this.updateFrameSize),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.join",this.realtimeJoin),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.set-avatar",this.onParticipantAvatarChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize()},this.setFrameOffset=t=>{let e=null!=t?t:{};["top","bottom","left","right"].forEach(t=>{Object.keys(e).includes(t)||(e[t]=0)}),this.frameOffset=e},this.setFrameStyle=t=>{let e=document.createElement("style"),{bottom:r,left:o,right:a,top:s}=this.frameOffset;if(e.innerHTML=`
    :root {
      --superviz-offset-top: ${s}px;
      --superviz-offset-right: ${a}px;
      --superviz-offset-left: ${o}px;
      --superviz-offset-bottom: ${r}px;
    } 
    ${gf}    
    `,document.head.appendChild(e),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${t}`)},this.onFrameDimensionsUpdate=({width:t,height:e})=>{let r=document.getElementById(Wo),{bottom:o,right:a,left:s,top:l}=this.frameOffset,f=null!==t,h=0===t,p=!!e,A=0===e||e>window.innerHeight,g="100%",m,v;f&&(m=`${t}px`),h&&(m=`calc(${g} - ${a}px - ${s}px)`),p&&(v=`${e}px`),A&&(v=`calc(${g} - ${l}px - ${o}px)`),r.style.width=m,r.style.height=v,this.frameSizeObserver.publish({width:m,height:v})},this.updateFrameSize=t=>{let e=document.getElementById(Wo),r=e.classList.contains(vf);"LARGE"===t&&r||"SMALL"===t&&!r||e.classList.toggle(vf)},this.onWindowResize=()=>{let{bottom:t,left:e,right:r,top:o}=this.frameOffset,{innerHeight:a,innerWidth:s}=window;a=a-t-o,s=s-e-r,this.messageBridge.publish("frame.parante-window-size-update",{height:a,width:s})},this.updateFrameLocale=()=>{let{language:t,locales:e}=this.frameLocale,r=["en",...e.map(t=>null==t?void 0:t.language)];if(t&&!r.includes(t))throw Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)},this.updateMeetingAvatars=()=>{this.messageBridge.publish("meeting.avatar-list-update",this.meetingAvatars)},this.onParticipantAmountUpdate=t=>{this.participantAmountUpdateObserver.publish(t)},this.onParticipantJoined=t=>{this.participantJoinedObserver.publish(t)},this.onParticipantLeft=t=>{this.participantLeftObserver.publish(t)},this.onParticipantListUpdate=t=>{this.participantListObserver.publish(t)},this.onParticipantAvatarChange=t=>{this.participantAvatarObserver.publish(t)},this.realtimeJoin=(t={})=>{this.realtimeObserver.publish(t)},this.onMeetingHostChange=t=>{this.hostChangeObserver.publish(t)},this.onFollowParticipantDidChange=t=>{this.followParticipantObserver.publish(t)},this.onGoToDidChange=t=>{this.goToParticipantObserver.publish(t)},this.onGather=()=>{this.gatherParticipantsObserver.publish()},this.onGridModeChange=t=>{this.gridModeChangeObserver.publish(t)},this.onSameAccountError=t=>{this.sameAccountErrorObserver.publish(t)},this.onDevicesChange=t=>{this.devicesObserver.publish(t)},this.meetingStateUpdate=t=>{this.meetingStateObserver.publish(t)},this.onConnectionStatusChange=t=>{this.meetingConnectionObserver.publish(t)},this.waitForHostDidChange=t=>{this.messageBridge.publish("realtime.wait-for-host",t)},this.gridModeDidChange=t=>{this.messageBridge.publish("realtime.grid-mode-change",t)},this.participantsListDidChange=t=>{this.messageBridge.publish("realtime.participant-list-update",t)},this.onMasterParticipantDidChange=t=>{this.messageBridge.publish("realtime.host-change",t)},this.followParticipantDidChange=t=>{this.messageBridge.publish("realtime.follow-participant",t)};let{apiKey:e,debug:r,language:o,roomId:a,canUseCams:s,canUseScreenshare:l,canUseDefaultAvatars:f,canUseFollow:h,canUseGoTo:p,canUseGather:A,position:g,browserService:m,offset:v,canUseDefaultToolbar:$,locales:b,avatars:C}=t;this.browserService=m;let _=document.createElement("div"),O=["right","left"].includes(g)&&!this.browserService.isMobileDevice?"vertical":"horizontal",w={apiKey:e,debug:r,canUseFollow:h,canUseGoTo:p,canUseCams:s,canUseGather:A,canUseScreenshare:l,canUseDefaultAvatars:f,camerasOrientation:O,canUseDefaultToolbar:$,roomId:a};_.classList.add("sv_video_wrapper"),_.id="sv-video-wrapper",document.body.appendChild(_),this.updateFrameState(1),this.bricklayer=new Ke.FrameBricklayer,this.bricklayer.build(_.id,ge.SDK_VIDEO_CONFERENCE_LAYER_URL,Wo,w,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(v),this.setFrameStyle(g),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:o,locales:b},this.meetingAvatars=C,window.addEventListener("resize",this.onWindowResize)}updateFrameState(t){t!==this.frameState&&(this.frameState=t,this.frameStateObserver.publish(this.frameState)),this.meetingStateUpdate({1:6,2:7,0:8}[t])}start(t){this.messageBridge.publish("meeting.start",t)}leave(){this.messageBridge.publish("meeting.leave",{}),this.destroy()}destroy(){this.messageBridge.destroy(),this.bricklayer.destroy(),this.frameStateObserver.destroy(),this.realtimeObserver.destroy(),this.hostChangeObserver.destroy(),this.gridModeChangeObserver.destroy(),this.followParticipantObserver.destroy(),this.bricklayer=null,this.frameState=null}toggleChat(){this.messageBridge.publish("meeting-controls.toggle-chat")}toggleMeetingSetup(){this.messageBridge.publish("meeting-controls.toggle-setup")}toggleMicrophone(){this.messageBridge.publish("meeting-controls.toggle-microphone")}toggleScreenShare(){this.messageBridge.publish("meeting-controls.toggle-screenshare")}hangUp(){this.messageBridge.publish("hang-up")}toggleCam(){this.messageBridge.publish("meeting-controls.toggle-cam")}},MC=yf(),ko=class{constructor({apiKey:t,debug:e=!1,language:r,roomId:o,ablyKey:a,group:s,participant:l,shouldKickParticipantsOnHostLeave:f,camsOff:h,screenshareOff:p,defaultAvatars:A,offset:g,enableFollow:m,enableGoTo:v,enableGather:$,defaultToolbar:b,locales:C,avatars:_}){var O;this.integrationManager=null,this.observerHelpers={},this.hasJoined=!1,this.participantList=[],this.isBroadcast=!1,this.setSyncProperty=(t,e)=>{this.realtime.setSyncProperty(t,e)},this.subscribe=(t,e)=>{this.observerHelpers[t]||(this.observerHelpers[t]=new bf.ObserverHelper),this.observerHelpers[t].subscribe(e)},this.unsubscribe=t=>{this.observerHelpers[t]&&(this.observerHelpers[t].reset(),delete this.observerHelpers[t])},this.startVideo=t=>{this.videoManager=new Tr(t),this.videoManager.frameStateObserver.subscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.subscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.subscribe(this.onHostDidChange),this.videoManager.followParticipantObserver.subscribe(this.onFollowParticipantDidChange),this.videoManager.goToParticipantObserver.subscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.subscribe(this.onGatherDidChange),this.videoManager.gridModeChangeObserver.subscribe(this.onGridModeDidChange),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange),this.videoManager.participantAmountUpdateObserver.subscribe(this.onParticipantAmountUpdate),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.participantAvatarObserver.subscribe(this.onParticipantAvatarUpdate),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus)},this.publish=(t,e)=>{t in this.observerHelpers&&this.observerHelpers[t].publish(e)},this.onSyncPropertiesDidChange=t=>{Object.entries(t).forEach(([t,e])=>{this.publish(t,e)})},this.onKickAllParticipantsDidChange=t=>{this.publish("meeting.kick-all-participants",t),this.destroy()},this.onRealtimeJoin=t=>{this.realtime.join(t)},this.onHostDidChange=t=>{this.realtime.setHost(t)},this.onFollowParticipantDidChange=t=>{this.realtime.setFollowParticipant(t)},this.onGoToParticipantDidChange=t=>{this.integrationManager.goToParticipant(t)},this.onGatherDidChange=()=>{this.realtime.setGather(!0)},this.onFrameStateDidChange=t=>{2===t&&this.start()},this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)},this.onRoomInfoUpdated=t=>{let{isGridModeEnable:e,followParticipantId:r,gather:o}=t;this.videoManager.gridModeDidChange(e),this.videoManager.followParticipantDidChange(r),this.realtime.hostClientId===this.participant.id&&o&&this.realtime.setGather(!1)},this.onParticipantsDidChange=t=>{t[this.participant.id]&&!this.hasJoined&&(this.publish("my-participant.joined",this.participant),this.hasJoined=!0);let e=Object.values(t).map(t=>({timestamp:t.timestamp,connectionId:t.connectionId,participantId:t.clientId,color:this.realtime.getSlotColor(t.data.slotIndex).name}));this.participantList=this.updateParticipantListFromParticipants(t),this.publish("meeting.participant-list-update",this.participantList),this.videoManager.participantsListDidChange(e)},this.onMasterParticipantDidChange=t=>{this.videoManager.onMasterParticipantDidChange(null==t?void 0:t.newMasterParticipantParticipantId)},this.onGridModeDidChange=t=>{this.realtime.setGridMode(t)},this.updateParticipantListFromParticipants=t=>{let e=[];return Object.values(t).forEach(t=>{var r;e.push({id:t.clientId,color:this.realtime.getSlotColor(null==(r=t.data)?void 0:r.slotIndex).color,avatarConfig:t.data.avatarConfig,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId})}),e},this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.destroy()},this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)},this.onParticipantAmountUpdate=t=>{this.publish("meeting.amount-of-participants-update",t)},this.onParticipantJoined=t=>{this.checkBroadcastMode(),this.publish("meeting.participant-joined",t)},this.onParticipantLeft=t=>{t.id===this.participant.id&&this.publish("my-participant.left",t),this.publish("meeting.participant-left",t),this.destroy()},this.onParticipantAvatarUpdate=t=>{this.participant.avatar.model=t},this.onParticipantListUpdate=t=>{let e=t.find(t=>t.id===this.participant.id);(0,Cf.default)(e,this.participant)||(this.participant=Object.assign({},this.participant,e),this.publish("my-participant.update",this.participant))},this.onAuthenticationFailed=t=>{this.publish("realtime.authentication-failed",t),this.destroy()},this.onMeetingStateUpdate=t=>{me.log("MEETING STATE",t),this.publish("meeting.state-update",t)},this.onConnectionStatusChange=t=>{let e=[2,4,3,6];e.includes(t)&&this.realtime.freezeSync(!0),e.includes(this.connectionService.oldConnectionStatus)&&!e.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)},this.roomId=o,this.group=s,this.participant=l,this.realtime=new $n(a),this.browserService=new yr;let w=!h,I=!p,R=!!A&&!(null!=(O=null==l?void 0:l.avatar)&&O.model),M=null==b||b,T=!!m,P=!!v,k=!!$;(null==l?void 0:l.avatar)===void 0&&(this.participant=Object.assign({},this.participant,{avatar:{model:""}}));let B="right";this.connectionService=new Li,this.connectionService.addListerners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange),this.startVideo({canUseCams:w,canUseScreenshare:I,canUseDefaultAvatars:R,canUseFollow:T,canUseGoTo:P,canUseGather:k,canUseDefaultToolbar:M,apiKey:t,debug:e,language:r,roomId:o,position:B,browserService:this.browserService,offset:g,locales:null!=C?C:[],avatars:null!=_?_:[]}),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onParticipantsDidChange),this.realtime.masterParticipantObserver.subscribe(this.onMasterParticipantDidChange),this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.authenticationObserver.subscribe(this.onAuthenticationFailed),this.realtime.start({initialParticipantData:Ht({participantId:this.participant.id},this.participant),roomId:this.roomId,apiKey:t,shouldKickParticipantsOnHostLeave:null==f||f,isBroadcast:this.isBroadcast})}get isIntegrationManagerInitializated(){return!!this.integrationManager}checkBroadcastMode(){this.isBroadcast=this.participantList.some(t=>"audience"===t.type)}start(){me.log("SUPERVIZ SDK VERSION",MC.version),this.videoManager.start({roomId:this.roomId,participant:this.participant,group:this.group})}destroy(){this.publish("destroy",void 0),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.unsubscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.unsubscribe(this.onHostDidChange),this.videoManager.followParticipantObserver.unsubscribe(this.onFollowParticipantDidChange),this.videoManager.gridModeChangeObserver.unsubscribe(this.onGridModeDidChange),this.videoManager.goToParticipantObserver.unsubscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.unsubscribe(this.onGatherDidChange),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange),this.videoManager.participantAmountUpdateObserver.unsubscribe(this.onParticipantAmountUpdate),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.participantAvatarObserver.unsubscribe(this.onParticipantAvatarUpdate),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onParticipantsDidChange),this.realtime.masterParticipantObserver.unsubscribe(this.onMasterParticipantDidChange),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.authenticationObserver.unsubscribe(this.onAuthenticationFailed),this.connectionService.connectionStatusObserver.unsubscribe(this.onConnectionStatusChange),Object.keys(this.observerHelpers).forEach(t=>this.unsubscribe(t)),this.videoManager.leave(),this.realtime.leave(),this.connectionService.removeListeners(),this.hasJoined=!1,this.unloadPlugin()}toggleChat(){this.videoManager.toggleChat()}toggleMeetingSetup(){this.videoManager.toggleMeetingSetup()}toggleCam(){this.videoManager.toggleCam()}toggleMicrophone(){this.videoManager.toggleMicrophone()}toggleScreenShare(){this.videoManager.toggleScreenShare()}hangUp(){this.videoManager.hangUp()}loadPlugin(t,e){var r,o,a,s,l,f;if(this.isIntegrationManagerInitializated)throw Error("the 3D plugin has already been started");e.avatarConfig&&this.realtime.setParticipantData({avatarConfig:e.avatarConfig}),this.participant.avatar&&this.participant.avatar.model&&this.realtime.setParticipantData({avatar:{model:this.participant.avatar.model}});let h=[];return this.realtime.getParticipants&&(h=Object.values(this.realtime.getParticipants)),this.integrationManager=new Ni(Cc(Ht({plugin:t},e),{localParticipant:{id:this.participant.id,name:this.participant.name,avatar:this.participant.avatar,avatarConfig:e.avatarConfig},participantList:h.map(t=>{let e=t.clientId,{name:r,avatar:o,avatarConfig:a,slotIndex:s,isAudience:l}=t.data;return{id:e,name:r,avatar:o,avatarConfig:a,slotIndex:s,isAudience:l}}),RealtimeService:this.realtime})),{enableAvatars:null==(r=this.integrationManager)?void 0:r.enableAvatars,disableAvatars:null==(o=this.integrationManager)?void 0:o.disableAvatars,enableMouse:null==(a=this.integrationManager)?void 0:a.enableMouse,disableMouse:null==(s=this.integrationManager)?void 0:s.disableMouse,enableLaser:null==(l=this.integrationManager)?void 0:l.enableLaser,disableLaser:null==(f=this.integrationManager)?void 0:f.disableLaser,getParticipantsOn3D:()=>{var t;return null!=(t=this.integrationManager)&&t.participants?this.integrationManager.participants:[]},getAvatars:()=>{var t;return null==(t=this.integrationManager)?void 0:t.getAvatars}}}unloadPlugin(){this.integrationManager&&(this.integrationManager.plugin.destroy(),this.integrationManager=null)}},Of=t=>{let e=new ko(t);return{setSyncProperty:(t,r)=>e.setSyncProperty(t,r),subscribe:(t,r)=>e.subscribe(t,r),unsubscribe:t=>e.unsubscribe(t),destroy:()=>e.destroy(),toggleMeetingSetup:()=>e.toggleMeetingSetup(),toggleMicrophone:()=>e.toggleMicrophone(),toggleCam:()=>e.toggleCam(),toggleScreenShare:()=>e.toggleScreenShare(),hangUp:()=>e.hangUp(),toggleChat:()=>e.toggleChat(),loadPlugin:(t,r)=>e.loadPlugin(t,r),unloadPlugin:()=>e.unloadPlugin()}};oe(),oe(),oe();var _C=({group:t,participant:e,roomId:r})=>{if(!t||!t.name||!t.id)throw Error("group fields is required");if(!e||!e.id)throw Error("participant fields is required");if(!r)throw Error("room id is required")},Ef=(t,e)=>et(void 0,null,function*(){if(_C(e),e.debug&&me.enable("@superviz/*"),!(yield Vc(t)))throw Error("Failed to validate API key");let r=yield Wt.fetchConfig(t);if(!r||!r.ablyKey)throw Error("Failed to load configuration from server");let{ablyKey:o}=r;return Of(Object.assign({},e,{apiKey:t,ablyKey:o}))});window&&(window.SuperVizSdk={init:Ef,MeetingEvent:gr,FrameSize:Hi,DeviceEvent:co,RealtimeEvent:Vn,MeetingState:vi,MeetingConnectionStatus:vr,MeetingControlsEvent:gi});var DE={init:Ef};export{yr as BrowserService,co as DeviceEvent,Hi as FrameSize,vr as MeetingConnectionStatus,gi as MeetingControlsEvent,gr as MeetingEvent,vi as MeetingState,lo as ParticipantType,Vn as RealtimeEvent,DE as default}; /*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */  /*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */  /**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */ 