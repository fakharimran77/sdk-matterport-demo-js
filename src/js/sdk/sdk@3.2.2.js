var a0=Object.create;var lo=Object.defineProperty,o0=Object.defineProperties,s0=Object.getOwnPropertyDescriptor,u0=Object.getOwnPropertyDescriptors,c0=Object.getOwnPropertyNames,yc=Object.getOwnPropertySymbols,l0=Object.getPrototypeOf,Cc=Object.prototype.hasOwnProperty,f0=Object.prototype.propertyIsEnumerable;var bc=(i,r,n)=>r in i?lo(i,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[r]=n,Ht=(i,r)=>{for(var n in r||(r={}))Cc.call(r,n)&&bc(i,n,r[n]);if(yc)for(var n of yc(r))f0.call(r,n)&&bc(i,n,r[n]);return i},Oc=(i,r)=>o0(i,u0(r));var d0=(i,r)=>()=>(i&&(r=i(i=0)),r);var We=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports);var h0=(i,r,n,u)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of c0(r))!Cc.call(i,o)&&o!==n&&lo(i,o,{get:()=>r[o],enumerable:!(u=s0(r,o))||u.enumerable});return i};var xt=(i,r,n)=>(n=i!=null?a0(l0(i)):{},h0(r||!i||!i.__esModule?lo(n,"default",{value:i,enumerable:!0}):n,i));var qe=(i,r,n)=>new Promise((u,o)=>{var g=d=>{try{l(n.next(d))}catch(b){o(b)}},S=d=>{try{l(n.throw(d))}catch(b){o(b)}},l=d=>d.done?u(d.value):Promise.resolve(d.value).then(g,S);l((n=n.apply(i,r)).next())});var ge,oe=d0(()=>{ge={}});var zn=We((UC,Fc)=>{oe();var p0=Object.create,bi=Object.defineProperty,g0=Object.getOwnPropertyDescriptor,v0=Object.getOwnPropertyNames,m0=Object.getPrototypeOf,y0=Object.prototype.hasOwnProperty,b0=(i,r)=>()=>(i&&(r=i(i=0)),r),it=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports),C0=(i,r)=>{for(var n in r)bi(i,n,{get:r[n],enumerable:!0})},Ec=(i,r,n,u)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of v0(r))!y0.call(i,o)&&o!==n&&bi(i,o,{get:()=>r[o],enumerable:!(u=g0(r,o))||u.enumerable});return i},Sc=(i,r,n)=>(n=i!=null?p0(m0(i)):{},Ec(r||!i||!i.__esModule?bi(n,"default",{value:i,enumerable:!0}):n,i)),O0=i=>Ec(bi({},"__esModule",{value:!0}),i),Ic,Ne=b0(()=>{Ic={}}),E0=it((i,r)=>{Ne();var n=1e3,u=n*60,o=u*60,g=o*24,S=g*7,l=g*365.25;r.exports=function(s,m){m=m||{};var T=typeof s;if(T==="string"&&s.length>0)return d(s);if(T==="number"&&isFinite(s))return m.long?E(s):b(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function d(s){if(s=String(s),!(s.length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(m){var T=parseFloat(m[1]),M=(m[2]||"ms").toLowerCase();switch(M){case"years":case"year":case"yrs":case"yr":case"y":return T*l;case"weeks":case"week":case"w":return T*S;case"days":case"day":case"d":return T*g;case"hours":case"hour":case"hrs":case"hr":case"h":return T*o;case"minutes":case"minute":case"mins":case"min":case"m":return T*u;case"seconds":case"second":case"secs":case"sec":case"s":return T*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return T;default:return}}}}function b(s){var m=Math.abs(s);return m>=g?Math.round(s/g)+"d":m>=o?Math.round(s/o)+"h":m>=u?Math.round(s/u)+"m":m>=n?Math.round(s/n)+"s":s+"ms"}function E(s){var m=Math.abs(s);return m>=g?I(s,m,g,"day"):m>=o?I(s,m,o,"hour"):m>=u?I(s,m,u,"minute"):m>=n?I(s,m,n,"second"):s+" ms"}function I(s,m,T,M){var C=m>=T*1.5;return Math.round(s/T)+" "+M+(C?"s":"")}}),S0=it((i,r)=>{Ne();function n(u){g.debug=g,g.default=g,g.coerce=I,g.disable=d,g.enable=l,g.enabled=b,g.humanize=E0(),g.destroy=s,Object.keys(u).forEach(m=>{g[m]=u[m]}),g.names=[],g.skips=[],g.formatters={};function o(m){let T=0;for(let M=0;M<m.length;M++)T=(T<<5)-T+m.charCodeAt(M),T|=0;return g.colors[Math.abs(T)%g.colors.length]}g.selectColor=o;function g(m){let T,M=null,C,y;function R(...c){if(!R.enabled)return;let v=R,h=Number(new Date),A=h-(T||h);v.diff=A,v.prev=T,v.curr=h,T=h,c[0]=g.coerce(c[0]),typeof c[0]!="string"&&c.unshift("%O");let f=0;c[0]=c[0].replace(/%([a-zA-Z%])/g,(O,P)=>{if(O==="%%")return"%";f++;let L=g.formatters[P];if(typeof L=="function"){let V=c[f];O=L.call(v,V),c.splice(f,1),f--}return O}),g.formatArgs.call(v,c),(v.log||g.log).apply(v,c)}return R.namespace=m,R.useColors=g.useColors(),R.color=g.selectColor(m),R.extend=S,R.destroy=g.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>M!==null?M:(C!==g.namespaces&&(C=g.namespaces,y=g.enabled(m)),y),set:c=>{M=c}}),typeof g.init=="function"&&g.init(R),R}function S(m,T){let M=g(this.namespace+(typeof T=="undefined"?":":T)+m);return M.log=this.log,M}function l(m){g.save(m),g.namespaces=m,g.names=[],g.skips=[];let T,M=(typeof m=="string"?m:"").split(/[\s,]+/),C=M.length;for(T=0;T<C;T++)!M[T]||(m=M[T].replace(/\*/g,".*?"),m[0]==="-"?g.skips.push(new RegExp("^"+m.slice(1)+"$")):g.names.push(new RegExp("^"+m+"$")))}function d(){let m=[...g.names.map(E),...g.skips.map(E).map(T=>"-"+T)].join(",");return g.enable(""),m}function b(m){if(m[m.length-1]==="*")return!0;let T,M;for(T=0,M=g.skips.length;T<M;T++)if(g.skips[T].test(m))return!1;for(T=0,M=g.names.length;T<M;T++)if(g.names[T].test(m))return!0;return!1}function E(m){return m.toString().substring(2,m.toString().length-2).replace(/\.\*\?$/,"*")}function I(m){return m instanceof Error?m.stack||m.message:m}function s(){}return g.enable(g.load()),g}r.exports=n}),I0=it((i,r)=>{Ne(),i.formatArgs=u,i.save=o,i.load=g,i.useColors=n,i.storage=S(),i.destroy=(()=>{let d=!1;return()=>{d||(d=!0)}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function u(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;let b="color: "+this.color;d.splice(1,0,b,"color: inherit");let E=0,I=0;d[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(E++,s==="%c"&&(I=E))}),d.splice(I,0,b)}i.log=console.debug||console.log||(()=>{});function o(d){try{d?i.storage.setItem("debug",d):i.storage.removeItem("debug")}catch(b){}}function g(){let d;try{d=i.storage.getItem("debug")}catch(b){}return!d&&typeof process!="undefined"&&"env"in process&&(d=Ic.DEBUG),d}function S(){try{return localStorage}catch(d){}}r.exports=S0()(i);var{formatters:l}=r.exports;l.j=function(d){try{return JSON.stringify(d)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}}),po=it((i,r)=>{Ne();function n(u){var o=typeof u;return u!=null&&(o=="object"||o=="function")}r.exports=n}),R0=it((i,r)=>{Ne();var n=typeof global=="object"&&global&&global.Object===Object&&global;r.exports=n}),Rc=it((i,r)=>{Ne();var n=R0(),u=typeof self=="object"&&self&&self.Object===Object&&self,o=n||u||Function("return this")();r.exports=o}),T0=it((i,r)=>{Ne();var n=Rc(),u=function(){return n.Date.now()};r.exports=u}),M0=it((i,r)=>{Ne();var n=/\s/;function u(o){for(var g=o.length;g--&&n.test(o.charAt(g)););return g}r.exports=u}),_0=it((i,r)=>{Ne();var n=M0(),u=/^\s+/;function o(g){return g&&g.slice(0,n(g)+1).replace(u,"")}r.exports=o}),Tc=it((i,r)=>{Ne();var n=Rc(),u=n.Symbol;r.exports=u}),P0=it((i,r)=>{Ne();var n=Tc(),u=Object.prototype,o=u.hasOwnProperty,g=u.toString,S=n?n.toStringTag:void 0;function l(d){var b=o.call(d,S),E=d[S];try{d[S]=void 0;var I=!0}catch(m){}var s=g.call(d);return I&&(b?d[S]=E:delete d[S]),s}r.exports=l}),w0=it((i,r)=>{Ne();var n=Object.prototype,u=n.toString;function o(g){return u.call(g)}r.exports=o}),x0=it((i,r)=>{Ne();var n=Tc(),u=P0(),o=w0(),g="[object Null]",S="[object Undefined]",l=n?n.toStringTag:void 0;function d(b){return b==null?b===void 0?S:g:l&&l in Object(b)?u(b):o(b)}r.exports=d}),L0=it((i,r)=>{Ne();function n(u){return u!=null&&typeof u=="object"}r.exports=n}),B0=it((i,r)=>{Ne();var n=x0(),u=L0(),o="[object Symbol]";function g(S){return typeof S=="symbol"||u(S)&&n(S)==o}r.exports=g}),D0=it((i,r)=>{Ne();var n=_0(),u=po(),o=B0(),g=0/0,S=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,d=/^0o[0-7]+$/i,b=parseInt;function E(I){if(typeof I=="number")return I;if(o(I))return g;if(u(I)){var s=typeof I.valueOf=="function"?I.valueOf():I;I=u(s)?s+"":s}if(typeof I!="string")return I===0?I:+I;I=n(I);var m=l.test(I);return m||d.test(I)?b(I.slice(2),m?2:8):S.test(I)?g:+I}r.exports=E}),N0=it((i,r)=>{Ne();var n=po(),u=T0(),o=D0(),g="Expected a function",S=Math.max,l=Math.min;function d(b,E,I){var s,m,T,M,C,y,R=0,c=!1,v=!1,h=!0;if(typeof b!="function")throw new TypeError(g);E=o(E)||0,n(I)&&(c=!!I.leading,v="maxWait"in I,T=v?S(o(I.maxWait)||0,E):T,h="trailing"in I?!!I.trailing:h);function A(x){var k=s,W=m;return s=m=void 0,R=x,M=b.apply(W,k),M}function f(x){return R=x,C=setTimeout(L,E),c?A(x):M}function O(x){var k=x-y,W=x-R,K=E-k;return v?l(K,T-W):K}function P(x){var k=x-y,W=x-R;return y===void 0||k>=E||k<0||v&&W>=T}function L(){var x=u();if(P(x))return V(x);C=setTimeout(L,O(x))}function V(x){return C=void 0,h&&s?A(x):(s=m=void 0,M)}function H(){C!==void 0&&clearTimeout(C),R=0,s=y=m=C=void 0}function D(){return C===void 0?M:V(u())}function _(){var x=u(),k=P(x);if(s=arguments,m=this,y=x,k){if(C===void 0)return f(y);if(v)return clearTimeout(C),C=setTimeout(L,E),A(y)}return C===void 0&&(C=setTimeout(L,E)),M}return _.cancel=H,_.flush=D,_}r.exports=d}),F0=it((i,r)=>{Ne();var n=N0(),u=po(),o="Expected a function";function g(S,l,d){var b=!0,E=!0;if(typeof S!="function")throw new TypeError(o);return u(d)&&(b="leading"in d?!!d.leading:b,E="trailing"in d?!!d.trailing:E),n(S,l,{leading:b,maxWait:l,trailing:E})}r.exports=g}),Mc={};C0(Mc,{EnvironmentStateTypes:()=>xc,FrameBricklayer:()=>G0,HeartBeat:()=>k0,LibraryStateReasonTypes:()=>Bc,LibraryStateTypes:()=>Lc,Logger:()=>go,MessageBridge:()=>Nc,MessageTypes:()=>_c,ObserverHelper:()=>Dc,RealtimeStateReasonTypes:()=>wc,RealtimeStateTypes:()=>Pc});Fc.exports=O0(Mc);Ne();Ne();Ne();var _c=(i=>(i.COMMUNICATOR_STATE_UPDATE="communicator.state-update",i.FRAME_LOAD="frame.load",i.GOTO_USER="environment.goto-user",i.FOLLOW_USER="environment.follow-user",i.GATHER_ALL="environment.gather-all",i.REALTIME_ENTER_ROOM="realtime.enter-room",i.REALTIME_LEAVE="realtime.leave",i.REALTIME_SET_HOST="realtime.set-host",i.REALTIME_SET_ROOM_PROPERTIES="realtime.set-room-properties",i.REALTIME_HOST_UPDATE="realtime.host-update",i.REALTIME_ROOM_PROPERTIES_UPDATE="realtime.room-properties-update",i.REALTIME_USER_AMOUNT_UPDATE="realtime.amount-of-users-update",i.REALTIME_USER_LIST_UPDATE="realtime.user-list-update",i.REALTIME_USER_JOINED="realtime.user-joined",i.REALTIME_USER_LEFT="realtime.user-left",i.HEARTBEAT="heartbeat",i))(_c||{});Ne();var Pc=(i=>(i[i.DISCONNECTED=0]="DISCONNECTED",i[i.INITIALIZING=1]="INITIALIZING",i[i.READY_TO_JOIN=2]="READY_TO_JOIN",i[i.CONNECTING=3]="CONNECTING",i[i.CONNECTED=4]="CONNECTED",i[i.FAILED=-1]="FAILED",i[i.RETRYING=-2]="RETRYING",i))(Pc||{}),wc=(i=>(i[i.LOBBY_SERVER_NOT_REACHEABLE=1]="LOBBY_SERVER_NOT_REACHEABLE",i[i.LOBBY_CONNECTION_ERROR=2]="LOBBY_CONNECTION_ERROR",i[i.ROOM_CONNECTION_FAILED=3]="ROOM_CONNECTION_FAILED",i[i.LOST_CONNECTION=4]="LOST_CONNECTION",i))(wc||{}),xc=(i=>(i[i.UNKNOWN=1]="UNKNOWN",i[i.LOADING=2]="LOADING",i[i.LOADED=3]="LOADED",i[i.ERROR=-1]="ERROR",i))(xc||{}),Lc=(i=>(i[i.INITIALIZING=1]="INITIALIZING",i[i.READY_TO_START=2]="READY_TO_START",i[i.CONNECTING=3]="CONNECTING",i[i.LOADING_MODEL=4]="LOADING_MODEL",i[i.CONNECTED=5]="CONNECTED",i[i.ERROR=-1]="ERROR",i[i.RETRYING=-2]="RETRYING",i))(Lc||{}),Bc=(i=>(i[i.LOBBY_SERVER_NOT_REACHEABLE=1]="LOBBY_SERVER_NOT_REACHEABLE",i[i.LOBBY_CONNECTION_ERROR=2]="LOBBY_CONNECTION_ERROR",i[i.ROOM_CONNECTION_FAILED=3]="ROOM_CONNECTION_FAILED",i[i.LOST_CONNECTION=4]="LOST_CONNECTION",i[i.UNABLE_TO_LOAD_ROOM_INFO=5]="UNABLE_TO_LOAD_ROOM_INFO",i[i.UNABLE_TO_LOAD_FRAME=10]="UNABLE_TO_LOAD_FRAME",i[i.UNABLE_TO_LOAD_SCENE=11]="UNABLE_TO_LOAD_SCENE",i[i.SCENE_NOT_AVAILABLE_TO_USE=12]="SCENE_NOT_AVAILABLE_TO_USE",i[i.UNABLE_TO_LOAD_SCENE_RESOURCES=13]="UNABLE_TO_LOAD_SCENE_RESOURCES",i[i.FRAME_IS_UNRESPONSIVE=14]="FRAME_IS_UNRESPONSIVE",i[i.AUTHENTICATION_FAILED=20]="AUTHENTICATION_FAILED",i))(Bc||{});Ne();Ne();var Ao=Sc(I0()),go=class{constructor(i){this.disable(),this.logger=(0,Ao.default)(i)}log(i,...r){this.logger(i,...r)}enable(i="*"){Ao.default.enable(i)}disable(){Ao.default.disable()}};Ne();var U0=Sc(F0()),Dc=class{constructor(i={}){let{throttleTime:r,logger:n=new go("@immersive/core:ObserverHelper")}=i;this.logger=n,this.throttleTime=r,this.callbacks=[],this.subscribe=this.subscribe.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.publish=this.publish.bind(this),this.reset=this.reset.bind(this),this.throttleTime&&(this.publish=(0,U0.default)(this.publish,this.throttleTime))}subscribe(i){if(!i)throw new Error("Tried to subscribe to event using an invalid callback");this.callbacks.push(i)}unsubscribe(i){this.callbacks=this.callbacks.filter(r=>r!==i)}publish(...i){this.callbacks.forEach(r=>{this.callListener(r,i).catch(n=>{this.logger.log("core:ObserverHelper",`
            Failed to execute callback on publish value.
            Callback: ${r}
            Event: ${JSON.stringify(i)}
          `)})})}reset(){this.callbacks=[]}destroy(){delete this.logger,delete this.callbacks}callListener(i,r){return new Promise((n,u)=>{try{let o=i(...r);n(o)}catch(o){u(o)}})}};Ne();Ne();var G0=class{build(i,r,n,u={},o={}){let g=document.querySelector(`#${i}`),S=new URL(r);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(u).forEach(([l,d])=>{S.searchParams.set(l,d)}),Object.entries(o).forEach(([l,d])=>{this.element.setAttribute(l,d)}),this.element.src=S.toString(),this.element.id=n,g.appendChild(this.element),this.wrapperId=i}destroy(){let i=document.querySelector(`#${this.wrapperId}`);!!i&&!!i.querySelector(`#${this.element.id}`)&&i.removeChild(this.element),this.wrapperId=null,this.element=null}};Ne();Ne();Ne();var Nc=class{constructor(i){this.observerHelpers={},this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"],this.originBlockList=["https://sketchfab.com"],this.publish=(S,l={})=>{this.logger.log("MessageBridge","Posting message to frame",S,l),this.contentWindow.postMessage({type:S,data:l},this.allowedOrigins)},this.listen=(S,l)=>{this.observerHelpers[S]||(this.observerHelpers[S]=new Dc({logger:this.logger})),this.observerHelpers[S].subscribe(l)},this.onReceiveMessage=S=>{let{type:l,data:d,source:b}=S.data;if(this.sourceBlockList.includes(b)||this.originBlockList.includes(S.origin))return;let E=!!l,I=!this.domains.length||this.domains.includes(S.origin),s=this.observerHelpers.hasOwnProperty(l);if(this.logger.log("MessageBridge",`Message received - 
        TYPE: ${S.type} 
        ORIGIN: ${S.origin} 
        DATA: ${JSON.stringify(S.data)} `),!E||!I||!s){this.logger.log("MessageBridge","Message discarded");return}this.observerHelpers[l].publish(d)};let{contentWindow:r,domains:n=[],allowedOrigins:u="*",sourceBlockList:o=[],logger:g=new go("@immersive/core:MessageBridge")}=i;if(this.logger=g,this.domains=n,this.allowedOrigins=u,this.sourceBlockList.push(...o),typeof window!="undefined"){if(this.contentWindow)throw new Error("Tried to init PostMessageBridge more than one time");this.contentWindow=r,window.addEventListener("message",this.onReceiveMessage)}}destroy(){Object.entries(this.observerHelpers).forEach(([i,r])=>{r.reset(),delete this.observerHelpers[i]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observerHelpers,delete this.sourceBlockList}},H0=10*1e3,W0=class{constructor({context:i,interval:r,contentWindow:n}){this.emitter=()=>{this.MessageBridge.publish("heartbeat",{context:this.context,timestamp:Date.now(),timeInterval:this.interval,nextMessageTime:Date.now()+this.interval})},this.listen=u=>{this.MessageBridge.listen("heartbeat",u)},this.context=i,this.interval=r||H0,this.MessageBridge=new Nc({contentWindow:n}),this.start(),this.emitter()}start(){this.timer=setInterval(this.emitter,this.interval)}stop(){clearTimeout(this.timer)}destroy(){this.stop(),this.MessageBridge.destroy()}},k0=W0});var Gc=We((QC,Uc)=>{oe();var jn=1e3,Jn=jn*60,Kn=Jn*60,En=Kn*24,V0=En*7,Q0=En*365.25;Uc.exports=function(i,r){r=r||{};var n=typeof i;if(n==="string"&&i.length>0)return z0(i);if(n==="number"&&isFinite(i))return r.long?J0(i):j0(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))};function z0(i){if(i=String(i),!(i.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(!!r){var n=parseFloat(r[1]),u=(r[2]||"ms").toLowerCase();switch(u){case"years":case"year":case"yrs":case"yr":case"y":return n*Q0;case"weeks":case"week":case"w":return n*V0;case"days":case"day":case"d":return n*En;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Kn;case"minutes":case"minute":case"mins":case"min":case"m":return n*Jn;case"seconds":case"second":case"secs":case"sec":case"s":return n*jn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function j0(i){var r=Math.abs(i);return r>=En?Math.round(i/En)+"d":r>=Kn?Math.round(i/Kn)+"h":r>=Jn?Math.round(i/Jn)+"m":r>=jn?Math.round(i/jn)+"s":i+"ms"}function J0(i){var r=Math.abs(i);return r>=En?Ci(i,r,En,"day"):r>=Kn?Ci(i,r,Kn,"hour"):r>=Jn?Ci(i,r,Jn,"minute"):r>=jn?Ci(i,r,jn,"second"):i+" ms"}function Ci(i,r,n,u){var o=r>=n*1.5;return Math.round(i/n)+" "+u+(o?"s":"")}});var Wc=We((zC,Hc)=>{oe();function K0(i){n.debug=n,n.default=n,n.coerce=d,n.disable=g,n.enable=o,n.enabled=S,n.humanize=Gc(),n.destroy=b,Object.keys(i).forEach(E=>{n[E]=i[E]}),n.names=[],n.skips=[],n.formatters={};function r(E){let I=0;for(let s=0;s<E.length;s++)I=(I<<5)-I+E.charCodeAt(s),I|=0;return n.colors[Math.abs(I)%n.colors.length]}n.selectColor=r;function n(E){let I,s=null,m,T;function M(...C){if(!M.enabled)return;let y=M,R=Number(new Date),c=R-(I||R);y.diff=c,y.prev=I,y.curr=R,I=R,C[0]=n.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let v=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(A,f)=>{if(A==="%%")return"%";v++;let O=n.formatters[f];if(typeof O=="function"){let P=C[v];A=O.call(y,P),C.splice(v,1),v--}return A}),n.formatArgs.call(y,C),(y.log||n.log).apply(y,C)}return M.namespace=E,M.useColors=n.useColors(),M.color=n.selectColor(E),M.extend=u,M.destroy=n.destroy,Object.defineProperty(M,"enabled",{enumerable:!0,configurable:!1,get:()=>s!==null?s:(m!==n.namespaces&&(m=n.namespaces,T=n.enabled(E)),T),set:C=>{s=C}}),typeof n.init=="function"&&n.init(M),M}function u(E,I){let s=n(this.namespace+(typeof I=="undefined"?":":I)+E);return s.log=this.log,s}function o(E){n.save(E),n.namespaces=E,n.names=[],n.skips=[];let I,s=(typeof E=="string"?E:"").split(/[\s,]+/),m=s.length;for(I=0;I<m;I++)!s[I]||(E=s[I].replace(/\*/g,".*?"),E[0]==="-"?n.skips.push(new RegExp("^"+E.slice(1)+"$")):n.names.push(new RegExp("^"+E+"$")))}function g(){let E=[...n.names.map(l),...n.skips.map(l).map(I=>"-"+I)].join(",");return n.enable(""),E}function S(E){if(E[E.length-1]==="*")return!0;let I,s;for(I=0,s=n.skips.length;I<s;I++)if(n.skips[I].test(E))return!1;for(I=0,s=n.names.length;I<s;I++)if(n.names[I].test(E))return!0;return!1}function l(E){return E.toString().substring(2,E.toString().length-2).replace(/\.\*\?$/,"*")}function d(E){return E instanceof Error?E.stack||E.message:E}function b(){}return n.enable(n.load()),n}Hc.exports=K0});var kc=We((Et,Oi)=>{oe();Et.formatArgs=Y0;Et.save=q0;Et.load=X0;Et.useColors=Z0;Et.storage=$0();Et.destroy=(()=>{let i=!1;return()=>{i||(i=!0)}})();Et.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Z0(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Y0(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+Oi.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;i.splice(1,0,r,"color: inherit");let n=0,u=0;i[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(u=n))}),i.splice(u,0,r)}Et.log=console.debug||console.log||(()=>{});function q0(i){try{i?Et.storage.setItem("debug",i):Et.storage.removeItem("debug")}catch(r){}}function X0(){let i;try{i=Et.storage.getItem("debug")}catch(r){}return!i&&typeof process!="undefined"&&"env"in process&&(i=ge.DEBUG),i}function $0(){try{return localStorage}catch(i){}}Oi.exports=Wc()(Et);var{formatters:ey}=Oi.exports;ey.j=function(i){try{return JSON.stringify(i)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}});var zc=We((br,mo)=>{oe();(function(i,r){typeof br=="object"&&typeof mo=="object"?mo.exports=r():typeof define=="function"&&define.amd?define([],r):typeof br=="object"?br.bowser=r():i.bowser=r()})(br,function(){return function(i){var r={};function n(u){if(r[u])return r[u].exports;var o=r[u]={i:u,l:!1,exports:{}};return i[u].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=i,n.c=r,n.d=function(u,o,g){n.o(u,o)||Object.defineProperty(u,o,{enumerable:!0,get:g})},n.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},n.t=function(u,o){if(1&o&&(u=n(u)),8&o||4&o&&typeof u=="object"&&u&&u.__esModule)return u;var g=Object.create(null);if(n.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:u}),2&o&&typeof u!="string")for(var S in u)n.d(g,S,function(l){return u[l]}.bind(null,S));return g},n.n=function(u){var o=u&&u.__esModule?function(){return u.default}:function(){return u};return n.d(o,"a",o),o},n.o=function(u,o){return Object.prototype.hasOwnProperty.call(u,o)},n.p="",n(n.s=90)}({17:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u=n(18),o=function(){function g(){}return g.getFirstMatch=function(S,l){var d=l.match(S);return d&&d.length>0&&d[1]||""},g.getSecondMatch=function(S,l){var d=l.match(S);return d&&d.length>1&&d[2]||""},g.matchAndReturnConst=function(S,l,d){if(S.test(l))return d},g.getWindowsVersionName=function(S){switch(S){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},g.getMacOSVersionName=function(S){var l=S.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(l.push(0),l[0]===10)switch(l[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},g.getAndroidVersionName=function(S){var l=S.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(l.push(0),!(l[0]===1&&l[1]<5))return l[0]===1&&l[1]<6?"Cupcake":l[0]===1&&l[1]>=6?"Donut":l[0]===2&&l[1]<2?"Eclair":l[0]===2&&l[1]===2?"Froyo":l[0]===2&&l[1]>2?"Gingerbread":l[0]===3?"Honeycomb":l[0]===4&&l[1]<1?"Ice Cream Sandwich":l[0]===4&&l[1]<4?"Jelly Bean":l[0]===4&&l[1]>=4?"KitKat":l[0]===5?"Lollipop":l[0]===6?"Marshmallow":l[0]===7?"Nougat":l[0]===8?"Oreo":l[0]===9?"Pie":void 0},g.getVersionPrecision=function(S){return S.split(".").length},g.compareVersions=function(S,l,d){d===void 0&&(d=!1);var b=g.getVersionPrecision(S),E=g.getVersionPrecision(l),I=Math.max(b,E),s=0,m=g.map([S,l],function(T){var M=I-g.getVersionPrecision(T),C=T+new Array(M+1).join(".0");return g.map(C.split("."),function(y){return new Array(20-y.length).join("0")+y}).reverse()});for(d&&(s=I-Math.min(b,E)),I-=1;I>=s;){if(m[0][I]>m[1][I])return 1;if(m[0][I]===m[1][I]){if(I===s)return 0;I-=1}else if(m[0][I]<m[1][I])return-1}},g.map=function(S,l){var d,b=[];if(Array.prototype.map)return Array.prototype.map.call(S,l);for(d=0;d<S.length;d+=1)b.push(l(S[d]));return b},g.find=function(S,l){var d,b;if(Array.prototype.find)return Array.prototype.find.call(S,l);for(d=0,b=S.length;d<b;d+=1){var E=S[d];if(l(E,d))return E}},g.assign=function(S){for(var l,d,b=S,E=arguments.length,I=new Array(E>1?E-1:0),s=1;s<E;s++)I[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[S].concat(I));var m=function(){var T=I[l];typeof T=="object"&&T!==null&&Object.keys(T).forEach(function(M){b[M]=T[M]})};for(l=0,d=I.length;l<d;l+=1)m();return S},g.getBrowserAlias=function(S){return u.BROWSER_ALIASES_MAP[S]},g.getBrowserTypeByAlias=function(S){return u.BROWSER_MAP[S]||""},g}();r.default=o,i.exports=r.default},18:function(i,r,n){"use strict";r.__esModule=!0,r.ENGINE_MAP=r.OS_MAP=r.PLATFORMS_MAP=r.BROWSER_MAP=r.BROWSER_ALIASES_MAP=void 0,r.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},r.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},r.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},r.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(91))&&u.__esModule?u:{default:u},g=n(18);function S(d,b){for(var E=0;E<b.length;E++){var I=b[E];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(d,I.key,I)}}var l=function(){function d(){}var b,E,I;return d.getParser=function(s,m){if(m===void 0&&(m=!1),typeof s!="string")throw new Error("UserAgent should be a string");return new o.default(s,m)},d.parse=function(s){return new o.default(s).getResult()},b=d,I=[{key:"BROWSER_MAP",get:function(){return g.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return g.ENGINE_MAP}},{key:"OS_MAP",get:function(){return g.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return g.PLATFORMS_MAP}}],(E=null)&&S(b.prototype,E),I&&S(b,I),d}();r.default=l,i.exports=r.default},91:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u=d(n(92)),o=d(n(93)),g=d(n(94)),S=d(n(95)),l=d(n(17));function d(E){return E&&E.__esModule?E:{default:E}}var b=function(){function E(s,m){if(m===void 0&&(m=!1),s==null||s==="")throw new Error("UserAgent parameter can't be empty");this._ua=s,this.parsedResult={},m!==!0&&this.parse()}var I=E.prototype;return I.getUA=function(){return this._ua},I.test=function(s){return s.test(this._ua)},I.parseBrowser=function(){var s=this;this.parsedResult.browser={};var m=l.default.find(u.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(M){return s.test(M)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.browser=m.describe(this.getUA())),this.parsedResult.browser},I.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},I.getBrowserName=function(s){return s?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},I.getBrowserVersion=function(){return this.getBrowser().version},I.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},I.parseOS=function(){var s=this;this.parsedResult.os={};var m=l.default.find(o.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(M){return s.test(M)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.os=m.describe(this.getUA())),this.parsedResult.os},I.getOSName=function(s){var m=this.getOS().name;return s?String(m).toLowerCase()||"":m||""},I.getOSVersion=function(){return this.getOS().version},I.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},I.getPlatformType=function(s){s===void 0&&(s=!1);var m=this.getPlatform().type;return s?String(m).toLowerCase()||"":m||""},I.parsePlatform=function(){var s=this;this.parsedResult.platform={};var m=l.default.find(g.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(M){return s.test(M)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.platform=m.describe(this.getUA())),this.parsedResult.platform},I.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},I.getEngineName=function(s){return s?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},I.parseEngine=function(){var s=this;this.parsedResult.engine={};var m=l.default.find(S.default,function(T){if(typeof T.test=="function")return T.test(s);if(T.test instanceof Array)return T.test.some(function(M){return s.test(M)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.engine=m.describe(this.getUA())),this.parsedResult.engine},I.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},I.getResult=function(){return l.default.assign({},this.parsedResult)},I.satisfies=function(s){var m=this,T={},M=0,C={},y=0;if(Object.keys(s).forEach(function(P){var L=s[P];typeof L=="string"?(C[P]=L,y+=1):typeof L=="object"&&(T[P]=L,M+=1)}),M>0){var R=Object.keys(T),c=l.default.find(R,function(P){return m.isOS(P)});if(c){var v=this.satisfies(T[c]);if(v!==void 0)return v}var h=l.default.find(R,function(P){return m.isPlatform(P)});if(h){var A=this.satisfies(T[h]);if(A!==void 0)return A}}if(y>0){var f=Object.keys(C),O=l.default.find(f,function(P){return m.isBrowser(P,!0)});if(O!==void 0)return this.compareVersion(C[O])}},I.isBrowser=function(s,m){m===void 0&&(m=!1);var T=this.getBrowserName().toLowerCase(),M=s.toLowerCase(),C=l.default.getBrowserTypeByAlias(M);return m&&C&&(M=C.toLowerCase()),M===T},I.compareVersion=function(s){var m=[0],T=s,M=!1,C=this.getBrowserVersion();if(typeof C=="string")return s[0]===">"||s[0]==="<"?(T=s.substr(1),s[1]==="="?(M=!0,T=s.substr(2)):m=[],s[0]===">"?m.push(1):m.push(-1)):s[0]==="="?T=s.substr(1):s[0]==="~"&&(M=!0,T=s.substr(1)),m.indexOf(l.default.compareVersions(C,T,M))>-1},I.isOS=function(s){return this.getOSName(!0)===String(s).toLowerCase()},I.isPlatform=function(s){return this.getPlatformType(!0)===String(s).toLowerCase()},I.isEngine=function(s){return this.getEngineName(!0)===String(s).toLowerCase()},I.is=function(s,m){return m===void 0&&(m=!1),this.isBrowser(s,m)||this.isOS(s)||this.isPlatform(s)},I.some=function(s){var m=this;return s===void 0&&(s=[]),s.some(function(T){return m.is(T)})},E}();r.default=b,i.exports=r.default},92:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},g=/version\/(\d+(\.?_?\d+)+)/i,S=[{test:[/googlebot/i],describe:function(l){var d={name:"Googlebot"},b=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/opera/i],describe:function(l){var d={name:"Opera"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/opr\/|opios/i],describe:function(l){var d={name:"Opera"},b=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/SamsungBrowser/i],describe:function(l){var d={name:"Samsung Internet for Android"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/Whale/i],describe:function(l){var d={name:"NAVER Whale Browser"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/MZBrowser/i],describe:function(l){var d={name:"MZ Browser"},b=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/focus/i],describe:function(l){var d={name:"Focus"},b=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/swing/i],describe:function(l){var d={name:"Swing"},b=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/coast/i],describe:function(l){var d={name:"Opera Coast"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(l){var d={name:"Opera Touch"},b=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/yabrowser/i],describe:function(l){var d={name:"Yandex Browser"},b=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/ucbrowser/i],describe:function(l){var d={name:"UC Browser"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/Maxthon|mxios/i],describe:function(l){var d={name:"Maxthon"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/epiphany/i],describe:function(l){var d={name:"Epiphany"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/puffin/i],describe:function(l){var d={name:"Puffin"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/sleipnir/i],describe:function(l){var d={name:"Sleipnir"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/k-meleon/i],describe:function(l){var d={name:"K-Meleon"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/micromessenger/i],describe:function(l){var d={name:"WeChat"},b=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/qqbrowser/i],describe:function(l){var d={name:/qqbrowserlite/i.test(l)?"QQ Browser Lite":"QQ Browser"},b=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/msie|trident/i],describe:function(l){var d={name:"Internet Explorer"},b=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/\sedg\//i],describe:function(l){var d={name:"Microsoft Edge"},b=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/edg([ea]|ios)/i],describe:function(l){var d={name:"Microsoft Edge"},b=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/vivaldi/i],describe:function(l){var d={name:"Vivaldi"},b=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/seamonkey/i],describe:function(l){var d={name:"SeaMonkey"},b=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/sailfish/i],describe:function(l){var d={name:"Sailfish"},b=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,l);return b&&(d.version=b),d}},{test:[/silk/i],describe:function(l){var d={name:"Amazon Silk"},b=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/phantom/i],describe:function(l){var d={name:"PhantomJS"},b=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/slimerjs/i],describe:function(l){var d={name:"SlimerJS"},b=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var d={name:"BlackBerry"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var d={name:"WebOS Browser"},b=o.default.getFirstMatch(g,l)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/bada/i],describe:function(l){var d={name:"Bada"},b=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/tizen/i],describe:function(l){var d={name:"Tizen"},b=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/qupzilla/i],describe:function(l){var d={name:"QupZilla"},b=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/firefox|iceweasel|fxios/i],describe:function(l){var d={name:"Firefox"},b=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/electron/i],describe:function(l){var d={name:"Electron"},b=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/MiuiBrowser/i],describe:function(l){var d={name:"Miui"},b=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/chromium/i],describe:function(l){var d={name:"Chromium"},b=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,l)||o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/chrome|crios|crmo/i],describe:function(l){var d={name:"Chrome"},b=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/GSA/i],describe:function(l){var d={name:"Google Search"},b=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:function(l){var d=!l.test(/like android/i),b=l.test(/android/i);return d&&b},describe:function(l){var d={name:"Android Browser"},b=o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/playstation 4/i],describe:function(l){var d={name:"PlayStation 4"},b=o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/safari|applewebkit/i],describe:function(l){var d={name:"Safari"},b=o.default.getFirstMatch(g,l);return b&&(d.version=b),d}},{test:[/.*/i],describe:function(l){var d=l.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(d,l),version:o.default.getSecondMatch(d,l)}}}];r.default=S,i.exports=r.default},93:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},g=n(18),S=[{test:[/Roku\/DVP/],describe:function(l){var d=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,l);return{name:g.OS_MAP.Roku,version:d}}},{test:[/windows phone/i],describe:function(l){var d=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,l);return{name:g.OS_MAP.WindowsPhone,version:d}}},{test:[/windows /i],describe:function(l){var d=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,l),b=o.default.getWindowsVersionName(d);return{name:g.OS_MAP.Windows,version:d,versionName:b}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(l){var d={name:g.OS_MAP.iOS},b=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,l);return b&&(d.version=b),d}},{test:[/macintosh/i],describe:function(l){var d=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,l).replace(/[_\s]/g,"."),b=o.default.getMacOSVersionName(d),E={name:g.OS_MAP.MacOS,version:d};return b&&(E.versionName=b),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(l){var d=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,l).replace(/[_\s]/g,".");return{name:g.OS_MAP.iOS,version:d}}},{test:function(l){var d=!l.test(/like android/i),b=l.test(/android/i);return d&&b},describe:function(l){var d=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,l),b=o.default.getAndroidVersionName(d),E={name:g.OS_MAP.Android,version:d};return b&&(E.versionName=b),E}},{test:[/(web|hpw)[o0]s/i],describe:function(l){var d=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,l),b={name:g.OS_MAP.WebOS};return d&&d.length&&(b.version=d),b}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(l){var d=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,l)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,l)||o.default.getFirstMatch(/\bbb(\d+)/i,l);return{name:g.OS_MAP.BlackBerry,version:d}}},{test:[/bada/i],describe:function(l){var d=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,l);return{name:g.OS_MAP.Bada,version:d}}},{test:[/tizen/i],describe:function(l){var d=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,l);return{name:g.OS_MAP.Tizen,version:d}}},{test:[/linux/i],describe:function(){return{name:g.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:g.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(l){var d=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,l);return{name:g.OS_MAP.PlayStation4,version:d}}}];r.default=S,i.exports=r.default},94:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},g=n(18),S=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(l){var d=o.default.getFirstMatch(/(can-l01)/i,l)&&"Nova",b={type:g.PLATFORMS_MAP.mobile,vendor:"Huawei"};return d&&(b.model=d),b}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:g.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:g.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:g.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:g.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:g.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:g.PLATFORMS_MAP.tablet}}},{test:function(l){var d=l.test(/ipod|iphone/i),b=l.test(/like (ipod|iphone)/i);return d&&!b},describe:function(l){var d=o.default.getFirstMatch(/(ipod|iphone)/i,l);return{type:g.PLATFORMS_MAP.mobile,vendor:"Apple",model:d}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:g.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:g.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName(!0)==="blackberry"},describe:function(){return{type:g.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(l){return l.getBrowserName(!0)==="bada"},describe:function(){return{type:g.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getBrowserName()==="windows phone"},describe:function(){return{type:g.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(l){var d=Number(String(l.getOSVersion()).split(".")[0]);return l.getOSName(!0)==="android"&&d>=3},describe:function(){return{type:g.PLATFORMS_MAP.tablet}}},{test:function(l){return l.getOSName(!0)==="android"},describe:function(){return{type:g.PLATFORMS_MAP.mobile}}},{test:function(l){return l.getOSName(!0)==="macos"},describe:function(){return{type:g.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(l){return l.getOSName(!0)==="windows"},describe:function(){return{type:g.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="linux"},describe:function(){return{type:g.PLATFORMS_MAP.desktop}}},{test:function(l){return l.getOSName(!0)==="playstation 4"},describe:function(){return{type:g.PLATFORMS_MAP.tv}}},{test:function(l){return l.getOSName(!0)==="roku"},describe:function(){return{type:g.PLATFORMS_MAP.tv}}}];r.default=S,i.exports=r.default},95:function(i,r,n){"use strict";r.__esModule=!0,r.default=void 0;var u,o=(u=n(17))&&u.__esModule?u:{default:u},g=n(18),S=[{test:function(l){return l.getBrowserName(!0)==="microsoft edge"},describe:function(l){if(/\sedg\//i.test(l))return{name:g.ENGINE_MAP.Blink};var d=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,l);return{name:g.ENGINE_MAP.EdgeHTML,version:d}}},{test:[/trident/i],describe:function(l){var d={name:g.ENGINE_MAP.Trident},b=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:function(l){return l.test(/presto/i)},describe:function(l){var d={name:g.ENGINE_MAP.Presto},b=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:function(l){var d=l.test(/gecko/i),b=l.test(/like gecko/i);return d&&!b},describe:function(l){var d={name:g.ENGINE_MAP.Gecko},b=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:g.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(l){var d={name:g.ENGINE_MAP.WebKit},b=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,l);return b&&(d.version=b),d}}];r.default=S,i.exports=r.default}})})});var Rl=We((Or,Yn)=>{oe();var ty=200,_o="__lodash_hash_undefined__",wi=1,rl=2,il=9007199254740991,Si="[object Arguments]",Oo="[object Array]",ny="[object AsyncFunction]",al="[object Boolean]",ol="[object Date]",sl="[object Error]",ul="[object Function]",ry="[object GeneratorFunction]",Ii="[object Map]",cl="[object Number]",iy="[object Null]",Zn="[object Object]",jc="[object Promise]",ay="[object Proxy]",ll="[object RegExp]",Ri="[object Set]",fl="[object String]",oy="[object Symbol]",sy="[object Undefined]",Eo="[object WeakMap]",dl="[object ArrayBuffer]",Ti="[object DataView]",uy="[object Float32Array]",cy="[object Float64Array]",ly="[object Int8Array]",fy="[object Int16Array]",dy="[object Int32Array]",hy="[object Uint8Array]",Ay="[object Uint8ClampedArray]",py="[object Uint16Array]",gy="[object Uint32Array]",vy=/[\\^$.*+?()[\]{}|]/g,my=/^\[object .+?Constructor\]$/,yy=/^(?:0|[1-9]\d*)$/,Ve={};Ve[uy]=Ve[cy]=Ve[ly]=Ve[fy]=Ve[dy]=Ve[hy]=Ve[Ay]=Ve[py]=Ve[gy]=!0;Ve[Si]=Ve[Oo]=Ve[dl]=Ve[al]=Ve[Ti]=Ve[ol]=Ve[sl]=Ve[ul]=Ve[Ii]=Ve[cl]=Ve[Zn]=Ve[ll]=Ve[Ri]=Ve[fl]=Ve[Eo]=!1;var hl=typeof global=="object"&&global&&global.Object===Object&&global,by=typeof self=="object"&&self&&self.Object===Object&&self,Xt=hl||by||Function("return this")(),Al=typeof Or=="object"&&Or&&!Or.nodeType&&Or,Jc=Al&&typeof Yn=="object"&&Yn&&!Yn.nodeType&&Yn,pl=Jc&&Jc.exports===Al,yo=pl&&hl.process,Kc=function(){try{return yo&&yo.binding&&yo.binding("util")}catch(i){}}(),Zc=Kc&&Kc.isTypedArray;function Cy(i,r){for(var n=-1,u=i==null?0:i.length,o=0,g=[];++n<u;){var S=i[n];r(S,n,i)&&(g[o++]=S)}return g}function Oy(i,r){for(var n=-1,u=r.length,o=i.length;++n<u;)i[o+n]=r[n];return i}function Ey(i,r){for(var n=-1,u=i==null?0:i.length;++n<u;)if(r(i[n],n,i))return!0;return!1}function Sy(i,r){for(var n=-1,u=Array(i);++n<i;)u[n]=r(n);return u}function Iy(i){return function(r){return i(r)}}function Ry(i,r){return i.has(r)}function Ty(i,r){return i==null?void 0:i[r]}function My(i){var r=-1,n=Array(i.size);return i.forEach(function(u,o){n[++r]=[o,u]}),n}function _y(i,r){return function(n){return i(r(n))}}function Py(i){var r=-1,n=Array(i.size);return i.forEach(function(u){n[++r]=u}),n}var wy=Array.prototype,xy=Function.prototype,xi=Object.prototype,bo=Xt["__core-js_shared__"],gl=xy.toString,kt=xi.hasOwnProperty,Yc=function(){var i=/[^.]+$/.exec(bo&&bo.keys&&bo.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),vl=xi.toString,Ly=RegExp("^"+gl.call(kt).replace(vy,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qc=pl?Xt.Buffer:void 0,Mi=Xt.Symbol,Xc=Xt.Uint8Array,ml=xi.propertyIsEnumerable,By=wy.splice,In=Mi?Mi.toStringTag:void 0,$c=Object.getOwnPropertySymbols,Dy=qc?qc.isBuffer:void 0,Ny=_y(Object.keys,Object),So=qn(Xt,"DataView"),Er=qn(Xt,"Map"),Io=qn(Xt,"Promise"),Ro=qn(Xt,"Set"),To=qn(Xt,"WeakMap"),Sr=qn(Object,"create"),Fy=Mn(So),Uy=Mn(Er),Gy=Mn(Io),Hy=Mn(Ro),Wy=Mn(To),el=Mi?Mi.prototype:void 0,Co=el?el.valueOf:void 0;function Rn(i){var r=-1,n=i==null?0:i.length;for(this.clear();++r<n;){var u=i[r];this.set(u[0],u[1])}}function ky(){this.__data__=Sr?Sr(null):{},this.size=0}function Vy(i){var r=this.has(i)&&delete this.__data__[i];return this.size-=r?1:0,r}function Qy(i){var r=this.__data__;if(Sr){var n=r[i];return n===_o?void 0:n}return kt.call(r,i)?r[i]:void 0}function zy(i){var r=this.__data__;return Sr?r[i]!==void 0:kt.call(r,i)}function jy(i,r){var n=this.__data__;return this.size+=this.has(i)?0:1,n[i]=Sr&&r===void 0?_o:r,this}Rn.prototype.clear=ky;Rn.prototype.delete=Vy;Rn.prototype.get=Qy;Rn.prototype.has=zy;Rn.prototype.set=jy;function $t(i){var r=-1,n=i==null?0:i.length;for(this.clear();++r<n;){var u=i[r];this.set(u[0],u[1])}}function Jy(){this.__data__=[],this.size=0}function Ky(i){var r=this.__data__,n=Li(r,i);if(n<0)return!1;var u=r.length-1;return n==u?r.pop():By.call(r,n,1),--this.size,!0}function Zy(i){var r=this.__data__,n=Li(r,i);return n<0?void 0:r[n][1]}function Yy(i){return Li(this.__data__,i)>-1}function qy(i,r){var n=this.__data__,u=Li(n,i);return u<0?(++this.size,n.push([i,r])):n[u][1]=r,this}$t.prototype.clear=Jy;$t.prototype.delete=Ky;$t.prototype.get=Zy;$t.prototype.has=Yy;$t.prototype.set=qy;function Tn(i){var r=-1,n=i==null?0:i.length;for(this.clear();++r<n;){var u=i[r];this.set(u[0],u[1])}}function Xy(){this.size=0,this.__data__={hash:new Rn,map:new(Er||$t),string:new Rn}}function $y(i){var r=Bi(this,i).delete(i);return this.size-=r?1:0,r}function eb(i){return Bi(this,i).get(i)}function tb(i){return Bi(this,i).has(i)}function nb(i,r){var n=Bi(this,i),u=n.size;return n.set(i,r),this.size+=n.size==u?0:1,this}Tn.prototype.clear=Xy;Tn.prototype.delete=$y;Tn.prototype.get=eb;Tn.prototype.has=tb;Tn.prototype.set=nb;function _i(i){var r=-1,n=i==null?0:i.length;for(this.__data__=new Tn;++r<n;)this.add(i[r])}function rb(i){return this.__data__.set(i,_o),this}function ib(i){return this.__data__.has(i)}_i.prototype.add=_i.prototype.push=rb;_i.prototype.has=ib;function dn(i){var r=this.__data__=new $t(i);this.size=r.size}function ab(){this.__data__=new $t,this.size=0}function ob(i){var r=this.__data__,n=r.delete(i);return this.size=r.size,n}function sb(i){return this.__data__.get(i)}function ub(i){return this.__data__.has(i)}function cb(i,r){var n=this.__data__;if(n instanceof $t){var u=n.__data__;if(!Er||u.length<ty-1)return u.push([i,r]),this.size=++n.size,this;n=this.__data__=new Tn(u)}return n.set(i,r),this.size=n.size,this}dn.prototype.clear=ab;dn.prototype.delete=ob;dn.prototype.get=sb;dn.prototype.has=ub;dn.prototype.set=cb;function lb(i,r){var n=Pi(i),u=!n&&Ib(i),o=!n&&!u&&Mo(i),g=!n&&!u&&!o&&Il(i),S=n||u||o||g,l=S?Sy(i.length,String):[],d=l.length;for(var b in i)(r||kt.call(i,b))&&!(S&&(b=="length"||o&&(b=="offset"||b=="parent")||g&&(b=="buffer"||b=="byteLength"||b=="byteOffset")||bb(b,d)))&&l.push(b);return l}function Li(i,r){for(var n=i.length;n--;)if(Cl(i[n][0],r))return n;return-1}function fb(i,r,n){var u=r(i);return Pi(i)?u:Oy(u,n(i))}function Rr(i){return i==null?i===void 0?sy:iy:In&&In in Object(i)?mb(i):Sb(i)}function tl(i){return Ir(i)&&Rr(i)==Si}function yl(i,r,n,u,o){return i===r?!0:i==null||r==null||!Ir(i)&&!Ir(r)?i!==i&&r!==r:db(i,r,n,u,yl,o)}function db(i,r,n,u,o,g){var S=Pi(i),l=Pi(r),d=S?Oo:fn(i),b=l?Oo:fn(r);d=d==Si?Zn:d,b=b==Si?Zn:b;var E=d==Zn,I=b==Zn,s=d==b;if(s&&Mo(i)){if(!Mo(r))return!1;S=!0,E=!1}if(s&&!E)return g||(g=new dn),S||Il(i)?bl(i,r,n,u,o,g):gb(i,r,d,n,u,o,g);if(!(n&wi)){var m=E&&kt.call(i,"__wrapped__"),T=I&&kt.call(r,"__wrapped__");if(m||T){var M=m?i.value():i,C=T?r.value():r;return g||(g=new dn),o(M,C,n,u,g)}}return s?(g||(g=new dn),vb(i,r,n,u,o,g)):!1}function hb(i){if(!Sl(i)||Ob(i))return!1;var r=Ol(i)?Ly:my;return r.test(Mn(i))}function Ab(i){return Ir(i)&&El(i.length)&&!!Ve[Rr(i)]}function pb(i){if(!Eb(i))return Ny(i);var r=[];for(var n in Object(i))kt.call(i,n)&&n!="constructor"&&r.push(n);return r}function bl(i,r,n,u,o,g){var S=n&wi,l=i.length,d=r.length;if(l!=d&&!(S&&d>l))return!1;var b=g.get(i);if(b&&g.get(r))return b==r;var E=-1,I=!0,s=n&rl?new _i:void 0;for(g.set(i,r),g.set(r,i);++E<l;){var m=i[E],T=r[E];if(u)var M=S?u(T,m,E,r,i,g):u(m,T,E,i,r,g);if(M!==void 0){if(M)continue;I=!1;break}if(s){if(!Ey(r,function(C,y){if(!Ry(s,y)&&(m===C||o(m,C,n,u,g)))return s.push(y)})){I=!1;break}}else if(!(m===T||o(m,T,n,u,g))){I=!1;break}}return g.delete(i),g.delete(r),I}function gb(i,r,n,u,o,g,S){switch(n){case Ti:if(i.byteLength!=r.byteLength||i.byteOffset!=r.byteOffset)return!1;i=i.buffer,r=r.buffer;case dl:return!(i.byteLength!=r.byteLength||!g(new Xc(i),new Xc(r)));case al:case ol:case cl:return Cl(+i,+r);case sl:return i.name==r.name&&i.message==r.message;case ll:case fl:return i==r+"";case Ii:var l=My;case Ri:var d=u&wi;if(l||(l=Py),i.size!=r.size&&!d)return!1;var b=S.get(i);if(b)return b==r;u|=rl,S.set(i,r);var E=bl(l(i),l(r),u,o,g,S);return S.delete(i),E;case oy:if(Co)return Co.call(i)==Co.call(r)}return!1}function vb(i,r,n,u,o,g){var S=n&wi,l=nl(i),d=l.length,b=nl(r),E=b.length;if(d!=E&&!S)return!1;for(var I=d;I--;){var s=l[I];if(!(S?s in r:kt.call(r,s)))return!1}var m=g.get(i);if(m&&g.get(r))return m==r;var T=!0;g.set(i,r),g.set(r,i);for(var M=S;++I<d;){s=l[I];var C=i[s],y=r[s];if(u)var R=S?u(y,C,s,r,i,g):u(C,y,s,i,r,g);if(!(R===void 0?C===y||o(C,y,n,u,g):R)){T=!1;break}M||(M=s=="constructor")}if(T&&!M){var c=i.constructor,v=r.constructor;c!=v&&"constructor"in i&&"constructor"in r&&!(typeof c=="function"&&c instanceof c&&typeof v=="function"&&v instanceof v)&&(T=!1)}return g.delete(i),g.delete(r),T}function nl(i){return fb(i,Mb,yb)}function Bi(i,r){var n=i.__data__;return Cb(r)?n[typeof r=="string"?"string":"hash"]:n.map}function qn(i,r){var n=Ty(i,r);return hb(n)?n:void 0}function mb(i){var r=kt.call(i,In),n=i[In];try{i[In]=void 0;var u=!0}catch(g){}var o=vl.call(i);return u&&(r?i[In]=n:delete i[In]),o}var yb=$c?function(i){return i==null?[]:(i=Object(i),Cy($c(i),function(r){return ml.call(i,r)}))}:_b,fn=Rr;(So&&fn(new So(new ArrayBuffer(1)))!=Ti||Er&&fn(new Er)!=Ii||Io&&fn(Io.resolve())!=jc||Ro&&fn(new Ro)!=Ri||To&&fn(new To)!=Eo)&&(fn=function(i){var r=Rr(i),n=r==Zn?i.constructor:void 0,u=n?Mn(n):"";if(u)switch(u){case Fy:return Ti;case Uy:return Ii;case Gy:return jc;case Hy:return Ri;case Wy:return Eo}return r});function bb(i,r){return r=r==null?il:r,!!r&&(typeof i=="number"||yy.test(i))&&i>-1&&i%1==0&&i<r}function Cb(i){var r=typeof i;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?i!=="__proto__":i===null}function Ob(i){return!!Yc&&Yc in i}function Eb(i){var r=i&&i.constructor,n=typeof r=="function"&&r.prototype||xi;return i===n}function Sb(i){return vl.call(i)}function Mn(i){if(i!=null){try{return gl.call(i)}catch(r){}try{return i+""}catch(r){}}return""}function Cl(i,r){return i===r||i!==i&&r!==r}var Ib=tl(function(){return arguments}())?tl:function(i){return Ir(i)&&kt.call(i,"callee")&&!ml.call(i,"callee")},Pi=Array.isArray;function Rb(i){return i!=null&&El(i.length)&&!Ol(i)}var Mo=Dy||Pb;function Tb(i,r){return yl(i,r)}function Ol(i){if(!Sl(i))return!1;var r=Rr(i);return r==ul||r==ry||r==ny||r==ay}function El(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=il}function Sl(i){var r=typeof i;return i!=null&&(r=="object"||r=="function")}function Ir(i){return i!=null&&typeof i=="object"}var Il=Zc?Iy(Zc):Ab;function Mb(i){return Rb(i)?lb(i):pb(i)}function _b(){return[]}function Pb(){return!1}Yn.exports=Tb});var Ml=We((Xn,Tr)=>{oe();(function(){var i,r="4.17.21",n=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",g="Invalid `variable` option passed into `_.template`",S="__lodash_hash_undefined__",l=500,d="__lodash_placeholder__",b=1,E=2,I=4,s=1,m=2,T=1,M=2,C=4,y=8,R=16,c=32,v=64,h=128,A=256,f=512,O=30,P="...",L=800,V=16,H=1,D=2,_=3,x=1/0,k=9007199254740991,W=17976931348623157e292,K=0/0,$=4294967295,Y=$-1,G=$>>>1,N=[["ary",h],["bind",T],["bindKey",M],["curry",y],["curryRight",R],["flip",f],["partial",c],["partialRight",v],["rearg",A]],F="[object Arguments]",j="[object Array]",z="[object AsyncFunction]",ee="[object Boolean]",ce="[object Date]",ve="[object DOMException]",pe="[object Error]",Se="[object Function]",Le="[object GeneratorFunction]",fe="[object Map]",xe="[object Number]",tt="[object Null]",Ue="[object Object]",Qe="[object Promise]",ft="[object Proxy]",X="[object RegExp]",re="[object Set]",ue="[object String]",he="[object Symbol]",Re="[object Undefined]",Xe="[object WeakMap]",hn="[object WeakSet]",nr="[object ArrayBuffer]",_n="[object DataView]",Vi="[object Float32Array]",Qi="[object Float64Array]",zi="[object Int8Array]",ji="[object Int16Array]",Ji="[object Int32Array]",Ki="[object Uint8Array]",Zi="[object Uint8ClampedArray]",Yi="[object Uint16Array]",qi="[object Uint32Array]",Rf=/\b__p \+= '';/g,Tf=/\b(__p \+=) '' \+/g,Mf=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Qo=/&(?:amp|lt|gt|quot|#39);/g,zo=/[&<>"']/g,_f=RegExp(Qo.source),Pf=RegExp(zo.source),wf=/<%-([\s\S]+?)%>/g,xf=/<%([\s\S]+?)%>/g,jo=/<%=([\s\S]+?)%>/g,Lf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bf=/^\w*$/,Df=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Xi=/[\\^$.*+?()[\]{}|]/g,Nf=RegExp(Xi.source),$i=/^\s+/,Ff=/\s/,Uf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gf=/\{\n\/\* \[wrapped with (.+)\] \*/,Hf=/,? & /,Wf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,kf=/[()=,{}\[\]\/\s]/,Vf=/\\(\\)?/g,Qf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Jo=/\w*$/,zf=/^[-+]0x[0-9a-f]+$/i,jf=/^0b[01]+$/i,Jf=/^\[object .+?Constructor\]$/,Kf=/^0o[0-7]+$/i,Zf=/^(?:0|[1-9]\d*)$/,Yf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pr=/($^)/,qf=/['\n\r\u2028\u2029\\]/g,wr="\\ud800-\\udfff",Xf="\\u0300-\\u036f",$f="\\ufe20-\\ufe2f",ed="\\u20d0-\\u20ff",Ko=Xf+$f+ed,Zo="\\u2700-\\u27bf",Yo="a-z\\xdf-\\xf6\\xf8-\\xff",td="\\xac\\xb1\\xd7\\xf7",nd="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rd="\\u2000-\\u206f",id=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",qo="A-Z\\xc0-\\xd6\\xd8-\\xde",Xo="\\ufe0e\\ufe0f",$o=td+nd+rd+id,ea="['\u2019]",ad="["+wr+"]",es="["+$o+"]",xr="["+Ko+"]",ts="\\d+",od="["+Zo+"]",ns="["+Yo+"]",rs="[^"+wr+$o+ts+Zo+Yo+qo+"]",ta="\\ud83c[\\udffb-\\udfff]",sd="(?:"+xr+"|"+ta+")",is="[^"+wr+"]",na="(?:\\ud83c[\\udde6-\\uddff]){2}",ra="[\\ud800-\\udbff][\\udc00-\\udfff]",Pn="["+qo+"]",as="\\u200d",os="(?:"+ns+"|"+rs+")",ud="(?:"+Pn+"|"+rs+")",ss="(?:"+ea+"(?:d|ll|m|re|s|t|ve))?",us="(?:"+ea+"(?:D|LL|M|RE|S|T|VE))?",cs=sd+"?",ls="["+Xo+"]?",cd="(?:"+as+"(?:"+[is,na,ra].join("|")+")"+ls+cs+")*",ld="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",fd="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",fs=ls+cs+cd,dd="(?:"+[od,na,ra].join("|")+")"+fs,hd="(?:"+[is+xr+"?",xr,na,ra,ad].join("|")+")",Ad=RegExp(ea,"g"),pd=RegExp(xr,"g"),ia=RegExp(ta+"(?="+ta+")|"+hd+fs,"g"),gd=RegExp([Pn+"?"+ns+"+"+ss+"(?="+[es,Pn,"$"].join("|")+")",ud+"+"+us+"(?="+[es,Pn+os,"$"].join("|")+")",Pn+"?"+os+"+"+ss,Pn+"+"+us,fd,ld,ts,dd].join("|"),"g"),vd=RegExp("["+as+wr+Ko+Xo+"]"),md=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,yd=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],bd=-1,ke={};ke[Vi]=ke[Qi]=ke[zi]=ke[ji]=ke[Ji]=ke[Ki]=ke[Zi]=ke[Yi]=ke[qi]=!0,ke[F]=ke[j]=ke[nr]=ke[ee]=ke[_n]=ke[ce]=ke[pe]=ke[Se]=ke[fe]=ke[xe]=ke[Ue]=ke[X]=ke[re]=ke[ue]=ke[Xe]=!1;var He={};He[F]=He[j]=He[nr]=He[_n]=He[ee]=He[ce]=He[Vi]=He[Qi]=He[zi]=He[ji]=He[Ji]=He[fe]=He[xe]=He[Ue]=He[X]=He[re]=He[ue]=He[he]=He[Ki]=He[Zi]=He[Yi]=He[qi]=!0,He[pe]=He[Se]=He[Xe]=!1;var Cd={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Od={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ed={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Sd={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Id=parseFloat,Rd=parseInt,ds=typeof global=="object"&&global&&global.Object===Object&&global,Td=typeof self=="object"&&self&&self.Object===Object&&self,nt=ds||Td||Function("return this")(),aa=typeof Xn=="object"&&Xn&&!Xn.nodeType&&Xn,An=aa&&typeof Tr=="object"&&Tr&&!Tr.nodeType&&Tr,hs=An&&An.exports===aa,oa=hs&&ds.process,St=function(){try{var Z=An&&An.require&&An.require("util").types;return Z||oa&&oa.binding&&oa.binding("util")}catch(ne){}}(),As=St&&St.isArrayBuffer,ps=St&&St.isDate,gs=St&&St.isMap,vs=St&&St.isRegExp,ms=St&&St.isSet,ys=St&&St.isTypedArray;function vt(Z,ne,te){switch(te.length){case 0:return Z.call(ne);case 1:return Z.call(ne,te[0]);case 2:return Z.call(ne,te[0],te[1]);case 3:return Z.call(ne,te[0],te[1],te[2])}return Z.apply(ne,te)}function Md(Z,ne,te,de){for(var Oe=-1,Be=Z==null?0:Z.length;++Oe<Be;){var $e=Z[Oe];ne(de,$e,te($e),Z)}return de}function It(Z,ne){for(var te=-1,de=Z==null?0:Z.length;++te<de&&ne(Z[te],te,Z)!==!1;);return Z}function _d(Z,ne){for(var te=Z==null?0:Z.length;te--&&ne(Z[te],te,Z)!==!1;);return Z}function bs(Z,ne){for(var te=-1,de=Z==null?0:Z.length;++te<de;)if(!ne(Z[te],te,Z))return!1;return!0}function en(Z,ne){for(var te=-1,de=Z==null?0:Z.length,Oe=0,Be=[];++te<de;){var $e=Z[te];ne($e,te,Z)&&(Be[Oe++]=$e)}return Be}function Lr(Z,ne){var te=Z==null?0:Z.length;return!!te&&wn(Z,ne,0)>-1}function sa(Z,ne,te){for(var de=-1,Oe=Z==null?0:Z.length;++de<Oe;)if(te(ne,Z[de]))return!0;return!1}function ze(Z,ne){for(var te=-1,de=Z==null?0:Z.length,Oe=Array(de);++te<de;)Oe[te]=ne(Z[te],te,Z);return Oe}function tn(Z,ne){for(var te=-1,de=ne.length,Oe=Z.length;++te<de;)Z[Oe+te]=ne[te];return Z}function ua(Z,ne,te,de){var Oe=-1,Be=Z==null?0:Z.length;for(de&&Be&&(te=Z[++Oe]);++Oe<Be;)te=ne(te,Z[Oe],Oe,Z);return te}function Pd(Z,ne,te,de){var Oe=Z==null?0:Z.length;for(de&&Oe&&(te=Z[--Oe]);Oe--;)te=ne(te,Z[Oe],Oe,Z);return te}function ca(Z,ne){for(var te=-1,de=Z==null?0:Z.length;++te<de;)if(ne(Z[te],te,Z))return!0;return!1}var wd=la("length");function xd(Z){return Z.split("")}function Ld(Z){return Z.match(Wf)||[]}function Cs(Z,ne,te){var de;return te(Z,function(Oe,Be,$e){if(ne(Oe,Be,$e))return de=Be,!1}),de}function Br(Z,ne,te,de){for(var Oe=Z.length,Be=te+(de?1:-1);de?Be--:++Be<Oe;)if(ne(Z[Be],Be,Z))return Be;return-1}function wn(Z,ne,te){return ne===ne?zd(Z,ne,te):Br(Z,Os,te)}function Bd(Z,ne,te,de){for(var Oe=te-1,Be=Z.length;++Oe<Be;)if(de(Z[Oe],ne))return Oe;return-1}function Os(Z){return Z!==Z}function Es(Z,ne){var te=Z==null?0:Z.length;return te?da(Z,ne)/te:K}function la(Z){return function(ne){return ne==null?i:ne[Z]}}function fa(Z){return function(ne){return Z==null?i:Z[ne]}}function Ss(Z,ne,te,de,Oe){return Oe(Z,function(Be,$e,Ge){te=de?(de=!1,Be):ne(te,Be,$e,Ge)}),te}function Dd(Z,ne){var te=Z.length;for(Z.sort(ne);te--;)Z[te]=Z[te].value;return Z}function da(Z,ne){for(var te,de=-1,Oe=Z.length;++de<Oe;){var Be=ne(Z[de]);Be!==i&&(te=te===i?Be:te+Be)}return te}function ha(Z,ne){for(var te=-1,de=Array(Z);++te<Z;)de[te]=ne(te);return de}function Nd(Z,ne){return ze(ne,function(te){return[te,Z[te]]})}function Is(Z){return Z&&Z.slice(0,_s(Z)+1).replace($i,"")}function mt(Z){return function(ne){return Z(ne)}}function Aa(Z,ne){return ze(ne,function(te){return Z[te]})}function rr(Z,ne){return Z.has(ne)}function Rs(Z,ne){for(var te=-1,de=Z.length;++te<de&&wn(ne,Z[te],0)>-1;);return te}function Ts(Z,ne){for(var te=Z.length;te--&&wn(ne,Z[te],0)>-1;);return te}function Fd(Z,ne){for(var te=Z.length,de=0;te--;)Z[te]===ne&&++de;return de}var Ud=fa(Cd),Gd=fa(Od);function Hd(Z){return"\\"+Sd[Z]}function Wd(Z,ne){return Z==null?i:Z[ne]}function xn(Z){return vd.test(Z)}function kd(Z){return md.test(Z)}function Vd(Z){for(var ne,te=[];!(ne=Z.next()).done;)te.push(ne.value);return te}function pa(Z){var ne=-1,te=Array(Z.size);return Z.forEach(function(de,Oe){te[++ne]=[Oe,de]}),te}function Ms(Z,ne){return function(te){return Z(ne(te))}}function nn(Z,ne){for(var te=-1,de=Z.length,Oe=0,Be=[];++te<de;){var $e=Z[te];($e===ne||$e===d)&&(Z[te]=d,Be[Oe++]=te)}return Be}function Dr(Z){var ne=-1,te=Array(Z.size);return Z.forEach(function(de){te[++ne]=de}),te}function Qd(Z){var ne=-1,te=Array(Z.size);return Z.forEach(function(de){te[++ne]=[de,de]}),te}function zd(Z,ne,te){for(var de=te-1,Oe=Z.length;++de<Oe;)if(Z[de]===ne)return de;return-1}function jd(Z,ne,te){for(var de=te+1;de--;)if(Z[de]===ne)return de;return de}function Ln(Z){return xn(Z)?Kd(Z):wd(Z)}function Lt(Z){return xn(Z)?Zd(Z):xd(Z)}function _s(Z){for(var ne=Z.length;ne--&&Ff.test(Z.charAt(ne)););return ne}var Jd=fa(Ed);function Kd(Z){for(var ne=ia.lastIndex=0;ia.test(Z);)++ne;return ne}function Zd(Z){return Z.match(ia)||[]}function Yd(Z){return Z.match(gd)||[]}var qd=function Z(ne){ne=ne==null?nt:rn.defaults(nt.Object(),ne,rn.pick(nt,yd));var te=ne.Array,de=ne.Date,Oe=ne.Error,Be=ne.Function,$e=ne.Math,Ge=ne.Object,ga=ne.RegExp,Xd=ne.String,Rt=ne.TypeError,Nr=te.prototype,$d=Be.prototype,Bn=Ge.prototype,Fr=ne["__core-js_shared__"],Ur=$d.toString,Fe=Bn.hasOwnProperty,eh=0,Ps=function(){var e=/[^.]+$/.exec(Fr&&Fr.keys&&Fr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Gr=Bn.toString,th=Ur.call(Ge),nh=nt._,rh=ga("^"+Ur.call(Fe).replace(Xi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hr=hs?ne.Buffer:i,an=ne.Symbol,Wr=ne.Uint8Array,ws=Hr?Hr.allocUnsafe:i,kr=Ms(Ge.getPrototypeOf,Ge),xs=Ge.create,Ls=Bn.propertyIsEnumerable,Vr=Nr.splice,Bs=an?an.isConcatSpreadable:i,ir=an?an.iterator:i,pn=an?an.toStringTag:i,Qr=function(){try{var e=bn(Ge,"defineProperty");return e({},"",{}),e}catch(t){}}(),ih=ne.clearTimeout!==nt.clearTimeout&&ne.clearTimeout,ah=de&&de.now!==nt.Date.now&&de.now,oh=ne.setTimeout!==nt.setTimeout&&ne.setTimeout,zr=$e.ceil,jr=$e.floor,va=Ge.getOwnPropertySymbols,sh=Hr?Hr.isBuffer:i,Ds=ne.isFinite,uh=Nr.join,ch=Ms(Ge.keys,Ge),et=$e.max,ot=$e.min,lh=de.now,fh=ne.parseInt,Ns=$e.random,dh=Nr.reverse,ma=bn(ne,"DataView"),ar=bn(ne,"Map"),ya=bn(ne,"Promise"),Dn=bn(ne,"Set"),or=bn(ne,"WeakMap"),sr=bn(Ge,"create"),Jr=or&&new or,Nn={},hh=Cn(ma),Ah=Cn(ar),ph=Cn(ya),gh=Cn(Dn),vh=Cn(or),Kr=an?an.prototype:i,ur=Kr?Kr.valueOf:i,Fs=Kr?Kr.toString:i;function B(e){if(Je(e)&&!Ee(e)&&!(e instanceof Pe)){if(e instanceof Tt)return e;if(Fe.call(e,"__wrapped__"))return Uu(e)}return new Tt(e)}var Fn=function(){function e(){}return function(t){if(!je(t))return{};if(xs)return xs(t);e.prototype=t;var a=new e;return e.prototype=i,a}}();function Zr(){}function Tt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}B.templateSettings={escape:wf,evaluate:xf,interpolate:jo,variable:"",imports:{_:B}},B.prototype=Zr.prototype,B.prototype.constructor=B,Tt.prototype=Fn(Zr.prototype),Tt.prototype.constructor=Tt;function Pe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$,this.__views__=[]}function mh(){var e=new Pe(this.__wrapped__);return e.__actions__=dt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=dt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=dt(this.__views__),e}function yh(){if(this.__filtered__){var e=new Pe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function bh(){var e=this.__wrapped__.value(),t=this.__dir__,a=Ee(e),p=t<0,w=a?e.length:0,U=xA(0,w,this.__views__),Q=U.start,J=U.end,q=J-Q,ie=p?J:Q-1,ae=this.__iteratees__,se=ae.length,le=0,Ae=ot(q,this.__takeCount__);if(!a||!p&&w==q&&Ae==q)return su(e,this.__actions__);var be=[];e:for(;q--&&le<Ae;){ie+=t;for(var Te=-1,Ce=e[ie];++Te<se;){var _e=ae[Te],we=_e.iteratee,Ct=_e.type,lt=we(Ce);if(Ct==D)Ce=lt;else if(!lt){if(Ct==H)continue e;break e}}be[le++]=Ce}return be}Pe.prototype=Fn(Zr.prototype),Pe.prototype.constructor=Pe;function gn(e){var t=-1,a=e==null?0:e.length;for(this.clear();++t<a;){var p=e[t];this.set(p[0],p[1])}}function Ch(){this.__data__=sr?sr(null):{},this.size=0}function Oh(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Eh(e){var t=this.__data__;if(sr){var a=t[e];return a===S?i:a}return Fe.call(t,e)?t[e]:i}function Sh(e){var t=this.__data__;return sr?t[e]!==i:Fe.call(t,e)}function Ih(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=sr&&t===i?S:t,this}gn.prototype.clear=Ch,gn.prototype.delete=Oh,gn.prototype.get=Eh,gn.prototype.has=Sh,gn.prototype.set=Ih;function Vt(e){var t=-1,a=e==null?0:e.length;for(this.clear();++t<a;){var p=e[t];this.set(p[0],p[1])}}function Rh(){this.__data__=[],this.size=0}function Th(e){var t=this.__data__,a=Yr(t,e);if(a<0)return!1;var p=t.length-1;return a==p?t.pop():Vr.call(t,a,1),--this.size,!0}function Mh(e){var t=this.__data__,a=Yr(t,e);return a<0?i:t[a][1]}function _h(e){return Yr(this.__data__,e)>-1}function Ph(e,t){var a=this.__data__,p=Yr(a,e);return p<0?(++this.size,a.push([e,t])):a[p][1]=t,this}Vt.prototype.clear=Rh,Vt.prototype.delete=Th,Vt.prototype.get=Mh,Vt.prototype.has=_h,Vt.prototype.set=Ph;function Qt(e){var t=-1,a=e==null?0:e.length;for(this.clear();++t<a;){var p=e[t];this.set(p[0],p[1])}}function wh(){this.size=0,this.__data__={hash:new gn,map:new(ar||Vt),string:new gn}}function xh(e){var t=ui(this,e).delete(e);return this.size-=t?1:0,t}function Lh(e){return ui(this,e).get(e)}function Bh(e){return ui(this,e).has(e)}function Dh(e,t){var a=ui(this,e),p=a.size;return a.set(e,t),this.size+=a.size==p?0:1,this}Qt.prototype.clear=wh,Qt.prototype.delete=xh,Qt.prototype.get=Lh,Qt.prototype.has=Bh,Qt.prototype.set=Dh;function vn(e){var t=-1,a=e==null?0:e.length;for(this.__data__=new Qt;++t<a;)this.add(e[t])}function Nh(e){return this.__data__.set(e,S),this}function Fh(e){return this.__data__.has(e)}vn.prototype.add=vn.prototype.push=Nh,vn.prototype.has=Fh;function Bt(e){var t=this.__data__=new Vt(e);this.size=t.size}function Uh(){this.__data__=new Vt,this.size=0}function Gh(e){var t=this.__data__,a=t.delete(e);return this.size=t.size,a}function Hh(e){return this.__data__.get(e)}function Wh(e){return this.__data__.has(e)}function kh(e,t){var a=this.__data__;if(a instanceof Vt){var p=a.__data__;if(!ar||p.length<n-1)return p.push([e,t]),this.size=++a.size,this;a=this.__data__=new Qt(p)}return a.set(e,t),this.size=a.size,this}Bt.prototype.clear=Uh,Bt.prototype.delete=Gh,Bt.prototype.get=Hh,Bt.prototype.has=Wh,Bt.prototype.set=kh;function Us(e,t){var a=Ee(e),p=!a&&On(e),w=!a&&!p&&ln(e),U=!a&&!p&&!w&&Wn(e),Q=a||p||w||U,J=Q?ha(e.length,Xd):[],q=J.length;for(var ie in e)(t||Fe.call(e,ie))&&!(Q&&(ie=="length"||w&&(ie=="offset"||ie=="parent")||U&&(ie=="buffer"||ie=="byteLength"||ie=="byteOffset")||Kt(ie,q)))&&J.push(ie);return J}function Gs(e){var t=e.length;return t?e[Pa(0,t-1)]:i}function Vh(e,t){return ci(dt(e),mn(t,0,e.length))}function Qh(e){return ci(dt(e))}function ba(e,t,a){(a!==i&&!Dt(e[t],a)||a===i&&!(t in e))&&zt(e,t,a)}function cr(e,t,a){var p=e[t];(!(Fe.call(e,t)&&Dt(p,a))||a===i&&!(t in e))&&zt(e,t,a)}function Yr(e,t){for(var a=e.length;a--;)if(Dt(e[a][0],t))return a;return-1}function zh(e,t,a,p){return on(e,function(w,U,Q){t(p,w,a(w),Q)}),p}function Hs(e,t){return e&&Ut(t,rt(t),e)}function jh(e,t){return e&&Ut(t,At(t),e)}function zt(e,t,a){t=="__proto__"&&Qr?Qr(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}function Ca(e,t){for(var a=-1,p=t.length,w=te(p),U=e==null;++a<p;)w[a]=U?i:to(e,t[a]);return w}function mn(e,t,a){return e===e&&(a!==i&&(e=e<=a?e:a),t!==i&&(e=e>=t?e:t)),e}function Mt(e,t,a,p,w,U){var Q,J=t&b,q=t&E,ie=t&I;if(a&&(Q=w?a(e,p,w,U):a(e)),Q!==i)return Q;if(!je(e))return e;var ae=Ee(e);if(ae){if(Q=BA(e),!J)return dt(e,Q)}else{var se=st(e),le=se==Se||se==Le;if(ln(e))return lu(e,J);if(se==Ue||se==F||le&&!w){if(Q=q||le?{}:_u(e),!J)return q?EA(e,jh(Q,e)):OA(e,Hs(Q,e))}else{if(!He[se])return w?e:{};Q=DA(e,se,J)}}U||(U=new Bt);var Ae=U.get(e);if(Ae)return Ae;U.set(e,Q),ic(e)?e.forEach(function(Ce){Q.add(Mt(Ce,t,a,Ce,e,U))}):nc(e)&&e.forEach(function(Ce,_e){Q.set(_e,Mt(Ce,t,a,_e,e,U))});var be=ie?q?Wa:Ha:q?At:rt,Te=ae?i:be(e);return It(Te||e,function(Ce,_e){Te&&(_e=Ce,Ce=e[_e]),cr(Q,_e,Mt(Ce,t,a,_e,e,U))}),Q}function Jh(e){var t=rt(e);return function(a){return Ws(a,e,t)}}function Ws(e,t,a){var p=a.length;if(e==null)return!p;for(e=Ge(e);p--;){var w=a[p],U=t[w],Q=e[w];if(Q===i&&!(w in e)||!U(Q))return!1}return!0}function ks(e,t,a){if(typeof e!="function")throw new Rt(o);return gr(function(){e.apply(i,a)},t)}function lr(e,t,a,p){var w=-1,U=Lr,Q=!0,J=e.length,q=[],ie=t.length;if(!J)return q;a&&(t=ze(t,mt(a))),p?(U=sa,Q=!1):t.length>=n&&(U=rr,Q=!1,t=new vn(t));e:for(;++w<J;){var ae=e[w],se=a==null?ae:a(ae);if(ae=p||ae!==0?ae:0,Q&&se===se){for(var le=ie;le--;)if(t[le]===se)continue e;q.push(ae)}else U(t,se,p)||q.push(ae)}return q}var on=pu(Ft),Vs=pu(Ea,!0);function Kh(e,t){var a=!0;return on(e,function(p,w,U){return a=!!t(p,w,U),a}),a}function qr(e,t,a){for(var p=-1,w=e.length;++p<w;){var U=e[p],Q=t(U);if(Q!=null&&(J===i?Q===Q&&!bt(Q):a(Q,J)))var J=Q,q=U}return q}function Zh(e,t,a,p){var w=e.length;for(a=Ie(a),a<0&&(a=-a>w?0:w+a),p=p===i||p>w?w:Ie(p),p<0&&(p+=w),p=a>p?0:oc(p);a<p;)e[a++]=t;return e}function Qs(e,t){var a=[];return on(e,function(p,w,U){t(p,w,U)&&a.push(p)}),a}function at(e,t,a,p,w){var U=-1,Q=e.length;for(a||(a=FA),w||(w=[]);++U<Q;){var J=e[U];t>0&&a(J)?t>1?at(J,t-1,a,p,w):tn(w,J):p||(w[w.length]=J)}return w}var Oa=gu(),zs=gu(!0);function Ft(e,t){return e&&Oa(e,t,rt)}function Ea(e,t){return e&&zs(e,t,rt)}function Xr(e,t){return en(t,function(a){return Zt(e[a])})}function yn(e,t){t=un(t,e);for(var a=0,p=t.length;e!=null&&a<p;)e=e[Gt(t[a++])];return a&&a==p?e:i}function js(e,t,a){var p=t(e);return Ee(e)?p:tn(p,a(e))}function ut(e){return e==null?e===i?Re:tt:pn&&pn in Ge(e)?wA(e):QA(e)}function Sa(e,t){return e>t}function Yh(e,t){return e!=null&&Fe.call(e,t)}function qh(e,t){return e!=null&&t in Ge(e)}function Xh(e,t,a){return e>=ot(t,a)&&e<et(t,a)}function Ia(e,t,a){for(var p=a?sa:Lr,w=e[0].length,U=e.length,Q=U,J=te(U),q=1/0,ie=[];Q--;){var ae=e[Q];Q&&t&&(ae=ze(ae,mt(t))),q=ot(ae.length,q),J[Q]=!a&&(t||w>=120&&ae.length>=120)?new vn(Q&&ae):i}ae=e[0];var se=-1,le=J[0];e:for(;++se<w&&ie.length<q;){var Ae=ae[se],be=t?t(Ae):Ae;if(Ae=a||Ae!==0?Ae:0,!(le?rr(le,be):p(ie,be,a))){for(Q=U;--Q;){var Te=J[Q];if(!(Te?rr(Te,be):p(e[Q],be,a)))continue e}le&&le.push(be),ie.push(Ae)}}return ie}function $h(e,t,a,p){return Ft(e,function(w,U,Q){t(p,a(w),U,Q)}),p}function fr(e,t,a){t=un(t,e),e=Lu(e,t);var p=e==null?e:e[Gt(Pt(t))];return p==null?i:vt(p,e,a)}function Js(e){return Je(e)&&ut(e)==F}function eA(e){return Je(e)&&ut(e)==nr}function tA(e){return Je(e)&&ut(e)==ce}function dr(e,t,a,p,w){return e===t?!0:e==null||t==null||!Je(e)&&!Je(t)?e!==e&&t!==t:nA(e,t,a,p,dr,w)}function nA(e,t,a,p,w,U){var Q=Ee(e),J=Ee(t),q=Q?j:st(e),ie=J?j:st(t);q=q==F?Ue:q,ie=ie==F?Ue:ie;var ae=q==Ue,se=ie==Ue,le=q==ie;if(le&&ln(e)){if(!ln(t))return!1;Q=!0,ae=!1}if(le&&!ae)return U||(U=new Bt),Q||Wn(e)?Ru(e,t,a,p,w,U):_A(e,t,q,a,p,w,U);if(!(a&s)){var Ae=ae&&Fe.call(e,"__wrapped__"),be=se&&Fe.call(t,"__wrapped__");if(Ae||be){var Te=Ae?e.value():e,Ce=be?t.value():t;return U||(U=new Bt),w(Te,Ce,a,p,U)}}return le?(U||(U=new Bt),PA(e,t,a,p,w,U)):!1}function rA(e){return Je(e)&&st(e)==fe}function Ra(e,t,a,p){var w=a.length,U=w,Q=!p;if(e==null)return!U;for(e=Ge(e);w--;){var J=a[w];if(Q&&J[2]?J[1]!==e[J[0]]:!(J[0]in e))return!1}for(;++w<U;){J=a[w];var q=J[0],ie=e[q],ae=J[1];if(Q&&J[2]){if(ie===i&&!(q in e))return!1}else{var se=new Bt;if(p)var le=p(ie,ae,q,e,t,se);if(!(le===i?dr(ae,ie,s|m,p,se):le))return!1}}return!0}function Ks(e){if(!je(e)||GA(e))return!1;var t=Zt(e)?rh:Jf;return t.test(Cn(e))}function iA(e){return Je(e)&&ut(e)==X}function aA(e){return Je(e)&&st(e)==re}function oA(e){return Je(e)&&pi(e.length)&&!!ke[ut(e)]}function Zs(e){return typeof e=="function"?e:e==null?pt:typeof e=="object"?Ee(e)?Xs(e[0],e[1]):qs(e):vc(e)}function Ta(e){if(!pr(e))return ch(e);var t=[];for(var a in Ge(e))Fe.call(e,a)&&a!="constructor"&&t.push(a);return t}function sA(e){if(!je(e))return VA(e);var t=pr(e),a=[];for(var p in e)p=="constructor"&&(t||!Fe.call(e,p))||a.push(p);return a}function Ma(e,t){return e<t}function Ys(e,t){var a=-1,p=ht(e)?te(e.length):[];return on(e,function(w,U,Q){p[++a]=t(w,U,Q)}),p}function qs(e){var t=Va(e);return t.length==1&&t[0][2]?wu(t[0][0],t[0][1]):function(a){return a===e||Ra(a,e,t)}}function Xs(e,t){return za(e)&&Pu(t)?wu(Gt(e),t):function(a){var p=to(a,e);return p===i&&p===t?no(a,e):dr(t,p,s|m)}}function $r(e,t,a,p,w){e!==t&&Oa(t,function(U,Q){if(w||(w=new Bt),je(U))uA(e,t,Q,a,$r,p,w);else{var J=p?p(Ja(e,Q),U,Q+"",e,t,w):i;J===i&&(J=U),ba(e,Q,J)}},At)}function uA(e,t,a,p,w,U,Q){var J=Ja(e,a),q=Ja(t,a),ie=Q.get(q);if(ie){ba(e,a,ie);return}var ae=U?U(J,q,a+"",e,t,Q):i,se=ae===i;if(se){var le=Ee(q),Ae=!le&&ln(q),be=!le&&!Ae&&Wn(q);ae=q,le||Ae||be?Ee(J)?ae=J:Ze(J)?ae=dt(J):Ae?(se=!1,ae=lu(q,!0)):be?(se=!1,ae=fu(q,!0)):ae=[]:vr(q)||On(q)?(ae=J,On(J)?ae=sc(J):(!je(J)||Zt(J))&&(ae=_u(q))):se=!1}se&&(Q.set(q,ae),w(ae,q,p,U,Q),Q.delete(q)),ba(e,a,ae)}function $s(e,t){var a=e.length;if(!!a)return t+=t<0?a:0,Kt(t,a)?e[t]:i}function eu(e,t,a){t.length?t=ze(t,function(U){return Ee(U)?function(Q){return yn(Q,U.length===1?U[0]:U)}:U}):t=[pt];var p=-1;t=ze(t,mt(ye()));var w=Ys(e,function(U,Q,J){var q=ze(t,function(ie){return ie(U)});return{criteria:q,index:++p,value:U}});return Dd(w,function(U,Q){return CA(U,Q,a)})}function cA(e,t){return tu(e,t,function(a,p){return no(e,p)})}function tu(e,t,a){for(var p=-1,w=t.length,U={};++p<w;){var Q=t[p],J=yn(e,Q);a(J,Q)&&hr(U,un(Q,e),J)}return U}function lA(e){return function(t){return yn(t,e)}}function _a(e,t,a,p){var w=p?Bd:wn,U=-1,Q=t.length,J=e;for(e===t&&(t=dt(t)),a&&(J=ze(e,mt(a)));++U<Q;)for(var q=0,ie=t[U],ae=a?a(ie):ie;(q=w(J,ae,q,p))>-1;)J!==e&&Vr.call(J,q,1),Vr.call(e,q,1);return e}function nu(e,t){for(var a=e?t.length:0,p=a-1;a--;){var w=t[a];if(a==p||w!==U){var U=w;Kt(w)?Vr.call(e,w,1):La(e,w)}}return e}function Pa(e,t){return e+jr(Ns()*(t-e+1))}function fA(e,t,a,p){for(var w=-1,U=et(zr((t-e)/(a||1)),0),Q=te(U);U--;)Q[p?U:++w]=e,e+=a;return Q}function wa(e,t){var a="";if(!e||t<1||t>k)return a;do t%2&&(a+=e),t=jr(t/2),t&&(e+=e);while(t);return a}function Me(e,t){return Ka(xu(e,t,pt),e+"")}function dA(e){return Gs(kn(e))}function hA(e,t){var a=kn(e);return ci(a,mn(t,0,a.length))}function hr(e,t,a,p){if(!je(e))return e;t=un(t,e);for(var w=-1,U=t.length,Q=U-1,J=e;J!=null&&++w<U;){var q=Gt(t[w]),ie=a;if(q==="__proto__"||q==="constructor"||q==="prototype")return e;if(w!=Q){var ae=J[q];ie=p?p(ae,q,J):i,ie===i&&(ie=je(ae)?ae:Kt(t[w+1])?[]:{})}cr(J,q,ie),J=J[q]}return e}var ru=Jr?function(e,t){return Jr.set(e,t),e}:pt,AA=Qr?function(e,t){return Qr(e,"toString",{configurable:!0,enumerable:!1,value:io(t),writable:!0})}:pt;function pA(e){return ci(kn(e))}function _t(e,t,a){var p=-1,w=e.length;t<0&&(t=-t>w?0:w+t),a=a>w?w:a,a<0&&(a+=w),w=t>a?0:a-t>>>0,t>>>=0;for(var U=te(w);++p<w;)U[p]=e[p+t];return U}function gA(e,t){var a;return on(e,function(p,w,U){return a=t(p,w,U),!a}),!!a}function ei(e,t,a){var p=0,w=e==null?p:e.length;if(typeof t=="number"&&t===t&&w<=G){for(;p<w;){var U=p+w>>>1,Q=e[U];Q!==null&&!bt(Q)&&(a?Q<=t:Q<t)?p=U+1:w=U}return w}return xa(e,t,pt,a)}function xa(e,t,a,p){var w=0,U=e==null?0:e.length;if(U===0)return 0;t=a(t);for(var Q=t!==t,J=t===null,q=bt(t),ie=t===i;w<U;){var ae=jr((w+U)/2),se=a(e[ae]),le=se!==i,Ae=se===null,be=se===se,Te=bt(se);if(Q)var Ce=p||be;else ie?Ce=be&&(p||le):J?Ce=be&&le&&(p||!Ae):q?Ce=be&&le&&!Ae&&(p||!Te):Ae||Te?Ce=!1:Ce=p?se<=t:se<t;Ce?w=ae+1:U=ae}return ot(U,Y)}function iu(e,t){for(var a=-1,p=e.length,w=0,U=[];++a<p;){var Q=e[a],J=t?t(Q):Q;if(!a||!Dt(J,q)){var q=J;U[w++]=Q===0?0:Q}}return U}function au(e){return typeof e=="number"?e:bt(e)?K:+e}function yt(e){if(typeof e=="string")return e;if(Ee(e))return ze(e,yt)+"";if(bt(e))return Fs?Fs.call(e):"";var t=e+"";return t=="0"&&1/e==-x?"-0":t}function sn(e,t,a){var p=-1,w=Lr,U=e.length,Q=!0,J=[],q=J;if(a)Q=!1,w=sa;else if(U>=n){var ie=t?null:TA(e);if(ie)return Dr(ie);Q=!1,w=rr,q=new vn}else q=t?[]:J;e:for(;++p<U;){var ae=e[p],se=t?t(ae):ae;if(ae=a||ae!==0?ae:0,Q&&se===se){for(var le=q.length;le--;)if(q[le]===se)continue e;t&&q.push(se),J.push(ae)}else w(q,se,a)||(q!==J&&q.push(se),J.push(ae))}return J}function La(e,t){return t=un(t,e),e=Lu(e,t),e==null||delete e[Gt(Pt(t))]}function ou(e,t,a,p){return hr(e,t,a(yn(e,t)),p)}function ti(e,t,a,p){for(var w=e.length,U=p?w:-1;(p?U--:++U<w)&&t(e[U],U,e););return a?_t(e,p?0:U,p?U+1:w):_t(e,p?U+1:0,p?w:U)}function su(e,t){var a=e;return a instanceof Pe&&(a=a.value()),ua(t,function(p,w){return w.func.apply(w.thisArg,tn([p],w.args))},a)}function Ba(e,t,a){var p=e.length;if(p<2)return p?sn(e[0]):[];for(var w=-1,U=te(p);++w<p;)for(var Q=e[w],J=-1;++J<p;)J!=w&&(U[w]=lr(U[w]||Q,e[J],t,a));return sn(at(U,1),t,a)}function uu(e,t,a){for(var p=-1,w=e.length,U=t.length,Q={};++p<w;){var J=p<U?t[p]:i;a(Q,e[p],J)}return Q}function Da(e){return Ze(e)?e:[]}function Na(e){return typeof e=="function"?e:pt}function un(e,t){return Ee(e)?e:za(e,t)?[e]:Fu(De(e))}var vA=Me;function cn(e,t,a){var p=e.length;return a=a===i?p:a,!t&&a>=p?e:_t(e,t,a)}var cu=ih||function(e){return nt.clearTimeout(e)};function lu(e,t){if(t)return e.slice();var a=e.length,p=ws?ws(a):new e.constructor(a);return e.copy(p),p}function Fa(e){var t=new e.constructor(e.byteLength);return new Wr(t).set(new Wr(e)),t}function mA(e,t){var a=t?Fa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function yA(e){var t=new e.constructor(e.source,Jo.exec(e));return t.lastIndex=e.lastIndex,t}function bA(e){return ur?Ge(ur.call(e)):{}}function fu(e,t){var a=t?Fa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function du(e,t){if(e!==t){var a=e!==i,p=e===null,w=e===e,U=bt(e),Q=t!==i,J=t===null,q=t===t,ie=bt(t);if(!J&&!ie&&!U&&e>t||U&&Q&&q&&!J&&!ie||p&&Q&&q||!a&&q||!w)return 1;if(!p&&!U&&!ie&&e<t||ie&&a&&w&&!p&&!U||J&&a&&w||!Q&&w||!q)return-1}return 0}function CA(e,t,a){for(var p=-1,w=e.criteria,U=t.criteria,Q=w.length,J=a.length;++p<Q;){var q=du(w[p],U[p]);if(q){if(p>=J)return q;var ie=a[p];return q*(ie=="desc"?-1:1)}}return e.index-t.index}function hu(e,t,a,p){for(var w=-1,U=e.length,Q=a.length,J=-1,q=t.length,ie=et(U-Q,0),ae=te(q+ie),se=!p;++J<q;)ae[J]=t[J];for(;++w<Q;)(se||w<U)&&(ae[a[w]]=e[w]);for(;ie--;)ae[J++]=e[w++];return ae}function Au(e,t,a,p){for(var w=-1,U=e.length,Q=-1,J=a.length,q=-1,ie=t.length,ae=et(U-J,0),se=te(ae+ie),le=!p;++w<ae;)se[w]=e[w];for(var Ae=w;++q<ie;)se[Ae+q]=t[q];for(;++Q<J;)(le||w<U)&&(se[Ae+a[Q]]=e[w++]);return se}function dt(e,t){var a=-1,p=e.length;for(t||(t=te(p));++a<p;)t[a]=e[a];return t}function Ut(e,t,a,p){var w=!a;a||(a={});for(var U=-1,Q=t.length;++U<Q;){var J=t[U],q=p?p(a[J],e[J],J,a,e):i;q===i&&(q=e[J]),w?zt(a,J,q):cr(a,J,q)}return a}function OA(e,t){return Ut(e,Qa(e),t)}function EA(e,t){return Ut(e,Tu(e),t)}function ni(e,t){return function(a,p){var w=Ee(a)?Md:zh,U=t?t():{};return w(a,e,ye(p,2),U)}}function Un(e){return Me(function(t,a){var p=-1,w=a.length,U=w>1?a[w-1]:i,Q=w>2?a[2]:i;for(U=e.length>3&&typeof U=="function"?(w--,U):i,Q&&ct(a[0],a[1],Q)&&(U=w<3?i:U,w=1),t=Ge(t);++p<w;){var J=a[p];J&&e(t,J,p,U)}return t})}function pu(e,t){return function(a,p){if(a==null)return a;if(!ht(a))return e(a,p);for(var w=a.length,U=t?w:-1,Q=Ge(a);(t?U--:++U<w)&&p(Q[U],U,Q)!==!1;);return a}}function gu(e){return function(t,a,p){for(var w=-1,U=Ge(t),Q=p(t),J=Q.length;J--;){var q=Q[e?J:++w];if(a(U[q],q,U)===!1)break}return t}}function SA(e,t,a){var p=t&T,w=Ar(e);function U(){var Q=this&&this!==nt&&this instanceof U?w:e;return Q.apply(p?a:this,arguments)}return U}function vu(e){return function(t){t=De(t);var a=xn(t)?Lt(t):i,p=a?a[0]:t.charAt(0),w=a?cn(a,1).join(""):t.slice(1);return p[e]()+w}}function Gn(e){return function(t){return ua(pc(Ac(t).replace(Ad,"")),e,"")}}function Ar(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var a=Fn(e.prototype),p=e.apply(a,t);return je(p)?p:a}}function IA(e,t,a){var p=Ar(e);function w(){for(var U=arguments.length,Q=te(U),J=U,q=Hn(w);J--;)Q[J]=arguments[J];var ie=U<3&&Q[0]!==q&&Q[U-1]!==q?[]:nn(Q,q);if(U-=ie.length,U<a)return Ou(e,t,ri,w.placeholder,i,Q,ie,i,i,a-U);var ae=this&&this!==nt&&this instanceof w?p:e;return vt(ae,this,Q)}return w}function mu(e){return function(t,a,p){var w=Ge(t);if(!ht(t)){var U=ye(a,3);t=rt(t),a=function(J){return U(w[J],J,w)}}var Q=e(t,a,p);return Q>-1?w[U?t[Q]:Q]:i}}function yu(e){return Jt(function(t){var a=t.length,p=a,w=Tt.prototype.thru;for(e&&t.reverse();p--;){var U=t[p];if(typeof U!="function")throw new Rt(o);if(w&&!Q&&si(U)=="wrapper")var Q=new Tt([],!0)}for(p=Q?p:a;++p<a;){U=t[p];var J=si(U),q=J=="wrapper"?ka(U):i;q&&ja(q[0])&&q[1]==(h|y|c|A)&&!q[4].length&&q[9]==1?Q=Q[si(q[0])].apply(Q,q[3]):Q=U.length==1&&ja(U)?Q[J]():Q.thru(U)}return function(){var ie=arguments,ae=ie[0];if(Q&&ie.length==1&&Ee(ae))return Q.plant(ae).value();for(var se=0,le=a?t[se].apply(this,ie):ae;++se<a;)le=t[se].call(this,le);return le}})}function ri(e,t,a,p,w,U,Q,J,q,ie){var ae=t&h,se=t&T,le=t&M,Ae=t&(y|R),be=t&f,Te=le?i:Ar(e);function Ce(){for(var _e=arguments.length,we=te(_e),Ct=_e;Ct--;)we[Ct]=arguments[Ct];if(Ae)var lt=Hn(Ce),Ot=Fd(we,lt);if(p&&(we=hu(we,p,w,Ae)),U&&(we=Au(we,U,Q,Ae)),_e-=Ot,Ae&&_e<ie){var Ye=nn(we,lt);return Ou(e,t,ri,Ce.placeholder,a,we,Ye,J,q,ie-_e)}var Nt=se?a:this,qt=le?Nt[e]:e;return _e=we.length,J?we=zA(we,J):be&&_e>1&&we.reverse(),ae&&q<_e&&(we.length=q),this&&this!==nt&&this instanceof Ce&&(qt=Te||Ar(qt)),qt.apply(Nt,we)}return Ce}function bu(e,t){return function(a,p){return $h(a,e,t(p),{})}}function ii(e,t){return function(a,p){var w;if(a===i&&p===i)return t;if(a!==i&&(w=a),p!==i){if(w===i)return p;typeof a=="string"||typeof p=="string"?(a=yt(a),p=yt(p)):(a=au(a),p=au(p)),w=e(a,p)}return w}}function Ua(e){return Jt(function(t){return t=ze(t,mt(ye())),Me(function(a){var p=this;return e(t,function(w){return vt(w,p,a)})})})}function ai(e,t){t=t===i?" ":yt(t);var a=t.length;if(a<2)return a?wa(t,e):t;var p=wa(t,zr(e/Ln(t)));return xn(t)?cn(Lt(p),0,e).join(""):p.slice(0,e)}function RA(e,t,a,p){var w=t&T,U=Ar(e);function Q(){for(var J=-1,q=arguments.length,ie=-1,ae=p.length,se=te(ae+q),le=this&&this!==nt&&this instanceof Q?U:e;++ie<ae;)se[ie]=p[ie];for(;q--;)se[ie++]=arguments[++J];return vt(le,w?a:this,se)}return Q}function Cu(e){return function(t,a,p){return p&&typeof p!="number"&&ct(t,a,p)&&(a=p=i),t=Yt(t),a===i?(a=t,t=0):a=Yt(a),p=p===i?t<a?1:-1:Yt(p),fA(t,a,p,e)}}function oi(e){return function(t,a){return typeof t=="string"&&typeof a=="string"||(t=wt(t),a=wt(a)),e(t,a)}}function Ou(e,t,a,p,w,U,Q,J,q,ie){var ae=t&y,se=ae?Q:i,le=ae?i:Q,Ae=ae?U:i,be=ae?i:U;t|=ae?c:v,t&=~(ae?v:c),t&C||(t&=~(T|M));var Te=[e,t,w,Ae,se,be,le,J,q,ie],Ce=a.apply(i,Te);return ja(e)&&Bu(Ce,Te),Ce.placeholder=p,Du(Ce,e,t)}function Ga(e){var t=$e[e];return function(a,p){if(a=wt(a),p=p==null?0:ot(Ie(p),292),p&&Ds(a)){var w=(De(a)+"e").split("e"),U=t(w[0]+"e"+(+w[1]+p));return w=(De(U)+"e").split("e"),+(w[0]+"e"+(+w[1]-p))}return t(a)}}var TA=Dn&&1/Dr(new Dn([,-0]))[1]==x?function(e){return new Dn(e)}:so;function Eu(e){return function(t){var a=st(t);return a==fe?pa(t):a==re?Qd(t):Nd(t,e(t))}}function jt(e,t,a,p,w,U,Q,J){var q=t&M;if(!q&&typeof e!="function")throw new Rt(o);var ie=p?p.length:0;if(ie||(t&=~(c|v),p=w=i),Q=Q===i?Q:et(Ie(Q),0),J=J===i?J:Ie(J),ie-=w?w.length:0,t&v){var ae=p,se=w;p=w=i}var le=q?i:ka(e),Ae=[e,t,a,p,w,ae,se,U,Q,J];if(le&&kA(Ae,le),e=Ae[0],t=Ae[1],a=Ae[2],p=Ae[3],w=Ae[4],J=Ae[9]=Ae[9]===i?q?0:e.length:et(Ae[9]-ie,0),!J&&t&(y|R)&&(t&=~(y|R)),!t||t==T)var be=SA(e,t,a);else t==y||t==R?be=IA(e,t,J):(t==c||t==(T|c))&&!w.length?be=RA(e,t,a,p):be=ri.apply(i,Ae);var Te=le?ru:Bu;return Du(Te(be,Ae),e,t)}function Su(e,t,a,p){return e===i||Dt(e,Bn[a])&&!Fe.call(p,a)?t:e}function Iu(e,t,a,p,w,U){return je(e)&&je(t)&&(U.set(t,e),$r(e,t,i,Iu,U),U.delete(t)),e}function MA(e){return vr(e)?i:e}function Ru(e,t,a,p,w,U){var Q=a&s,J=e.length,q=t.length;if(J!=q&&!(Q&&q>J))return!1;var ie=U.get(e),ae=U.get(t);if(ie&&ae)return ie==t&&ae==e;var se=-1,le=!0,Ae=a&m?new vn:i;for(U.set(e,t),U.set(t,e);++se<J;){var be=e[se],Te=t[se];if(p)var Ce=Q?p(Te,be,se,t,e,U):p(be,Te,se,e,t,U);if(Ce!==i){if(Ce)continue;le=!1;break}if(Ae){if(!ca(t,function(_e,we){if(!rr(Ae,we)&&(be===_e||w(be,_e,a,p,U)))return Ae.push(we)})){le=!1;break}}else if(!(be===Te||w(be,Te,a,p,U))){le=!1;break}}return U.delete(e),U.delete(t),le}function _A(e,t,a,p,w,U,Q){switch(a){case _n:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case nr:return!(e.byteLength!=t.byteLength||!U(new Wr(e),new Wr(t)));case ee:case ce:case xe:return Dt(+e,+t);case pe:return e.name==t.name&&e.message==t.message;case X:case ue:return e==t+"";case fe:var J=pa;case re:var q=p&s;if(J||(J=Dr),e.size!=t.size&&!q)return!1;var ie=Q.get(e);if(ie)return ie==t;p|=m,Q.set(e,t);var ae=Ru(J(e),J(t),p,w,U,Q);return Q.delete(e),ae;case he:if(ur)return ur.call(e)==ur.call(t)}return!1}function PA(e,t,a,p,w,U){var Q=a&s,J=Ha(e),q=J.length,ie=Ha(t),ae=ie.length;if(q!=ae&&!Q)return!1;for(var se=q;se--;){var le=J[se];if(!(Q?le in t:Fe.call(t,le)))return!1}var Ae=U.get(e),be=U.get(t);if(Ae&&be)return Ae==t&&be==e;var Te=!0;U.set(e,t),U.set(t,e);for(var Ce=Q;++se<q;){le=J[se];var _e=e[le],we=t[le];if(p)var Ct=Q?p(we,_e,le,t,e,U):p(_e,we,le,e,t,U);if(!(Ct===i?_e===we||w(_e,we,a,p,U):Ct)){Te=!1;break}Ce||(Ce=le=="constructor")}if(Te&&!Ce){var lt=e.constructor,Ot=t.constructor;lt!=Ot&&"constructor"in e&&"constructor"in t&&!(typeof lt=="function"&&lt instanceof lt&&typeof Ot=="function"&&Ot instanceof Ot)&&(Te=!1)}return U.delete(e),U.delete(t),Te}function Jt(e){return Ka(xu(e,i,Wu),e+"")}function Ha(e){return js(e,rt,Qa)}function Wa(e){return js(e,At,Tu)}var ka=Jr?function(e){return Jr.get(e)}:so;function si(e){for(var t=e.name+"",a=Nn[t],p=Fe.call(Nn,t)?a.length:0;p--;){var w=a[p],U=w.func;if(U==null||U==e)return w.name}return t}function Hn(e){var t=Fe.call(B,"placeholder")?B:e;return t.placeholder}function ye(){var e=B.iteratee||ao;return e=e===ao?Zs:e,arguments.length?e(arguments[0],arguments[1]):e}function ui(e,t){var a=e.__data__;return UA(t)?a[typeof t=="string"?"string":"hash"]:a.map}function Va(e){for(var t=rt(e),a=t.length;a--;){var p=t[a],w=e[p];t[a]=[p,w,Pu(w)]}return t}function bn(e,t){var a=Wd(e,t);return Ks(a)?a:i}function wA(e){var t=Fe.call(e,pn),a=e[pn];try{e[pn]=i;var p=!0}catch(U){}var w=Gr.call(e);return p&&(t?e[pn]=a:delete e[pn]),w}var Qa=va?function(e){return e==null?[]:(e=Ge(e),en(va(e),function(t){return Ls.call(e,t)}))}:uo,Tu=va?function(e){for(var t=[];e;)tn(t,Qa(e)),e=kr(e);return t}:uo,st=ut;(ma&&st(new ma(new ArrayBuffer(1)))!=_n||ar&&st(new ar)!=fe||ya&&st(ya.resolve())!=Qe||Dn&&st(new Dn)!=re||or&&st(new or)!=Xe)&&(st=function(e){var t=ut(e),a=t==Ue?e.constructor:i,p=a?Cn(a):"";if(p)switch(p){case hh:return _n;case Ah:return fe;case ph:return Qe;case gh:return re;case vh:return Xe}return t});function xA(e,t,a){for(var p=-1,w=a.length;++p<w;){var U=a[p],Q=U.size;switch(U.type){case"drop":e+=Q;break;case"dropRight":t-=Q;break;case"take":t=ot(t,e+Q);break;case"takeRight":e=et(e,t-Q);break}}return{start:e,end:t}}function LA(e){var t=e.match(Gf);return t?t[1].split(Hf):[]}function Mu(e,t,a){t=un(t,e);for(var p=-1,w=t.length,U=!1;++p<w;){var Q=Gt(t[p]);if(!(U=e!=null&&a(e,Q)))break;e=e[Q]}return U||++p!=w?U:(w=e==null?0:e.length,!!w&&pi(w)&&Kt(Q,w)&&(Ee(e)||On(e)))}function BA(e){var t=e.length,a=new e.constructor(t);return t&&typeof e[0]=="string"&&Fe.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function _u(e){return typeof e.constructor=="function"&&!pr(e)?Fn(kr(e)):{}}function DA(e,t,a){var p=e.constructor;switch(t){case nr:return Fa(e);case ee:case ce:return new p(+e);case _n:return mA(e,a);case Vi:case Qi:case zi:case ji:case Ji:case Ki:case Zi:case Yi:case qi:return fu(e,a);case fe:return new p;case xe:case ue:return new p(e);case X:return yA(e);case re:return new p;case he:return bA(e)}}function NA(e,t){var a=t.length;if(!a)return e;var p=a-1;return t[p]=(a>1?"& ":"")+t[p],t=t.join(a>2?", ":" "),e.replace(Uf,`{
/* [wrapped with `+t+`] */
`)}function FA(e){return Ee(e)||On(e)||!!(Bs&&e&&e[Bs])}function Kt(e,t){var a=typeof e;return t=t==null?k:t,!!t&&(a=="number"||a!="symbol"&&Zf.test(e))&&e>-1&&e%1==0&&e<t}function ct(e,t,a){if(!je(a))return!1;var p=typeof t;return(p=="number"?ht(a)&&Kt(t,a.length):p=="string"&&t in a)?Dt(a[t],e):!1}function za(e,t){if(Ee(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||bt(e)?!0:Bf.test(e)||!Lf.test(e)||t!=null&&e in Ge(t)}function UA(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ja(e){var t=si(e),a=B[t];if(typeof a!="function"||!(t in Pe.prototype))return!1;if(e===a)return!0;var p=ka(a);return!!p&&e===p[0]}function GA(e){return!!Ps&&Ps in e}var HA=Fr?Zt:co;function pr(e){var t=e&&e.constructor,a=typeof t=="function"&&t.prototype||Bn;return e===a}function Pu(e){return e===e&&!je(e)}function wu(e,t){return function(a){return a==null?!1:a[e]===t&&(t!==i||e in Ge(a))}}function WA(e){var t=hi(e,function(p){return a.size===l&&a.clear(),p}),a=t.cache;return t}function kA(e,t){var a=e[1],p=t[1],w=a|p,U=w<(T|M|h),Q=p==h&&a==y||p==h&&a==A&&e[7].length<=t[8]||p==(h|A)&&t[7].length<=t[8]&&a==y;if(!(U||Q))return e;p&T&&(e[2]=t[2],w|=a&T?0:C);var J=t[3];if(J){var q=e[3];e[3]=q?hu(q,J,t[4]):J,e[4]=q?nn(e[3],d):t[4]}return J=t[5],J&&(q=e[5],e[5]=q?Au(q,J,t[6]):J,e[6]=q?nn(e[5],d):t[6]),J=t[7],J&&(e[7]=J),p&h&&(e[8]=e[8]==null?t[8]:ot(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=w,e}function VA(e){var t=[];if(e!=null)for(var a in Ge(e))t.push(a);return t}function QA(e){return Gr.call(e)}function xu(e,t,a){return t=et(t===i?e.length-1:t,0),function(){for(var p=arguments,w=-1,U=et(p.length-t,0),Q=te(U);++w<U;)Q[w]=p[t+w];w=-1;for(var J=te(t+1);++w<t;)J[w]=p[w];return J[t]=a(Q),vt(e,this,J)}}function Lu(e,t){return t.length<2?e:yn(e,_t(t,0,-1))}function zA(e,t){for(var a=e.length,p=ot(t.length,a),w=dt(e);p--;){var U=t[p];e[p]=Kt(U,a)?w[U]:i}return e}function Ja(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Bu=Nu(ru),gr=oh||function(e,t){return nt.setTimeout(e,t)},Ka=Nu(AA);function Du(e,t,a){var p=t+"";return Ka(e,NA(p,jA(LA(p),a)))}function Nu(e){var t=0,a=0;return function(){var p=lh(),w=V-(p-a);if(a=p,w>0){if(++t>=L)return arguments[0]}else t=0;return e.apply(i,arguments)}}function ci(e,t){var a=-1,p=e.length,w=p-1;for(t=t===i?p:t;++a<t;){var U=Pa(a,w),Q=e[U];e[U]=e[a],e[a]=Q}return e.length=t,e}var Fu=WA(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Df,function(a,p,w,U){t.push(w?U.replace(Vf,"$1"):p||a)}),t});function Gt(e){if(typeof e=="string"||bt(e))return e;var t=e+"";return t=="0"&&1/e==-x?"-0":t}function Cn(e){if(e!=null){try{return Ur.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function jA(e,t){return It(N,function(a){var p="_."+a[0];t&a[1]&&!Lr(e,p)&&e.push(p)}),e.sort()}function Uu(e){if(e instanceof Pe)return e.clone();var t=new Tt(e.__wrapped__,e.__chain__);return t.__actions__=dt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function JA(e,t,a){(a?ct(e,t,a):t===i)?t=1:t=et(Ie(t),0);var p=e==null?0:e.length;if(!p||t<1)return[];for(var w=0,U=0,Q=te(zr(p/t));w<p;)Q[U++]=_t(e,w,w+=t);return Q}function KA(e){for(var t=-1,a=e==null?0:e.length,p=0,w=[];++t<a;){var U=e[t];U&&(w[p++]=U)}return w}function ZA(){var e=arguments.length;if(!e)return[];for(var t=te(e-1),a=arguments[0],p=e;p--;)t[p-1]=arguments[p];return tn(Ee(a)?dt(a):[a],at(t,1))}var YA=Me(function(e,t){return Ze(e)?lr(e,at(t,1,Ze,!0)):[]}),qA=Me(function(e,t){var a=Pt(t);return Ze(a)&&(a=i),Ze(e)?lr(e,at(t,1,Ze,!0),ye(a,2)):[]}),XA=Me(function(e,t){var a=Pt(t);return Ze(a)&&(a=i),Ze(e)?lr(e,at(t,1,Ze,!0),i,a):[]});function $A(e,t,a){var p=e==null?0:e.length;return p?(t=a||t===i?1:Ie(t),_t(e,t<0?0:t,p)):[]}function ep(e,t,a){var p=e==null?0:e.length;return p?(t=a||t===i?1:Ie(t),t=p-t,_t(e,0,t<0?0:t)):[]}function tp(e,t){return e&&e.length?ti(e,ye(t,3),!0,!0):[]}function np(e,t){return e&&e.length?ti(e,ye(t,3),!0):[]}function rp(e,t,a,p){var w=e==null?0:e.length;return w?(a&&typeof a!="number"&&ct(e,t,a)&&(a=0,p=w),Zh(e,t,a,p)):[]}function Gu(e,t,a){var p=e==null?0:e.length;if(!p)return-1;var w=a==null?0:Ie(a);return w<0&&(w=et(p+w,0)),Br(e,ye(t,3),w)}function Hu(e,t,a){var p=e==null?0:e.length;if(!p)return-1;var w=p-1;return a!==i&&(w=Ie(a),w=a<0?et(p+w,0):ot(w,p-1)),Br(e,ye(t,3),w,!0)}function Wu(e){var t=e==null?0:e.length;return t?at(e,1):[]}function ip(e){var t=e==null?0:e.length;return t?at(e,x):[]}function ap(e,t){var a=e==null?0:e.length;return a?(t=t===i?1:Ie(t),at(e,t)):[]}function op(e){for(var t=-1,a=e==null?0:e.length,p={};++t<a;){var w=e[t];p[w[0]]=w[1]}return p}function ku(e){return e&&e.length?e[0]:i}function sp(e,t,a){var p=e==null?0:e.length;if(!p)return-1;var w=a==null?0:Ie(a);return w<0&&(w=et(p+w,0)),wn(e,t,w)}function up(e){var t=e==null?0:e.length;return t?_t(e,0,-1):[]}var cp=Me(function(e){var t=ze(e,Da);return t.length&&t[0]===e[0]?Ia(t):[]}),lp=Me(function(e){var t=Pt(e),a=ze(e,Da);return t===Pt(a)?t=i:a.pop(),a.length&&a[0]===e[0]?Ia(a,ye(t,2)):[]}),fp=Me(function(e){var t=Pt(e),a=ze(e,Da);return t=typeof t=="function"?t:i,t&&a.pop(),a.length&&a[0]===e[0]?Ia(a,i,t):[]});function dp(e,t){return e==null?"":uh.call(e,t)}function Pt(e){var t=e==null?0:e.length;return t?e[t-1]:i}function hp(e,t,a){var p=e==null?0:e.length;if(!p)return-1;var w=p;return a!==i&&(w=Ie(a),w=w<0?et(p+w,0):ot(w,p-1)),t===t?jd(e,t,w):Br(e,Os,w,!0)}function Ap(e,t){return e&&e.length?$s(e,Ie(t)):i}var pp=Me(Vu);function Vu(e,t){return e&&e.length&&t&&t.length?_a(e,t):e}function gp(e,t,a){return e&&e.length&&t&&t.length?_a(e,t,ye(a,2)):e}function vp(e,t,a){return e&&e.length&&t&&t.length?_a(e,t,i,a):e}var mp=Jt(function(e,t){var a=e==null?0:e.length,p=Ca(e,t);return nu(e,ze(t,function(w){return Kt(w,a)?+w:w}).sort(du)),p});function yp(e,t){var a=[];if(!(e&&e.length))return a;var p=-1,w=[],U=e.length;for(t=ye(t,3);++p<U;){var Q=e[p];t(Q,p,e)&&(a.push(Q),w.push(p))}return nu(e,w),a}function Za(e){return e==null?e:dh.call(e)}function bp(e,t,a){var p=e==null?0:e.length;return p?(a&&typeof a!="number"&&ct(e,t,a)?(t=0,a=p):(t=t==null?0:Ie(t),a=a===i?p:Ie(a)),_t(e,t,a)):[]}function Cp(e,t){return ei(e,t)}function Op(e,t,a){return xa(e,t,ye(a,2))}function Ep(e,t){var a=e==null?0:e.length;if(a){var p=ei(e,t);if(p<a&&Dt(e[p],t))return p}return-1}function Sp(e,t){return ei(e,t,!0)}function Ip(e,t,a){return xa(e,t,ye(a,2),!0)}function Rp(e,t){var a=e==null?0:e.length;if(a){var p=ei(e,t,!0)-1;if(Dt(e[p],t))return p}return-1}function Tp(e){return e&&e.length?iu(e):[]}function Mp(e,t){return e&&e.length?iu(e,ye(t,2)):[]}function _p(e){var t=e==null?0:e.length;return t?_t(e,1,t):[]}function Pp(e,t,a){return e&&e.length?(t=a||t===i?1:Ie(t),_t(e,0,t<0?0:t)):[]}function wp(e,t,a){var p=e==null?0:e.length;return p?(t=a||t===i?1:Ie(t),t=p-t,_t(e,t<0?0:t,p)):[]}function xp(e,t){return e&&e.length?ti(e,ye(t,3),!1,!0):[]}function Lp(e,t){return e&&e.length?ti(e,ye(t,3)):[]}var Bp=Me(function(e){return sn(at(e,1,Ze,!0))}),Dp=Me(function(e){var t=Pt(e);return Ze(t)&&(t=i),sn(at(e,1,Ze,!0),ye(t,2))}),Np=Me(function(e){var t=Pt(e);return t=typeof t=="function"?t:i,sn(at(e,1,Ze,!0),i,t)});function Fp(e){return e&&e.length?sn(e):[]}function Up(e,t){return e&&e.length?sn(e,ye(t,2)):[]}function Gp(e,t){return t=typeof t=="function"?t:i,e&&e.length?sn(e,i,t):[]}function Ya(e){if(!(e&&e.length))return[];var t=0;return e=en(e,function(a){if(Ze(a))return t=et(a.length,t),!0}),ha(t,function(a){return ze(e,la(a))})}function Qu(e,t){if(!(e&&e.length))return[];var a=Ya(e);return t==null?a:ze(a,function(p){return vt(t,i,p)})}var Hp=Me(function(e,t){return Ze(e)?lr(e,t):[]}),Wp=Me(function(e){return Ba(en(e,Ze))}),kp=Me(function(e){var t=Pt(e);return Ze(t)&&(t=i),Ba(en(e,Ze),ye(t,2))}),Vp=Me(function(e){var t=Pt(e);return t=typeof t=="function"?t:i,Ba(en(e,Ze),i,t)}),Qp=Me(Ya);function zp(e,t){return uu(e||[],t||[],cr)}function jp(e,t){return uu(e||[],t||[],hr)}var Jp=Me(function(e){var t=e.length,a=t>1?e[t-1]:i;return a=typeof a=="function"?(e.pop(),a):i,Qu(e,a)});function zu(e){var t=B(e);return t.__chain__=!0,t}function Kp(e,t){return t(e),e}function li(e,t){return t(e)}var Zp=Jt(function(e){var t=e.length,a=t?e[0]:0,p=this.__wrapped__,w=function(U){return Ca(U,e)};return t>1||this.__actions__.length||!(p instanceof Pe)||!Kt(a)?this.thru(w):(p=p.slice(a,+a+(t?1:0)),p.__actions__.push({func:li,args:[w],thisArg:i}),new Tt(p,this.__chain__).thru(function(U){return t&&!U.length&&U.push(i),U}))});function Yp(){return zu(this)}function qp(){return new Tt(this.value(),this.__chain__)}function Xp(){this.__values__===i&&(this.__values__=ac(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function $p(){return this}function eg(e){for(var t,a=this;a instanceof Zr;){var p=Uu(a);p.__index__=0,p.__values__=i,t?w.__wrapped__=p:t=p;var w=p;a=a.__wrapped__}return w.__wrapped__=e,t}function tg(){var e=this.__wrapped__;if(e instanceof Pe){var t=e;return this.__actions__.length&&(t=new Pe(this)),t=t.reverse(),t.__actions__.push({func:li,args:[Za],thisArg:i}),new Tt(t,this.__chain__)}return this.thru(Za)}function ng(){return su(this.__wrapped__,this.__actions__)}var rg=ni(function(e,t,a){Fe.call(e,a)?++e[a]:zt(e,a,1)});function ig(e,t,a){var p=Ee(e)?bs:Kh;return a&&ct(e,t,a)&&(t=i),p(e,ye(t,3))}function ag(e,t){var a=Ee(e)?en:Qs;return a(e,ye(t,3))}var og=mu(Gu),sg=mu(Hu);function ug(e,t){return at(fi(e,t),1)}function cg(e,t){return at(fi(e,t),x)}function lg(e,t,a){return a=a===i?1:Ie(a),at(fi(e,t),a)}function ju(e,t){var a=Ee(e)?It:on;return a(e,ye(t,3))}function Ju(e,t){var a=Ee(e)?_d:Vs;return a(e,ye(t,3))}var fg=ni(function(e,t,a){Fe.call(e,a)?e[a].push(t):zt(e,a,[t])});function dg(e,t,a,p){e=ht(e)?e:kn(e),a=a&&!p?Ie(a):0;var w=e.length;return a<0&&(a=et(w+a,0)),gi(e)?a<=w&&e.indexOf(t,a)>-1:!!w&&wn(e,t,a)>-1}var hg=Me(function(e,t,a){var p=-1,w=typeof t=="function",U=ht(e)?te(e.length):[];return on(e,function(Q){U[++p]=w?vt(t,Q,a):fr(Q,t,a)}),U}),Ag=ni(function(e,t,a){zt(e,a,t)});function fi(e,t){var a=Ee(e)?ze:Ys;return a(e,ye(t,3))}function pg(e,t,a,p){return e==null?[]:(Ee(t)||(t=t==null?[]:[t]),a=p?i:a,Ee(a)||(a=a==null?[]:[a]),eu(e,t,a))}var gg=ni(function(e,t,a){e[a?0:1].push(t)},function(){return[[],[]]});function vg(e,t,a){var p=Ee(e)?ua:Ss,w=arguments.length<3;return p(e,ye(t,4),a,w,on)}function mg(e,t,a){var p=Ee(e)?Pd:Ss,w=arguments.length<3;return p(e,ye(t,4),a,w,Vs)}function yg(e,t){var a=Ee(e)?en:Qs;return a(e,Ai(ye(t,3)))}function bg(e){var t=Ee(e)?Gs:dA;return t(e)}function Cg(e,t,a){(a?ct(e,t,a):t===i)?t=1:t=Ie(t);var p=Ee(e)?Vh:hA;return p(e,t)}function Og(e){var t=Ee(e)?Qh:pA;return t(e)}function Eg(e){if(e==null)return 0;if(ht(e))return gi(e)?Ln(e):e.length;var t=st(e);return t==fe||t==re?e.size:Ta(e).length}function Sg(e,t,a){var p=Ee(e)?ca:gA;return a&&ct(e,t,a)&&(t=i),p(e,ye(t,3))}var Ig=Me(function(e,t){if(e==null)return[];var a=t.length;return a>1&&ct(e,t[0],t[1])?t=[]:a>2&&ct(t[0],t[1],t[2])&&(t=[t[0]]),eu(e,at(t,1),[])}),di=ah||function(){return nt.Date.now()};function Rg(e,t){if(typeof t!="function")throw new Rt(o);return e=Ie(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ku(e,t,a){return t=a?i:t,t=e&&t==null?e.length:t,jt(e,h,i,i,i,i,t)}function Zu(e,t){var a;if(typeof t!="function")throw new Rt(o);return e=Ie(e),function(){return--e>0&&(a=t.apply(this,arguments)),e<=1&&(t=i),a}}var qa=Me(function(e,t,a){var p=T;if(a.length){var w=nn(a,Hn(qa));p|=c}return jt(e,p,t,a,w)}),Yu=Me(function(e,t,a){var p=T|M;if(a.length){var w=nn(a,Hn(Yu));p|=c}return jt(t,p,e,a,w)});function qu(e,t,a){t=a?i:t;var p=jt(e,y,i,i,i,i,i,t);return p.placeholder=qu.placeholder,p}function Xu(e,t,a){t=a?i:t;var p=jt(e,R,i,i,i,i,i,t);return p.placeholder=Xu.placeholder,p}function $u(e,t,a){var p,w,U,Q,J,q,ie=0,ae=!1,se=!1,le=!0;if(typeof e!="function")throw new Rt(o);t=wt(t)||0,je(a)&&(ae=!!a.leading,se="maxWait"in a,U=se?et(wt(a.maxWait)||0,t):U,le="trailing"in a?!!a.trailing:le);function Ae(Ye){var Nt=p,qt=w;return p=w=i,ie=Ye,Q=e.apply(qt,Nt),Q}function be(Ye){return ie=Ye,J=gr(_e,t),ae?Ae(Ye):Q}function Te(Ye){var Nt=Ye-q,qt=Ye-ie,mc=t-Nt;return se?ot(mc,U-qt):mc}function Ce(Ye){var Nt=Ye-q,qt=Ye-ie;return q===i||Nt>=t||Nt<0||se&&qt>=U}function _e(){var Ye=di();if(Ce(Ye))return we(Ye);J=gr(_e,Te(Ye))}function we(Ye){return J=i,le&&p?Ae(Ye):(p=w=i,Q)}function Ct(){J!==i&&cu(J),ie=0,p=q=w=J=i}function lt(){return J===i?Q:we(di())}function Ot(){var Ye=di(),Nt=Ce(Ye);if(p=arguments,w=this,q=Ye,Nt){if(J===i)return be(q);if(se)return cu(J),J=gr(_e,t),Ae(q)}return J===i&&(J=gr(_e,t)),Q}return Ot.cancel=Ct,Ot.flush=lt,Ot}var Tg=Me(function(e,t){return ks(e,1,t)}),Mg=Me(function(e,t,a){return ks(e,wt(t)||0,a)});function _g(e){return jt(e,f)}function hi(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Rt(o);var a=function(){var p=arguments,w=t?t.apply(this,p):p[0],U=a.cache;if(U.has(w))return U.get(w);var Q=e.apply(this,p);return a.cache=U.set(w,Q)||U,Q};return a.cache=new(hi.Cache||Qt),a}hi.Cache=Qt;function Ai(e){if(typeof e!="function")throw new Rt(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Pg(e){return Zu(2,e)}var wg=vA(function(e,t){t=t.length==1&&Ee(t[0])?ze(t[0],mt(ye())):ze(at(t,1),mt(ye()));var a=t.length;return Me(function(p){for(var w=-1,U=ot(p.length,a);++w<U;)p[w]=t[w].call(this,p[w]);return vt(e,this,p)})}),Xa=Me(function(e,t){var a=nn(t,Hn(Xa));return jt(e,c,i,t,a)}),ec=Me(function(e,t){var a=nn(t,Hn(ec));return jt(e,v,i,t,a)}),xg=Jt(function(e,t){return jt(e,A,i,i,i,t)});function Lg(e,t){if(typeof e!="function")throw new Rt(o);return t=t===i?t:Ie(t),Me(e,t)}function Bg(e,t){if(typeof e!="function")throw new Rt(o);return t=t==null?0:et(Ie(t),0),Me(function(a){var p=a[t],w=cn(a,0,t);return p&&tn(w,p),vt(e,this,w)})}function Dg(e,t,a){var p=!0,w=!0;if(typeof e!="function")throw new Rt(o);return je(a)&&(p="leading"in a?!!a.leading:p,w="trailing"in a?!!a.trailing:w),$u(e,t,{leading:p,maxWait:t,trailing:w})}function Ng(e){return Ku(e,1)}function Fg(e,t){return Xa(Na(t),e)}function Ug(){if(!arguments.length)return[];var e=arguments[0];return Ee(e)?e:[e]}function Gg(e){return Mt(e,I)}function Hg(e,t){return t=typeof t=="function"?t:i,Mt(e,I,t)}function Wg(e){return Mt(e,b|I)}function kg(e,t){return t=typeof t=="function"?t:i,Mt(e,b|I,t)}function Vg(e,t){return t==null||Ws(e,t,rt(t))}function Dt(e,t){return e===t||e!==e&&t!==t}var Qg=oi(Sa),zg=oi(function(e,t){return e>=t}),On=Js(function(){return arguments}())?Js:function(e){return Je(e)&&Fe.call(e,"callee")&&!Ls.call(e,"callee")},Ee=te.isArray,jg=As?mt(As):eA;function ht(e){return e!=null&&pi(e.length)&&!Zt(e)}function Ze(e){return Je(e)&&ht(e)}function Jg(e){return e===!0||e===!1||Je(e)&&ut(e)==ee}var ln=sh||co,Kg=ps?mt(ps):tA;function Zg(e){return Je(e)&&e.nodeType===1&&!vr(e)}function Yg(e){if(e==null)return!0;if(ht(e)&&(Ee(e)||typeof e=="string"||typeof e.splice=="function"||ln(e)||Wn(e)||On(e)))return!e.length;var t=st(e);if(t==fe||t==re)return!e.size;if(pr(e))return!Ta(e).length;for(var a in e)if(Fe.call(e,a))return!1;return!0}function qg(e,t){return dr(e,t)}function Xg(e,t,a){a=typeof a=="function"?a:i;var p=a?a(e,t):i;return p===i?dr(e,t,i,a):!!p}function $a(e){if(!Je(e))return!1;var t=ut(e);return t==pe||t==ve||typeof e.message=="string"&&typeof e.name=="string"&&!vr(e)}function $g(e){return typeof e=="number"&&Ds(e)}function Zt(e){if(!je(e))return!1;var t=ut(e);return t==Se||t==Le||t==z||t==ft}function tc(e){return typeof e=="number"&&e==Ie(e)}function pi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=k}function je(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Je(e){return e!=null&&typeof e=="object"}var nc=gs?mt(gs):rA;function ev(e,t){return e===t||Ra(e,t,Va(t))}function tv(e,t,a){return a=typeof a=="function"?a:i,Ra(e,t,Va(t),a)}function nv(e){return rc(e)&&e!=+e}function rv(e){if(HA(e))throw new Oe(u);return Ks(e)}function iv(e){return e===null}function av(e){return e==null}function rc(e){return typeof e=="number"||Je(e)&&ut(e)==xe}function vr(e){if(!Je(e)||ut(e)!=Ue)return!1;var t=kr(e);if(t===null)return!0;var a=Fe.call(t,"constructor")&&t.constructor;return typeof a=="function"&&a instanceof a&&Ur.call(a)==th}var eo=vs?mt(vs):iA;function ov(e){return tc(e)&&e>=-k&&e<=k}var ic=ms?mt(ms):aA;function gi(e){return typeof e=="string"||!Ee(e)&&Je(e)&&ut(e)==ue}function bt(e){return typeof e=="symbol"||Je(e)&&ut(e)==he}var Wn=ys?mt(ys):oA;function sv(e){return e===i}function uv(e){return Je(e)&&st(e)==Xe}function cv(e){return Je(e)&&ut(e)==hn}var lv=oi(Ma),fv=oi(function(e,t){return e<=t});function ac(e){if(!e)return[];if(ht(e))return gi(e)?Lt(e):dt(e);if(ir&&e[ir])return Vd(e[ir]());var t=st(e),a=t==fe?pa:t==re?Dr:kn;return a(e)}function Yt(e){if(!e)return e===0?e:0;if(e=wt(e),e===x||e===-x){var t=e<0?-1:1;return t*W}return e===e?e:0}function Ie(e){var t=Yt(e),a=t%1;return t===t?a?t-a:t:0}function oc(e){return e?mn(Ie(e),0,$):0}function wt(e){if(typeof e=="number")return e;if(bt(e))return K;if(je(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=je(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Is(e);var a=jf.test(e);return a||Kf.test(e)?Rd(e.slice(2),a?2:8):zf.test(e)?K:+e}function sc(e){return Ut(e,At(e))}function dv(e){return e?mn(Ie(e),-k,k):e===0?e:0}function De(e){return e==null?"":yt(e)}var hv=Un(function(e,t){if(pr(t)||ht(t)){Ut(t,rt(t),e);return}for(var a in t)Fe.call(t,a)&&cr(e,a,t[a])}),uc=Un(function(e,t){Ut(t,At(t),e)}),vi=Un(function(e,t,a,p){Ut(t,At(t),e,p)}),Av=Un(function(e,t,a,p){Ut(t,rt(t),e,p)}),pv=Jt(Ca);function gv(e,t){var a=Fn(e);return t==null?a:Hs(a,t)}var vv=Me(function(e,t){e=Ge(e);var a=-1,p=t.length,w=p>2?t[2]:i;for(w&&ct(t[0],t[1],w)&&(p=1);++a<p;)for(var U=t[a],Q=At(U),J=-1,q=Q.length;++J<q;){var ie=Q[J],ae=e[ie];(ae===i||Dt(ae,Bn[ie])&&!Fe.call(e,ie))&&(e[ie]=U[ie])}return e}),mv=Me(function(e){return e.push(i,Iu),vt(cc,i,e)});function yv(e,t){return Cs(e,ye(t,3),Ft)}function bv(e,t){return Cs(e,ye(t,3),Ea)}function Cv(e,t){return e==null?e:Oa(e,ye(t,3),At)}function Ov(e,t){return e==null?e:zs(e,ye(t,3),At)}function Ev(e,t){return e&&Ft(e,ye(t,3))}function Sv(e,t){return e&&Ea(e,ye(t,3))}function Iv(e){return e==null?[]:Xr(e,rt(e))}function Rv(e){return e==null?[]:Xr(e,At(e))}function to(e,t,a){var p=e==null?i:yn(e,t);return p===i?a:p}function Tv(e,t){return e!=null&&Mu(e,t,Yh)}function no(e,t){return e!=null&&Mu(e,t,qh)}var Mv=bu(function(e,t,a){t!=null&&typeof t.toString!="function"&&(t=Gr.call(t)),e[t]=a},io(pt)),_v=bu(function(e,t,a){t!=null&&typeof t.toString!="function"&&(t=Gr.call(t)),Fe.call(e,t)?e[t].push(a):e[t]=[a]},ye),Pv=Me(fr);function rt(e){return ht(e)?Us(e):Ta(e)}function At(e){return ht(e)?Us(e,!0):sA(e)}function wv(e,t){var a={};return t=ye(t,3),Ft(e,function(p,w,U){zt(a,t(p,w,U),p)}),a}function xv(e,t){var a={};return t=ye(t,3),Ft(e,function(p,w,U){zt(a,w,t(p,w,U))}),a}var Lv=Un(function(e,t,a){$r(e,t,a)}),cc=Un(function(e,t,a,p){$r(e,t,a,p)}),Bv=Jt(function(e,t){var a={};if(e==null)return a;var p=!1;t=ze(t,function(U){return U=un(U,e),p||(p=U.length>1),U}),Ut(e,Wa(e),a),p&&(a=Mt(a,b|E|I,MA));for(var w=t.length;w--;)La(a,t[w]);return a});function Dv(e,t){return lc(e,Ai(ye(t)))}var Nv=Jt(function(e,t){return e==null?{}:cA(e,t)});function lc(e,t){if(e==null)return{};var a=ze(Wa(e),function(p){return[p]});return t=ye(t),tu(e,a,function(p,w){return t(p,w[0])})}function Fv(e,t,a){t=un(t,e);var p=-1,w=t.length;for(w||(w=1,e=i);++p<w;){var U=e==null?i:e[Gt(t[p])];U===i&&(p=w,U=a),e=Zt(U)?U.call(e):U}return e}function Uv(e,t,a){return e==null?e:hr(e,t,a)}function Gv(e,t,a,p){return p=typeof p=="function"?p:i,e==null?e:hr(e,t,a,p)}var fc=Eu(rt),dc=Eu(At);function Hv(e,t,a){var p=Ee(e),w=p||ln(e)||Wn(e);if(t=ye(t,4),a==null){var U=e&&e.constructor;w?a=p?new U:[]:je(e)?a=Zt(U)?Fn(kr(e)):{}:a={}}return(w?It:Ft)(e,function(Q,J,q){return t(a,Q,J,q)}),a}function Wv(e,t){return e==null?!0:La(e,t)}function kv(e,t,a){return e==null?e:ou(e,t,Na(a))}function Vv(e,t,a,p){return p=typeof p=="function"?p:i,e==null?e:ou(e,t,Na(a),p)}function kn(e){return e==null?[]:Aa(e,rt(e))}function Qv(e){return e==null?[]:Aa(e,At(e))}function zv(e,t,a){return a===i&&(a=t,t=i),a!==i&&(a=wt(a),a=a===a?a:0),t!==i&&(t=wt(t),t=t===t?t:0),mn(wt(e),t,a)}function jv(e,t,a){return t=Yt(t),a===i?(a=t,t=0):a=Yt(a),e=wt(e),Xh(e,t,a)}function Jv(e,t,a){if(a&&typeof a!="boolean"&&ct(e,t,a)&&(t=a=i),a===i&&(typeof t=="boolean"?(a=t,t=i):typeof e=="boolean"&&(a=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Yt(e),t===i?(t=e,e=0):t=Yt(t)),e>t){var p=e;e=t,t=p}if(a||e%1||t%1){var w=Ns();return ot(e+w*(t-e+Id("1e-"+((w+"").length-1))),t)}return Pa(e,t)}var Kv=Gn(function(e,t,a){return t=t.toLowerCase(),e+(a?hc(t):t)});function hc(e){return ro(De(e).toLowerCase())}function Ac(e){return e=De(e),e&&e.replace(Yf,Ud).replace(pd,"")}function Zv(e,t,a){e=De(e),t=yt(t);var p=e.length;a=a===i?p:mn(Ie(a),0,p);var w=a;return a-=t.length,a>=0&&e.slice(a,w)==t}function Yv(e){return e=De(e),e&&Pf.test(e)?e.replace(zo,Gd):e}function qv(e){return e=De(e),e&&Nf.test(e)?e.replace(Xi,"\\$&"):e}var Xv=Gn(function(e,t,a){return e+(a?"-":"")+t.toLowerCase()}),$v=Gn(function(e,t,a){return e+(a?" ":"")+t.toLowerCase()}),em=vu("toLowerCase");function tm(e,t,a){e=De(e),t=Ie(t);var p=t?Ln(e):0;if(!t||p>=t)return e;var w=(t-p)/2;return ai(jr(w),a)+e+ai(zr(w),a)}function nm(e,t,a){e=De(e),t=Ie(t);var p=t?Ln(e):0;return t&&p<t?e+ai(t-p,a):e}function rm(e,t,a){e=De(e),t=Ie(t);var p=t?Ln(e):0;return t&&p<t?ai(t-p,a)+e:e}function im(e,t,a){return a||t==null?t=0:t&&(t=+t),fh(De(e).replace($i,""),t||0)}function am(e,t,a){return(a?ct(e,t,a):t===i)?t=1:t=Ie(t),wa(De(e),t)}function om(){var e=arguments,t=De(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var sm=Gn(function(e,t,a){return e+(a?"_":"")+t.toLowerCase()});function um(e,t,a){return a&&typeof a!="number"&&ct(e,t,a)&&(t=a=i),a=a===i?$:a>>>0,a?(e=De(e),e&&(typeof t=="string"||t!=null&&!eo(t))&&(t=yt(t),!t&&xn(e))?cn(Lt(e),0,a):e.split(t,a)):[]}var cm=Gn(function(e,t,a){return e+(a?" ":"")+ro(t)});function lm(e,t,a){return e=De(e),a=a==null?0:mn(Ie(a),0,e.length),t=yt(t),e.slice(a,a+t.length)==t}function fm(e,t,a){var p=B.templateSettings;a&&ct(e,t,a)&&(t=i),e=De(e),t=vi({},t,p,Su);var w=vi({},t.imports,p.imports,Su),U=rt(w),Q=Aa(w,U),J,q,ie=0,ae=t.interpolate||Pr,se="__p += '",le=ga((t.escape||Pr).source+"|"+ae.source+"|"+(ae===jo?Qf:Pr).source+"|"+(t.evaluate||Pr).source+"|$","g"),Ae="//# sourceURL="+(Fe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++bd+"]")+`
`;e.replace(le,function(Ce,_e,we,Ct,lt,Ot){return we||(we=Ct),se+=e.slice(ie,Ot).replace(qf,Hd),_e&&(J=!0,se+=`' +
__e(`+_e+`) +
'`),lt&&(q=!0,se+=`';
`+lt+`;
__p += '`),we&&(se+=`' +
((__t = (`+we+`)) == null ? '' : __t) +
'`),ie=Ot+Ce.length,Ce}),se+=`';
`;var be=Fe.call(t,"variable")&&t.variable;if(!be)se=`with (obj) {
`+se+`
}
`;else if(kf.test(be))throw new Oe(g);se=(q?se.replace(Rf,""):se).replace(Tf,"$1").replace(Mf,"$1;"),se="function("+(be||"obj")+`) {
`+(be?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(J?", __e = _.escape":"")+(q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+se+`return __p
}`;var Te=gc(function(){return Be(U,Ae+"return "+se).apply(i,Q)});if(Te.source=se,$a(Te))throw Te;return Te}function dm(e){return De(e).toLowerCase()}function hm(e){return De(e).toUpperCase()}function Am(e,t,a){if(e=De(e),e&&(a||t===i))return Is(e);if(!e||!(t=yt(t)))return e;var p=Lt(e),w=Lt(t),U=Rs(p,w),Q=Ts(p,w)+1;return cn(p,U,Q).join("")}function pm(e,t,a){if(e=De(e),e&&(a||t===i))return e.slice(0,_s(e)+1);if(!e||!(t=yt(t)))return e;var p=Lt(e),w=Ts(p,Lt(t))+1;return cn(p,0,w).join("")}function gm(e,t,a){if(e=De(e),e&&(a||t===i))return e.replace($i,"");if(!e||!(t=yt(t)))return e;var p=Lt(e),w=Rs(p,Lt(t));return cn(p,w).join("")}function vm(e,t){var a=O,p=P;if(je(t)){var w="separator"in t?t.separator:w;a="length"in t?Ie(t.length):a,p="omission"in t?yt(t.omission):p}e=De(e);var U=e.length;if(xn(e)){var Q=Lt(e);U=Q.length}if(a>=U)return e;var J=a-Ln(p);if(J<1)return p;var q=Q?cn(Q,0,J).join(""):e.slice(0,J);if(w===i)return q+p;if(Q&&(J+=q.length-J),eo(w)){if(e.slice(J).search(w)){var ie,ae=q;for(w.global||(w=ga(w.source,De(Jo.exec(w))+"g")),w.lastIndex=0;ie=w.exec(ae);)var se=ie.index;q=q.slice(0,se===i?J:se)}}else if(e.indexOf(yt(w),J)!=J){var le=q.lastIndexOf(w);le>-1&&(q=q.slice(0,le))}return q+p}function mm(e){return e=De(e),e&&_f.test(e)?e.replace(Qo,Jd):e}var ym=Gn(function(e,t,a){return e+(a?" ":"")+t.toUpperCase()}),ro=vu("toUpperCase");function pc(e,t,a){return e=De(e),t=a?i:t,t===i?kd(e)?Yd(e):Ld(e):e.match(t)||[]}var gc=Me(function(e,t){try{return vt(e,i,t)}catch(a){return $a(a)?a:new Oe(a)}}),bm=Jt(function(e,t){return It(t,function(a){a=Gt(a),zt(e,a,qa(e[a],e))}),e});function Cm(e){var t=e==null?0:e.length,a=ye();return e=t?ze(e,function(p){if(typeof p[1]!="function")throw new Rt(o);return[a(p[0]),p[1]]}):[],Me(function(p){for(var w=-1;++w<t;){var U=e[w];if(vt(U[0],this,p))return vt(U[1],this,p)}})}function Om(e){return Jh(Mt(e,b))}function io(e){return function(){return e}}function Em(e,t){return e==null||e!==e?t:e}var Sm=yu(),Im=yu(!0);function pt(e){return e}function ao(e){return Zs(typeof e=="function"?e:Mt(e,b))}function Rm(e){return qs(Mt(e,b))}function Tm(e,t){return Xs(e,Mt(t,b))}var Mm=Me(function(e,t){return function(a){return fr(a,e,t)}}),_m=Me(function(e,t){return function(a){return fr(e,a,t)}});function oo(e,t,a){var p=rt(t),w=Xr(t,p);a==null&&!(je(t)&&(w.length||!p.length))&&(a=t,t=e,e=this,w=Xr(t,rt(t)));var U=!(je(a)&&"chain"in a)||!!a.chain,Q=Zt(e);return It(w,function(J){var q=t[J];e[J]=q,Q&&(e.prototype[J]=function(){var ie=this.__chain__;if(U||ie){var ae=e(this.__wrapped__),se=ae.__actions__=dt(this.__actions__);return se.push({func:q,args:arguments,thisArg:e}),ae.__chain__=ie,ae}return q.apply(e,tn([this.value()],arguments))})}),e}function Pm(){return nt._===this&&(nt._=nh),this}function so(){}function wm(e){return e=Ie(e),Me(function(t){return $s(t,e)})}var xm=Ua(ze),Lm=Ua(bs),Bm=Ua(ca);function vc(e){return za(e)?la(Gt(e)):lA(e)}function Dm(e){return function(t){return e==null?i:yn(e,t)}}var Nm=Cu(),Fm=Cu(!0);function uo(){return[]}function co(){return!1}function Um(){return{}}function Gm(){return""}function Hm(){return!0}function Wm(e,t){if(e=Ie(e),e<1||e>k)return[];var a=$,p=ot(e,$);t=ye(t),e-=$;for(var w=ha(p,t);++a<e;)t(a);return w}function km(e){return Ee(e)?ze(e,Gt):bt(e)?[e]:dt(Fu(De(e)))}function Vm(e){var t=++eh;return De(e)+t}var Qm=ii(function(e,t){return e+t},0),zm=Ga("ceil"),jm=ii(function(e,t){return e/t},1),Jm=Ga("floor");function Km(e){return e&&e.length?qr(e,pt,Sa):i}function Zm(e,t){return e&&e.length?qr(e,ye(t,2),Sa):i}function Ym(e){return Es(e,pt)}function qm(e,t){return Es(e,ye(t,2))}function Xm(e){return e&&e.length?qr(e,pt,Ma):i}function $m(e,t){return e&&e.length?qr(e,ye(t,2),Ma):i}var e0=ii(function(e,t){return e*t},1),t0=Ga("round"),n0=ii(function(e,t){return e-t},0);function r0(e){return e&&e.length?da(e,pt):0}function i0(e,t){return e&&e.length?da(e,ye(t,2)):0}return B.after=Rg,B.ary=Ku,B.assign=hv,B.assignIn=uc,B.assignInWith=vi,B.assignWith=Av,B.at=pv,B.before=Zu,B.bind=qa,B.bindAll=bm,B.bindKey=Yu,B.castArray=Ug,B.chain=zu,B.chunk=JA,B.compact=KA,B.concat=ZA,B.cond=Cm,B.conforms=Om,B.constant=io,B.countBy=rg,B.create=gv,B.curry=qu,B.curryRight=Xu,B.debounce=$u,B.defaults=vv,B.defaultsDeep=mv,B.defer=Tg,B.delay=Mg,B.difference=YA,B.differenceBy=qA,B.differenceWith=XA,B.drop=$A,B.dropRight=ep,B.dropRightWhile=tp,B.dropWhile=np,B.fill=rp,B.filter=ag,B.flatMap=ug,B.flatMapDeep=cg,B.flatMapDepth=lg,B.flatten=Wu,B.flattenDeep=ip,B.flattenDepth=ap,B.flip=_g,B.flow=Sm,B.flowRight=Im,B.fromPairs=op,B.functions=Iv,B.functionsIn=Rv,B.groupBy=fg,B.initial=up,B.intersection=cp,B.intersectionBy=lp,B.intersectionWith=fp,B.invert=Mv,B.invertBy=_v,B.invokeMap=hg,B.iteratee=ao,B.keyBy=Ag,B.keys=rt,B.keysIn=At,B.map=fi,B.mapKeys=wv,B.mapValues=xv,B.matches=Rm,B.matchesProperty=Tm,B.memoize=hi,B.merge=Lv,B.mergeWith=cc,B.method=Mm,B.methodOf=_m,B.mixin=oo,B.negate=Ai,B.nthArg=wm,B.omit=Bv,B.omitBy=Dv,B.once=Pg,B.orderBy=pg,B.over=xm,B.overArgs=wg,B.overEvery=Lm,B.overSome=Bm,B.partial=Xa,B.partialRight=ec,B.partition=gg,B.pick=Nv,B.pickBy=lc,B.property=vc,B.propertyOf=Dm,B.pull=pp,B.pullAll=Vu,B.pullAllBy=gp,B.pullAllWith=vp,B.pullAt=mp,B.range=Nm,B.rangeRight=Fm,B.rearg=xg,B.reject=yg,B.remove=yp,B.rest=Lg,B.reverse=Za,B.sampleSize=Cg,B.set=Uv,B.setWith=Gv,B.shuffle=Og,B.slice=bp,B.sortBy=Ig,B.sortedUniq=Tp,B.sortedUniqBy=Mp,B.split=um,B.spread=Bg,B.tail=_p,B.take=Pp,B.takeRight=wp,B.takeRightWhile=xp,B.takeWhile=Lp,B.tap=Kp,B.throttle=Dg,B.thru=li,B.toArray=ac,B.toPairs=fc,B.toPairsIn=dc,B.toPath=km,B.toPlainObject=sc,B.transform=Hv,B.unary=Ng,B.union=Bp,B.unionBy=Dp,B.unionWith=Np,B.uniq=Fp,B.uniqBy=Up,B.uniqWith=Gp,B.unset=Wv,B.unzip=Ya,B.unzipWith=Qu,B.update=kv,B.updateWith=Vv,B.values=kn,B.valuesIn=Qv,B.without=Hp,B.words=pc,B.wrap=Fg,B.xor=Wp,B.xorBy=kp,B.xorWith=Vp,B.zip=Qp,B.zipObject=zp,B.zipObjectDeep=jp,B.zipWith=Jp,B.entries=fc,B.entriesIn=dc,B.extend=uc,B.extendWith=vi,oo(B,B),B.add=Qm,B.attempt=gc,B.camelCase=Kv,B.capitalize=hc,B.ceil=zm,B.clamp=zv,B.clone=Gg,B.cloneDeep=Wg,B.cloneDeepWith=kg,B.cloneWith=Hg,B.conformsTo=Vg,B.deburr=Ac,B.defaultTo=Em,B.divide=jm,B.endsWith=Zv,B.eq=Dt,B.escape=Yv,B.escapeRegExp=qv,B.every=ig,B.find=og,B.findIndex=Gu,B.findKey=yv,B.findLast=sg,B.findLastIndex=Hu,B.findLastKey=bv,B.floor=Jm,B.forEach=ju,B.forEachRight=Ju,B.forIn=Cv,B.forInRight=Ov,B.forOwn=Ev,B.forOwnRight=Sv,B.get=to,B.gt=Qg,B.gte=zg,B.has=Tv,B.hasIn=no,B.head=ku,B.identity=pt,B.includes=dg,B.indexOf=sp,B.inRange=jv,B.invoke=Pv,B.isArguments=On,B.isArray=Ee,B.isArrayBuffer=jg,B.isArrayLike=ht,B.isArrayLikeObject=Ze,B.isBoolean=Jg,B.isBuffer=ln,B.isDate=Kg,B.isElement=Zg,B.isEmpty=Yg,B.isEqual=qg,B.isEqualWith=Xg,B.isError=$a,B.isFinite=$g,B.isFunction=Zt,B.isInteger=tc,B.isLength=pi,B.isMap=nc,B.isMatch=ev,B.isMatchWith=tv,B.isNaN=nv,B.isNative=rv,B.isNil=av,B.isNull=iv,B.isNumber=rc,B.isObject=je,B.isObjectLike=Je,B.isPlainObject=vr,B.isRegExp=eo,B.isSafeInteger=ov,B.isSet=ic,B.isString=gi,B.isSymbol=bt,B.isTypedArray=Wn,B.isUndefined=sv,B.isWeakMap=uv,B.isWeakSet=cv,B.join=dp,B.kebabCase=Xv,B.last=Pt,B.lastIndexOf=hp,B.lowerCase=$v,B.lowerFirst=em,B.lt=lv,B.lte=fv,B.max=Km,B.maxBy=Zm,B.mean=Ym,B.meanBy=qm,B.min=Xm,B.minBy=$m,B.stubArray=uo,B.stubFalse=co,B.stubObject=Um,B.stubString=Gm,B.stubTrue=Hm,B.multiply=e0,B.nth=Ap,B.noConflict=Pm,B.noop=so,B.now=di,B.pad=tm,B.padEnd=nm,B.padStart=rm,B.parseInt=im,B.random=Jv,B.reduce=vg,B.reduceRight=mg,B.repeat=am,B.replace=om,B.result=Fv,B.round=t0,B.runInContext=Z,B.sample=bg,B.size=Eg,B.snakeCase=sm,B.some=Sg,B.sortedIndex=Cp,B.sortedIndexBy=Op,B.sortedIndexOf=Ep,B.sortedLastIndex=Sp,B.sortedLastIndexBy=Ip,B.sortedLastIndexOf=Rp,B.startCase=cm,B.startsWith=lm,B.subtract=n0,B.sum=r0,B.sumBy=i0,B.template=fm,B.times=Wm,B.toFinite=Yt,B.toInteger=Ie,B.toLength=oc,B.toLower=dm,B.toNumber=wt,B.toSafeInteger=dv,B.toString=De,B.toUpper=hm,B.trim=Am,B.trimEnd=pm,B.trimStart=gm,B.truncate=vm,B.unescape=mm,B.uniqueId=Vm,B.upperCase=ym,B.upperFirst=ro,B.each=ju,B.eachRight=Ju,B.first=ku,oo(B,function(){var e={};return Ft(B,function(t,a){Fe.call(B.prototype,a)||(e[a]=t)}),e}(),{chain:!1}),B.VERSION=r,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){B[e].placeholder=B}),It(["drop","take"],function(e,t){Pe.prototype[e]=function(a){a=a===i?1:et(Ie(a),0);var p=this.__filtered__&&!t?new Pe(this):this.clone();return p.__filtered__?p.__takeCount__=ot(a,p.__takeCount__):p.__views__.push({size:ot(a,$),type:e+(p.__dir__<0?"Right":"")}),p},Pe.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),It(["filter","map","takeWhile"],function(e,t){var a=t+1,p=a==H||a==_;Pe.prototype[e]=function(w){var U=this.clone();return U.__iteratees__.push({iteratee:ye(w,3),type:a}),U.__filtered__=U.__filtered__||p,U}}),It(["head","last"],function(e,t){var a="take"+(t?"Right":"");Pe.prototype[e]=function(){return this[a](1).value()[0]}}),It(["initial","tail"],function(e,t){var a="drop"+(t?"":"Right");Pe.prototype[e]=function(){return this.__filtered__?new Pe(this):this[a](1)}}),Pe.prototype.compact=function(){return this.filter(pt)},Pe.prototype.find=function(e){return this.filter(e).head()},Pe.prototype.findLast=function(e){return this.reverse().find(e)},Pe.prototype.invokeMap=Me(function(e,t){return typeof e=="function"?new Pe(this):this.map(function(a){return fr(a,e,t)})}),Pe.prototype.reject=function(e){return this.filter(Ai(ye(e)))},Pe.prototype.slice=function(e,t){e=Ie(e);var a=this;return a.__filtered__&&(e>0||t<0)?new Pe(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),t!==i&&(t=Ie(t),a=t<0?a.dropRight(-t):a.take(t-e)),a)},Pe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Pe.prototype.toArray=function(){return this.take($)},Ft(Pe.prototype,function(e,t){var a=/^(?:filter|find|map|reject)|While$/.test(t),p=/^(?:head|last)$/.test(t),w=B[p?"take"+(t=="last"?"Right":""):t],U=p||/^find/.test(t);!w||(B.prototype[t]=function(){var Q=this.__wrapped__,J=p?[1]:arguments,q=Q instanceof Pe,ie=J[0],ae=q||Ee(Q),se=function(_e){var we=w.apply(B,tn([_e],J));return p&&le?we[0]:we};ae&&a&&typeof ie=="function"&&ie.length!=1&&(q=ae=!1);var le=this.__chain__,Ae=!!this.__actions__.length,be=U&&!le,Te=q&&!Ae;if(!U&&ae){Q=Te?Q:new Pe(this);var Ce=e.apply(Q,J);return Ce.__actions__.push({func:li,args:[se],thisArg:i}),new Tt(Ce,le)}return be&&Te?e.apply(this,J):(Ce=this.thru(se),be?p?Ce.value()[0]:Ce.value():Ce)})}),It(["pop","push","shift","sort","splice","unshift"],function(e){var t=Nr[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",p=/^(?:pop|shift)$/.test(e);B.prototype[e]=function(){var w=arguments;if(p&&!this.__chain__){var U=this.value();return t.apply(Ee(U)?U:[],w)}return this[a](function(Q){return t.apply(Ee(Q)?Q:[],w)})}}),Ft(Pe.prototype,function(e,t){var a=B[t];if(a){var p=a.name+"";Fe.call(Nn,p)||(Nn[p]=[]),Nn[p].push({name:t,func:a})}}),Nn[ri(i,M).name]=[{name:"wrapper",func:i}],Pe.prototype.clone=mh,Pe.prototype.reverse=yh,Pe.prototype.value=bh,B.prototype.at=Zp,B.prototype.chain=Yp,B.prototype.commit=qp,B.prototype.next=Xp,B.prototype.plant=eg,B.prototype.reverse=tg,B.prototype.toJSON=B.prototype.valueOf=B.prototype.value=ng,B.prototype.first=B.prototype.head,ir&&(B.prototype[ir]=$p),B},rn=qd();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(nt._=rn,define(function(){return rn})):An?((An.exports=rn)._=rn,aa._=rn):nt._=rn}).call(Xn)});var Pl=We((Gi,Po)=>{oe();(function(r,n){typeof Gi=="object"&&typeof Po=="object"?Po.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Gi=="object"?Gi.Ably=n():r.Ably=n()})(window,function(){return function(i){var r={};function n(u){if(r[u])return r[u].exports;var o=r[u]={i:u,l:!1,exports:{}};return i[u].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=i,n.c=r,n.d=function(u,o,g){n.o(u,o)||Object.defineProperty(u,o,{enumerable:!0,get:g})},n.r=function(u){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},n.t=function(u,o){if(o&1&&(u=n(u)),o&8||o&4&&typeof u=="object"&&u&&u.__esModule)return u;var g=Object.create(null);if(n.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:u}),o&2&&typeof u!="string")for(var S in u)n.d(g,S,function(l){return u[l]}.bind(null,S));return g},n.n=function(u){var o=u&&u.__esModule?function(){return u.default}:function(){return u};return n.d(o,"a",o),o},n.o=function(u,o){return Object.prototype.hasOwnProperty.call(u,o)},n.p="",n(n.s=41)}([function(i,r,n){"use strict";r.__esModule=!0;var u=function(){function o(){}return o}();r.default=u},function(i,r,n){"use strict";n.r(r),n.d(r,"__extends",function(){return o}),n.d(r,"__assign",function(){return g}),n.d(r,"__rest",function(){return S}),n.d(r,"__decorate",function(){return l}),n.d(r,"__param",function(){return d}),n.d(r,"__metadata",function(){return b}),n.d(r,"__awaiter",function(){return E}),n.d(r,"__generator",function(){return I}),n.d(r,"__createBinding",function(){return s}),n.d(r,"__exportStar",function(){return m}),n.d(r,"__values",function(){return T}),n.d(r,"__read",function(){return M}),n.d(r,"__spread",function(){return C}),n.d(r,"__spreadArrays",function(){return y}),n.d(r,"__spreadArray",function(){return R}),n.d(r,"__await",function(){return c}),n.d(r,"__asyncGenerator",function(){return v}),n.d(r,"__asyncDelegator",function(){return h}),n.d(r,"__asyncValues",function(){return A}),n.d(r,"__makeTemplateObject",function(){return f}),n.d(r,"__importStar",function(){return P}),n.d(r,"__importDefault",function(){return L}),n.d(r,"__classPrivateFieldGet",function(){return V}),n.d(r,"__classPrivateFieldSet",function(){return H});var u=function(D,_){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,k){x.__proto__=k}||function(x,k){for(var W in k)Object.prototype.hasOwnProperty.call(k,W)&&(x[W]=k[W])},u(D,_)};function o(D,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");u(D,_);function x(){this.constructor=D}D.prototype=_===null?Object.create(_):(x.prototype=_.prototype,new x)}var g=function(){return g=Object.assign||function(_){for(var x,k=1,W=arguments.length;k<W;k++){x=arguments[k];for(var K in x)Object.prototype.hasOwnProperty.call(x,K)&&(_[K]=x[K])}return _},g.apply(this,arguments)};function S(D,_){var x={};for(var k in D)Object.prototype.hasOwnProperty.call(D,k)&&_.indexOf(k)<0&&(x[k]=D[k]);if(D!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,k=Object.getOwnPropertySymbols(D);W<k.length;W++)_.indexOf(k[W])<0&&Object.prototype.propertyIsEnumerable.call(D,k[W])&&(x[k[W]]=D[k[W]]);return x}function l(D,_,x,k){var W=arguments.length,K=W<3?_:k===null?k=Object.getOwnPropertyDescriptor(_,x):k,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(D,_,x,k);else for(var Y=D.length-1;Y>=0;Y--)($=D[Y])&&(K=(W<3?$(K):W>3?$(_,x,K):$(_,x))||K);return W>3&&K&&Object.defineProperty(_,x,K),K}function d(D,_){return function(x,k){_(x,k,D)}}function b(D,_){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(D,_)}function E(D,_,x,k){function W(K){return K instanceof x?K:new x(function($){$(K)})}return new(x||(x=Promise))(function(K,$){function Y(F){try{N(k.next(F))}catch(j){$(j)}}function G(F){try{N(k.throw(F))}catch(j){$(j)}}function N(F){F.done?K(F.value):W(F.value).then(Y,G)}N((k=k.apply(D,_||[])).next())})}function I(D,_){var x={label:0,sent:function(){if(K[0]&1)throw K[1];return K[1]},trys:[],ops:[]},k,W,K,$;return $={next:Y(0),throw:Y(1),return:Y(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function Y(N){return function(F){return G([N,F])}}function G(N){if(k)throw new TypeError("Generator is already executing.");for(;x;)try{if(k=1,W&&(K=N[0]&2?W.return:N[0]?W.throw||((K=W.return)&&K.call(W),0):W.next)&&!(K=K.call(W,N[1])).done)return K;switch(W=0,K&&(N=[N[0]&2,K.value]),N[0]){case 0:case 1:K=N;break;case 4:return x.label++,{value:N[1],done:!1};case 5:x.label++,W=N[1],N=[0];continue;case 7:N=x.ops.pop(),x.trys.pop();continue;default:if(K=x.trys,!(K=K.length>0&&K[K.length-1])&&(N[0]===6||N[0]===2)){x=0;continue}if(N[0]===3&&(!K||N[1]>K[0]&&N[1]<K[3])){x.label=N[1];break}if(N[0]===6&&x.label<K[1]){x.label=K[1],K=N;break}if(K&&x.label<K[2]){x.label=K[2],x.ops.push(N);break}K[2]&&x.ops.pop(),x.trys.pop();continue}N=_.call(D,x)}catch(F){N=[6,F],W=0}finally{k=K=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}var s=Object.create?function(D,_,x,k){k===void 0&&(k=x),Object.defineProperty(D,k,{enumerable:!0,get:function(){return _[x]}})}:function(D,_,x,k){k===void 0&&(k=x),D[k]=_[x]};function m(D,_){for(var x in D)x!=="default"&&!Object.prototype.hasOwnProperty.call(_,x)&&s(_,D,x)}function T(D){var _=typeof Symbol=="function"&&Symbol.iterator,x=_&&D[_],k=0;if(x)return x.call(D);if(D&&typeof D.length=="number")return{next:function(){return D&&k>=D.length&&(D=void 0),{value:D&&D[k++],done:!D}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")}function M(D,_){var x=typeof Symbol=="function"&&D[Symbol.iterator];if(!x)return D;var k=x.call(D),W,K=[],$;try{for(;(_===void 0||_-- >0)&&!(W=k.next()).done;)K.push(W.value)}catch(Y){$={error:Y}}finally{try{W&&!W.done&&(x=k.return)&&x.call(k)}finally{if($)throw $.error}}return K}function C(){for(var D=[],_=0;_<arguments.length;_++)D=D.concat(M(arguments[_]));return D}function y(){for(var D=0,_=0,x=arguments.length;_<x;_++)D+=arguments[_].length;for(var k=Array(D),W=0,_=0;_<x;_++)for(var K=arguments[_],$=0,Y=K.length;$<Y;$++,W++)k[W]=K[$];return k}function R(D,_,x){if(x||arguments.length===2)for(var k=0,W=_.length,K;k<W;k++)(K||!(k in _))&&(K||(K=Array.prototype.slice.call(_,0,k)),K[k]=_[k]);return D.concat(K||Array.prototype.slice.call(_))}function c(D){return this instanceof c?(this.v=D,this):new c(D)}function v(D,_,x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var k=x.apply(D,_||[]),W,K=[];return W={},$("next"),$("throw"),$("return"),W[Symbol.asyncIterator]=function(){return this},W;function $(z){k[z]&&(W[z]=function(ee){return new Promise(function(ce,ve){K.push([z,ee,ce,ve])>1||Y(z,ee)})})}function Y(z,ee){try{G(k[z](ee))}catch(ce){j(K[0][3],ce)}}function G(z){z.value instanceof c?Promise.resolve(z.value.v).then(N,F):j(K[0][2],z)}function N(z){Y("next",z)}function F(z){Y("throw",z)}function j(z,ee){z(ee),K.shift(),K.length&&Y(K[0][0],K[0][1])}}function h(D){var _,x;return _={},k("next"),k("throw",function(W){throw W}),k("return"),_[Symbol.iterator]=function(){return this},_;function k(W,K){_[W]=D[W]?function($){return(x=!x)?{value:c(D[W]($)),done:W==="return"}:K?K($):$}:K}}function A(D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=D[Symbol.asyncIterator],x;return _?_.call(D):(D=typeof T=="function"?T(D):D[Symbol.iterator](),x={},k("next"),k("throw"),k("return"),x[Symbol.asyncIterator]=function(){return this},x);function k(K){x[K]=D[K]&&function($){return new Promise(function(Y,G){$=D[K]($),W(Y,G,$.done,$.value)})}}function W(K,$,Y,G){Promise.resolve(G).then(function(N){K({value:N,done:Y})},$)}}function f(D,_){return Object.defineProperty?Object.defineProperty(D,"raw",{value:_}):D.raw=_,D}var O=Object.create?function(D,_){Object.defineProperty(D,"default",{enumerable:!0,value:_})}:function(D,_){D.default=_};function P(D){if(D&&D.__esModule)return D;var _={};if(D!=null)for(var x in D)x!=="default"&&Object.prototype.hasOwnProperty.call(D,x)&&s(_,D,x);return O(_,D),_}function L(D){return D&&D.__esModule?D:{default:D}}function V(D,_,x,k){if(x==="a"&&!k)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?D!==_||!k:!_.has(D))throw new TypeError("Cannot read private member from an object whose class did not declare it");return x==="m"?k:x==="a"?k.call(D):k?k.value:_.get(D)}function H(D,_,x,k,W){if(k==="m")throw new TypeError("Private method is not writable");if(k==="a"&&!W)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?D!==_||!W:!_.has(D))throw new TypeError("Cannot write private member to an object whose class did not declare it");return k==="a"?W.call(D,x):W?W.value=x:_.set(D,x),x}},function(i,r,n){"use strict";(function(u){r.__esModule=!0,r.allToUpperCase=r.allToLowerCase=r.encodeBody=r.decodeBody=r.Format=r.promisify=r.trim=r.arrChooseN=r.randomHexString=r.randomString=r.cheapRandStr=r.dataSizeBytes=r.inspectBody=r.inspectError=r.isErrorInfo=r.now=r.parseQueryString=r.toQueryString=r.arrPopRandomElement=r.defaultPostHeaders=r.defaultGetHeaders=r.allSame=r.arrEvery=r.arrFilter=r.arrMap=r.safeArrForEach=r.arrForEach=r.forInOwnNonNullProperties=r.valuesArray=r.keysArray=r.arrWithoutValue=r.arrDeleteValue=r.arrIn=r.arrIndexOf=r.arrSubtract=r.arrIntersectOb=r.arrIntersect=r.intersect=r.containsValue=r.inherits=r.prototypicalClone=r.shallowClone=r.isEmptyArg=r.isOnlyPropIn=r.isEmpty=r.isObject=r.ensureArray=r.isArray=r.copy=r.mixin=void 0,r.getGlobalObject=r.getJitterCoefficient=r.getBackoffCoefficient=void 0;var o=n(1),g=o.__importDefault(n(0)),S=o.__importDefault(n(8));function l(X){return Math.floor(Math.random()*X.length)}function d(X){for(var re=[],ue=1;ue<arguments.length;ue++)re[ue-1]=arguments[ue];for(var he=0;he<re.length;he++){var Re=re[he];if(!Re)break;var Xe=Object.prototype.hasOwnProperty;for(var hn in Re)(!Xe||Xe.call(Re,hn))&&(X[hn]=Re[hn])}return X}r.mixin=d;function b(X){return d({},X)}r.copy=b,r.isArray=Array.isArray||function(X){return Object.prototype.toString.call(X)=="[object Array]"};function E(X){return T(X)?[]:r.isArray(X)?X:[X]}r.ensureArray=E;function I(X){return Object.prototype.toString.call(X)=="[object Object]"}r.isObject=I;function s(X){for(var re in X)return!1;return!0}r.isEmpty=s;function m(X,re){for(var ue in X)if(ue!==re)return!1;return!0}r.isOnlyPropIn=m;function T(X){return X==null}r.isEmptyArg=T;function M(X){var re=new Object;for(var ue in X)re[ue]=X[ue];return re}r.shallowClone=M;function C(X,re){var ue=function(){function Re(){}return Re}();ue.prototype=X;var he=new ue;return re&&d(he,re),he}r.prototypicalClone=C;var y=function(X,re){if(g.default.Config.inherits){g.default.Config.inherits(X,re);return}X.super_=re,X.prototype=C(re.prototype,{constructor:X})};r.inherits=y;function R(X,re){for(var ue in X)if(X[ue]==re)return!0;return!1}r.containsValue=R;function c(X,re){return r.isArray(re)?v(X,re):h(X,re)}r.intersect=c;function v(X,re){for(var ue=[],he=0;he<X.length;he++){var Re=X[he];r.arrIndexOf(re,Re)!=-1&&ue.push(Re)}return ue}r.arrIntersect=v;function h(X,re){for(var ue=[],he=0;he<X.length;he++){var Re=X[he];Re in re&&ue.push(Re)}return ue}r.arrIntersectOb=h;function A(X,re){for(var ue=[],he=0;he<X.length;he++){var Re=X[he];r.arrIndexOf(re,Re)==-1&&ue.push(Re)}return ue}r.arrSubtract=A,r.arrIndexOf=Array.prototype.indexOf?function(X,re,ue){return X.indexOf(re,ue)}:function(X,re,ue){ue=ue||0;for(var he=X.length;ue<he;ue++)if(X[ue]===re)return ue;return-1};function f(X,re){return r.arrIndexOf(X,re)!==-1}r.arrIn=f;function O(X,re){var ue=r.arrIndexOf(X,re),he=ue!=-1;return he&&X.splice(ue,1),he}r.arrDeleteValue=O;function P(X,re){var ue=X.slice();return O(ue,re),ue}r.arrWithoutValue=P;function L(X,re){var ue=[];for(var he in X)re&&!Object.prototype.hasOwnProperty.call(X,he)||ue.push(he);return ue}r.keysArray=L;function V(X,re){var ue=[];for(var he in X)re&&!Object.prototype.hasOwnProperty.call(X,he)||ue.push(X[he]);return ue}r.valuesArray=V;function H(X,re){for(var ue in X)Object.prototype.hasOwnProperty.call(X,ue)&&X[ue]&&re(ue)}r.forInOwnNonNullProperties=H,r.arrForEach=Array.prototype.forEach?function(X,re){X.forEach(re)}:function(X,re){for(var ue=X.length,he=0;he<ue;he++)re(X[he],he,X)};function D(X,re){return r.arrForEach(X.slice(),re)}r.safeArrForEach=D,r.arrMap=Array.prototype.map?function(X,re){return X.map(re)}:function(X,re){for(var ue=[],he=X.length,Re=0;Re<he;Re++)ue.push(re(X[Re],Re,X));return ue},r.arrFilter=Array.prototype.filter?function(X,re){return X.filter(re)}:function(X,re){for(var ue=[],he=X.length,Re=0;Re<he;Re++)re(X[Re])&&ue.push(X[Re]);return ue},r.arrEvery=Array.prototype.every?function(X,re){return X.every(re)}:function(X,re){for(var ue=X.length,he=0;he<ue;he++)if(!re(X[he],he,X))return!1;return!0};function _(X,re){if(X.length===0)return!0;var ue=X[0][re];return r.arrEvery(X,function(he){return he[re]===ue})}r.allSame=_;var x={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function k(X){var re=x[X||Se.json];return{accept:re,"X-Ably-Version":S.default.apiVersion,"Ably-Agent":S.default.agent}}r.defaultGetHeaders=k;function W(X){var re,ue=re=x[X||Se.json];return{accept:ue,"content-type":re,"X-Ably-Version":S.default.apiVersion,"Ably-Agent":S.default.agent}}r.defaultPostHeaders=W;function K(X){return X.splice(l(X),1)[0]}r.arrPopRandomElement=K;function $(X){var re=[];if(X)for(var ue in X)re.push(encodeURIComponent(ue)+"="+encodeURIComponent(X[ue]));return re.length?"?"+re.join("&"):""}r.toQueryString=$;function Y(X){for(var re,ue=/([^?&=]+)=?([^&]*)/g,he={};re=ue.exec(X);)he[decodeURIComponent(re[1])]=decodeURIComponent(re[2]);return he}r.parseQueryString=Y,r.now=Date.now||function(){return new Date().getTime()};function G(X){return X.constructor.name=="ErrorInfo"}r.isErrorInfo=G;function N(X){var re,ue;return X instanceof Error||((ue=(re=X)===null||re===void 0?void 0:re.constructor)===null||ue===void 0?void 0:ue.name)==="ErrorInfo"?g.default.Config.inspect(X):X.toString()}r.inspectError=N;function F(X){return g.default.BufferUtils.isBuffer(X)?X.toString():typeof X=="string"?X:g.default.Config.inspect(X)}r.inspectBody=F;function j(X){if(g.default.BufferUtils.isBuffer(X))return g.default.BufferUtils.byteLength(X);if(typeof X=="string")return g.default.Config.stringByteSize(X);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof X)}r.dataSizeBytes=j;function z(){return String(Math.random()).substr(2)}r.cheapRandStr=z;var ee=function(X){if(g.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var re=new Uint8Array(X);return g.default.Config.getRandomValues(re),g.default.BufferUtils.base64Encode(re)}for(var ue=g.default.BufferUtils.base64CharSet,he=Math.round(X*4/3),Re="",Xe=0;Xe<he;Xe++)Re+=ue[l(ue)];return Re};r.randomString=ee;var ce=function(X){if(g.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var re=new Uint8Array(X);return g.default.Config.getRandomValues(re),g.default.BufferUtils.hexEncode(re)}for(var ue=g.default.BufferUtils.hexCharSet,he=X*2,Re="",Xe=0;Xe<he;Xe++)Re+=ue[l(ue)];return Re};r.randomHexString=ce;function ve(X,re){for(var ue=Math.min(re,X.length),he=X.slice(),Re=[],Xe=0;Xe<ue;Xe++)Re.push(K(he));return Re}r.arrChooseN=ve,r.trim=String.prototype.trim?function(X){return X.trim()}:function(X){return X.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function pe(X,re,ue){return new Promise(function(he,Re){X[re].apply(X,o.__spreadArray(o.__spreadArray([],ue),[function(Xe,hn){Xe?Re(Xe):he(hn)}]))})}r.promisify=pe;var Se;(function(X){X.msgpack="msgpack",X.json="json"})(Se=r.Format||(r.Format={}));function Le(X,re){return re=="msgpack"?g.default.Config.msgpack.decode(X):JSON.parse(String(X))}r.decodeBody=Le;function fe(X,re){return re=="msgpack"?g.default.Config.msgpack.encode(X,!0):JSON.stringify(X)}r.encodeBody=fe;function xe(X){return X.map(function(re){return re&&re.toLowerCase()})}r.allToLowerCase=xe;function tt(X){return X.map(function(re){return re&&re.toUpperCase()})}r.allToUpperCase=tt;function Ue(X){return Math.min((X+2)/3,2)}r.getBackoffCoefficient=Ue;function Qe(){return 1-Math.random()*.2}r.getJitterCoefficient=Qe;function ft(){return u||(typeof window!="undefined"?window:self)}r.getGlobalObject=ft}).call(this,n(12))},function(i,r,n){"use strict";(function(u){r.__esModule=!0;var o=n(1),g=o.__importDefault(n(0)),S=u||(typeof window!="undefined"?window:self),l;(function(s){s[s.None=0]="None",s[s.Error=1]="Error",s[s.Major=2]="Major",s[s.Minor=3]="Minor",s[s.Micro=4]="Micro"})(l||(l={}));function d(s,m){return(""+s).padStart(m?3:2,"0")}function b(s){return g.default.Config.logTimestamps?function(m){var T=new Date;s(d(T.getHours())+":"+d(T.getMinutes())+":"+d(T.getSeconds())+"."+d(T.getMilliseconds(),1)+" "+m)}:s}var E=function(){var s,m,T,M;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((m=(s=S==null?void 0:S.console)===null||s===void 0?void 0:s.log)===null||m===void 0?void 0:m.apply)=="function"?(T=function(){for(var C=[],y=0;y<arguments.length;y++)C[y]=arguments[y]},M=console.warn?function(){for(var C=[],y=0;y<arguments.length;y++)C[y]=arguments[y]}:T):S!=null&&S.console.log?T=M=function(){Function.prototype.apply.call(console.log,console,arguments)}:T=M=function(){},[T,M].map(b)},I=function(){function s(){s.logLevel=s.LOG_DEFAULT}return s.initLogHandlers=function(){var m=E(),T=m[0],M=m[1];this.logHandler=T,this.logErrorHandler=M},s.logLevel=l.Error,s.LOG_NONE=l.None,s.LOG_ERROR=l.Error,s.LOG_MAJOR=l.Major,s.LOG_MINOR=l.Minor,s.LOG_MICRO=l.Micro,s.LOG_DEFAULT=l.Error,s.LOG_DEBUG=l.Micro,s.logAction=function(m,T,M){s.shouldLog(m)&&(m===l.Error?s.logErrorHandler:s.logHandler)("Ably: "+T+": "+M)},s.deprecated=function(m,T){s.deprecatedWithMsg(m,"Please use '"+T+"' instead.")},s.deprecatedWithMsg=function(m,T){s.shouldLog(l.Error)&&s.logErrorHandler("Ably: Deprecation warning - '"+m+"' is deprecated and will be removed from a future version. "+T)},s.shouldLog=function(m){return m<=s.logLevel},s.setLog=function(m,T){m!==void 0&&(s.logLevel=m),T!==void 0&&(s.logHandler=s.logErrorHandler=T)},s}();r.default=I}).call(this,n(12))},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){if(typeof ArrayBuffer=="function"){var o=u,g=o.lib,S=g.WordArray,l=S.init,d=S.init=function(b){if(b instanceof ArrayBuffer&&(b=new Uint8Array(b)),(b instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&b instanceof Uint8ClampedArray||b instanceof Int16Array||b instanceof Uint16Array||b instanceof Int32Array||b instanceof Uint32Array||b instanceof Float32Array||b instanceof Float64Array)&&(b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength)),b instanceof Uint8Array){for(var E=b.byteLength,I=[],s=0;s<E;s++)I[s>>>2]|=b[s]<<24-s%4*8;l.call(this,I,E)}else l.apply(this,arguments)};d.prototype=S}}(),u.lib.WordArray})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),g=u.__importStar(n(2)),S=function(){function l(d,b,E,I){this.message=d,this.code=b,this.statusCode=E,this.cause=I}return l.prototype.toString=function(){var d="["+this.constructor.name;return this.message&&(d+=": "+this.message),this.statusCode&&(d+="; statusCode="+this.statusCode),this.code&&(d+="; code="+this.code),this.cause&&(d+="; cause="+g.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(d+="; see "+this.href+" "),d+="]",d},l.fromValues=function(d){var b=d,E=b.message,I=b.code,s=b.statusCode;if(typeof E!="string"||typeof I!="number"||typeof s!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(d));var m=Object.assign(new l(E,I,s),d);return m.code&&!m.href&&(m.href="https://help.ably.io/error/"+m.code),m},l}();r.default=S},function(i,r,n){(function(u){(function(o,g){i.exports=r=g()})(this,function(){var o=o||function(g,S){var l;if(typeof window!="undefined"&&window.crypto&&(l=window.crypto),!l&&typeof window!="undefined"&&window.msCrypto&&(l=window.msCrypto),!l&&typeof u!="undefined"&&u.crypto&&(l=u.crypto),!l)try{l=n(44)}catch(h){}var d=function(){if(l){if(typeof l.getRandomValues=="function")try{return l.getRandomValues(new Uint32Array(1))[0]}catch(h){}if(typeof l.randomBytes=="function")try{return l.randomBytes(4).readInt32LE()}catch(h){}}throw new Error("Native crypto module could not be used to get secure random number.")},b=Object.create||function(){function h(){}return function(A){var f;return h.prototype=A,f=new h,h.prototype=null,f}}(),E={},I=E.lib={},s=I.Base=function(){return{extend:function(h){var A=b(this);return h&&A.mixIn(h),(!A.hasOwnProperty("init")||this.init===A.init)&&(A.init=function(){A.$super.init.apply(this,arguments)}),A.init.prototype=A,A.$super=this,A},create:function(){var h=this.extend();return h.init.apply(h,arguments),h},init:function(){},mixIn:function(h){for(var A in h)h.hasOwnProperty(A)&&(this[A]=h[A]);h.hasOwnProperty("toString")&&(this.toString=h.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),m=I.WordArray=s.extend({init:function(h,A){h=this.words=h||[],A!=S?this.sigBytes=A:this.sigBytes=h.length*4},toString:function(h){return(h||M).stringify(this)},concat:function(h){var A=this.words,f=h.words,O=this.sigBytes,P=h.sigBytes;if(this.clamp(),O%4)for(var L=0;L<P;L++){var V=f[L>>>2]>>>24-L%4*8&255;A[O+L>>>2]|=V<<24-(O+L)%4*8}else for(var L=0;L<P;L+=4)A[O+L>>>2]=f[L>>>2];return this.sigBytes+=P,this},clamp:function(){var h=this.words,A=this.sigBytes;h[A>>>2]&=4294967295<<32-A%4*8,h.length=g.ceil(A/4)},clone:function(){var h=s.clone.call(this);return h.words=this.words.slice(0),h},random:function(h){for(var A=[],f=0;f<h;f+=4)A.push(d());return new m.init(A,h)}}),T=E.enc={},M=T.Hex={stringify:function(h){for(var A=h.words,f=h.sigBytes,O=[],P=0;P<f;P++){var L=A[P>>>2]>>>24-P%4*8&255;O.push((L>>>4).toString(16)),O.push((L&15).toString(16))}return O.join("")},parse:function(h){for(var A=h.length,f=[],O=0;O<A;O+=2)f[O>>>3]|=parseInt(h.substr(O,2),16)<<24-O%8*4;return new m.init(f,A/2)}},C=T.Latin1={stringify:function(h){for(var A=h.words,f=h.sigBytes,O=[],P=0;P<f;P++){var L=A[P>>>2]>>>24-P%4*8&255;O.push(String.fromCharCode(L))}return O.join("")},parse:function(h){for(var A=h.length,f=[],O=0;O<A;O++)f[O>>>2]|=(h.charCodeAt(O)&255)<<24-O%4*8;return new m.init(f,A)}},y=T.Utf8={stringify:function(h){try{return decodeURIComponent(escape(C.stringify(h)))}catch(A){throw new Error("Malformed UTF-8 data")}},parse:function(h){return C.parse(unescape(encodeURIComponent(h)))}},R=I.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new m.init,this._nDataBytes=0},_append:function(h){typeof h=="string"&&(h=y.parse(h)),this._data.concat(h),this._nDataBytes+=h.sigBytes},_process:function(h){var A,f=this._data,O=f.words,P=f.sigBytes,L=this.blockSize,V=L*4,H=P/V;h?H=g.ceil(H):H=g.max((H|0)-this._minBufferSize,0);var D=H*L,_=g.min(D*4,P);if(D){for(var x=0;x<D;x+=L)this._doProcessBlock(O,x);A=O.splice(0,D),f.sigBytes-=_}return new m.init(A,_)},clone:function(){var h=s.clone.call(this);return h._data=this._data.clone(),h},_minBufferSize:0}),c=I.Hasher=R.extend({cfg:s.extend(),init:function(h){this.cfg=this.cfg.extend(h),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(h){return this._append(h),this._process(),this},finalize:function(h){h&&this._append(h);var A=this._doFinalize();return A},blockSize:512/32,_createHelper:function(h){return function(A,f){return new h.init(f).finalize(A)}},_createHmacHelper:function(h){return function(A,f){return new v.HMAC.init(h,f).finalize(A)}}}),v=E.algo={};return E}(Math);return o})}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(3)),S=u.__importDefault(n(0));function l(E,I,s){try{I.apply(E,s)}catch(m){g.default.logAction(g.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+m+"; stack = "+(m&&m.stack))}}function d(E,I,s){for(var m,T,M,C=0;C<E.length;C++)if(m=E[C],s&&(m=m[s]),o.isArray(m)){for(;(T=o.arrIndexOf(m,I))!==-1;)m.splice(T,1);s&&m.length===0&&delete E[C][s]}else if(o.isObject(m))for(M in m)Object.prototype.hasOwnProperty.call(m,M)&&o.isArray(m[M])&&d([m],I,M)}var b=function(){function E(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return E.prototype.on=function(){for(var I=this,s=[],m=0;m<arguments.length;m++)s[m]=arguments[m];if(s.length===1){var T=s[0];if(typeof T=="function")this.any.push(T);else throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(s))}if(s.length===2){var M=s[0],C=s[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(s));if(o.isEmptyArg(M))this.any.push(C);else if(o.isArray(M))M.forEach(function(R){I.on(R,C)});else{if(typeof M!="string")throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(s));var y=this.events[M]||(this.events[M]=[]);y.push(C)}}},E.prototype.off=function(){for(var I,s=this,m=[],T=0;T<arguments.length;T++)m[T]=arguments[T];if(m.length==0||o.isEmptyArg(m[0])&&o.isEmptyArg(m[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var M=m[0],C=m[1],y=null,R=null;if(m.length===1||!C)typeof M=="function"?y=M:R=M;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+S.default.Config.inspect(m));I=[M,C],R=I[0],y=I[1]}if(y&&o.isEmptyArg(R)){d([this.any,this.events,this.anyOnce,this.eventsOnce],y);return}if(o.isArray(R)){R.forEach(function(c){s.off(c,y)});return}if(typeof R!="string")throw new Error("EventEmitter.off(): invalid arguments:"+S.default.Config.inspect(m));y?d([this.events,this.eventsOnce],y,R):(delete this.events[R],delete this.eventsOnce[R])},E.prototype.listeners=function(I){if(I){var s=this.events[I]||[];return this.eventsOnce[I]&&Array.prototype.push.apply(s,this.eventsOnce[I]),s.length?s:null}return this.any.length?this.any:null},E.prototype.emit=function(I){for(var s=[],m=1;m<arguments.length;m++)s[m-1]=arguments[m];var T={event:I},M=[];this.anyOnce.length&&(Array.prototype.push.apply(M,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(M,this.any);var C=this.eventsOnce[I];C&&(Array.prototype.push.apply(M,C),delete this.eventsOnce[I]);var y=this.events[I];y&&Array.prototype.push.apply(M,y),o.arrForEach(M,function(R){l(T,R,s)})},E.prototype.once=function(){for(var I=this,s=[],m=0;m<arguments.length;m++)s[m]=arguments[m];var T=s.length;if((T===0||T===1&&typeof s[0]!="function")&&S.default.Config.Promise){var M=s[0];if(typeof M!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(s));return new S.default.Config.Promise(function(h){I.once(M,h)})}var C=s[0],y=s[1];if(s.length===1&&typeof C=="function")this.anyOnce.push(C);else if(o.isEmptyArg(C)){if(typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(s));this.anyOnce.push(y)}else if(o.isArray(C)){var R=this,c=function(){var h=Array.prototype.slice.call(arguments);if(o.arrForEach(C,function(A){R.off(A,c)}),typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(s));y.apply(this,h)};o.arrForEach(C,function(h){R.on(h,c)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(s));var v=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(y){if(typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(s));v.push(y)}}},E.prototype.whenState=function(I,s,m){for(var T=this,M=[],C=3;C<arguments.length;C++)M[C-3]=arguments[C];var y={event:I};if(typeof I!="string"||typeof s!="string")throw"whenState requires a valid event String argument";if(typeof m!="function"&&S.default.Config.Promise)return new S.default.Config.Promise(function(R){E.prototype.whenState.apply(T,[I,s,R].concat(M))});I===s?l(y,m,M):this.once(I,m)},E}();r.default=b},function(i,r,n){"use strict";r.__esModule=!0,r.getDefaults=r.normaliseOptions=r.objectifyOptions=r.getHosts=r.getFallbackHosts=r.environmentFallbackHosts=r.getHttpScheme=r.getPort=r.getHost=void 0;var u=n(1),o=u.__importDefault(n(0)),g=u.__importStar(n(2)),S=u.__importDefault(n(3)),l=u.__importDefault(n(5)),d=n(42),b="ably-js/"+d.version,E={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:d.version,apiVersion:"1.2",agent:b,getHost:I,getPort:s,getHttpScheme:m,environmentFallbackHosts:T,getFallbackHosts:M,getHosts:C,checkHost:y,objectifyOptions:v,normaliseOptions:h};function I(f,O,P){return P?O=O==f.restHost&&f.realtimeHost||O||f.realtimeHost:O=O||f.restHost,O}r.getHost=I;function s(f,O){return O||f.tls?f.tlsPort:f.port}r.getPort=s;function m(f){return f.tls?"https://":"http://"}r.getHttpScheme=m;function T(f){return[f+"-a-fallback.ably-realtime.com",f+"-b-fallback.ably-realtime.com",f+"-c-fallback.ably-realtime.com",f+"-d-fallback.ably-realtime.com",f+"-e-fallback.ably-realtime.com"]}r.environmentFallbackHosts=T;function M(f){var O=f.fallbackHosts,P=typeof f.httpMaxRetryCount!="undefined"?f.httpMaxRetryCount:E.httpMaxRetryCount;return O?g.arrChooseN(O,P):[]}r.getFallbackHosts=M;function C(f){return[f.restHost].concat(M(f))}r.getHosts=C;function y(f){if(typeof f!="string")throw new l.default("host must be a string; was a "+typeof f,4e4,400);if(!f.length)throw new l.default("host must not be zero-length",4e4,400)}function R(f,O,P){return f.realtimeHost?f.realtimeHost:f.restHost?(S.default.logAction(S.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+f.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+f.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),f.restHost):O?E.REALTIME_HOST:P+"-"+E.REALTIME_HOST}function c(f){var O={};for(var P in E.TIMEOUTS)O[P]=f[P]||E.TIMEOUTS[P];return O}function v(f){return typeof f=="string"?f.indexOf(":")==-1?{token:f}:{key:f}:f}r.objectifyOptions=v;function h(f){if(f.host&&(S.default.deprecated("host","restHost"),f.restHost=f.host),f.wsHost&&(S.default.deprecated("wsHost","realtimeHost"),f.realtimeHost=f.wsHost),f.queueEvents&&(S.default.deprecated("queueEvents","queueMessages"),f.queueMessages=f.queueEvents),f.fallbackHostsUseDefault){if(f.fallbackHosts){var O="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions",O),new l.default(O,4e4,400)}if(f.port||f.tlsPort){var O="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions",O),new l.default(O,4e4,400)}f.environment?S.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):S.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),f.fallbackHosts=E.FALLBACK_HOSTS}f.recover===!0&&(S.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),f.recover=function(k,W){W(!0)}),typeof f.recover=="function"&&f.closeOnUnload===!0&&(S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),f.recover=void 0),"closeOnUnload"in f||(f.closeOnUnload=!f.recover),f.transports&&g.arrIn(f.transports,"xhr")&&(S.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),g.arrDeleteValue(f.transports,"xhr"),f.transports.push("xhr_streaming")),"queueMessages"in f||(f.queueMessages=!0);var P=f.environment&&String(f.environment).toLowerCase()||E.ENVIRONMENT,L=!P||P==="production";!f.fallbackHosts&&!f.restHost&&!f.realtimeHost&&!f.port&&!f.tlsPort&&(f.fallbackHosts=L?E.FALLBACK_HOSTS:T(P));var V=f.restHost||(L?E.REST_HOST:P+"-"+E.REST_HOST),H=R(f,L,P);g.arrForEach((f.fallbackHosts||[]).concat(V,H),y),f.port=f.port||E.PORT,f.tlsPort=f.tlsPort||E.TLS_PORT,"tls"in f||(f.tls=!0);var D=c(f);if("useBinaryProtocol"in f?f.useBinaryProtocol=o.default.Config.supportsBinary&&f.useBinaryProtocol:f.useBinaryProtocol=o.default.Config.preferBinary,f.clientId){var _=f.headers=f.headers||{};_["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(f.clientId))}if("idempotentRestPublishing"in f||(f.idempotentRestPublishing=!0),f.promises&&!o.default.Config.Promise&&(S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),f.promises=!1),f.agents)for(var x in f.agents)E.agent+=" "+x+"/"+f.agents[x];return u.__assign(u.__assign({},f),{useBinaryProtocol:"useBinaryProtocol"in f?o.default.Config.supportsBinary&&f.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:H,restHost:V,maxMessageSize:f.maxMessageSize||E.maxMessageSize,timeouts:D})}r.normaliseOptions=h,r.default=E;function A(f){return Object.assign(E,f)}r.getDefaults=A},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),g=u.__importDefault(n(3)),S=u.__importDefault(n(5)),l=u.__importStar(n(2));function d(s){return!s||!s.channelOptions?{channelOptions:s,plugins:{},baseEncodedPreviousPayload:void 0}:s}function b(s){if(s&&s.cipher&&!s.cipher.channelCipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var m=o.default.Crypto.getCipher(s.cipher);return{cipher:m.cipherParams,channelCipher:m.cipher}}return s}function E(s){var m=0;return s.name&&(m+=s.name.length),s.clientId&&(m+=s.clientId.length),s.extras&&(m+=JSON.stringify(s.extras).length),s.data&&(m+=l.dataSizeBytes(s.data)),m}var I=function(){function s(){}return s.prototype.toJSON=function(){var m=this.encoding,T=this.data;return T&&o.default.BufferUtils.isBuffer(T)&&(arguments.length>0?(m=m?m+"/base64":"base64",T=o.default.BufferUtils.base64Encode(T)):T=o.default.BufferUtils.toBuffer(T)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:m,data:T}},s.prototype.toString=function(){var m="[Message";return this.name&&(m+="; name="+this.name),this.id&&(m+="; id="+this.id),this.timestamp&&(m+="; timestamp="+this.timestamp),this.clientId&&(m+="; clientId="+this.clientId),this.connectionId&&(m+="; connectionId="+this.connectionId),this.encoding&&(m+="; encoding="+this.encoding),this.extras&&(m+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?m+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?m+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):m+="; data (json)="+JSON.stringify(this.data)),this.extras&&(m+="; extras="+JSON.stringify(this.extras)),m+="]",m},s.encrypt=function(m,T,M){var C=m.data,y=m.encoding,R=T.channelCipher;y=y?y+"/":"",o.default.BufferUtils.isBuffer(C)||(C=o.default.BufferUtils.utf8Encode(String(C)),y=y+"utf-8/"),R.encrypt(C,function(c,v){if(c){M(c);return}m.data=v,m.encoding=y+"cipher+"+R.algorithm,M(null,m)})},s.encode=function(m,T,M){var C=m.data,y=typeof C=="string"||o.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!y)if(l.isObject(C)||l.isArray(C))m.data=JSON.stringify(C),m.encoding=m.encoding?m.encoding+"/json":"json";else throw new S.default("Data type is unsupported",40013,400);T!=null&&T.cipher?s.encrypt(m,T,M):M(null,m)},s.encodeArray=function(m,T,M){for(var C=0,y=0;y<m.length;y++)s.encode(m[y],T,function(R){if(R){M(R);return}C++,C==m.length&&M(null,m)})},s.decode=function(m,T){var M=d(T),C=m.data,y=m.encoding;if(y){var R=y.split("/"),c=void 0,v=R.length,h=m.data,A="";try{for(;(c=v)>0;){var f=R[--v].match(/([-\w]+)(\+([\w-]+))?/);if(!f)break;switch(A=f[1],A){case"base64":h=o.default.BufferUtils.base64Decode(String(h)),c==R.length&&(C=h);continue;case"utf-8":h=o.default.BufferUtils.utf8Decode(h);continue;case"json":h=JSON.parse(h);continue;case"cipher":if(M.channelOptions!=null&&M.channelOptions.cipher&&M.channelOptions.channelCipher){var O=f[3],P=M.channelOptions.channelCipher;if(O!=P.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");h=P.decrypt(h);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!M.plugins||!M.plugins.vcdiff)throw new S.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new S.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=M.baseEncodedPreviousPayload;typeof L=="string"&&(L=o.default.BufferUtils.utf8Encode(L)),L=o.default.BufferUtils.toBuffer(L),h=o.default.BufferUtils.toBuffer(h),h=o.default.BufferUtils.typedArrayToBuffer(M.plugins.vcdiff.decode(h,L)),C=h}catch(H){throw new S.default("Vcdiff delta decode failed with "+H,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(H){var V=H;throw new S.default("Error processing the "+A+" encoding, decoder returned \u2018"+V.message+"\u2019",V.code||40013,400)}finally{m.encoding=c<=0?null:R.slice(0,c).join("/"),m.data=h}}M.baseEncodedPreviousPayload=C},s.fromResponseBody=function(m,T,M){M&&(m=l.decodeBody(m,M));for(var C=0;C<m.length;C++){var y=m[C]=s.fromValues(m[C]);try{s.decode(y,T)}catch(R){g.default.logAction(g.default.LOG_ERROR,"Message.fromResponseBody()",R.toString())}}return m},s.fromValues=function(m){return Object.assign(new s,m)},s.fromValuesArray=function(m){for(var T=m.length,M=new Array(T),C=0;C<T;C++)M[C]=s.fromValues(m[C]);return M},s.fromEncoded=function(m,T){var M=s.fromValues(m),C=b(T);try{s.decode(M,C)}catch(y){g.default.logAction(g.default.LOG_ERROR,"Message.fromEncoded()",y.toString())}return M},s.fromEncodedArray=function(m,T){return b(T),m.map(function(M){return s.fromEncoded(M,T)})},s.getMessagesSize=function(m){for(var T,M=0,C=0;C<m.length;C++)T=m[C],M+=T.size||(T.size=E(T));return M},s.serialize=l.encodeBody,s}();r.default=I},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(5)),S=u.__importDefault(n(9)),l=u.__importDefault(n(14)),d={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},b=[];Object.keys(d).forEach(function(M){b[d[M]]=M});var E={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},I=Object.keys(E);E.MODE_ALL=E.PRESENCE|E.PUBLISH|E.SUBSCRIBE|E.PRESENCE_SUBSCRIBE;function s(M){var C=[];if(M)for(var y=0;y<M.length;y++)C.push(M[y].toString());return"[ "+C.join(", ")+" ]"}var m="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),T=function(){function M(){var C=this;this.hasFlag=function(y){return(C.flags&E[y])>0}}return M.prototype.setFlag=function(C){return this.flags=this.flags|E[C]},M.prototype.getMode=function(){return this.flags&&this.flags&E.MODE_ALL},M.prototype.encodeModesToFlags=function(C){var y=this;C.forEach(function(R){return y.setFlag(R)})},M.prototype.decodeModesFromFlags=function(){var C=this,y=[];return M.channelModes.forEach(function(R){C.hasFlag(R)&&y.push(R)}),y.length>0?y:void 0},M.fromValues=function(C){return Object.assign(new M,C)},M.Action=d,M.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],M.ActionName=b,M.serialize=o.encodeBody,M.deserialize=function(C,y){var R=o.decodeBody(C,y);return M.fromDeserialized(R)},M.fromDeserialized=function(C){var y=C.error;y&&(C.error=g.default.fromValues(y));var R=C.messages;if(R)for(var c=0;c<R.length;c++)R[c]=S.default.fromValues(R[c]);var v=C.presence;if(v)for(var c=0;c<v.length;c++)v[c]=l.default.fromValues(v[c],!0);return Object.assign(new M,C)},M.stringify=function(C){var y="[ProtocolMessage";C.action!==void 0&&(y+="; action="+M.ActionName[C.action]||!1);for(var R,c=0;c<m.length;c++)R=m[c],C[R]!==void 0&&(y+="; "+R+"="+C[R]);if(C.messages&&(y+="; messages="+s(S.default.fromValuesArray(C.messages))),C.presence&&(y+="; presence="+s(l.default.fromValuesArray(C.presence))),C.error&&(y+="; error="+g.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(y+="; token="+C.auth.accessToken),C.flags&&(y+="; flags="+I.filter(C.hasFlag).join(",")),C.params){var v="";o.forInOwnNonNullProperties(C.params,function(h){v.length>0&&(v+="; "),v+=h+"="+C.params[h]}),v.length>0&&(y+="; params=["+v+"]")}return y+="]",y},M.isDuplicate=function(C,y){if(C&&y&&(C.action===d.MESSAGE||C.action===d.PRESENCE)&&C.action===y.action&&C.channel===y.channel&&C.id===y.id){if(C.action===d.PRESENCE)return!0;if(C.messages.length===y.messages.length){for(var R=0;R<C.messages.length;R++){var c=C.messages[R],v=y.messages[R];if((c.extras&&c.extras.delta&&c.extras.delta.format)!==(v.extras&&v.extras.delta&&v.extras.delta.format))return!1}return!0}}return!1},M}();r.default=T},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(10)),S=u.__importDefault(n(26)),l=u.__importDefault(n(3)),d=u.__importDefault(n(8)),b=u.__importDefault(n(19)),E=u.__importDefault(n(16)),I=u.__importDefault(n(5)),s=u.__importDefault(n(20)),m=u.__importDefault(n(0));function T(y){var R=[80015,80017,80030];return y.code?E.default.isTokenErr(y)?!1:o.arrIn(R,y.code)?!0:y.code>=4e4&&y.code<5e4:!1}function M(y){return T(y)?[g.default.fromValues({action:g.default.Action.ERROR,error:y})]:[g.default.fromValues({action:g.default.Action.DISCONNECTED,error:y})]}var C=function(y){u.__extends(R,y);function R(c,v,h){var A=y.call(this,c,v,h,!0)||this;return A.onAuthUpdated=function(f){A.authParams={access_token:f.token}},A.stream="stream"in h?h.stream:!0,A.sendRequest=null,A.recvRequest=null,A.pendingCallback=null,A.pendingItems=null,A}return R.prototype.connect=function(){var c=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","starting"),S.default.prototype.connect.call(this);var v=this.params,h=v.options,A=d.default.getHost(h,v.host),f=d.default.getPort(h),O=h.tls?"https://":"http://";this.baseUri=O+A+":"+f+"/comet/";var P=this.baseUri+"connect";l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","uri: "+P),this.auth.getAuthParams(function(L,V){if(L){c.disconnect(L);return}if(!c.isDisposed){c.authParams=V;var H=c.params.getConnectParams(V);"stream"in H&&(c.stream=H.stream),l.default.logAction(l.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(H));var D=!1,_=c.recvRequest=c.createRequest(P,null,H,null,c.stream?s.default.REQ_RECV_STREAM:s.default.REQ_RECV);_.on("data",function(x){!c.recvRequest||(D||(D=!0,c.emit("preconnect")),c.onData(x))}),_.on("complete",function(x){if(c.recvRequest||(x=x||new I.default("Request cancelled",80003,400)),c.recvRequest=null,!D&&!x&&(D=!0,c.emit("preconnect")),c.onActivity(),x){x.code?c.onData(M(x)):c.disconnect(x);return}m.default.Config.nextTick(function(){c.recv()})}),_.exec()}})},R.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},R.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},R.prototype._requestCloseOrDisconnect=function(c){var v=this,h=c?this.closeUri:this.disconnectUri;if(h){var A=this.createRequest(h,null,this.authParams,null,s.default.REQ_SEND);A.on("complete",function(f){f&&(l.default.logAction(l.default.LOG_ERROR,"CometTransport.request"+(c?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(f)),v.finish("disconnected",f))}),A.exec()}},R.prototype.dispose=function(){var c=this;l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(l.default.logAction(l.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",b.default.disconnected),m.default.Config.nextTick(function(){c.emit("disposed")}))},R.prototype.onConnect=function(c){if(!this.isDisposed){var v=c.connectionKey;S.default.prototype.onConnect.call(this,c);var h=this.baseUri+v;l.default.logAction(l.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+h+"; connectionKey = "+c.connectionKey),this.sendUri=h+"/send",this.recvUri=h+"/recv",this.closeUri=h+"/close",this.disconnectUri=h+"/disconnect"}},R.prototype.send=function(c){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(c);return}var v=this.pendingItems||[];v.push(c),this.pendingItems=null,this.sendItems(v)},R.prototype.sendAnyPending=function(){var c=this.pendingItems;!c||(this.pendingItems=null,this.sendItems(c))},R.prototype.sendItems=function(c){var v=this,h=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(c),s.default.REQ_SEND);h.on("complete",function(A,f){if(A&&l.default.logAction(l.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(A)),v.sendRequest=null,A){A.code?v.onData(M(A)):v.disconnect(A);return}f&&v.onData(f),v.pendingItems&&m.default.Config.nextTick(function(){v.sendRequest||v.sendAnyPending()})}),h.exec()},R.prototype.recv=function(){var c=this;if(!this.recvRequest&&!!this.isConnected){var v=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?s.default.REQ_RECV_STREAM:s.default.REQ_RECV_POLL);v.on("data",function(h){c.onData(h)}),v.on("complete",function(h){if(c.recvRequest=null,c.onActivity(),h){h.code?c.onData(M(h)):c.disconnect(h);return}m.default.Config.nextTick(function(){c.recv()})}),v.exec()}},R.prototype.onData=function(c){try{var v=this.decodeResponse(c);if(v&&v.length)for(var h=0;h<v.length;h++)this.onProtocolMessage(g.default.fromDeserialized(v[h]))}catch(A){l.default.logAction(l.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+A.stack)}},R.prototype.encodeRequest=function(c){return JSON.stringify(c)},R.prototype.decodeResponse=function(c){return typeof c=="string"?JSON.parse(c):c},R}(S.default);r.default=C},function(i,r){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(u){typeof window=="object"&&(n=window)}i.exports=n},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){var o=u,g=o.lib,S=g.WordArray,l=o.enc,d=l.Base64={stringify:function(E){var I=E.words,s=E.sigBytes,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.clamp();for(var T=[],M=0;M<s;M+=3)for(var C=I[M>>>2]>>>24-M%4*8&255,y=I[M+1>>>2]>>>24-(M+1)%4*8&255,R=I[M+2>>>2]>>>24-(M+2)%4*8&255,c=C<<16|y<<8|R,v=0;v<4&&M+v*.75<s;v++)T.push(m.charAt(c>>>6*(3-v)&63));var h=m.charAt(64);if(h)for(;T.length%4;)T.push(h);return T.join("")},parse:function(E){var I=E.length,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var T=0;T<s.length;T++)m[s.charCodeAt(T)]=T}var M=s.charAt(64);if(M){var C=E.indexOf(M);C!==-1&&(I=C)}return b(E,I,m)}};function b(E,I,s){for(var m=[],T=0,M=0;M<I;M++)if(M%4){var C=s[E.charCodeAt(M-1)]<<M%4*2,y=s[E.charCodeAt(M)]>>>6-M%4*2,R=C|y;m[T>>>2]|=R<<24-T%4*8,T++}return S.create(m,T)}}(),u.enc.Base64})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(3)),g=u.__importDefault(n(0)),S=u.__importDefault(n(9)),l=u.__importStar(n(2));function d(E){return b.Actions.indexOf(E)}var b=function(){function E(){}return E.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},E.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var I=this.id.split(":");return{connectionId:I[0],msgSerial:parseInt(I[1],10),index:parseInt(I[2],10)}},E.prototype.toJSON=function(){var I=this.data,s=this.encoding;return I&&g.default.BufferUtils.isBuffer(I)&&(arguments.length>0?(s=s?s+"/base64":"base64",I=g.default.BufferUtils.base64Encode(I)):I=g.default.BufferUtils.toBuffer(I)),{clientId:this.clientId,action:d(this.action),data:I,encoding:s}},E.prototype.toString=function(){var I="[PresenceMessage";return I+="; action="+this.action,this.id&&(I+="; id="+this.id),this.timestamp&&(I+="; timestamp="+this.timestamp),this.clientId&&(I+="; clientId="+this.clientId),this.connectionId&&(I+="; connectionId="+this.connectionId),this.encoding&&(I+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?I+="; data="+this.data:g.default.BufferUtils.isBuffer(this.data)?I+="; data (buffer)="+g.default.BufferUtils.base64Encode(this.data):I+="; data (json)="+JSON.stringify(this.data)),I+="]",I},E.fromResponseBody=function(I,s,m){var T=[];m&&(I=l.decodeBody(I,m));for(var M=0;M<I.length;M++){var C=T[M]=E.fromValues(I[M],!0);try{E.decode(C,s)}catch(y){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",y.toString())}}return T},E.fromValues=function(I,s){return s&&(I.action=E.Actions[I.action]),Object.assign(new E,I)},E.fromValuesArray=function(I){for(var s=I.length,m=new Array(s),T=0;T<s;T++)m[T]=E.fromValues(I[T]);return m},E.fromEncoded=function(I,s){var m=E.fromValues(I,!0);try{E.decode(m,s)}catch(T){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",T.toString())}return m},E.fromEncodedArray=function(I,s){return I.map(function(m){return E.fromEncoded(m,s)})},E.Actions=["absent","present","enter","leave","update"],E.encode=S.default.encode,E.decode=S.default.decode,E.getMessagesSize=S.default.getMessagesSize,E}();r.default=b},function(i,r,n){"use strict";(function(u){r.__esModule=!0;var o=n(1),g=o.__importStar(n(2)),S=o.__importDefault(n(7)),l=o.__importDefault(n(5)),d=o.__importDefault(n(3)),b=o.__importDefault(n(8)),E=o.__importDefault(n(20)),I=o.__importDefault(n(0));function s(O,P){return g.arrIn(g.allToLowerCase(g.keysArray(P)),"x-ably-errorcode")}function m(O,P){if(s(O,P))return O.error&&l.default.fromValues(O.error)}var T=function(){},M=0,C={},y=typeof u!="undefined"&&u.XDomainRequest;function R(){var O=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return O&&Number(O[1])}function c(){var O;return y&&(O=R())&&O===10}function v(O,P){return O.getResponseHeader&&O.getResponseHeader(P)}function h(O){return O.getResponseHeader&&(O.getResponseHeader("transfer-encoding")||!O.getResponseHeader("content-length"))}function A(O){for(var P=g.trim(O.getAllResponseHeaders()).split(`\r
`),L={},V=0;V<P.length;V++){var H=P[V].split(":").map(g.trim);L[H[0].toLowerCase()]=H[1]}return L}var f=function(O){o.__extends(P,O);function P(L,V,H,D,_,x,k){var W=O.call(this)||this;return H=H||{},H.rnd=g.cheapRandStr(),c()&&!H.envelope&&(H.envelope="json"),W.uri=L+g.toQueryString(H),W.headers=V||{},W.body=D,W.method=k?k.toUpperCase():g.isEmptyArg(D)?"GET":"POST",W.requestMode=_,W.timeouts=x,W.timedOut=!1,W.requestComplete=!1,W.id=String(++M),C[W.id]=W,W}return P.createRequest=function(L,V,H,D,_,x,k){var W=x||b.default.TIMEOUTS;return new P(L,V,g.copy(H),D,_,W,k)},P.prototype.complete=function(L,V,H,D,_){this.requestComplete||(this.requestComplete=!0,!L&&V&&this.emit("data",V),this.emit("complete",L,V,H,D,_),this.dispose())},P.prototype.abort=function(){this.dispose()},P.prototype.exec=function(){var L=this,V=this.headers,H=this.requestMode==E.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,D=this.timer=setTimeout(function(){L.timedOut=!0,x.abort()},H),_=this.method,x=this.xhr=new XMLHttpRequest,k=V.accept,W=this.body,K="text";if(k?k.indexOf("application/x-msgpack")===0&&(K="arraybuffer"):V.accept="application/json",W){var $=V["content-type"]||(V["content-type"]="application/json");$.indexOf("application/json")>-1&&typeof W!="string"&&(W=JSON.stringify(W))}x.open(_,this.uri,!0),x.responseType=K,"authorization"in V&&(x.withCredentials=!0);for(var Y in V)x.setRequestHeader(Y,V[Y]);var G=function(fe,xe,tt,Ue){var Qe,ft=xe+" (event type: "+fe.type+")";!((Qe=L==null?void 0:L.xhr)===null||Qe===void 0)&&Qe.statusText&&(ft+=", current statusText is "+L.xhr.statusText),d.default.logAction(d.default.LOG_ERROR,"Request.on"+fe.type+"()",ft),L.complete(new l.default(ft,tt,Ue))};x.onerror=function(fe){G(fe,"XHR error occurred",null,400)},x.onabort=function(fe){L.timedOut?G(fe,"Request aborted due to request timeout expiring",null,408):G(fe,"Request cancelled",null,400)},x.ontimeout=function(fe){G(fe,"Request timed out",null,408)};var N,F,j,z=0,ee=!1,ce=function(){if(clearTimeout(D),j=F<400,F==204){L.complete(null,null,null,null,F);return}N=L.requestMode==E.default.REQ_RECV_STREAM&&j&&h(x)},ve=function(){var fe;try{var xe=v(x,"content-type"),tt=xe?xe.indexOf("application/json")>=0:x.responseType=="text";if(tt){var Ue=x.responseType==="arraybuffer"?I.default.BufferUtils.utf8Decode(x.response):String(x.responseText);Ue.length?fe=JSON.parse(Ue):fe=Ue,ee=!0}else fe=x.response;fe.response!==void 0?(F=fe.statusCode,j=F<400,V=fe.headers,fe=fe.response):V=A(x)}catch(ft){L.complete(new l.default("Malformed response body from server: "+ft.message,null,400));return}if(j||g.isArray(fe)){L.complete(null,fe,V,ee,F);return}var Qe=m(fe,V);Qe||(Qe=new l.default("Error response received from server: "+F+" body was: "+I.default.Config.inspect(fe),null,F)),L.complete(Qe,fe,V,ee,F)};function pe(){for(var fe=x.responseText,xe=fe.length-1,tt,Ue;z<xe&&(tt=fe.indexOf(`
`,z))>-1;)Ue=fe.slice(z,tt),z=tt+1,Se(Ue)}var Se=function(fe){try{fe=JSON.parse(fe)}catch(xe){L.complete(new l.default("Malformed response body from server: "+xe.message,null,400));return}L.emit("data",fe)},Le=function(){pe(),L.streamComplete=!0,I.default.Config.nextTick(function(){L.complete()})};x.onreadystatechange=function(){var fe=x.readyState;fe<3||x.status!==0&&(F===void 0&&(F=x.status,F===1223&&(F=204),ce()),fe==3&&N?pe():fe==4&&(N?Le():ve()))},x.send(W)},P.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=T,this.xhr=null;var V=this.timer;V&&(clearTimeout(V),this.timer=null),this.requestComplete||L.abort()}delete C[this.id]},P}(S.default);r.default=f}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(3)),g=u.__importStar(n(2)),S=u.__importDefault(n(22)),l=u.__importDefault(n(5)),d=u.__importDefault(n(43)),b=n(13),E=n(32),I=u.__importDefault(n(17)),s=u.__importDefault(n(0)),m=Math.pow(2,17);function T(){}function M(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function C(H){return!!H.connection}function y(H){return g.isErrorInfo(H)?(H.code||(H.statusCode===403?H.code=40300:(H.code=40170,H.statusCode=401)),H):new l.default(g.inspectError(H),H.code||40170,H.statusCode||401)}var R=function(H){return s.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):b.stringify(E.parse(H))},c=function(H,D){if(s.default.Config.createHmac){var _=s.default.Config.createHmac("SHA256",D);return _.update(H),_.digest("base64")}return b.stringify(d.default(H,D))};function v(H){if(!H)return"";typeof H=="string"&&(H=JSON.parse(H));var D={},_=g.keysArray(H,!0);if(!_)return"";_.sort();for(var x=0;x<_.length;x++)D[_[x]]=H[_[x]].sort();return JSON.stringify(D)}function h(H){if(H.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(H.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(H.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(H.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var D="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",D),new Error(D)}}function A(H){return"useTokenAuth"in H&&!H.useTokenAuth}function f(H){return H.useTokenAuth||!A(H)&&(H.authCallback||H.authUrl||H.token||H.tokenDetails)}function O(H){return!H.key&&!H.authCallback&&!H.authUrl}var P=0;function L(){return P++}var V=function(){function H(D,_){if(this.authOptions={},this.client=D,this.tokenParams=_.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,f(_)){if(_.key&&!c){var x="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",x),new Error(x)}O(_)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(_.defaultTokenParams,_),h(this.authOptions)}else{if(!_.key){var x="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",x),new l.default(x,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(_)}}return H.prototype.authorize=function(D,_,x){var k=this,W;if(typeof D=="function"&&!x?(x=D,W=D=null):typeof _=="function"&&!x?(x=_,W=null):W=_,!x&&this.client.options.promises)return g.promisify(this,"authorize",arguments);if(W&&W.key&&this.authOptions.key!==W.key)throw new l.default("Unable to update auth options with incompatible key",40102,401);W&&"force"in W&&(o.default.logAction(o.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),g.isOnlyPropIn(W,"force")&&(W=null)),this._forceNewToken(D,W,function(K,$){if(K){k.client.connection&&k.client.connection.connectionManager.actOnErrorFromAuthorize(K),x==null||x(K);return}C(k.client)?k.client.connection.connectionManager.onAuthUpdated($,x||T):x==null||x(null,$)})},H.prototype.authorise=function(D,_,x){o.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(D,_,x)},H.prototype._forceNewToken=function(D,_,x){var k=this;this.tokenDetails=null,this._saveTokenOptions(D,_),h(this.authOptions),this._ensureValidAuthCredentials(!0,function(W,K){delete k.tokenParams.timestamp,delete k.authOptions.queryTime,x(W,K)})},H.prototype.requestToken=function(D,_,x){var k=this;if(typeof D=="function"&&!x?(x=D,_=D=null):typeof _=="function"&&!x&&(x=_,_=null),!x&&this.client.options.promises)return g.promisify(this,"requestToken",arguments);_=_||this.authOptions,D=D||g.copy(this.tokenParams);var W=x||T,K,$=this.client;if(_.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),K=_.authCallback;else if(_.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),K=function(z,ee){var ce=g.mixin({accept:"application/json, text/plain"},_.authHeaders),ve=_.authMethod&&_.authMethod.toLowerCase()==="post",pe,Se=_.authUrl.indexOf("?");Se>-1&&(pe=g.parseQueryString(_.authUrl.slice(Se)),_.authUrl=_.authUrl.slice(0,Se),ve||(_.authParams=g.mixin(pe,_.authParams)));var Le=g.mixin({},_.authParams||{},z),fe=function(Ue,Qe,ft,X){var re;if(Ue?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+g.inspectError(Ue)):(re=ft["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+re+"; body: "+g.inspectBody(Qe))),Ue||X)return ee(Ue,Qe);if(s.default.BufferUtils.isBuffer(Qe)&&(Qe=Qe.toString()),!re){ee(new l.default("authUrl response is missing a content-type header",40170,401));return}var ue=re.indexOf("application/json")>-1,he=re.indexOf("text/plain")>-1||re.indexOf("application/jwt")>-1;if(!ue&&!he){ee(new l.default("authUrl responded with unacceptable content-type "+re+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ue){if(Qe.length>m){ee(new l.default("authUrl response exceeded max permitted length",40170,401));return}try{Qe=JSON.parse(Qe)}catch(Re){ee(new l.default("Unexpected error processing authURL response; err = "+Re.message,40170,401));return}}ee(null,Qe,re)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+_.authUrl+"; Params: "+JSON.stringify(Le)+"; method: "+(ve?"POST":"GET")),ve){var xe=ce||{};xe["content-type"]="application/x-www-form-urlencoded";var tt=g.toQueryString(Le).slice(1);k.client.http.doUri(I.default.Post,$,_.authUrl,xe,tt,pe,fe)}else k.client.http.doUri(I.default.Get,$,_.authUrl,ce||{},null,Le,fe)};else if(_.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),K=function(z,ee){k.createTokenRequest(z,_,ee)};else{var Y="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),W(new l.default(Y,40171,403));return}"capability"in D&&(D.capability=v(D.capability));var G=function(z,ee){var ce=z.keyName,ve="/keys/"+ce+"/requestToken",pe=function(Le){return $.baseUri(Le)+ve},Se=g.defaultPostHeaders();_.requestHeaders&&g.mixin(Se,_.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+ve+"; Token params: "+JSON.stringify(z)),k.client.http.do(I.default.Post,$,pe,Se,JSON.stringify(z),null,ee)},N=!1,F=this.client.options.timeouts.realtimeRequestTimeout,j=setTimeout(function(){N=!0;var z="Token request callback timed out after "+F/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",z),W(new l.default(z,40170,401))},F);K(D,function(z,ee,ce){if(!N){if(clearTimeout(j),z){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+g.inspectError(z)),W(y(z));return}if(typeof ee=="string"){ee.length===0?W(new l.default("Token string is empty",40170,401)):ee.length>m?W(new l.default("Token string exceeded max permitted length (was "+ee.length+" bytes)",40170,401)):ee==="undefined"||ee==="null"?W(new l.default("Token string was literal null/undefined",40170,401)):ee[0]==="{"&&!(ce&&ce.indexOf("application/jwt")>-1)?W(new l.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):W(null,{token:ee});return}if(typeof ee!="object"){var ve="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof ee;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",ve),W(new l.default(ve,40170,401));return}var pe=JSON.stringify(ee).length;if(pe>m&&!_.suppressMaxLengthCheck){W(new l.default("Token request/details object exceeded max permitted stringified size (was "+pe+" bytes)",40170,401));return}if("issued"in ee){W(null,ee);return}if(!("keyName"in ee)){var ve="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",ve),W(new l.default(ve,40170,401));return}G(ee,function(Se,Le,fe,xe){if(Se){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+g.inspectError(Se)),W(y(Se));return}xe||(Le=JSON.parse(Le)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),W(null,Le)})}})},H.prototype.createTokenRequest=function(D,_,x){var k=this;if(typeof D=="function"&&!x?(x=D,_=D=null):typeof _=="function"&&!x&&(x=_,_=null),!x&&this.client.options.promises)return g.promisify(this,"createTokenRequest",arguments);_=_||this.authOptions,D=D||g.copy(this.tokenParams);var W=_.key;if(!W){x(new l.default("No key specified",40101,403));return}var K=W.split(":"),$=K[0],Y=K[1];if(!Y){x(new l.default("Invalid key specified",40101,403));return}if(D.clientId===""){x(new l.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in D&&(D.capability=v(D.capability));var G=g.mixin({keyName:$},D),N=D.clientId||"",F=D.ttl||"",j=D.capability||"";(function(z){if(G.timestamp){z();return}k.getTimestamp(_&&_.queryTime,function(ee,ce){if(ee){x(ee);return}G.timestamp=ce,z()})})(function(){var z=G.nonce||(G.nonce=M()),ee=G.timestamp,ce=G.keyName+`
`+F+`
`+j+`
`+N+`
`+ee+`
`+z+`
`;G.mac=G.mac||c(ce,Y),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),x(null,G)})},H.prototype.getAuthParams=function(D){this.method=="basic"?D(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(_,x){if(_){D(_);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");D(null,{access_token:x.token})})},H.prototype.getAuthHeaders=function(D){this.method=="basic"?D(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(_,x){if(_){D(_);return}if(!x)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");D(null,{authorization:"Bearer "+R(x.token)})})},H.prototype.getTimestamp=function(D,_){!this.isTimeOffsetSet()&&(D||this.authOptions.queryTime)?this.client.time(_):_(null,this.getTimestampUsingOffset())},H.prototype.getTimestampUsingOffset=function(){return g.now()+(this.client.serverTimeOffset||0)},H.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},H.prototype._saveBasicOptions=function(D){this.method="basic",this.key=D.key,this.basicKey=R(D.key),this.authOptions=D||{},"clientId"in D&&this._userSetClientId(D.clientId)},H.prototype._saveTokenOptions=function(D,_){this.method="token",D&&(this.tokenParams=D),_&&(_.token&&(_.tokenDetails=typeof _.token=="string"?{token:_.token}:_.token),_.tokenDetails&&(this.tokenDetails=_.tokenDetails),"clientId"in _&&this._userSetClientId(_.clientId),this.authOptions=_)},H.prototype._ensureValidAuthCredentials=function(D,_){var x=this,k=this.tokenDetails;if(k){if(this._tokenClientIdMismatch(k.clientId)){_(new l.default("Mismatch between clientId in token ("+k.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!k.expires||k.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+k.expires),_(null,k);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=S.default.create())).push(_),!(this.currentTokenRequestId!==null&&!D)){var W=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function(K,$){if(x.currentTokenRequestId>W){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}x.currentTokenRequestId=null;var Y=x.waitingForTokenRequest||T;if(x.waitingForTokenRequest=null,K){Y(K);return}Y(null,x.tokenDetails=$)})}},H.prototype._userSetClientId=function(D){if(typeof D=="string"||D===null){if(D==="*")throw new l.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var _=this._uncheckedSetClientId(D);if(_)throw _}else throw new l.default("clientId must be either a string or null",40012,400)},H.prototype._uncheckedSetClientId=function(D){if(this._tokenClientIdMismatch(D)){var _="Unexpected clientId mismatch: client has "+this.clientId+", requested "+D,x=new l.default(_,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",_),x}else return this.clientId=this.tokenParams.clientId=D,null},H.prototype._tokenClientIdMismatch=function(D){return!!(this.clientId&&this.clientId!=="*"&&D&&D!=="*"&&this.clientId!==D)},H.isTokenErr=function(D){return D.code&&D.code>=40140&&D.code<40150},H}();r.default=V},function(i,r,n){"use strict";r.__esModule=!0;var u;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(u||(u={})),r.default=u},function(i,r,n){"use strict";r.__esModule=!0,r.HttpPaginatedResponse=r.PaginatedResult=void 0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(3)),S=u.__importDefault(n(24));function l(m){var T=m.match(/^\.\/(\w+)\?(.*)$/);return T&&T[2]&&o.parseQueryString(T[2])}function d(m){typeof m=="string"&&(m=m.split(","));for(var T={},M=0;M<m.length;M++){var C=m[M].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(C){var y=l(C[1]);y&&(T[C[2]]=y)}}return T}function b(m,T,M){return!(M&&(T||typeof m.code=="number"))}var E=function(){function m(T,M,C,y,R,c){this.rest=T,this.path=M,this.headers=C,this.envelope=y!=null?y:null,this.bodyHandler=R,this.useHttpPaginatedResponse=c||!1}return m.prototype.get=function(T,M){var C=this;S.default.get(this.rest,this.path,this.headers,T,this.envelope,function(y,R,c,v,h){C.handlePage(y,R,c,v,h,M)})},m.prototype.delete=function(T,M){var C=this;S.default.delete(this.rest,this.path,this.headers,T,this.envelope,function(y,R,c,v,h){C.handlePage(y,R,c,v,h,M)})},m.prototype.post=function(T,M,C){var y=this;S.default.post(this.rest,this.path,M,this.headers,T,this.envelope,function(R,c,v,h,A){C&&y.handlePage(R,c,v,h,A,C)})},m.prototype.put=function(T,M,C){var y=this;S.default.put(this.rest,this.path,M,this.headers,T,this.envelope,function(R,c,v,h,A){C&&y.handlePage(R,c,v,h,A,C)})},m.prototype.patch=function(T,M,C){var y=this;S.default.patch(this.rest,this.path,M,this.headers,T,this.envelope,function(R,c,v,h,A){C&&y.handlePage(R,c,v,h,A,C)})},m.prototype.handlePage=function(T,M,C,y,R,c){if(T&&b(T,M,this.useHttpPaginatedResponse)){g.default.logAction(g.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(T)),c==null||c(T);return}var v,h,A;try{v=this.bodyHandler(M,C||{},y)}catch(f){c==null||c(T||f);return}C&&(h=C.Link||C.link)&&(A=d(h)),this.useHttpPaginatedResponse?c(null,new s(this,v,C||{},R,A,T)):c(null,new I(this,v,A))},m}(),I=function(){function m(T,M,C){var y=this;this.resource=T,this.items=M;var R=this;C&&("first"in C&&(this.first=function(c){if(!c&&R.resource.rest.options.promises)return o.promisify(R,"first",[]);R.get(C.first,c)}),"current"in C&&(this.current=function(c){if(!c&&R.resource.rest.options.promises)return o.promisify(R,"current",[]);R.get(C.current,c)}),this.next=function(c){if(!c&&R.resource.rest.options.promises)return o.promisify(R,"next",[]);"next"in C?R.get(C.next,c):c(null)},this.hasNext=function(){return"next"in C},this.isLast=function(){var c;return!(!((c=y.hasNext)===null||c===void 0)&&c.call(y))})}return m.prototype.get=function(T,M){var C=this.resource;S.default.get(C.rest,C.path,C.headers,T,C.envelope,function(y,R,c,v,h){C.handlePage(y,R,c,v,h,M)})},m}();r.PaginatedResult=I;var s=function(m){u.__extends(T,m);function T(M,C,y,R,c,v){var h=m.call(this,M,C,c)||this;return h.statusCode=R,h.success=R<300&&R>=200,h.headers=y,h.errorCode=v&&v.code,h.errorMessage=v&&v.message,h}return T.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},T}(I);r.HttpPaginatedResponse=s,r.default=E},function(i,r,n){"use strict";r.__esModule=!0,r.isRetriable=void 0;var u=n(1),o=u.__importDefault(n(5)),g={disconnected:o.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:o.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:o.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:o.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:o.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:o.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:o.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function S(l){if(!l.statusCode||!l.code||l.statusCode>=500)return!0;var d=!1;return Object.values(g).forEach(function(b){b.code&&b.code==l.code&&(d=!0)}),d}r.isRetriable=S,r.default=g},function(i,r,n){"use strict";r.__esModule=!0;var u;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(u||(u={})),r.default=u},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(4),n(58),n(13),n(39),n(31),n(23),n(27),n(28),n(59),n(60))})(this,function(u){return u})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(3)),g=function(){function S(l){this.members=l||[]}return S.prototype.call=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];for(var b=0,E=this.members;b<E.length;b++){var I=E[b];if(I)try{I.apply(void 0,l)}catch(s){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+s+"; stack = "+s.stack)}}},S.prototype.push=function(){for(var l,d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];(l=this.members).push.apply(l,d)},S.create=function(l){var d=new S(l);return Object.assign(function(){for(var b=[],E=0;E<arguments.length;E++)b[E]=arguments[E];return d.call.apply(d,b)},{push:function(b){return d.push(b)}})},S}();r.default=g},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){(function(){var o=u,g=o.lib,S=g.Base,l=o.enc,d=l.Utf8,b=o.algo,E=b.HMAC=S.extend({init:function(I,s){I=this._hasher=new I.init,typeof s=="string"&&(s=d.parse(s));var m=I.blockSize,T=m*4;s.sigBytes>T&&(s=I.finalize(s)),s.clamp();for(var M=this._oKey=s.clone(),C=this._iKey=s.clone(),y=M.words,R=C.words,c=0;c<m;c++)y[c]^=1549556828,R[c]^=909522486;M.sigBytes=C.sigBytes=T,this.reset()},reset:function(){var I=this._hasher;I.reset(),I.update(this._iKey)},update:function(I){return this._hasher.update(I),this},finalize:function(I){var s=this._hasher,m=s.finalize(I);s.reset();var T=s.finalize(this._oKey.clone().concat(m));return T}})})()})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),g=u.__importStar(n(2)),S=u.__importDefault(n(3)),l=u.__importDefault(n(16)),d=u.__importDefault(n(17)),b=u.__importDefault(n(5));function E(C,y,R,c,v){C.http.supportsAuthHeaders?C.auth.getAuthHeaders(function(h,A){h?c(h):v(g.mixin(A,y),R)}):C.auth.getAuthParams(function(h,A){h?c(h):v(y,g.mixin(A,R))})}function I(C,y){return function(R,c,v,h,A){if(R&&!c){C(R);return}if(!h)try{c=g.decodeBody(c,y)}catch(H){C(H);return}if(!c){C(new b.default("unenvelope(): Response body is missing",null));return}var f=c,O=f.statusCode,P=f.response,L=f.headers;if(O===void 0){C(R,c,v,!0,A);return}if(O<200||O>=300){var V=P&&P.error||R;V||(V=new Error("Error in unenveloping "+c),V.statusCode=O),C(V,P,L,!0,O);return}C(R,P,L,!0,O)}}function s(C){var y=[];if(C)for(var R in C)y.push(R+"="+C[R]);return y.join("&")}function m(C,y){return C+(y?"?":"")+s(y)}function T(C,y,R,c){return function(v,h,A,f,O){v?S.default.logAction(S.default.LOG_MICRO,"Resource."+y+"()","Received Error; "+m(R,c)+"; Error: "+g.inspectError(v)):S.default.logAction(S.default.LOG_MICRO,"Resource."+y+"()","Received; "+m(R,c)+"; Headers: "+s(A)+"; StatusCode: "+O+"; Body: "+(o.default.BufferUtils.isBuffer(h)?h.toString():h)),C&&C(v,h,A,f,O)}}var M=function(){function C(){}return C.get=function(y,R,c,v,h,A){C.do(d.default.Get,y,R,null,c,v,h,A)},C.delete=function(y,R,c,v,h,A){C.do(d.default.Delete,y,R,null,c,v,h,A)},C.post=function(y,R,c,v,h,A,f){C.do(d.default.Post,y,R,c,v,h,A,f)},C.patch=function(y,R,c,v,h,A,f){C.do(d.default.Patch,y,R,c,v,h,A,f)},C.put=function(y,R,c,v,h,A,f){C.do(d.default.Put,y,R,c,v,h,A,f)},C.do=function(y,R,c,v,h,A,f,O){S.default.shouldLog(S.default.LOG_MICRO)&&(O=T(O,y,c,A)),f&&(O=O&&I(O,f),(A=A||{}).envelope=f);function P(L,V){var H;if(S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Resource."+y+"()","Sending; "+m(c,V)),S.default.shouldLog(S.default.LOG_MICRO)){var D=v;if(((H=L["content-type"])===null||H===void 0?void 0:H.indexOf("msgpack"))>0)try{D=o.default.Config.msgpack.decode(v)}catch(_){S.default.logAction(S.default.LOG_MICRO,"Resource."+y+"()","Sending MsgPack Decoding Error: "+g.inspectError(_))}S.default.logAction(S.default.LOG_MICRO,"Resource."+y+"()","Sending; "+m(c,V)+"; Body: "+D)}R.http.do(y,R,c,L,v,V,function(_,x,k,W,K){if(_&&l.default.isTokenErr(_)){R.auth.authorize(null,null,function($){if($){O($);return}E(R,k,V,O,P)});return}O(_,x,k,W,K)})}E(R,h,A,O,P)},C}();r.default=M},function(i,r,n){"use strict";(function(u){r.__esModule=!0,r.TransportParams=void 0;var o=n(1),g=o.__importDefault(n(10)),S=o.__importStar(n(2)),l=o.__importStar(n(51)),d=o.__importDefault(n(8)),b=o.__importDefault(n(0)),E=o.__importDefault(n(7)),I=o.__importDefault(n(35)),s=o.__importDefault(n(3)),m=o.__importDefault(n(36)),T=o.__importStar(n(19)),M=o.__importDefault(n(5)),C=o.__importDefault(n(16)),y=o.__importDefault(n(9)),R=o.__importDefault(n(22)),c=o.__importDefault(n(52)),v=o.__importDefault(n(26)),h=o.__importDefault(n(53)),A=function(){var $;return typeof b.default.WebStorage!="undefined"&&(($=b.default.WebStorage)===null||$===void 0?void 0:$.localSupported)},f=function(){var $;return typeof b.default.WebStorage!="undefined"&&(($=b.default.WebStorage)===null||$===void 0?void 0:$.sessionSupported)},O=g.default.Action,P=function(){},L="ably-transport-preference",V="ably-connection-recovery";function H(){var $,Y;return f()&&((Y=($=b.default.WebStorage)===null||$===void 0?void 0:$.getSession)===null||Y===void 0?void 0:Y.call($,V))}function D($){var Y,G;return f()&&((G=(Y=b.default.WebStorage)===null||Y===void 0?void 0:Y.setSession)===null||G===void 0?void 0:G.call(Y,V,$))}function _(){var $,Y;return f()&&((Y=($=b.default.WebStorage)===null||$===void 0?void 0:$.removeSession)===null||Y===void 0?void 0:Y.call($,V))}function x($,Y){return S.arrIndexOf(b.default.Defaults.transportPreferenceOrder,$.shortName)>S.arrIndexOf(b.default.Defaults.transportPreferenceOrder,Y.shortName)}function k($,Y,G){var N;if($.channel!==Y.channel||(N=$.action)!==O.PRESENCE&&N!==O.MESSAGE||N!==Y.action)return!1;var F=N===O.PRESENCE?"presence":"messages",j=$[F].concat(Y[F]),z=y.default.getMessagesSize(j);return z>G||!S.allSame(j,"clientId")||!S.arrEvery(j,function(ee){return!ee.id})?!1:($[F]=j,!0)}var W=function(){function $(Y,G,N,F){this.options=Y,this.host=G,this.mode=N,this.connectionKey=F,this.format=Y.useBinaryProtocol?S.Format.msgpack:S.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return $.prototype.getConnectParams=function(Y){var G=Y?S.copy(Y):{},N=this.options;switch(this.mode){case"upgrade":G.upgrade=this.connectionKey;break;case"resume":G.resume=this.connectionKey,this.timeSerial!==void 0?G.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(G.connectionSerial=this.connectionSerial);break;case"recover":{var F=N.recover.split(":");if(F){G.recover=F[0];var j=F[1];isNaN(Number(j))?G.timeSerial=j:G.connectionSerial=j}break}default:}return N.clientId!==void 0&&(G.clientId=N.clientId),N.echoMessages===!1&&(G.echo="false"),this.format!==void 0&&(G.format=this.format),this.stream!==void 0&&(G.stream=this.stream),this.heartbeats!==void 0&&(G.heartbeats=this.heartbeats),G.v=d.default.apiVersion,G.agent=encodeURIComponent(d.default.agent),N.transportParams!==void 0&&S.mixin(G,N.transportParams),G},$.prototype.toString=function(){var Y="[mode="+this.mode;return this.host&&(Y+=",host="+this.host),this.connectionKey&&(Y+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(Y+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(Y+=",timeSerial="+this.timeSerial),this.format&&(Y+=",format="+this.format),Y+="]",Y},$}();r.TransportParams=W;var K=function($){o.__extends(Y,$);function Y(G,N){var F=$.call(this)||this;F.disconnectedRetryCount=0,Y.initTransports(),F.realtime=G,F.options=N;var j=N.timeouts,z=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(F.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:z,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},F.state=F.states.initialized,F.errorReason=null,F.queuedMessages=new I.default,F.msgSerial=0,F.connectionDetails=void 0,F.connectionId=void 0,F.connectionKey=void 0,F.timeSerial=void 0,F.connectionSerial=void 0,F.connectionStateTtl=j.connectionStateTtl,F.maxIdleInterval=null,F.transports=S.intersect(N.transports||d.default.defaultTransports,Y.supportedTransports),F.baseTransport=S.intersect(d.default.baseTransportOrder,F.transports)[0],F.upgradeTransports=S.intersect(F.transports,d.default.upgradeTransports),F.transportPreference=null,F.httpHosts=d.default.getHosts(N),F.activeProtocol=null,F.proposedTransports=[],F.pendingTransports=[],F.host=null,F.lastAutoReconnectAttempt=null,F.lastActivity=null,F.mostRecentMsg=null,F.forceFallbackHost=!1,F.connectCounter=0,s.default.logAction(s.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),s.default.logAction(s.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||d.default.defaultTransports)+"]"),s.default.logAction(s.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+F.transports+"]"),s.default.logAction(s.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+F.httpHosts+"]"),!F.transports.length){var ee="no requested transports available";throw s.default.logAction(s.default.LOG_ERROR,"realtime.ConnectionManager()",ee),new Error(ee)}var ce=b.default.Config.addEventListener;return ce&&(f()&&typeof N.recover=="function"&&ce("beforeunload",F.persistConnection.bind(F)),N.closeOnUnload===!0&&ce("beforeunload",function(){s.default.logAction(s.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),F.requestState({state:"closing"})}),ce("online",function(){(F.state==F.states.disconnected||F.state==F.states.suspended)&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),F.requestState({state:"connecting"}))}),ce("offline",function(){F.state==F.states.connected&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),F.disconnectAllTransports())})),F}return Y.initTransports=function(){c.default(Y),S.arrForEach(b.default.Transports,function(G){G(Y)})},Y.prototype.createTransportParams=function(G,N){var F=new W(this.options,G,N,this.connectionKey);return this.timeSerial?F.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(F.connectionSerial=this.connectionSerial),F},Y.prototype.getTransportParams=function(G){var N=this,F=function(j){if(N.connectionKey){j("resume");return}if(typeof N.options.recover=="string"){j("recover");return}var z=N.options.recover,ee=H();if(ee&&typeof z=="function"){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),z(ee,function(ce){ce?(N.options.recover=ee.recoveryKey,j("recover")):j("clean")});return}j("clean")};F(function(j){var z=N.createTransportParams(null,j);if(j==="recover"){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var ee=N.options.recover.split(":");ee&&ee[2]&&(N.msgSerial=Number(ee[2]))}else s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+z.toString());G(z)})},Y.prototype.tryATransport=function(G,N,F){var j=this;s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),v.default.tryConnect(Y.supportedTransports[N],this,this.realtime.auth,G,function(z,ee){var ce=j.state;if(ce==j.states.closing||ce==j.states.closed||ce==j.states.failed){ee&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+ce.state+" while we were attempting the transport; closing "+ee),ee.close()),F(!0);return}if(z){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+z.event+", err: "+z.error.toString()),C.default.isTokenErr(z.error)&&!(j.errorReason&&C.default.isTokenErr(j.errorReason))?(j.errorReason=z.error,j.realtime.auth._forceNewToken(null,null,function(ve){if(ve){j.actOnErrorFromAuthorize(ve);return}j.tryATransport(G,N,F)})):z.event==="failed"?(j.notifyState({state:"failed",error:z.error}),F(!0)):z.event==="disconnected"&&(T.isRetriable(z.error)?F(!1):(j.notifyState({state:j.states.connecting.failState,error:z.error}),F(!0)));return}s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),j.setTransportPending(ee,G),F(null,ee)})},Y.prototype.setTransportPending=function(G,N){var F=this,j=N.mode;s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+G+"; mode = "+j),S.arrDeleteValue(this.proposedTransports,G),this.pendingTransports.push(G);var z=b.default.Defaults.transportPreferenceOrder[b.default.Defaults.transportPreferenceOrder.length-1];G.once("connected",function(ce,ve,pe,Se){j=="upgrade"?G.shortName!==z&&S.arrIn(F.getUpgradePossibilities(),z)&&F.activeProtocol?setTimeout(function(){F.scheduleTransportActivation(ce,G,ve,pe,Se)},F.options.timeouts.parallelUpgradeDelay):F.scheduleTransportActivation(ce,G,ve,pe,Se):(F.activateTransport(ce,G,ve,pe,Se),b.default.Config.nextTick(function(){F.connectImpl(N)})),j==="recover"&&F.options.recover&&(F.options.recover=null,F.unpersistConnection())});var ee=this;G.on(["disconnected","closed","failed"],function(ce){ee.deactivateTransport(G,this.event,ce)}),this.emit("transport.pending",G)},Y.prototype.scheduleTransportActivation=function(G,N,F,j,z){var ee=this,ce=this.activeProtocol&&this.activeProtocol.getTransport(),ve=function(){N.disconnect(),S.arrDeleteValue(ee.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),ve();return}if(ce&&!x(N,ce)){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+ce.shortName+" - abandoning upgrade"),ve();return}s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var pe=function(Se){var Le;if(Se){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+N+"; err = "+Se);return}if(!N.isConnected){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),ve();return}if(ee.state===ee.states.connected)s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),ee.state=ee.states.synchronizing,Le=ee.activeProtocol;else if(ee.state!==ee.states.connecting){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+ee.state.state+(ee.state===ee.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),ve();return}var fe=F!==ee.connectionId,xe=fe?z:ee;fe&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(ee.timeSerial||ee.connectionSerial)+" to "+(xe.timeSerial||xe.connectionSerial)+"; upgrade error was "+G),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N),ee.sync(N,xe,function(tt,Ue,Qe){if(tt){ee.state===ee.states.synchronizing&&(s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+N+"; err = "+tt),ee.disconnectAllTransports());return}var ft=function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),ee.activateTransport(G,N,Ue,j,Qe),ee.state===ee.states.synchronizing?(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),ee.state=ee.states.connected):s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+ee.state.state+", so leaving unchanged"),ee.state.sendEvents&&ee.sendQueuedMessages()};Le?Le.onceIdle(ft):ft()})};ce?this.realtime.channels.onceNopending(pe):pe()},Y.prototype.activateTransport=function(G,N,F,j,z){var ee=this;s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),G&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+G),F&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+F),j&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),z&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(z.timeSerial||z.connectionSerial)),this.persistTransportPreference(N);var ce=this.state,ve=this.states.connected.state;if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ce.state),ce.state==this.states.closing.state||ce.state==this.states.closed.state||ce.state==this.states.failed.state)return s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(S.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var pe=this.activeProtocol;this.activeProtocol=new l.default(N),this.host=N.params.host;var Se=j.connectionKey;if(Se&&this.connectionKey!=Se&&this.setConnection(F,j,z,!!G),this.onConnectionDetailsUpdate(j,N),b.default.Config.nextTick(function(){N.on("connected",function(fe,xe,tt){ee.onConnectionDetailsUpdate(tt,N),ee.emit("update",new m.default(ve,ve,null,fe))})}),ce.state===this.states.connected.state?G&&(this.errorReason=this.realtime.connection.errorReason=G,this.emit("update",new m.default(ve,ve,null,G))):(this.notifyState({state:"connected",error:G}),this.errorReason=this.realtime.connection.errorReason=G||null),this.emit("transport.active",N),pe)if(pe.messageQueue.count()>0&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+pe.transport.shortName+", new one is "+N.shortName+") finishing with "+pe.messageQueue.count()+" messages still pending"),pe.transport===N){var Le="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()",Le)}else pe.finish();return S.safeArrForEach(this.pendingTransports,function(fe){if(fe===N){var xe="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()",xe),S.arrDeleteValue(ee.pendingTransports,N)}else fe.disconnect()}),S.safeArrForEach(this.proposedTransports,function(fe){fe===N?(s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),S.arrDeleteValue(ee.proposedTransports,N)):fe.dispose()}),!0},Y.prototype.deactivateTransport=function(G,N,F){var j=this.activeProtocol,z=j&&j.getTransport()===G,ee=S.arrDeleteValue(this.pendingTransports,G),ce=S.arrDeleteValue(this.proposedTransports,G),ve=this.noTransportsScheduledForActivation();if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+G),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(z?"; was active":ee?"; was pending":ce?"; was proposed":"")+(ve?"":"; another transport is scheduled for activation")),F&&F.message&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+F.message),z&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),b.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",G),z&&ve||z&&N==="failed"||N==="closed"||j===null&&ee&&this.pendingTransports.length===0){if(N==="disconnected"&&F&&F.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:F,retryImmediately:!0});return}var pe=N==="failed"&&C.default.isTokenErr(F)?"disconnected":N;this.notifyState({state:pe,error:F});return}z&&N==="disconnected"&&this.state!==this.states.synchronizing&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:F}))},Y.prototype.noTransportsScheduledForActivation=function(){return S.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(G){return!G.isConnected})},Y.prototype.sync=function(G,N,F){var j=setTimeout(function(){G.off("sync"),F(new M.default("Timeout waiting for sync response",5e4,500))},this.options.timeouts.realtimeRequestTimeout),z=g.default.fromValues({action:O.SYNC,connectionKey:this.connectionKey});N.timeSerial?z.timeSerial=N.timeSerial:N.connectionSerial!==void 0&&(z.connectionSerial=N.connectionSerial),G.send(z),G.once("sync",function(ee,ce){clearTimeout(j),F(null,ee,ce)})},Y.prototype.setConnection=function(G,N,F,j){var z=this,ee=this.connectionId,ce=ee&&ee!==G,ve=!ee&&j;(ce||ve)&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==G?(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),b.default.Config.nextTick(function(){z.realtime.channels.reattach()})):this.options.checkChannelsOnResume&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){z.realtime.channels.checkAttachedMsgIndicators(G)},3e4)),this.realtime.connection.id=this.connectionId=G,this.realtime.connection.key=this.connectionKey=N.connectionKey;var pe=ce||!ee;this.setConnectionSerial(F,pe,!1)},Y.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},Y.prototype.setConnectionSerial=function(G,N,F){var j=G.timeSerial,z=G.connectionSerial;if(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+z+"; timeSerial = "+j+"; force = "+N+"; previous = "+this.connectionSerial),j!==void 0){if(j<=this.timeSerial&&!N)return F&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+j+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=j,this.setRecoveryKey();return}if(z!==void 0){if(z<=this.connectionSerial&&!N)return F&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+z+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=z,this.setRecoveryKey()}},Y.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},Y.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},Y.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},Y.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var G=S.now()-this.lastActivity;G>this.connectionStateTtl+this.maxIdleInterval&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+G+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},Y.prototype.persistConnection=function(){if(f()){var G=this.realtime.connection.recoveryKey;G&&D({recoveryKey:G,disconnectedAt:S.now(),location:u.location,clientId:this.realtime.auth.clientId})}},Y.prototype.unpersistConnection=function(){_()},Y.prototype.getError=function(){return this.errorReason||this.getStateError()},Y.prototype.getStateError=function(){return T.default[this.state.state]},Y.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},Y.prototype.enactStateChange=function(G){var N=G.current==="failed"?s.default.LOG_ERROR:s.default.LOG_MAJOR;s.default.logAction(N,"Connection state",G.current+(G.reason?"; reason: "+G.reason:"")),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+G.current+"; reason = "+(G.reason&&G.reason.message));var F=this.state=this.states[G.current];G.reason&&(this.errorReason=G.reason,this.realtime.connection.errorReason=G.reason),(F.terminal||F.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",G)},Y.prototype.startTransitionTimer=function(G){var N=this;s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+G.state),this.transitionTimer&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,s.default.logAction(s.default.LOG_MINOR,"ConnectionManager "+G.state+" timer expired","requesting new state: "+G.failState),N.notifyState({state:G.failState}))},G.retryDelay)},Y.prototype.cancelTransitionTimer=function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},Y.prototype.startSuspendTimer=function(){var G=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){G.suspendTimer&&(G.suspendTimer=null,s.default.logAction(s.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),G.states.connecting.failState="suspended",G.notifyState({state:"suspended"}))},this.connectionStateTtl))},Y.prototype.checkSuspendTimer=function(G){G!=="disconnected"&&G!=="suspended"&&G!=="connecting"&&this.cancelSuspendTimer()},Y.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},Y.prototype.startRetryTimer=function(G){var N=this;this.retryTimer=setTimeout(function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},G)},Y.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},Y.prototype.notifyState=function(G){var N=this,F=G.state,j=F==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||G.retryImmediately||this.state===this.states.connecting&&G.error&&C.default.isTokenErr(G.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+F+(j?"; will retry connection immediately":"")),F!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(G.state),(F==="suspended"||F==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var z=this.states[G.state],ee=z.retryDelay;z.state==="disconnected"&&(this.disconnectedRetryCount++,ee=z.retryDelay*S.getBackoffCoefficient(this.disconnectedRetryCount)*S.getJitterCoefficient());var ce=new m.default(this.state.state,z.state,ee,G.error||T.default[z.state]);if(j){var ve=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=S.now(),N.requestState({state:"connecting"}))},pe=this.lastAutoReconnectAttempt&&S.now()-this.lastAutoReconnectAttempt+1;pe&&pe<1e3?(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+pe+"ms ago, waiting another "+(1e3-pe)+"ms before trying again"),setTimeout(ve,1e3-pe)):b.default.Config.nextTick(ve)}else(F==="disconnected"||F==="suspended")&&this.startRetryTimer(ee);(F==="disconnected"&&!j||F==="suspended"||z.terminal)&&b.default.Config.nextTick(function(){N.disconnectAllTransports()}),F=="connected"&&!this.activeProtocol&&s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ce),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(F,ce.reason),this.failQueuedMessages(ce.reason))}},Y.prototype.requestState=function(G){var N=this,F=G.state;if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+F+"; current state: "+this.state.state),F!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(F),!(F=="connecting"&&this.state.state=="connected")&&!(F=="closing"&&this.state.state=="closed"))){var j=this.states[F],z=new m.default(this.state.state,j.state,null,G.error||T.default[j.state]);this.enactStateChange(z),F=="connecting"&&b.default.Config.nextTick(function(){N.startConnect()}),F=="closing"&&this.closeImpl()}},Y.prototype.startConnect=function(){var G=this;if(this.state!==this.states.connecting){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,F=++this.connectCounter,j=function(){G.checkConnectionStateFreshness(),G.getTransportParams(function(ee){F===G.connectCounter&&G.connectImpl(ee,F)})};if(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")j();else{var z=function(ee){F===G.connectCounter&&(ee?G.actOnErrorFromAuthorize(ee):j())};this.errorReason&&C.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,z):N._ensureValidAuthCredentials(!1,z)}},Y.prototype.connectImpl=function(G,N){var F=this.state.state;F!==this.states.connecting.state&&F!==this.states.connected.state?s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+F):this.pendingTransports.length?s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):F==this.states.connected.state?this.upgradeIfNeeded(G):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(G):this.connectBase(G,N)},Y.prototype.connectPreference=function(G){var N=this,F=this.getTransportPreference(),j=!1;S.arrIn(this.transports,F)||(this.unpersistTransportPreference(),this.connectImpl(G)),s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+F);var z=setTimeout(function(){j=!0,N.state.state!==N.states.connected.state&&(s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+F+" failed; clearing preference and trying from scratch"),N.disconnectAllTransports(),N.unpersistTransportPreference()),N.connectImpl(G)},this.options.timeouts.preferenceConnectTimeout);G.host=this.httpHosts[0],this.tryATransport(G,F,function(ee,ce){clearTimeout(z),j&&ce?(ce.off(),ce.disconnect(),S.arrDeleteValue(N.pendingTransports,ce)):!ce&&!ee&&(N.unpersistTransportPreference(),N.connectImpl(G))})},Y.prototype.connectBase=function(G,N){var F=this,j=function(pe){F.notifyState({state:F.states.connecting.failState,error:pe})},z=this.httpHosts.slice(),ee=function(pe,Se){N===F.connectCounter&&!Se&&!pe&&ve()};s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var ce=z.shift();if(!ce){j(new M.default("Unable to connect (no available host)",80003,404));return}G.host=ce;var ve=function(){if(!z.length){j(new M.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!F.realtime.http.checkConnectivity){j(new M.default("Internal error: Http.checkConnectivity not set",null,500));return}F.realtime.http.checkConnectivity(function(pe,Se){if(N===F.connectCounter){if(pe){j(pe);return}if(!Se){j(new M.default("Unable to connect (network unreachable)",80003,404));return}G.host=S.arrPopRandomElement(z),F.tryATransport(G,F.baseTransport,ee)}})};if(this.forceFallbackHost&&z.length){this.forceFallbackHost=!1,ve();return}this.tryATransport(G,this.baseTransport,ee)},Y.prototype.getUpgradePossibilities=function(){var G=this.activeProtocol.getTransport().shortName,N=S.arrIndexOf(this.upgradeTransports,G);return this.upgradeTransports.slice(N+1)},Y.prototype.upgradeIfNeeded=function(G){var N=this,F=this.getUpgradePossibilities();s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+b.default.Config.inspect(F)),F.length&&S.arrForEach(F,function(j){var z=N.createTransportParams(G.host,"upgrade");N.tryATransport(z,j,P)})},Y.prototype.closeImpl=function(){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),S.safeArrForEach(this.pendingTransports,function(G){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+G),G&&G.close()}),S.safeArrForEach(this.proposedTransports,function(G){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+G),G&&G.dispose()}),this.activeProtocol&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},Y.prototype.onAuthUpdated=function(G,N){var F=this,j;switch(this.state.state){case"connected":{if(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var z=this.activeProtocol.getTransport().params;b.default.Config.nextTick(function(){F.state.state==="connected"&&F.upgradeIfNeeded(z)})}var ee=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();ee&&ee.onAuthUpdated&&ee.onAuthUpdated(G);var ce=g.default.fromValues({action:O.AUTH,auth:{accessToken:G.token}});this.send(ce);var ve=function(){F.off(pe),N(null,G)},pe=function(Le){Le.current==="failed"&&(F.off(ve),F.off(pe),N(Le.reason||F.getStateError()))};this.once("connectiondetails",ve),this.on("connectionstate",pe);break}case"connecting":s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Se=function(Le){switch(Le.current){case"connected":F.off(Se),N(null,G);break;case"failed":case"closed":case"suspended":F.off(Se),N(Le.reason||F.getStateError());break;default:break}};this.on("connectionstate",Se),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},Y.prototype.disconnectAllTransports=function(G){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(G?" except the active transport":"")),this.connectCounter++,S.safeArrForEach(this.pendingTransports,function(N){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],S.safeArrForEach(this.proposedTransports,function(N){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!G&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},Y.prototype.send=function(G,N,F){F=F||P;var j=this.state;if(j.sendEvents){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new l.PendingMessage(G,F));return}var z=N&&j.queueEvents||j.forceQueueEvents;if(!z){var ee="rejecting event, queueEvent was "+N+", state was "+j.state;s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.send()",ee),F(this.errorReason||new M.default(ee,9e4,400));return}s.default.shouldLog(s.default.LOG_MICRO)&&s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+g.default.stringify(G)),this.queue(G,F)},Y.prototype.sendImpl=function(G){var N=G.message;G.ackRequired&&!G.sendAttempted&&(N.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(G)}catch(F){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+F.stack)}},Y.prototype.queue=function(G,N){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var F=this.queuedMessages.last(),j=this.options.maxMessageSize;F&&!F.sendAttempted&&k(F.message,G,j)?(F.merged||(F.callback=R.default.create([F.callback]),F.merged=!0),F.callback.push(N)):this.queuedMessages.push(new l.PendingMessage(G,N))},Y.prototype.sendQueuedMessages=function(){s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var G;G=this.queuedMessages.shift();)this.sendImpl(G)},Y.prototype.queuePendingMessages=function(G){G&&G.length&&(s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+G.length+" pending messages"),this.queuedMessages.prepend(G))},Y.prototype.failQueuedMessages=function(G){var N=this.queuedMessages.count();N>0&&(s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+S.inspectError(G)),this.queuedMessages.completeAllMessages(G))},Y.prototype.onChannelMessage=function(G,N){var F=this.activeProtocol&&N===this.activeProtocol.getTransport(),j=S.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing,z=G.action===O.MESSAGE||G.action===O.PRESENCE;if(F||j){if(z){var ee=this.setConnectionSerial(G,!1,!0);if(ee)return;if(g.default.isDuplicate(G,this.mostRecentMsg)){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+G.id);return}this.mostRecentMsg=G}this.realtime.channels.onChannelMessage(G)}else S.arrIndexOf([O.ACK,O.NACK,O.ERROR],G.action)>-1?this.realtime.channels.onChannelMessage(G):s.default.logAction(s.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(G)+"on defunct transport; discarding")},Y.prototype.ping=function(G,N){var F=this;if(G){s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+G);var j=function(){G.off("heartbeat",ce),N(new M.default("Timeout waiting for heartbeat response",5e4,500))},z=S.now(),ee=S.cheapRandStr(),ce=function(fe){if(fe===ee){G.off("heartbeat",ce),clearTimeout(ve);var xe=S.now()-z;N(null,xe)}},ve=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);G.on("heartbeat",ce),G.ping(ee);return}if(this.state.state!=="connected"){N(new M.default("Unable to ping service; not connected",4e4,400));return}var pe=!1,Se=function(fe,xe){F.off("transport.active",Le),pe||(pe=!0,N(fe,xe))},Le=function(){pe||(pe=!0,b.default.Config.nextTick(function(){F.ping(null,N)}))};this.on("transport.active",Le),this.ping(this.activeProtocol.getTransport(),Se)},Y.prototype.abort=function(G){this.activeProtocol.getTransport().fail(G)},Y.prototype.registerProposedTransport=function(G){this.proposedTransports.push(G)},Y.prototype.getTransportPreference=function(){var G,N;return this.transportPreference||A()&&((N=(G=b.default.WebStorage)===null||G===void 0?void 0:G.get)===null||N===void 0?void 0:N.call(G,L))},Y.prototype.persistTransportPreference=function(G){var N,F;S.arrIn(d.default.upgradeTransports,G.shortName)&&(this.transportPreference=G.shortName,A()&&((F=(N=b.default.WebStorage)===null||N===void 0?void 0:N.set)===null||F===void 0||F.call(N,L,G.shortName)))},Y.prototype.unpersistTransportPreference=function(){var G,N;this.transportPreference=null,A()&&((N=(G=b.default.WebStorage)===null||G===void 0?void 0:G.remove)===null||N===void 0||N.call(G,L))},Y.prototype.actOnErrorFromAuthorize=function(G){if(G.code===40171)this.notifyState({state:"failed",error:G});else if(G.statusCode===h.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new M.default(N,80019,403,G)})}else{var N="Client configured authentication provider request failed";s.default.logAction(s.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new M.default(N,80019,401,G)})}},Y.prototype.onConnectionDetailsUpdate=function(G,N){if(!!G){this.connectionDetails=G,G.maxMessageSize&&(this.options.maxMessageSize=G.maxMessageSize);var F=G.clientId;if(F){var j=this.realtime.auth._uncheckedSetClientId(F);if(j){s.default.logAction(s.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),N.fail(j);return}}var z=G.connectionStateTtl;z&&(this.connectionStateTtl=z),this.maxIdleInterval=G.maxIdleInterval,this.emit("connectiondetails",G)}},Y.supportedTransports={},Y}(E.default);r.default=K}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(10)),g=u.__importStar(n(2)),S=u.__importDefault(n(7)),l=u.__importDefault(n(3)),d=u.__importDefault(n(19)),b=u.__importDefault(n(5)),E=u.__importDefault(n(0)),I=o.default.Action,s=o.default.fromValues({action:I.CLOSE}),m=o.default.fromValues({action:I.DISCONNECT}),T=function(M){u.__extends(C,M);function C(y,R,c,v){var h=M.call(this)||this;return v&&(c.format=void 0,c.heartbeats=!0),h.connectionManager=y,y.registerProposedTransport(h),h.auth=R,h.params=c,h.timeouts=c.options.timeouts,h.format=c.format,h.isConnected=!1,h.isFinished=!1,h.isDisposed=!1,h.maxIdleInterval=null,h.idleTimer=null,h.lastActivity=null,h}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",d.default.closed)},C.prototype.disconnect=function(y){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",y||d.default.disconnected)},C.prototype.fail=function(y){this.isConnected&&this.requestDisconnect(),this.finish("failed",y||d.default.failed)},C.prototype.finish=function(y,R){var c;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((c=this.idleTimer)!==null&&c!==void 0?c:void 0),this.idleTimer=null,this.emit(y,R),this.dispose())},C.prototype.onProtocolMessage=function(y){switch(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(y)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),y.action){case I.HEARTBEAT:l.default.logAction(l.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",y.id);break;case I.CONNECTED:this.onConnect(y),this.emit("connected",y.error,y.connectionId,y.connectionDetails,y);break;case I.CLOSED:this.onClose(y);break;case I.DISCONNECTED:this.onDisconnect(y);break;case I.ACK:this.emit("ack",y.msgSerial,y.count);break;case I.NACK:this.emit("nack",y.msgSerial,y.count,y.error);break;case I.SYNC:if(y.connectionId!==void 0){this.emit("sync",y.connectionId,y);break}this.connectionManager.onChannelMessage(y,this);break;case I.AUTH:this.auth.authorize(function(R){R&&l.default.logAction(l.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+g.inspectError(R))});break;case I.ERROR:if(l.default.logAction(l.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+E.default.Config.inspect(y.error)+(y.channel?", channel: "+y.channel:"")),y.channel===void 0){this.onFatalError(y);break}this.connectionManager.onChannelMessage(y,this);break;default:this.connectionManager.onChannelMessage(y,this)}},C.prototype.onConnect=function(y){if(this.isConnected=!0,!y.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var R=y.connectionDetails.maxIdleInterval;R&&(this.maxIdleInterval=R+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(y){var R=y&&y.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onDisconnect()","err = "+g.inspectError(R)),this.finish("disconnected",R)},C.prototype.onFatalError=function(y){var R=y&&y.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onFatalError()","err = "+g.inspectError(R)),this.finish("failed",R)},C.prototype.onClose=function(y){var R=y&&y.error;l.default.logAction(l.default.LOG_MINOR,"Transport.onClose()","err = "+g.inspectError(R)),this.finish("closed",R)},C.prototype.requestClose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestClose()",""),this.send(s)},C.prototype.requestDisconnect=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(m)},C.prototype.ping=function(y){var R={action:o.default.Action.HEARTBEAT};y&&(R.id=y),this.send(o.default.fromValues(R))},C.prototype.dispose=function(){l.default.logAction(l.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=g.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(y){var R=this;this.idleTimer||(this.idleTimer=setTimeout(function(){R.onIdleTimerExpire()},y))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var y=g.now()-this.lastActivity,R=this.maxIdleInterval-y;if(R<=0){var c="No activity seen from realtime in "+y+"ms; assuming connection has dropped";l.default.logAction(l.default.LOG_ERROR,"Transport.onIdleTimerExpire()",c),this.disconnect(new b.default(c,80003,408))}else this.setIdleTimer(R+100)},C.tryConnect=function(y,R,c,v,h){var A=new y(R,c,v),f,O=function(L){clearTimeout(f),h({event:this.event,error:L})},P=R.options.timeouts.realtimeRequestTimeout;f=setTimeout(function(){A.off(["preconnect","disconnected","failed"]),A.dispose(),O.call({event:"disconnected"},new b.default("Timeout waiting for transport to indicate itself viable",5e4,500))},P),A.on(["failed","disconnected"],O),A.on("preconnect",function(){l.default.logAction(l.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+A),clearTimeout(f),A.off(["failed","disconnected"],O),h(null,A)}),A.connect()},C}(S.default);r.default=T},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(39),n(23))})(this,function(u){return function(){var o=u,g=o.lib,S=g.Base,l=g.WordArray,d=o.algo,b=d.MD5,E=d.EvpKDF=S.extend({cfg:S.extend({keySize:128/32,hasher:b,iterations:1}),init:function(I){this.cfg=this.cfg.extend(I)},compute:function(I,s){for(var m,T=this.cfg,M=T.hasher.create(),C=l.create(),y=C.words,R=T.keySize,c=T.iterations;y.length<R;){m&&M.update(m),m=M.update(I).finalize(s),M.reset();for(var v=1;v<c;v++)m=M.finalize(m),M.reset();C.concat(m)}return C.sigBytes=R*4,C}});o.EvpKDF=function(I,s,m){return E.create(m).compute(I,s)}}(),u.EvpKDF})},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(27))})(this,function(u){u.lib.Cipher||function(o){var g=u,S=g.lib,l=S.Base,d=S.WordArray,b=S.BufferedBlockAlgorithm,E=g.enc,I=E.Utf8,s=E.Base64,m=g.algo,T=m.EvpKDF,M=S.Cipher=b.extend({cfg:l.extend(),createEncryptor:function(_,x){return this.create(this._ENC_XFORM_MODE,_,x)},createDecryptor:function(_,x){return this.create(this._DEC_XFORM_MODE,_,x)},init:function(_,x,k){this.cfg=this.cfg.extend(k),this._xformMode=_,this._key=x,this.reset()},reset:function(){b.reset.call(this),this._doReset()},process:function(_){return this._append(_),this._process()},finalize:function(_){_&&this._append(_);var x=this._doFinalize();return x},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function _(x){return typeof x=="string"?D:L}return function(x){return{encrypt:function(k,W,K){return _(W).encrypt(x,k,W,K)},decrypt:function(k,W,K){return _(W).decrypt(x,k,W,K)}}}}()}),C=S.StreamCipher=M.extend({_doFinalize:function(){var _=this._process(!0);return _},blockSize:1}),y=g.mode={},R=S.BlockCipherMode=l.extend({createEncryptor:function(_,x){return this.Encryptor.create(_,x)},createDecryptor:function(_,x){return this.Decryptor.create(_,x)},init:function(_,x){this._cipher=_,this._iv=x}}),c=y.CBC=function(){var _=R.extend();_.Encryptor=_.extend({processBlock:function(k,W){var K=this._cipher,$=K.blockSize;x.call(this,k,W,$),K.encryptBlock(k,W),this._prevBlock=k.slice(W,W+$)}}),_.Decryptor=_.extend({processBlock:function(k,W){var K=this._cipher,$=K.blockSize,Y=k.slice(W,W+$);K.decryptBlock(k,W),x.call(this,k,W,$),this._prevBlock=Y}});function x(k,W,K){var $,Y=this._iv;Y?($=Y,this._iv=o):$=this._prevBlock;for(var G=0;G<K;G++)k[W+G]^=$[G]}return _}(),v=g.pad={},h=v.Pkcs7={pad:function(_,x){for(var k=x*4,W=k-_.sigBytes%k,K=W<<24|W<<16|W<<8|W,$=[],Y=0;Y<W;Y+=4)$.push(K);var G=d.create($,W);_.concat(G)},unpad:function(_){var x=_.words[_.sigBytes-1>>>2]&255;_.sigBytes-=x}},A=S.BlockCipher=M.extend({cfg:M.cfg.extend({mode:c,padding:h}),reset:function(){var _;M.reset.call(this);var x=this.cfg,k=x.iv,W=x.mode;this._xformMode==this._ENC_XFORM_MODE?_=W.createEncryptor:(_=W.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==_?this._mode.init(this,k&&k.words):(this._mode=_.call(W,this,k&&k.words),this._mode.__creator=_)},_doProcessBlock:function(_,x){this._mode.processBlock(_,x)},_doFinalize:function(){var _,x=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(x.pad(this._data,this.blockSize),_=this._process(!0)):(_=this._process(!0),x.unpad(_)),_},blockSize:128/32}),f=S.CipherParams=l.extend({init:function(_){this.mixIn(_)},toString:function(_){return(_||this.formatter).stringify(this)}}),O=g.format={},P=O.OpenSSL={stringify:function(_){var x,k=_.ciphertext,W=_.salt;return W?x=d.create([1398893684,1701076831]).concat(W).concat(k):x=k,x.toString(s)},parse:function(_){var x,k=s.parse(_),W=k.words;return W[0]==1398893684&&W[1]==1701076831&&(x=d.create(W.slice(2,4)),W.splice(0,4),k.sigBytes-=16),f.create({ciphertext:k,salt:x})}},L=S.SerializableCipher=l.extend({cfg:l.extend({format:P}),encrypt:function(_,x,k,W){W=this.cfg.extend(W);var K=_.createEncryptor(k,W),$=K.finalize(x),Y=K.cfg;return f.create({ciphertext:$,key:k,iv:Y.iv,algorithm:_,mode:Y.mode,padding:Y.padding,blockSize:_.blockSize,formatter:W.format})},decrypt:function(_,x,k,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var K=_.createDecryptor(k,W).finalize(x.ciphertext);return K},_parse:function(_,x){return typeof _=="string"?x.parse(_,this):_}}),V=g.kdf={},H=V.OpenSSL={execute:function(_,x,k,W){W||(W=d.random(64/8));var K=T.create({keySize:x+k}).compute(_,W),$=d.create(K.words.slice(x),k*4);return K.sigBytes=x*4,f.create({key:K,iv:$,salt:W})}},D=S.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:H}),encrypt:function(_,x,k,W){W=this.cfg.extend(W);var K=W.kdf.execute(k,_.keySize,_.ivSize);W.iv=K.iv;var $=L.encrypt.call(this,_,x,K.key,W);return $.mixIn(K),$},decrypt:function(_,x,k,W){W=this.cfg.extend(W),x=this._parse(x,W.format);var K=W.kdf.execute(k,_.keySize,_.ivSize,x.salt);W.iv=K.iv;var $=L.decrypt.call(this,_,x,K.key,W);return $}})}()})},function(i,r,n){"use strict";r.__esModule=!0,r.Request=r.createRequest=void 0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(11)),S=u.__importDefault(n(0)),l=u.__importDefault(n(7)),d=u.__importDefault(n(5)),b=u.__importDefault(n(8)),E=u.__importDefault(n(3)),I=u.__importDefault(n(20)),s=o.getGlobalObject(),m=function(){},T=s._ablyjs_jsonp={};T._=function(h){return T["_"+h]||m};var M=1,C="jsonp";function y(h,A,f,O,P,L,V){return L=L||b.default.TIMEOUTS,new c(void 0,h,A,o.copy(f),O,P,L,V)}r.createRequest=y;var R=function(h){u.__extends(A,h);function A(f,O,P){var L=h.call(this,f,O,P)||this;return L.shortName=C,P.stream=!1,L}return A.isAvailable=function(){return S.default.Config.jsonpSupported&&S.default.Config.allowComet},A.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},A.prototype.createRequest=function(f,O,P,L,V,H,D){return H=(this===null||this===void 0?void 0:this.timeouts)||H||b.default.TIMEOUTS,y(f,O,P,L,V,H,D)},A}(g.default),c=function(h){u.__extends(A,h);function A(f,O,P,L,V,H,D,_){var x=h.call(this)||this;return f===void 0&&(f=M++),x.id=f,x.uri=O,x.params=L||{},x.params.rnd=o.cheapRandStr(),P&&(P["X-Ably-Version"]&&(x.params.v=P["X-Ably-Version"]),P["X-Ably-Lib"]&&(x.params.lib=P["X-Ably-Lib"])),x.body=V,x.method=_,x.requestMode=H,x.timeouts=D,x.requestComplete=!1,x}return A.prototype.exec=function(){var f=this,O=this.id,P=this.body,L=this.method,V=this.uri,H=this.params;H.callback="_ablyjs_jsonp._("+O+")",H.envelope="jsonp",P&&(H.body=P),L&&L!=="get"&&(H.method=L);var D=this.script=document.createElement("script"),_=V+o.toQueryString(H);D.src=_,D.src.split("/").slice(-1)[0]!==_.split("/").slice(-1)[0]&&E.default.logAction(E.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),D.async=!0,D.type="text/javascript",D.charset="UTF-8",D.onerror=function(W){f.complete(new d.default("JSONP script error (event: "+S.default.Config.inspect(W)+")",null,400))},T["_"+O]=function(W){if(W.statusCode){var K=W.response;if(W.statusCode==204)f.complete(null,null,null,W.statusCode);else if(!K)f.complete(new d.default("Invalid server response: no envelope detected",null,500));else if(W.statusCode<400||o.isArray(K))f.complete(null,K,W.headers,W.statusCode);else{var $=K.error||new d.default("Error response received from server",null,W.statusCode);f.complete($)}}else f.complete(null,W)};var x=this.requestMode==I.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),x);var k=document.getElementsByTagName("head")[0];k.insertBefore(D,k.firstChild)},A.prototype.complete=function(f,O,P,L){if(P=P||{},!this.requestComplete){this.requestComplete=!0;var V=void 0;O&&(V=typeof O=="string"?"text/plain":"application/json",P["content-type"]=V,this.emit("data",O)),this.emit("complete",f,O,P,!0,L),this.dispose()}},A.prototype.abort=function(){this.dispose()},A.prototype.dispose=function(){var f=this.timer;f&&(clearTimeout(f),this.timer=null);var O=this.script;O.parentNode&&O.parentNode.removeChild(O),delete T[this.id],this.emit("disposed")},A}(l.default);r.Request=c;function v(h){return s.JSONPTransport=R,R.isAvailable()&&(h.supportedTransports[C]=R),R}r.default=v},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(3)),S=u.__importDefault(n(8)),l=u.__importDefault(n(16)),d=u.__importDefault(n(45)),b=u.__importDefault(n(18)),E=u.__importDefault(n(33)),I=u.__importDefault(n(5)),s=u.__importDefault(n(48)),m=u.__importDefault(n(17)),T=u.__importDefault(n(0)),M=function(){},C=function(){function R(c){if(!c){var v="no options provided";throw g.default.logAction(g.default.LOG_ERROR,"Rest()",v),new Error(v)}var h=S.default.objectifyOptions(c);h.log&&g.default.setLog(h.log.level,h.log.handler),g.default.logAction(g.default.LOG_MICRO,"Rest()","initialized with clientOptions "+T.default.Config.inspect(c));var A=this.options=S.default.normaliseOptions(h);if(A.key){var f=A.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!f){var v="invalid key parameter";throw g.default.logAction(g.default.LOG_ERROR,"Rest()",v),new I.default(v,40400,404)}A.keyName=f[1],A.keySecret=f[2]}if("clientId"in A)if(typeof A.clientId=="string"||A.clientId===null){if(A.clientId==="*")throw new I.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new I.default("clientId must be either a string or null",40012,400);g.default.logAction(g.default.LOG_MINOR,"Rest()","started; version = "+S.default.version),this.baseUri=this.authority=function(O){return S.default.getHttpScheme(A)+O+":"+S.default.getPort(A,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new T.default.Http,this.auth=new l.default(this,A),this.channels=new y(this),this.push=new d.default(this)}return R.prototype.stats=function(c,v){if(v===void 0)if(typeof c=="function")v=c,c=null;else{if(this.options.promises)return o.promisify(this,"stats",arguments);v=M}var h=o.defaultGetHeaders(),A=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=this.http.supportsLinkHeaders?void 0:A;this.options.headers&&o.mixin(h,this.options.headers),new b.default(this,"/stats",h,f,function(O,P,L){for(var V=L?O:JSON.parse(O),H=0;H<V.length;H++)V[H]=s.default.fromValues(V[H]);return V}).get(c,v)},R.prototype.time=function(c,v){var h=this;if(v===void 0){if(typeof c=="function")v=c,c=null;else if(this.options.promises)return o.promisify(this,"time",arguments)}var A=v||M,f=o.defaultGetHeaders();this.options.headers&&o.mixin(f,this.options.headers);var O=function(P){return h.authority(P)+"/time"};this.http.do(m.default.Get,this,O,f,null,c,function(P,L,V,H){if(P){A(P);return}H||(L=JSON.parse(L));var D=L[0];if(!D){A(new I.default("Internal error (unexpected result type from GET /time)",5e4,500));return}h.serverTimeOffset=D-o.now(),A(null,D)})},R.prototype.request=function(c,v,h,A,f,O){var P=this.options.useBinaryProtocol,L=P?T.default.Config.msgpack.encode:JSON.stringify,V=P?T.default.Config.msgpack.decode:JSON.parse,H=P?o.Format.msgpack:o.Format.json,D=this.http.supportsLinkHeaders?void 0:H;h=h||{};var _=c.toLowerCase(),x=_=="get"?o.defaultGetHeaders(H):o.defaultPostHeaders(H);if(O===void 0){if(this.options.promises)return o.promisify(this,"request",arguments);O=M}typeof A!="string"&&(A=L(A)),this.options.headers&&o.mixin(x,this.options.headers),f&&o.mixin(x,f);var k=new b.default(this,v,x,D,function(W,K,$){return o.ensureArray($?W:V(W))},!0);if(!o.arrIn(T.default.Http.methods,_))throw new I.default("Unsupported method "+_,40500,405);o.arrIn(T.default.Http.methodsWithBody,_)?k[_](h,A,O):k[_](h,O)},R.prototype.setLog=function(c){g.default.setLog(c.level,c.handler)},R.Promise=function(c){return c=S.default.objectifyOptions(c),c.promises=!0,new R(c)},R.Callbacks=R,R.Platform=T.default,R}(),y=function(){function R(c){this.rest=c,this.all={}}return R.prototype.get=function(c,v){c=String(c);var h=this.all[c];return h?v&&h.setOptions(v):this.all[c]=h=new E.default(this.rest,c,v),h},R.prototype.release=function(c){delete this.all[String(c)]},R}();r.default=C},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(o){var g=u,S=g.lib,l=S.WordArray,d=S.Hasher,b=g.algo,E=[],I=[];(function(){function T(R){for(var c=o.sqrt(R),v=2;v<=c;v++)if(!(R%v))return!1;return!0}function M(R){return(R-(R|0))*4294967296|0}for(var C=2,y=0;y<64;)T(C)&&(y<8&&(E[y]=M(o.pow(C,1/2))),I[y]=M(o.pow(C,1/3)),y++),C++})();var s=[],m=b.SHA256=d.extend({_doReset:function(){this._hash=new l.init(E.slice(0))},_doProcessBlock:function(T,M){for(var C=this._hash.words,y=C[0],R=C[1],c=C[2],v=C[3],h=C[4],A=C[5],f=C[6],O=C[7],P=0;P<64;P++){if(P<16)s[P]=T[M+P]|0;else{var L=s[P-15],V=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,H=s[P-2],D=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;s[P]=V+s[P-7]+D+s[P-16]}var _=h&A^~h&f,x=y&R^y&c^R&c,k=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),W=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),K=O+W+_+I[P]+s[P],$=k+x;O=f,f=A,A=h,h=v+K|0,v=c,c=R,R=y,y=K+$|0}C[0]=C[0]+y|0,C[1]=C[1]+R|0,C[2]=C[2]+c|0,C[3]=C[3]+v|0,C[4]=C[4]+h|0,C[5]=C[5]+A|0,C[6]=C[6]+f|0,C[7]=C[7]+O|0},_doFinalize:function(){var T=this._data,M=T.words,C=this._nDataBytes*8,y=T.sigBytes*8;return M[y>>>5]|=128<<24-y%32,M[(y+64>>>9<<4)+14]=o.floor(C/4294967296),M[(y+64>>>9<<4)+15]=C,T.sigBytes=M.length*4,this._process(),this._hash},clone:function(){var T=d.clone.call(this);return T._hash=this._hash.clone(),T}});g.SHA256=d._createHelper(m),g.HmacSHA256=d._createHmacHelper(m)}(Math),u.SHA256})},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return u.enc.Utf8})},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(7)),S=u.__importDefault(n(3)),l=u.__importDefault(n(34)),d=u.__importDefault(n(9)),b=u.__importDefault(n(5)),E=u.__importDefault(n(18)),I=u.__importDefault(n(24)),s=u.__importDefault(n(0));function m(){}var T=9;function M(R){return o.arrEvery(R,function(c){return!c.id})}function C(R){var c=R||{};if(c.cipher){if(!s.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var v=s.default.Crypto.getCipher(c.cipher);c.cipher=v.cipherParams,c.channelCipher=v.cipher}else"cipher"in c&&(c.cipher=void 0,c.channelCipher=null);return c}var y=function(R){u.__extends(c,R);function c(v,h,A){var f=R.call(this)||this;return S.default.logAction(S.default.LOG_MINOR,"Channel()","started; name = "+h),f.rest=v,f.name=h,f.basePath="/channels/"+encodeURIComponent(h),f.presence=new l.default(f),f.channelOptions=C(A),f}return c.prototype.setOptions=function(v){this.channelOptions=C(v)},c.prototype.history=function(v,h){if(S.default.logAction(S.default.LOG_MICRO,"Channel.history()","channel = "+this.name),h===void 0)if(typeof v=="function")h=v,v=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);h=m}this._history(v,h)},c.prototype._history=function(v,h){var A=this.rest,f=A.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,O=this.rest.http.supportsLinkHeaders?void 0:f,P=o.defaultGetHeaders(f);A.options.headers&&o.mixin(P,A.options.headers);var L=this.channelOptions;new E.default(A,this.basePath+"/messages",P,O,function(V,H,D){return d.default.fromResponseBody(V,L,D?void 0:f)}).get(v,h)},c.prototype.publish=function(){var v=this,h=arguments.length,A=arguments[0],f=arguments[1],O=arguments[h-1],P,L;if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);O=m}if(typeof A=="string"||A===null)P=[d.default.fromValues({name:A,data:f})],L=arguments[2];else if(o.isObject(A))P=[d.default.fromValues(A)],L=arguments[1];else if(o.isArray(A))P=d.default.fromValuesArray(A),L=arguments[1];else throw new b.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var V=this.rest,H=V.options,D=H.useBinaryProtocol?o.Format.msgpack:o.Format.json,_=V.options.idempotentRestPublishing,x=o.defaultPostHeaders(D);if(H.headers&&o.mixin(x,H.headers),_&&M(P)){var k=o.randomString(T);o.arrForEach(P,function(W,K){W.id=k+":"+K.toString()})}d.default.encodeArray(P,this.channelOptions,function(W){if(W){O(W);return}var K=d.default.getMessagesSize(P),$=H.maxMessageSize;if(K>$){O(new b.default("Maximum size of messages that can be published at once exceeded ( was "+K+" bytes; limit is "+$+" bytes)",40009,400));return}v._publish(d.default.serialize(P,D),x,L,O)})},c.prototype._publish=function(v,h,A,f){I.default.post(this.rest,this.basePath+"/messages",v,h,A,null,f)},c.prototype.status=function(v){if(typeof v!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var h=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,A=o.defaultPostHeaders(h);I.default.get(this.rest,this.basePath,A,{},h,v||m)},c}(g.default);r.default=y},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(7)),S=u.__importDefault(n(3)),l=u.__importDefault(n(18)),d=u.__importDefault(n(14));function b(){}var E=function(I){u.__extends(s,I);function s(m){var T=I.call(this)||this;return T.channel=m,T.basePath=m.basePath+"/presence",T}return s.prototype.get=function(m,T){if(S.default.logAction(S.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),T===void 0)if(typeof m=="function")T=m,m=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);T=b}var M=this.channel.rest,C=M.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.channel.rest.http.supportsLinkHeaders?void 0:C,R=o.defaultGetHeaders(C);M.options.headers&&o.mixin(R,M.options.headers);var c=this.channel.channelOptions;new l.default(M,this.basePath,R,y,function(v,h,A){return d.default.fromResponseBody(v,c,A?void 0:C)}).get(m,T)},s.prototype.history=function(m,T){S.default.logAction(S.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(m,T)},s.prototype._history=function(m,T){if(T===void 0)if(typeof m=="function")T=m,m=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",arguments);T=b}var M=this.channel.rest,C=M.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.channel.rest.http.supportsLinkHeaders?void 0:C,R=o.defaultGetHeaders(C);M.options.headers&&o.mixin(R,M.options.headers);var c=this.channel.channelOptions;new l.default(M,this.basePath+"/history",R,y,function(v,h,A){return d.default.fromResponseBody(v,c,A?void 0:C)}).get(m,T)},s}(g.default);r.default=E},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(7)),g=u.__importDefault(n(3)),S=function(l){u.__extends(d,l);function d(){var b=l.call(this)||this;return b.messages=[],b}return d.prototype.count=function(){return this.messages.length},d.prototype.push=function(b){this.messages.push(b)},d.prototype.shift=function(){return this.messages.shift()},d.prototype.last=function(){return this.messages[this.messages.length-1]},d.prototype.copyAll=function(){return this.messages.slice()},d.prototype.append=function(b){this.messages.push.apply(this.messages,b)},d.prototype.prepend=function(b){this.messages.unshift.apply(this.messages,b)},d.prototype.completeMessages=function(b,E,I){g.default.logAction(g.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+b+"; count = "+E),I=I||null;var s=this.messages;if(s.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var m=s[0];if(m){var T=m.message.msgSerial,M=b+E;if(M>T)for(var C=s.splice(0,M-T),y=0,R=C;y<R.length;y++){var c=R[y];c.callback(I)}s.length==0&&this.emit("idle")}},d.prototype.completeAllMessages=function(b){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,b)},d.prototype.clear=function(){g.default.logAction(g.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},d}(o.default);r.default=S},function(i,r,n){"use strict";r.__esModule=!0;var u=function(){function o(g,S,l,d){this.previous=g,this.current=S,l&&(this.retryIn=l),d&&(this.reason=d)}return o}();r.default=u},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(10)),g=u.__importDefault(n(7)),S=u.__importStar(n(2)),l=u.__importDefault(n(33)),d=u.__importDefault(n(3)),b=u.__importDefault(n(54)),E=u.__importDefault(n(9)),I=u.__importDefault(n(38)),s=u.__importDefault(n(5)),m=u.__importDefault(n(14)),T=u.__importDefault(n(19)),M=o.default.Action,C=function(){},y="statechange",R="sync";function c(h){if(h&&"params"in h&&!S.isObject(h.params))return new s.default("options.params must be an object",4e4,400);if(h&&"modes"in h){if(!S.isArray(h.modes))return new s.default("options.modes must be an array",4e4,400);for(var A=0;A<h.modes.length;A++){var f=h.modes[A];if(!f||typeof f!="string"||!S.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(f)))return new s.default("Invalid channel mode: "+f,4e4,400)}}}var v=function(h){u.__extends(A,h);function A(f,O,P){var L=h.call(this,f,O,P)||this;return L.retryCount=0,L.history=function(V,H){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),H===void 0)if(typeof V=="function")H=V,V=null;else{if(this.rest.options.promises)return S.promisify(this,"history",arguments);H=C}if(V&&V.untilAttach){if(this.state!=="attached"){H(new s.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){H(new s.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete V.untilAttach,V.from_serial=this.properties.attachSerial}l.default.prototype._history.call(this,V,H)},L.whenState=function(V,H){return g.default.prototype.whenState.call(L,V,L.state,H)},d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel()","started; name = "+O),L.realtime=f,L.presence=new b.default(L),L.connectionManager=f.connection.connectionManager,L.state="initialized",L.subscriptions=new g.default,L.syncChannelSerial=void 0,L.properties={attachSerial:void 0},L.setOptions(P),L.errorReason=null,L._requestedFlags=null,L._mode=null,L._attachedMsgIndicator=!1,L._attachResume=!1,L._decodingContext={channelOptions:L.channelOptions,plugins:f.options.plugins||{},baseEncodedPreviousPayload:void 0},L._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},L._allChannelChanges=new g.default,L}return A.invalidStateError=function(f){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+f}},A.processListenerArgs=function(f){return f=Array.prototype.slice.call(f),typeof f[0]=="function"&&f.unshift(null),f[f.length-1]==null&&f.pop(),f},A.prototype.setOptions=function(f,O){if(!O&&this.rest.options.promises)return S.promisify(this,"setOptions",arguments);var P=O||function(V){V&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+V.toString())},L=c(f);if(L){P(L);return}l.default.prototype.setOptions.call(this,f),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(f)?(this.attachImpl(),this._allChannelChanges.once(function(V){switch(this.event){case"update":case"attached":P==null||P(null);return;default:P==null||P(V.reason);return}})):P()},A.prototype._shouldReattachToSetOptions=function(f){return(this.state==="attached"||this.state==="attaching")&&(f.params||f.modes)},A.prototype.publish=function(){for(var f=this,O=[],P=0;P<arguments.length;P++)O[P]=arguments[P];var L=O[0],V=O.length,H=O[V-1];if(typeof H!="function"){if(this.realtime.options.promises)return S.promisify(this,"publish",arguments);H=C,++V}if(!this.connectionManager.activeState()){H(this.connectionManager.getError());return}if(V==2)if(S.isObject(L))L=[E.default.fromValues(L)];else if(S.isArray(L))L=E.default.fromValuesArray(L);else throw new s.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else L=[E.default.fromValues({name:O[0],data:O[1]})];var D=this.realtime.options.maxMessageSize;E.default.encodeArray(L,this.channelOptions,function(_){if(_){H(_);return}var x=E.default.getMessagesSize(L);if(x>D){H(new s.default("Maximum size of messages that can be published at once exceeded ( was "+x+" bytes; limit is "+D+" bytes)",40009,400));return}f.__publish(L,H)})},A.prototype.__publish=function(f,O){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+f.length);var P=this.state;switch(P){case"failed":case"suspended":O(s.default.fromValues(A.invalidStateError(P)));break;default:{d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+P);var L=new o.default;L.action=M.MESSAGE,L.channel=this.name,L.messages=f,this.sendMessage(L,O);break}}},A.prototype.onEvent=function(f){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var O=this.subscriptions,P=0;P<f.length;P++){var L=f[P];O.emit(L.name,L)}},A.prototype.attach=function(f,O){var P;if(typeof f=="function"?(O=f,P=null):P=f,!O){if(this.realtime.options.promises)return S.promisify(this,"attach",arguments);O=function(L){L&&d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+L.toString())}}if(P)d.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=P;else if(this.state==="attached"){O();return}this._attach(!1,null,O)},A.prototype._attach=function(f,O,P){P||(P=function(V){V&&d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+V.toString())});var L=this.connectionManager;if(!L.activeState()){P(L.getError());return}(this.state!=="attaching"||f)&&this.requestState("attaching",O),this.once(function(V){switch(this.event){case"attached":P==null||P();break;case"detached":case"suspended":case"failed":P==null||P(V.reason||L.getError()||new s.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":P==null||P(new s.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},A.prototype.attachImpl=function(){d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(y,!0);var f=o.default.fromValues({action:M.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?f.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&f.encodeModesToFlags(S.allToUpperCase(this.channelOptions.modes)),this._attachResume&&f.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(f.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(f,C)},A.prototype.detach=function(f){if(!f){if(this.realtime.options.promises)return S.promisify(this,"detach",arguments);f=C}var O=this.connectionManager;if(!O.activeState()){f(O.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),f();break;case"detached":f();break;case"failed":f(new s.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(P){switch(this.event){case"detached":f();break;case"attached":case"suspended":case"failed":f(P.reason||O.getError()||new s.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":f(new s.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},A.prototype.detachImpl=function(f){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(y,!0);var O=o.default.fromValues({action:M.DETACH,channel:this.name});this.sendMessage(O,f||C)},A.prototype.subscribe=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];var P=A.processListenerArgs(f),L=P[0],V=P[1],H=P[2];if(!H&&this.realtime.options.promises)return S.promisify(this,"subscribe",[L,V]);if(this.state==="failed"){H==null||H(s.default.fromValues(A.invalidStateError("failed")));return}return L&&typeof L=="object"&&!Array.isArray(L)?this._subscribeFilter(L,V):this.subscriptions.on(L,V),this.attach(H||C)},A.prototype._subscribeFilter=function(f,O){var P=function(L){var V,H,D,_,x,k,W={name:L.name,refTimeserial:(H=(V=L.extras)===null||V===void 0?void 0:V.ref)===null||H===void 0?void 0:H.timeserial,refType:(_=(D=L.extras)===null||D===void 0?void 0:D.ref)===null||_===void 0?void 0:_.type,isRef:!!(!((k=(x=L.extras)===null||x===void 0?void 0:x.ref)===null||k===void 0)&&k.timeserial),clientId:L.clientId};Object.entries(f).find(function(K){var $=K[0],Y=K[1];return Y!==void 0?W[$]!==Y:!1})||O(L)};this._addFilteredSubscription(f,O,P),this.subscriptions.on(P)},A.prototype._addFilteredSubscription=function(f,O,P){var L;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(O)){var V=this.filteredSubscriptions.get(O);V.set(f,((L=V==null?void 0:V.get(f))===null||L===void 0?void 0:L.concat(P))||[P])}else this.filteredSubscriptions.set(O,new Map([[f,[P]]]))},A.prototype._getAndDeleteFilteredSubscriptions=function(f,O){var P=this;if(!this.filteredSubscriptions)return[];if(!O&&f)return Array.from(this.filteredSubscriptions.entries()).map(function(D){var _,x=D[0],k=D[1],W=k.get(f);return k.delete(f),k.size===0&&((_=P.filteredSubscriptions)===null||_===void 0||_.delete(x)),W}).reduce(function(D,_){var x;return _?(x=D).concat.apply(x,_):D},[]);if(!O||!this.filteredSubscriptions.has(O))return[];var L=this.filteredSubscriptions.get(O);if(!f){var V=Array.from(L.values()).reduce(function(D,_){return D.concat.apply(D,_)},[]);return this.filteredSubscriptions.delete(O),V}var H=L.get(f);return L.delete(f),H||[]},A.prototype.unsubscribe=function(){for(var f=this,O,P=[],L=0;L<arguments.length;L++)P[L]=arguments[L];var V=A.processListenerArgs(P),H=V[0],D=V[1];if(typeof H=="object"&&!D||((O=this.filteredSubscriptions)===null||O===void 0?void 0:O.has(D))){this._getAndDeleteFilteredSubscriptions(H,D).forEach(function(_){return f.subscriptions.off(_)});return}this.subscriptions.off(H,D)},A.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new s.default("Unable to sync to channel; not attached",4e4);default:}var f=this.connectionManager;if(!f.activeState())throw f.getError();var O=o.default.fromValues({action:M.SYNC,channel:this.name});this.syncChannelSerial&&(O.channelSerial=this.syncChannelSerial),f.send(O)},A.prototype.sendMessage=function(f,O){this.connectionManager.send(f,this.realtime.options.queueMessages,O)},A.prototype.sendPresence=function(f,O){var P=o.default.fromValues({action:M.PRESENCE,channel:this.name,presence:S.isArray(f)?m.default.fromValuesArray(f):[m.default.fromValues(f)]});this.sendMessage(P,O)},A.prototype.onMessage=function(f){var O,P=!1;switch(f.action){case M.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=f.channelSerial,this._mode=f.getMode(),this.params=f.params||{};var L=f.decodeModesFromFlags();this.modes=L&&S.allToLowerCase(L)||void 0;var V=f.hasFlag("RESUMED"),H=f.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(y,!1),V||this.presence.onAttached(H);var D=new I.default(this.state,this.state,V,f.error);this._allChannelChanges.emit("update",D),(!V||this.channelOptions.updateOnAttached)&&this.emit("update",D)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",f.error,V,H);break}case M.DETACHED:{var _=f.error?s.default.fromValues(f.error):new s.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",_):this.state==="attaching"?this.notifyState("suspended",_):this.requestState("attaching",_);break}case M.SYNC:if(P=!0,O=this.syncChannelSerial=f.channelSerial,!f.presence)break;case M.PRESENCE:{for(var x=f.presence,k=f.id,W=f.connectionId,K=f.timestamp,$=this.channelOptions,Y=void 0,G=0;G<x.length;G++)try{Y=x[G],m.default.decode(Y,$),Y.connectionId||(Y.connectionId=W),Y.timestamp||(Y.timestamp=K),Y.id||(Y.id=k+":"+G)}catch(ce){d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",ce.toString())}this.presence.setPresence(x,P,O);break}case M.MESSAGE:{if(this.state!=="attached"){d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+f.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var N=f.messages,F=N[0],j=N[N.length-1],k=f.id,W=f.connectionId,K=f.timestamp;if(F.extras&&F.extras.delta&&F.extras.delta.from!==this._lastPayload.messageId){var z='Delta message decode failure - previous message not available for message "'+f.id+'" on this channel "'+this.name+'".';d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",z),this._startDecodeFailureRecovery(new s.default(z,40018,400));break}for(var G=0;G<N.length;G++){var z=N[G];try{E.default.decode(z,this._decodingContext)}catch(fe){switch(d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()",fe.toString()),fe.code){case 40018:this._startDecodeFailureRecovery(fe);return;case 40019:case 40021:this.notifyState("failed",fe);return}}z.connectionId||(z.connectionId=W),z.timestamp||(z.timestamp=K),z.id||(z.id=k+":"+G)}this._lastPayload.messageId=j.id,this._lastPayload.protocolMessageChannelSerial=f.channelSerial,this.onEvent(N);break}case M.ERROR:{var ee=f.error;ee&&ee.code==80016?this.checkPendingState():this.notifyState("failed",s.default.fromValues(ee));break}default:d.default.logAction(d.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+f.action+")"),this.connectionManager.abort(T.default.unknownChannelErr)}},A.prototype._startDecodeFailureRecovery=function(f){var O=this;this._lastPayload.decodeFailureRecoveryInProgress||(d.default.logAction(d.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,f,function(){O._lastPayload.decodeFailureRecoveryInProgress=!1}))},A.prototype.onAttached=function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},A.prototype.notifyState=function(f,O,P,L){if(d.default.logAction(d.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+f),this.clearStateTimer(),f!==this.state){this.presence.actOnChannelState(f,L,O),f==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),O&&(this.errorReason=O);var V=new I.default(this.state,f,P,O),H=f==="failed"?d.default.LOG_ERROR:d.default.LOG_MAJOR;d.default.logAction(H,'Channel state for channel "'+this.name+'"',f+(O?"; reason: "+O:"")),f!=="attaching"&&f!=="suspended"&&(this.retryCount=0),f==="attached"?(this.onAttached(),this.setInProgress(R,L),this.setInProgress(y,!1)):(f==="detached"||f==="failed"||f==="suspended")&&(this.setInProgress(y,!1),this.setInProgress(R,!1)),f==="attached"?this._attachResume=!0:(f==="detaching"||f==="failed")&&(this._attachResume=!1),this.state=f,this._allChannelChanges.emit(f,V),this.emit(f,V)}},A.prototype.requestState=function(f,O){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+f),this.notifyState(f,O),this.checkPendingState()},A.prototype.checkPendingState=function(){var f=this.connectionManager.state;if(!(f.sendEvents||f.forceQueueEvents)){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},A.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var f=new s.default("Channel attach timed out",90007,408);this.notifyState("suspended",f);break}case"detaching":{var f=new s.default("Channel detach timed out",90007,408);this.notifyState("attached",f);break}default:this.checkPendingState();break}},A.prototype.startStateTimerIfNotRunning=function(){var f=this;this.stateTimer||(this.stateTimer=setTimeout(function(){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),f.stateTimer=null,f.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},A.prototype.clearStateTimer=function(){var f=this.stateTimer;f&&(clearTimeout(f),this.stateTimer=null)},A.prototype.startRetryTimer=function(){var f=this;if(!this.retryTimer){this.retryCount++;var O=this.realtime.options.timeouts.channelRetryTimeout*S.getJitterCoefficient()*S.getBackoffCoefficient(this.retryCount);this.retryTimer=setTimeout(function(){f.state==="suspended"&&f.connectionManager.state.sendEvents&&(f.retryTimer=null,d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),f.requestState("attaching"))},O)}},A.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},A.prototype.setInProgress=function(f,O){this.rest.channels.setInProgress(this,f,O)},A.prototype.getReleaseErr=function(){var f=this.state;return f==="initialized"||f==="detached"||f==="failed"?null:new s.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+f,90001,400)},A.progressOps={statechange:y,sync:R},A}(l.default);r.default=v},function(i,r,n){"use strict";r.__esModule=!0;var u=function(){function o(g,S,l,d){this.previous=g,this.current=S,S==="attached"&&(this.resumed=l),d&&(this.reason=d)}return o}();r.default=u},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){var o=u,g=o.lib,S=g.WordArray,l=g.Hasher,d=o.algo,b=[],E=d.SHA1=l.extend({_doReset:function(){this._hash=new S.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(I,s){for(var m=this._hash.words,T=m[0],M=m[1],C=m[2],y=m[3],R=m[4],c=0;c<80;c++){if(c<16)b[c]=I[s+c]|0;else{var v=b[c-3]^b[c-8]^b[c-14]^b[c-16];b[c]=v<<1|v>>>31}var h=(T<<5|T>>>27)+R+b[c];c<20?h+=(M&C|~M&y)+1518500249:c<40?h+=(M^C^y)+1859775393:c<60?h+=(M&C|M&y|C&y)-1894007588:h+=(M^C^y)-899497514,R=y,y=C,C=M<<30|M>>>2,M=T,T=h}m[0]=m[0]+T|0,m[1]=m[1]+M|0,m[2]=m[2]+C|0,m[3]=m[3]+y|0,m[4]=m[4]+R|0},_doFinalize:function(){var I=this._data,s=I.words,m=this._nDataBytes*8,T=I.sigBytes*8;return s[T>>>5]|=128<<24-T%32,s[(T+64>>>9<<4)+14]=Math.floor(m/4294967296),s[(T+64>>>9<<4)+15]=m,I.sigBytes=s.length*4,this._process(),this._hash},clone:function(){var I=l.clone.call(this);return I._hash=this._hash.clone(),I}});o.SHA1=l._createHelper(E),o.HmacSHA1=l._createHmacHelper(E)}(),u.SHA1})},function(i,r,n){"use strict";r.__esModule=!0;function u(c){if(c===void 0)return"undefined";var v,h;if(c instanceof ArrayBuffer?(h="ArrayBuffer",v=new DataView(c)):c instanceof DataView&&(h="DataView",v=c),!v)return JSON.stringify(c);for(var A=[],f=0;f<c.byteLength;f++){if(f>20){A.push("...");break}var O=v.getUint8(f).toString(16);O.length===1&&(O="0"+O),A.push(O)}return"<"+h+" "+A.join(" ")+">"}function o(c,v,h){for(var A=0,f=h.length;A<f;A++){var O=h.charCodeAt(A);if(O<128){c.setUint8(v++,O>>>0&127|0);continue}if(O<2048){c.setUint8(v++,O>>>6&31|192),c.setUint8(v++,O>>>0&63|128);continue}if(O<65536){c.setUint8(v++,O>>>12&15|224),c.setUint8(v++,O>>>6&63|128),c.setUint8(v++,O>>>0&63|128);continue}if(O<1114112){c.setUint8(v++,O>>>18&7|240),c.setUint8(v++,O>>>12&63|128),c.setUint8(v++,O>>>6&63|128),c.setUint8(v++,O>>>0&63|128);continue}throw new Error("bad codepoint "+O)}}function g(c,v,h){for(var A="",f=v,O=v+h;f<O;f++){var P=c.getUint8(f);if((P&128)===0){A+=String.fromCharCode(P);continue}if((P&224)===192){A+=String.fromCharCode((P&15)<<6|c.getUint8(++f)&63);continue}if((P&240)===224){A+=String.fromCharCode((P&15)<<12|(c.getUint8(++f)&63)<<6|(c.getUint8(++f)&63)<<0);continue}if((P&248)===240){A+=String.fromCharCode((P&7)<<18|(c.getUint8(++f)&63)<<12|(c.getUint8(++f)&63)<<6|(c.getUint8(++f)&63)<<0);continue}throw new Error("Invalid byte "+P.toString(16))}return A}function S(c){for(var v=0,h=0,A=c.length;h<A;h++){var f=c.charCodeAt(h);if(f<128){v+=1;continue}if(f<2048){v+=2;continue}if(f<65536){v+=3;continue}if(f<1114112){v+=4;continue}throw new Error("bad codepoint "+f)}return v}function l(c,v){var h=R(c,v);if(h!==0){var A=new ArrayBuffer(h),f=new DataView(A);return y(c,f,0,v),A}}var d=(1<<16)*(1<<16),b=1/d;function E(c,v){return v=v||0,c.getInt32(v)*d+c.getUint32(v+4)}function I(c,v){return v=v||0,c.getUint32(v)*d+c.getUint32(v+4)}function s(c,v,h){h<9223372036854776e3?(c.setInt32(v,Math.floor(h*b)),c.setInt32(v+4,h&-1)):(c.setUint32(v,2147483647),c.setUint32(v+4,2147483647))}function m(c,v,h){h<18446744073709552e3?(c.setUint32(v,Math.floor(h*b)),c.setInt32(v+4,h&-1)):(c.setUint32(v,4294967295),c.setUint32(v+4,4294967295))}var T=function(){function c(v,h){var A=this;this.map=function(f){for(var O={},P=0;P<f;P++){var L=A.parse();O[L]=A.parse()}return O},this.bin=function(f){var O=new ArrayBuffer(f);return new Uint8Array(O).set(new Uint8Array(A.view.buffer,A.offset,f),0),A.offset+=f,O},this.buf=this.bin,this.str=function(f){var O=g(A.view,A.offset,f);return A.offset+=f,O},this.array=function(f){for(var O=new Array(f),P=0;P<f;P++)O[P]=A.parse();return O},this.ext=function(f){return A.offset+=f,{type:A.view.getInt8(A.offset),data:A.buf(f)}},this.parse=function(){var f=A.view.getUint8(A.offset),O,P;if((f&128)===0)return A.offset++,f;if((f&240)===128)return P=f&15,A.offset++,A.map(P);if((f&240)===144)return P=f&15,A.offset++,A.array(P);if((f&224)===160)return P=f&31,A.offset++,A.str(P);if((f&224)===224)return O=A.view.getInt8(A.offset),A.offset++,O;switch(f){case 192:return A.offset++,null;case 193:A.offset++;return;case 194:return A.offset++,!1;case 195:return A.offset++,!0;case 196:return P=A.view.getUint8(A.offset+1),A.offset+=2,A.bin(P);case 197:return P=A.view.getUint16(A.offset+1),A.offset+=3,A.bin(P);case 198:return P=A.view.getUint32(A.offset+1),A.offset+=5,A.bin(P);case 199:return P=A.view.getUint8(A.offset+1),A.offset+=2,A.ext(P);case 200:return P=A.view.getUint16(A.offset+1),A.offset+=3,A.ext(P);case 201:return P=A.view.getUint32(A.offset+1),A.offset+=5,A.ext(P);case 202:return O=A.view.getFloat32(A.offset+1),A.offset+=5,O;case 203:return O=A.view.getFloat64(A.offset+1),A.offset+=9,O;case 204:return O=A.view.getUint8(A.offset+1),A.offset+=2,O;case 205:return O=A.view.getUint16(A.offset+1),A.offset+=3,O;case 206:return O=A.view.getUint32(A.offset+1),A.offset+=5,O;case 207:return O=I(A.view,A.offset+1),A.offset+=9,O;case 208:return O=A.view.getInt8(A.offset+1),A.offset+=2,O;case 209:return O=A.view.getInt16(A.offset+1),A.offset+=3,O;case 210:return O=A.view.getInt32(A.offset+1),A.offset+=5,O;case 211:return O=E(A.view,A.offset+1),A.offset+=9,O;case 212:return P=1,A.offset++,A.ext(P);case 213:return P=2,A.offset++,A.ext(P);case 214:return P=4,A.offset++,A.ext(P);case 215:return P=8,A.offset++,A.ext(P);case 216:return P=16,A.offset++,A.ext(P);case 217:return P=A.view.getUint8(A.offset+1),A.offset+=2,A.str(P);case 218:return P=A.view.getUint16(A.offset+1),A.offset+=3,A.str(P);case 219:return P=A.view.getUint32(A.offset+1),A.offset+=5,A.str(P);case 220:return P=A.view.getUint16(A.offset+1),A.offset+=3,A.array(P);case 221:return P=A.view.getUint32(A.offset+1),A.offset+=5,A.array(P);case 222:return P=A.view.getUint16(A.offset+1),A.offset+=3,A.map(P);case 223:return P=A.view.getUint32(A.offset+1),A.offset+=5,A.map(P)}throw new Error("Unknown type 0x"+f.toString(16))},this.offset=h||0,this.view=v}return c}();function M(c){var v=new DataView(c),h=new T(v),A=h.parse();if(h.offset!==c.byteLength)throw new Error(c.byteLength-h.offset+" trailing bytes");return A}function C(c,v){return Object.keys(c).filter(function(h){var A=c[h],f=typeof A;return(!v||A!=null)&&(f!=="function"||!!A.toJSON)})}function y(c,v,h,A){var f=typeof c;if(typeof c=="string"){var O=S(c);if(O<32)return v.setUint8(h,O|160),o(v,h+1,c),1+O;if(O<256)return v.setUint8(h,217),v.setUint8(h+1,O),o(v,h+2,c),2+O;if(O<65536)return v.setUint8(h,218),v.setUint16(h+1,O),o(v,h+3,c),3+O;if(O<4294967296)return v.setUint8(h,219),v.setUint32(h+1,O),o(v,h+5,c),5+O}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var P=c.byteLength;if(P<256)return v.setUint8(h,196),v.setUint8(h+1,P),new Uint8Array(v.buffer).set(new Uint8Array(c),h+2),2+P;if(P<65536)return v.setUint8(h,197),v.setUint16(h+1,P),new Uint8Array(v.buffer).set(new Uint8Array(c),h+3),3+P;if(P<4294967296)return v.setUint8(h,198),v.setUint32(h+1,P),new Uint8Array(v.buffer).set(new Uint8Array(c),h+5),5+P}if(typeof c=="number"){if(Math.floor(c)!==c)return v.setUint8(h,203),v.setFloat64(h+1,c),9;if(c>=0){if(c<128)return v.setUint8(h,c),1;if(c<256)return v.setUint8(h,204),v.setUint8(h+1,c),2;if(c<65536)return v.setUint8(h,205),v.setUint16(h+1,c),3;if(c<4294967296)return v.setUint8(h,206),v.setUint32(h+1,c),5;if(c<18446744073709552e3)return v.setUint8(h,207),m(v,h+1,c),9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return v.setInt8(h,c),1;if(c>=-128)return v.setUint8(h,208),v.setInt8(h+1,c),2;if(c>=-32768)return v.setUint8(h,209),v.setInt16(h+1,c),3;if(c>=-2147483648)return v.setUint8(h,210),v.setInt32(h+1,c),5;if(c>=-9223372036854776e3)return v.setUint8(h,211),s(v,h+1,c),9;throw new Error("Number too small -0x"+(-c).toString(16).substr(1))}if(f==="undefined")return A?0:(v.setUint8(h,212),v.setUint8(h+1,0),v.setUint8(h+2,0),3);if(c===null)return A?0:(v.setUint8(h,192),1);if(f==="boolean")return v.setUint8(h,c?195:194),1;if(typeof c.toJSON=="function")return y(c.toJSON(),v,h,A);if(f==="object"){var L,V=0,H=void 0,D=Array.isArray(c);if(D?L=c.length:(H=C(c,A),L=H.length),L<16?(v.setUint8(h,L|(D?144:128)),V=1):L<65536?(v.setUint8(h,D?220:222),v.setUint16(h+1,L),V=3):L<4294967296&&(v.setUint8(h,D?221:223),v.setUint32(h+1,L),V=5),D)for(var _=0;_<L;_++)V+=y(c[_],v,h+V,A);else if(H)for(var _=0;_<L;_++){var x=H[_];V+=y(x,v,h+V),V+=y(c[x],v,h+V,A)}return V}if(f==="function")return 0;throw new Error("Unknown type "+f)}function R(c,v){var h=typeof c;if(h==="string"){var A=S(c);if(A<32)return 1+A;if(A<256)return 2+A;if(A<65536)return 3+A;if(A<4294967296)return 5+A}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var f=c.byteLength;if(f<256)return 2+f;if(f<65536)return 3+f;if(f<4294967296)return 5+f}if(typeof c=="number"){if(Math.floor(c)!==c)return 9;if(c>=0){if(c<128)return 1;if(c<256)return 2;if(c<65536)return 3;if(c<4294967296)return 5;if(c<18446744073709552e3)return 9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return 1;if(c>=-128)return 2;if(c>=-32768)return 3;if(c>=-2147483648)return 5;if(c>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+c.toString(16).substr(1))}if(h==="boolean")return 1;if(c===null)return v?0:1;if(c===void 0)return v?0:3;if(typeof c.toJSON=="function")return R(c.toJSON(),v);if(h==="object"){var O,P=0;if(Array.isArray(c)){O=c.length;for(var L=0;L<O;L++)P+=R(c[L],v)}else{var V=C(c,v);O=V.length;for(var L=0;L<O;L++){var H=V[L];P+=R(H)+R(c[H],v)}}if(O<16)return 1+P;if(O<65536)return 3+P;if(O<4294967296)return 5+P;throw new Error("Array or object too long 0x"+O.toString(16))}if(h==="function")return 0;throw new Error("Unknown type "+h)}r.default={encode:l,decode:M,inspect:u,utf8Write:o,utf8Read:g,utf8ByteCount:S}},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(30)),g=u.__importDefault(n(49)),S=u.__importDefault(n(0)),l=u.__importDefault(n(55)),d=u.__importDefault(n(57)),b=u.__importDefault(n(62)),E=u.__importDefault(n(63)),I=u.__importDefault(n(67)),s=u.__importDefault(n(3)),m=n(8),T=u.__importDefault(n(25)),M=u.__importDefault(n(64)),C=u.__importDefault(n(65)),y=u.__importDefault(n(40)),R=u.__importDefault(n(9)),c=u.__importDefault(n(14));S.default.Crypto=d.default,S.default.BufferUtils=l.default,S.default.Http=b.default,S.default.Config=E.default,S.default.Transports=I.default,S.default.WebStorage=M.default,o.default.Crypto=d.default,g.default.Crypto=d.default,o.default.Message=R.default,g.default.Message=R.default,o.default.PresenceMessage=c.default,g.default.PresenceMessage=c.default,g.default.ConnectionManager=T.default,s.default.initLogHandlers(),S.default.Defaults=m.getDefaults(C.default),S.default.Config.agent&&(S.default.Defaults.agent+=" "+S.default.Config.agent),S.default.Config.noUpgrade&&(S.default.Defaults.upgradeTransports=[]),r.default={Rest:o.default,Realtime:g.default,msgpack:y.default}},function(i){i.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.29","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}')},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(31),n(23))})(this,function(u){return u.HmacSHA256})},function(i,r){},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(46)),S=u.__importDefault(n(24)),l=u.__importDefault(n(18)),d=u.__importDefault(n(5)),b=u.__importDefault(n(47)),E=function(){},I=function(){function M(C){this.rest=C,this.admin=new s(C)}return M}(),s=function(){function M(C){this.rest=C,this.deviceRegistrations=new m(C),this.channelSubscriptions=new T(C)}return M.prototype.publish=function(C,y,R){var c=this.rest,v=c.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultPostHeaders(v),A={},f=o.mixin({recipient:C},y);if(typeof R!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);R=E}c.options.headers&&o.mixin(h,c.options.headers),c.options.pushFullWait&&o.mixin(A,{fullWait:"true"});var O=o.encodeBody(f,v);S.default.post(c,"/push/publish",O,h,A,null,function(P){return R(P)})},M}(),m=function(){function M(C){this.rest=C}return M.prototype.save=function(C,y){var R=this.rest,c=g.default.fromValues(C),v=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultPostHeaders(v),A={};if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);y=E}R.options.headers&&o.mixin(h,R.options.headers),R.options.pushFullWait&&o.mixin(A,{fullWait:"true"});var f=o.encodeBody(c,v);S.default.put(R,"/push/deviceRegistrations/"+encodeURIComponent(C.id),f,h,A,null,function(O,P,L,V){y(O,O?void 0:g.default.fromResponseBody(P,V?void 0:v))})},M.prototype.get=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=o.defaultGetHeaders(c),h=C.id||C;if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);y=E}if(typeof h!="string"||!h.length){y(new d.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&o.mixin(v,R.options.headers),S.default.get(R,"/push/deviceRegistrations/"+encodeURIComponent(h),v,{},null,function(A,f,O,P){y(A,A?void 0:g.default.fromResponseBody(f,P?void 0:c))})},M.prototype.list=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:c,h=o.defaultGetHeaders(c);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);y=E}R.options.headers&&o.mixin(h,R.options.headers),new l.default(R,"/push/deviceRegistrations",h,v,function(A,f,O){return g.default.fromResponseBody(A,O?void 0:c)}).get(C,y)},M.prototype.remove=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=o.defaultGetHeaders(c),h={},A=C.id||C;if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);y=E}if(typeof A!="string"||!A.length){y(new d.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&o.mixin(v,R.options.headers),R.options.pushFullWait&&o.mixin(h,{fullWait:"true"}),S.default.delete(R,"/push/deviceRegistrations/"+encodeURIComponent(A),v,h,null,function(f){return y(f)})},M.prototype.removeWhere=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=o.defaultGetHeaders(c);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);y=E}R.options.headers&&o.mixin(v,R.options.headers),R.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),S.default.delete(R,"/push/deviceRegistrations",v,C,null,function(h){return y(h)})},M}(),T=function(){function M(C){this.remove=M.prototype.removeWhere,this.rest=C}return M.prototype.save=function(C,y){var R=this.rest,c=b.default.fromValues(C),v=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultPostHeaders(v),A={};if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);y=E}R.options.headers&&o.mixin(h,R.options.headers),R.options.pushFullWait&&o.mixin(A,{fullWait:"true"});var f=o.encodeBody(c,v);S.default.post(R,"/push/channelSubscriptions",f,h,A,null,function(O,P,L,V){y(O,!O&&b.default.fromResponseBody(P,V?void 0:v))})},M.prototype.list=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:c,h=o.defaultGetHeaders(c);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);y=E}R.options.headers&&o.mixin(h,R.options.headers),new l.default(R,"/push/channelSubscriptions",h,v,function(A,f,O){return b.default.fromResponseBody(A,O?void 0:c)}).get(C,y)},M.prototype.removeWhere=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=o.defaultGetHeaders(c);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);y=E}R.options.headers&&o.mixin(v,R.options.headers),R.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),S.default.delete(R,"/push/channelSubscriptions",v,C,null,function(h){return y(h)})},M.prototype.listChannels=function(C,y){var R=this.rest,c=R.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,v=this.rest.http.supportsLinkHeaders?void 0:c,h=o.defaultGetHeaders(c);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);y=E}R.options.headers&&o.mixin(h,R.options.headers),R.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),new l.default(R,"/push/channels",h,v,function(A,f,O){for(var P=!O&&c?o.decodeBody(A,c):A,L=0;L<P.length;L++)P[L]=String(P[L]);return P}).get(C,y)},M}();r.default=I},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(5)),S;(function(b){b.Phone="phone",b.Tablet="tablet",b.Desktop="desktop",b.TV="tv",b.Watch="watch",b.Car="car",b.Embedded="embedded",b.Other="other"})(S||(S={}));var l;(function(b){b.Android="android",b.IOS="ios",b.Browser="browser"})(l||(l={}));var d=function(){function b(){}return b.prototype.toJSON=function(){var E,I,s;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(E=this.push)===null||E===void 0?void 0:E.recipient,state:(I=this.push)===null||I===void 0?void 0:I.state,error:(s=this.push)===null||s===void 0?void 0:s.error}}},b.prototype.toString=function(){var E,I,s,m,T="[DeviceDetails";return this.id&&(T+="; id="+this.id),this.platform&&(T+="; platform="+this.platform),this.formFactor&&(T+="; formFactor="+this.formFactor),this.clientId&&(T+="; clientId="+this.clientId),this.metadata&&(T+="; metadata="+this.metadata),this.deviceIdentityToken&&(T+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((E=this.push)===null||E===void 0)&&E.recipient&&(T+="; push.recipient="+JSON.stringify(this.push.recipient)),!((I=this.push)===null||I===void 0)&&I.state&&(T+="; push.state="+this.push.state),!((s=this.push)===null||s===void 0)&&s.error&&(T+="; push.error="+JSON.stringify(this.push.error)),!((m=this.push)===null||m===void 0)&&m.metadata&&(T+="; push.metadata="+this.push.metadata),T+="]",T},b.fromResponseBody=function(E,I){return I&&(E=o.decodeBody(E,I)),o.isArray(E)?b.fromValuesArray(E):b.fromValues(E)},b.fromValues=function(E){return E.error=E.error&&g.default.fromValues(E.error),Object.assign(new b,E)},b.fromValuesArray=function(E){for(var I=E.length,s=new Array(I),m=0;m<I;m++)s[m]=b.fromValues(E[m]);return s},b.toRequestBody=o.encodeBody,b}();r.default=d},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=function(){function S(){}return S.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},S.prototype.toString=function(){var l="[PushChannelSubscription";return this.channel&&(l+="; channel="+this.channel),this.deviceId&&(l+="; deviceId="+this.deviceId),this.clientId&&(l+="; clientId="+this.clientId),l+="]",l},S.fromResponseBody=function(l,d){return d&&(l=o.decodeBody(l,d)),o.isArray(l)?S.fromValuesArray(l):S.fromValues(l)},S.fromValues=function(l){return Object.assign(new S,l)},S.fromValuesArray=function(l){for(var d=l.length,b=new Array(d),E=0;E<d;E++)b[E]=S.fromValues(l[E]);return b},S.toRequestBody=o.encodeBody,S}();r.default=g},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=function(){function R(c){this.count=c&&c.count||0,this.data=c&&c.data||0,this.uncompressedData=c&&c.uncompressedData||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return R}(),S=function(R){u.__extends(c,R);function c(v){var h=R.call(this,v)||this;return v&&v.category&&(h.category={},o.forInOwnNonNullProperties(v.category,function(A){h.category[A]=new g(v.category[A])})),h}return c}(g),l=function(){function R(c){this.peak=c&&c.peak||0,this.min=c&&c.min||0,this.mean=c&&c.mean||0,this.opened=c&&c.opened||0,this.refused=c&&c.refused||0}return R}(),d=function(){function R(c){this.succeeded=c&&c.succeeded||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return R}(),b=function(){function R(c){this.plain=new l(c&&c.plain),this.tls=new l(c&&c.tls),this.all=new l(c&&c.all)}return R}(),E=function(){function R(c){this.messages=new S(c&&c.messages),this.presence=new S(c&&c.presence),this.all=new S(c&&c.all)}return R}(),I=function(){function R(c){this.realtime=new E(c&&c.realtime),this.rest=new E(c&&c.rest),this.webhook=new E(c&&c.webhook),this.sharedQueue=new E(c&&c.sharedQueue),this.externalQueue=new E(c&&c.externalQueue),this.httpEvent=new E(c&&c.httpEvent),this.push=new E(c&&c.push),this.all=new E(c&&c.all)}return R}(),s=function(){function R(c){this.all=new E(c&&c.all),this.inbound=new I(c&&c.inbound),this.outbound=new I(c&&c.outbound)}return R}(),m=function(){function R(c){this.all=new E(c&&c.all),this.producerPaid=new s(c&&c.producerPaid),this.consumerPaid=new s(c&&c.consumerPaid)}return R}(),T=function(){function R(c){this.messages=c&&c.messages||0;var v=c&&c.notifications;this.notifications={invalid:v&&v.invalid||0,attempted:v&&v.attempted||0,successful:v&&v.successful||0,failed:v&&v.failed||0},this.directPublishes=c&&c.directPublishes||0}return R}(),M=function(){function R(c){this.succeeded=c&&c.succeeded||0,this.skipped=c&&c.skipped||0,this.failed=c&&c.failed||0}return R}(),C=function(){function R(c){var v=this;this.delta=void 0,c&&c.delta&&(this.delta={},o.forInOwnNonNullProperties(c.delta,function(h){v.delta[h]=new M(c.delta[h])}))}return R}(),y=function(R){u.__extends(c,R);function c(v){var h=R.call(this,v)||this;return h.persisted=new E(v&&v.persisted),h.connections=new b(v&&v.connections),h.channels=new l(v&&v.channels),h.apiRequests=new d(v&&v.apiRequests),h.tokenRequests=new d(v&&v.tokenRequests),h.xchgProducer=new m(v&&v.xchgProducer),h.xchgConsumer=new m(v&&v.xchgConsumer),h.push=new T(v&&v.pushStats),h.processed=new C(v&&v.processed),h.inProgress=v&&v.inProgress||void 0,h.unit=v&&v.unit||void 0,h.intervalId=v&&v.intervalId||void 0,h}return c.fromValues=function(v){return new c(v)},c}(s);r.default=y},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(30)),S=u.__importDefault(n(7)),l=u.__importDefault(n(3)),d=u.__importDefault(n(50)),b=u.__importDefault(n(37)),E=u.__importDefault(n(8)),I=u.__importDefault(n(5)),s=u.__importDefault(n(10)),m=u.__importDefault(n(25)),T=u.__importDefault(n(0)),M=u.__importDefault(n(9)),C=function(R){u.__extends(c,R);function c(v){var h=R.call(this,v)||this;return l.default.logAction(l.default.LOG_MINOR,"Realtime()",""),h.connection=new d.default(h,h.options),h.channels=new y(h),v.autoConnect!==!1&&h.connect(),h}return c.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},c.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},c.Promise=function(v){return v=E.default.objectifyOptions(v),v.promises=!0,new c(v)},c.Callbacks=c,c.Utils=o,c.ConnectionManager=m.default,c.Platform=T.default,c.ProtocolMessage=s.default,c.Message=M.default,c}(g.default),y=function(R){u.__extends(c,R);function c(v){var h=R.call(this)||this;return h.realtime=v,h.all={},h.inProgress={},v.connection.connectionManager.on("transport.active",function(){h.onTransportActive()}),h}return c.prototype.onChannelMessage=function(v){var h=v.channel;if(h===void 0){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+v.action);return}var A=this.all[h];if(!A){l.default.logAction(l.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+h);return}A.onMessage(v)},c.prototype.onTransportActive=function(){for(var v in this.all){var h=this.all[v];h.state==="attaching"||h.state==="detaching"?h.checkPendingState():h.state==="suspended"&&h.attach()}},c.prototype.reattach=function(v){for(var h in this.all){var A=this.all[h];A.state==="attached"&&A.requestState("attaching",v)}},c.prototype.resetAttachedMsgIndicators=function(){for(var v in this.all){var h=this.all[v];h.state==="attached"&&(h._attachedMsgIndicator=!1)}},c.prototype.checkAttachedMsgIndicators=function(v){for(var h in this.all){var A=this.all[h];if(A.state==="attached"&&A._attachedMsgIndicator===!1){var f="30s after a resume, found channel which has not received an attached; channelId = "+h+"; connectionId = "+v;l.default.logAction(l.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",f),A.requestState("attaching")}}},c.prototype.propogateConnectionInterruption=function(v,h){var A={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},f=["attaching","attached","detaching","suspended"],O=A[v];for(var P in this.all){var L=this.all[P];o.arrIn(f,L.state)&&L.notifyState(O,h)}},c.prototype.get=function(v,h){v=String(v);var A=this.all[v];if(!A)A=this.all[v]=new b.default(this.realtime,v,h);else if(h){if(A._shouldReattachToSetOptions(h))throw new I.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);A.setOptions(h)}return A},c.prototype.release=function(v){v=String(v);var h=this.all[v];if(!!h){var A=h.getReleaseErr();if(A)throw A;delete this.all[v],delete this.inProgress[v]}},c.prototype.setInProgress=function(v,h,A){this.inProgress[v.name]=this.inProgress[v.name]||{},this.inProgress[v.name][h]=A,!A&&this.hasNopending()&&this.emit("nopending")},c.prototype.onceNopending=function(v){if(this.hasNopending()){v();return}this.once("nopending",v)},c.prototype.hasNopending=function(){return o.arrEvery(o.valuesArray(this.inProgress,!0),function(v){return!o.containsValue(v,!0)})},c}(S.default);r.default=C},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(7)),S=u.__importDefault(n(25)),l=u.__importDefault(n(3)),d=u.__importDefault(n(36)),b=u.__importDefault(n(0));function E(){}var I=function(s){u.__extends(m,s);function m(T,M){var C=s.call(this)||this;return C.whenState=function(y,R){return g.default.prototype.whenState.call(C,y,C.state,R,new d.default(void 0,y))},C.ably=T,C.connectionManager=new S.default(T,M),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.serial=void 0,C.timeSerial=void 0,C.recoveryKey=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(y){var R=C.state=y.current;b.default.Config.nextTick(function(){C.emit(R,y)})}),C.connectionManager.on("update",function(y){b.default.Config.nextTick(function(){C.emit("update",y)})}),C}return m.prototype.connect=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},m.prototype.ping=function(T){if(l.default.logAction(l.default.LOG_MINOR,"Connection.ping()",""),!T){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);T=E}this.connectionManager.ping(null,T)},m.prototype.close=function(){l.default.logAction(l.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},m}(g.default);r.default=I},function(i,r,n){"use strict";r.__esModule=!0,r.PendingMessage=void 0;var u=n(1),o=u.__importDefault(n(10)),g=u.__importStar(n(2)),S=u.__importDefault(n(7)),l=u.__importDefault(n(3)),d=u.__importDefault(n(35)),b=u.__importDefault(n(5)),E=o.default.Action,I=function(){function m(T,M){this.message=T,this.callback=M,this.merged=!1;var C=T.action;this.sendAttempted=!1,this.ackRequired=C==E.MESSAGE||C==E.PRESENCE}return m}();r.PendingMessage=I;var s=function(m){u.__extends(T,m);function T(M){var C=m.call(this)||this;return C.transport=M,C.messageQueue=new d.default,M.on("ack",function(y,R){C.onAck(y,R)}),M.on("nack",function(y,R,c){C.onNack(y,R,c)}),C}return T.prototype.onAck=function(M,C){l.default.logAction(l.default.LOG_MICRO,"Protocol.onAck()","serial = "+M+"; count = "+C),this.messageQueue.completeMessages(M,C)},T.prototype.onNack=function(M,C,y){l.default.logAction(l.default.LOG_ERROR,"Protocol.onNack()","serial = "+M+"; count = "+C+"; err = "+g.inspectError(y)),y||(y=new b.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(M,C,y)},T.prototype.onceIdle=function(M){var C=this.messageQueue;if(C.count()===0){M();return}C.once("idle",M)},T.prototype.send=function(M){M.ackRequired&&this.messageQueue.push(M),l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(M.message)),M.sendAttempted=!0,this.transport.send(M.message)},T.prototype.getTransport=function(){return this.transport},T.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},T.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},T.prototype.finish=function(){var M=this.transport;this.onceIdle(function(){M.disconnect()})},T}(S.default);r.default=s},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(0)),g=u.__importStar(n(2)),S=u.__importDefault(n(26)),l=u.__importDefault(n(8)),d=u.__importDefault(n(3)),b=u.__importDefault(n(10)),E=u.__importDefault(n(5)),I="web_socket";function s(M){return!!M.on}var m=function(M){u.__extends(C,M);function C(y,R,c){var v=M.call(this,y,R,c)||this;return v.shortName=I,c.heartbeats=o.default.Config.useProtocolHeartbeats,v.wsHost=l.default.getHost(c.options,c.host,!0),v}return C.isAvailable=function(){return!!o.default.Config.WebSocket},C.prototype.createWebSocket=function(y,R){var c=0;if(R)for(var v in R)y+=(c++?"&":"?")+v+"="+R[v];return this.uri=y,new o.default.Config.WebSocket(y)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),S.default.prototype.connect.call(this);var y=this,R=this.params,c=R.options,v=c.tls?"wss://":"ws://",h=v+this.wsHost+":"+l.default.getPort(c)+"/";d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+h),this.auth.getAuthParams(function(A,f){if(!y.isDisposed){var O="";for(var P in f)O+=" "+P+": "+f[P]+";";if(d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+O+" err: "+A),A){y.disconnect(A);return}var L=R.getConnectParams(f);try{var V=y.wsConnection=y.createWebSocket(h,L);V.binaryType=o.default.Config.binaryType,V.onopen=function(){y.onWsOpen()},V.onclose=function(H){y.onWsClose(H)},V.onmessage=function(H){y.onWsData(H.data)},V.onerror=function(H){y.onWsError(H)},s(V)&&V.on("ping",function(){y.onActivity()})}catch(H){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(H.stack||H.message)),y.disconnect(H)}}})},C.prototype.send=function(y){var R=this.wsConnection;if(!R){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{R.send(b.default.serialize(y,this.params.format))}catch(v){var c="Exception from ws connection when trying to send: "+g.inspectError(v);d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.send()",c),this.finish("disconnected",new E.default(c,5e4,500))}},C.prototype.onWsData=function(y){d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+y.length+"; type = "+typeof y);try{this.onProtocolMessage(b.default.deserialize(y,this.format))}catch(R){d.default.logAction(d.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+R.stack)}},C.prototype.onWsOpen=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(y){var R,c;if(typeof y=="object"?(c=y.code,R=y.wasClean||c===1e3):(c=y,R=c==1e3),delete this.wsConnection,R){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var v=new E.default("Websocket closed",80003,400);this.finish("disconnected",v)}else{var h="Unclean disconnection of WebSocket ; code = "+c,v=new E.default(h,80003,400);d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onWsClose()",h),this.finish("disconnected",v)}this.emit("disposed")},C.prototype.onWsError=function(y){var R=this;d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+y.message),o.default.Config.nextTick(function(){R.disconnect(Error(y.message))})},C.prototype.dispose=function(){d.default.logAction(d.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var y=this.wsConnection;y&&(y.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(d.default.logAction(d.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!y)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");y.close()}))},C}(S.default);function T(M){return m.isAvailable()&&(M.supportedTransports[I]=m),m}r.default=T},function(i,r,n){"use strict";r.__esModule=!0,r.isSuccessCode=void 0;var u;(function(g){g[g.Success=200]="Success",g[g.NoContent=204]="NoContent",g[g.BadRequest=400]="BadRequest",g[g.Unauthorized=401]="Unauthorized",g[g.Forbidden=403]="Forbidden",g[g.RequestTimeout=408]="RequestTimeout",g[g.InternalServerError=500]="InternalServerError"})(u||(u={}));function o(g){return g>=u.Success&&g<u.BadRequest}r.isSuccessCode=o,r.default=u},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importStar(n(2)),g=u.__importDefault(n(34)),S=u.__importDefault(n(7)),l=u.__importDefault(n(3)),d=u.__importDefault(n(14)),b=u.__importDefault(n(5)),E=u.__importDefault(n(37)),I=u.__importDefault(n(22)),s=u.__importDefault(n(38)),m=function(){};function T(h){return h.clientId+":"+h.connectionId}function M(h){return h.channel.realtime.auth.clientId}function C(h){var A=h.channel.realtime,f=A.auth.clientId;return(!f||f==="*")&&A.connection.state==="connected"}function y(h,A,f){switch(h.state){case"attached":case"suspended":f();break;case"initialized":case"detached":case"detaching":case"attaching":h.attach(function(O){O?A(O):f()});break;default:A(b.default.fromValues(E.default.invalidStateError(h.state)))}}function R(h,A){if(h.isSynthesized()||A.isSynthesized())return h.timestamp>A.timestamp;var f=h.parseId(),O=A.parseId();return f.msgSerial===O.msgSerial?f.index>O.index:f.msgSerial>O.msgSerial}var c=function(h){u.__extends(A,h);function A(f){var O=h.call(this,f)||this;return O.channel=f,O.syncComplete=!1,O.members=new v(O),O._myMembers=new v(O),O.subscriptions=new S.default,O.pendingPresence=[],O}return A.prototype.enter=function(f,O){if(C(this))throw new b.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,f,"enter",O)},A.prototype.update=function(f,O){if(C(this))throw new b.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,f,"update",O)},A.prototype.enterClient=function(f,O,P){return this._enterOrUpdateClient(f,O,"enter",P)},A.prototype.updateClient=function(f,O,P){return this._enterOrUpdateClient(f,O,"update",P)},A.prototype._enterOrUpdateClient=function(f,O,P,L){var V=this;if(!L)if(typeof O=="function")L=O,O=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[f,O,P]);L=m}var H=this.channel;if(!H.connectionManager.activeState()){L(H.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence."+P+"Client()","channel = "+H.name+", client = "+(f||"(implicit) "+M(this)));var D=d.default.fromValues({action:P,data:O});f&&(D.clientId=f),d.default.encode(D,H.channelOptions,function(_){if(_){L(_);return}switch(H.state){case"attached":H.sendPresence(D,L);break;case"initialized":case"detached":H.attach();case"attaching":V.pendingPresence.push({presence:D,callback:L});break;default:_=new b.default("Unable to "+P+" presence channel while in "+H.state+" state",90001),_.code=90001,L(_)}})},A.prototype.leave=function(f,O){if(C(this))throw new b.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,f,O)},A.prototype.leaveClient=function(f,O,P){if(!P)if(typeof O=="function")P=O,O=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[f,O]);P=m}var L=this.channel;if(!L.connectionManager.activeState()){P==null||P(L.connectionManager.getError());return}l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+f);var V=d.default.fromValues({action:"leave",data:O});switch(f&&(V.clientId=f),L.state){case"attached":L.sendPresence(V,P);break;case"attaching":this.pendingPresence.push({presence:V,callback:P});break;case"initialized":case"failed":{var H=new b.default("Unable to leave presence channel (incompatible state)",90001);P==null||P(H);break}default:P==null||P(E.default.invalidStateError(L.state))}},A.prototype.get=function(f,O){var P=this,L=Array.prototype.slice.call(arguments);L.length==1&&typeof L[0]=="function"&&L.unshift(null),f=L[0],O=L[1];var V=!f||("waitForSync"in f?f.waitForSync:!0);if(!O){if(this.channel.realtime.options.promises)return o.promisify(this,"get",L);O=m}function H(D){O(null,f?D.list(f):D.values())}if(this.channel.state==="suspended"){V?O(b.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):H(this.members);return}y(this.channel,O,function(){var D=P.members;V?D.waitSync(function(){H(D)}):H(D)})},A.prototype.history=function(f,O){if(l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),O===void 0)if(typeof f=="function")O=f,f=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);O=m}f&&f.untilAttach&&(this.channel.state==="attached"?(delete f.untilAttach,f.from_serial=this.channel.properties.attachSerial):O(new b.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),g.default.prototype._history.call(this,f,O)},A.prototype.setPresence=function(f,O,P){l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+f.length+" participants; syncChannelSerial = "+P);var L,V,H=this.members,D=this._myMembers,_=[],x=this.channel.connectionManager.connectionId;O&&(this.members.startSync(),P&&(V=P.match(/^[\w-]+:(.*)$/))&&(L=V[1]));for(var k=0;k<f.length;k++){var W=d.default.fromValues(f[k]);switch(W.action){case"leave":H.remove(W)&&_.push(W),W.connectionId===x&&!W.isSynthesized()&&D.remove(W);break;case"enter":case"present":case"update":H.put(W)&&_.push(W),W.connectionId===x&&D.put(W);break}}O&&!L&&(H.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(E.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var k=0;k<_.length;k++){var W=_[k];this.subscriptions.emit(W.action,W)}},A.prototype.onAttached=function(f){l.default.logAction(l.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+f),f?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var O=this.pendingPresence,P=O.length;if(P){this.pendingPresence=[];var L=[],V=I.default.create();l.default.logAction(l.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+P+" queued presence messages");for(var H=0;H<P;H++){var D=O[H];L.push(D.presence),V.push(D.callback)}this.channel.sendPresence(L,V)}},A.prototype.actOnChannelState=function(f,O,P){switch(f){case"attached":this.onAttached(O);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(P);break}},A.prototype.failPendingPresence=function(f){if(this.pendingPresence.length){l.default.logAction(l.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(f));for(var O=0;O<this.pendingPresence.length;O++)try{this.pendingPresence[O].callback(f)}catch(P){}this.pendingPresence=[]}},A.prototype._clearMyMembers=function(){this._myMembers.clear()},A.prototype._ensureMyMembersPresent=function(){var f=this,O=this.members,P=this._myMembers,L=function(D){if(D){var _="Presence auto-re-enter failed: "+D.toString(),x=new b.default(_,91004,400);l.default.logAction(l.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",_);var k=new s.default(f.channel.state,f.channel.state,!0,x);f.channel.emit("update",k)}};for(var V in P.map)if(!(V in O.map)){var H=P.map[V];l.default.logAction(l.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+H.clientId+'" into the presence set'),this._enterOrUpdateClient(H.clientId,H.data,"enter",L),delete P.map[V]}},A.prototype._synthesizeLeaves=function(f){var O=this.subscriptions;o.arrForEach(f,function(P){var L=d.default.fromValues({action:"leave",connectionId:P.connectionId,clientId:P.clientId,data:P.data,encoding:P.encoding,timestamp:o.now()});O.emit("leave",L)})},A.prototype.on=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];l.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,f)},A.prototype.off=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];l.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,f)},A.prototype.subscribe=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];var P=E.default.processListenerArgs(f),L=P[0],V=P[1],H=P[2],D=this.channel;if(!H){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[L,V]);H=m}if(D.state==="failed"){H(b.default.fromValues(E.default.invalidStateError("failed")));return}this.subscriptions.on(L,V),D.attach(H)},A.prototype.unsubscribe=function(){for(var f=[],O=0;O<arguments.length;O++)f[O]=arguments[O];var P=E.default.processListenerArgs(f),L=P[0],V=P[1];this.subscriptions.off(L,V)},A}(g.default),v=function(h){u.__extends(A,h);function A(f){var O=h.call(this)||this;return O.presence=f,O.map={},O.syncInProgress=!1,O.residualMembers=null,O}return A.prototype.get=function(f){return this.map[f]},A.prototype.getClient=function(f){var O=this.map,P=[];for(var L in O){var V=O[L];V.clientId==f&&V.action!="absent"&&P.push(V)}return P},A.prototype.list=function(f){var O=this.map,P=f&&f.clientId,L=f&&f.connectionId,V=[];for(var H in O){var D=O[H];D.action!=="absent"&&(P&&P!=D.clientId||L&&L!=D.connectionId||V.push(D))}return V},A.prototype.put=function(f){(f.action==="enter"||f.action==="update")&&(f=d.default.fromValues(f),f.action="present");var O=this.map,P=T(f);this.residualMembers&&delete this.residualMembers[P];var L=O[P];return L&&!R(f,L)?!1:(O[P]=f,!0)},A.prototype.values=function(){var f=this.map,O=[];for(var P in f){var L=f[P];L.action!="absent"&&O.push(L)}return O},A.prototype.remove=function(f){var O=this.map,P=T(f),L=O[P];return L&&!R(f,L)?!1:(this.syncInProgress?(f=d.default.fromValues(f),f.action="absent",O[P]=f):delete O[P],!0)},A.prototype.startSync=function(){var f=this.map,O=this.syncInProgress;l.default.logAction(l.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),this.syncInProgress||(this.residualMembers=o.copy(f),this.setInProgress(!0))},A.prototype.endSync=function(){var f=this.map,O=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),O){for(var P in f){var L=f[P];L.action==="absent"&&delete f[P]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var V in this.residualMembers)delete f[V];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},A.prototype.waitSync=function(f){var O=this.syncInProgress;if(l.default.logAction(l.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+O),!O){f();return}this.once("sync",f)},A.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},A.prototype.setInProgress=function(f){l.default.logAction(l.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+f),this.syncInProgress=f,this.presence.syncComplete=!f},A}(S.default);r.default=c},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=n(56),g=n(32),S=n(13),l=u.__importDefault(n(4)),d=u.__importDefault(n(0)),b=function(){function E(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return E.prototype.isWordArray=function(I){return I!=null&&I.sigBytes!==void 0},E.prototype.isArrayBuffer=function(I){return I!=null&&I.constructor===ArrayBuffer},E.prototype.isTypedArray=function(I){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(I)},E.prototype.uint8ViewToBase64=function(I){for(var s="",m=this.base64CharSet,T=I.byteLength,M=T%3,C=T-M,y,R,c,v,h,A=0;A<C;A=A+3)h=I[A]<<16|I[A+1]<<8|I[A+2],y=(h&16515072)>>18,R=(h&258048)>>12,c=(h&4032)>>6,v=h&63,s+=m[y]+m[R]+m[c]+m[v];return M==1?(h=I[C],y=(h&252)>>2,R=(h&3)<<4,s+=m[y]+m[R]+"=="):M==2&&(h=I[C]<<8|I[C+1],y=(h&64512)>>10,R=(h&1008)>>4,c=(h&15)<<2,s+=m[y]+m[R]+m[c]+"="),s},E.prototype.base64ToArrayBuffer=function(I){for(var s=atob==null?void 0:atob(I),m=s.length,T=new Uint8Array(m),M=0;M<m;M++){var C=s.charCodeAt(M);T[M]=C}return T.buffer},E.prototype.isBuffer=function(I){return this.isArrayBuffer(I)||this.isWordArray(I)||this.isTypedArray(I)},E.prototype.toBuffer=function(I){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(I))return new Uint8Array(I);if(this.isTypedArray(I))return new Uint8Array(I.buffer);if(this.isWordArray(I)){for(var s=new ArrayBuffer(I.sigBytes),m=new Uint8Array(s),T=0;T<I.sigBytes;T++)m[T]=I.words[T>>>2]>>>24-T%4*8&255;return m}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},E.prototype.toArrayBuffer=function(I){return this.isArrayBuffer(I)?I:this.toBuffer(I).buffer},E.prototype.toWordArray=function(I){return this.isTypedArray(I)&&(I=I.buffer),this.isWordArray(I)?I:l.default.create(I)},E.prototype.base64Encode=function(I){return this.isWordArray(I)?S.stringify(I):this.uint8ViewToBase64(this.toBuffer(I))},E.prototype.base64Decode=function(I){return ArrayBuffer&&d.default.Config.atob?this.base64ToArrayBuffer(I):S.parse(I)},E.prototype.hexEncode=function(I){return o.stringify(this.toWordArray(I))},E.prototype.hexDecode=function(I){var s=o.parse(I);return ArrayBuffer?this.toArrayBuffer(s):s},E.prototype.utf8Encode=function(I){return TextEncoder?new TextEncoder().encode(I).buffer:g.parse(I)},E.prototype.utf8Decode=function(I){if(!this.isBuffer(I))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(I)?new TextDecoder().decode(I):(I=this.toWordArray(I),g.stringify(I))},E.prototype.bufferCompare=function(I,s){if(!I)return-1;if(!s)return 1;var m=this.toWordArray(I),T=this.toWordArray(s);m.clamp(),T.clamp();var M=m.sigBytes-T.sigBytes;if(M!=0)return M;for(var C=m.words,y=T.words,R=0;R<C.length;R++)if(M=C[R]-y[R],M!=0)return M;return 0},E.prototype.byteLength=function(I){return this.isArrayBuffer(I)||this.isTypedArray(I)?I.byteLength:this.isWordArray(I)?I.sigBytes:-1},E.prototype.typedArrayToBuffer=function(I){return I.buffer},E}();r.default=new b},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return u.enc.Hex})},function(i,r,n){"use strict";n.r(r);var u=n(4),o=n.n(u),g=n(13),S=n.n(g),l=n(21),d=n.n(l),b=n(0),E=n.n(b),I=n(3),s=n.n(I),m=function(){var T="aes",M=256,C="cbc",y=16,R=4,c=4294967296,v=2147483648,h;if(E.a.getRandomWordArray)h=E.a.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&E.a.getRandomValues){var A=new Uint32Array(R);h=function(_,x){var k=_/4,W=k==R?A:new Uint32Array(k);E.a.getRandomValues(W,function(K){x(K,E.a.BufferUtils.toWordArray(W))})}}else h=function(_,x){s.a.logAction(s.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var k=_/4,W=new Array(k),K=0;K<k;K++)W[K]=Math.floor(Math.random()*c)-v;x(null,o.a.create(W))};function f(_){return _+y&-y}function O(_){if(_.algorithm==="aes"&&_.mode==="cbc"){if(_.keyLength===128||_.keyLength===256)return;throw new Error("Unsupported key length "+_.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function P(_){return _.replace("_","/").replace("-","+")}var L=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function V(){}function H(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}V.CipherParams=H,V.getDefaultParams=function(_){var x;if(typeof _=="function"||typeof _=="string"){if(s.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof _=="function")V.generateRandomKey(function(W){_(null,V.getDefaultParams({key:W}))});else if(typeof arguments[1]=="function")arguments[1](null,V.getDefaultParams({key:_}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!_.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof _.key=="string"?x=Object(g.parse)(P(_.key)):x=E.a.BufferUtils.toWordArray(_.key);var k=new H;if(k.key=x,k.algorithm=_.algorithm||T,k.keyLength=x.words.length*(4*8),k.mode=_.mode||C,_.keyLength&&_.keyLength!==k.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+_.keyLength+" was specified, but the key actually has length "+k.keyLength);return O(k),k},V.generateRandomKey=function(_,x){arguments.length==1&&typeof _=="function"&&(x=_,_=void 0),h((_||M)/8,x)},V.getCipher=function(_){var x=_ instanceof H?_:V.getDefaultParams(_);return{cipherParams:x,cipher:new D(x,R,_.iv)}};function D(_,x,k){this.algorithm=_.algorithm+"-"+String(_.keyLength)+"-"+_.mode,this.cjsAlgorithm=_.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=E.a.BufferUtils.toWordArray(_.key),k&&(this.iv=E.a.BufferUtils.toWordArray(k).clone()),this.blockLengthWords=x}return D.prototype.encrypt=function(_,x){s.a.logAction(s.a.LOG_MICRO,"CBCCipher.encrypt()",""),_=E.a.BufferUtils.toWordArray(_);var k=_.sigBytes,W=f(k),K=this,$=function(){K.getIv(function(Y,G){if(Y){x(Y);return}var N=K.encryptCipher.process(_.concat(L[W-k])),F=G.concat(N);x(null,F)})};this.encryptCipher?$():this.iv?(this.encryptCipher=d.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),$()):h(y,function(Y,G){if(Y){x(Y);return}K.encryptCipher=d.a.algo[K.cjsAlgorithm].createEncryptor(K.key,{iv:G}),K.iv=G,$()})},D.prototype.decrypt=function(_){s.a.logAction(s.a.LOG_MICRO,"CBCCipher.decrypt()",""),_=E.a.BufferUtils.toWordArray(_);var x=this.blockLengthWords,k=_.words,W=o.a.create(k.slice(0,x)),K=o.a.create(k.slice(x)),$=d.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:W}),Y=$.process(K),G=$.finalize();return $.reset(),G&&G.sigBytes&&Y.concat(G),Y},D.prototype.getIv=function(_){if(this.iv){var x=this.iv;this.iv=null,_(null,x);return}var k=this;h(y,function(W,K){if(W){_(W);return}_(null,k.encryptCipher.process(K))})},V}();r.default=m},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(){var o=u,g=o.lib,S=g.WordArray,l=o.enc,d=l.Utf16=l.Utf16BE={stringify:function(E){for(var I=E.words,s=E.sigBytes,m=[],T=0;T<s;T+=2){var M=I[T>>>2]>>>16-T%4*8&65535;m.push(String.fromCharCode(M))}return m.join("")},parse:function(E){for(var I=E.length,s=[],m=0;m<I;m++)s[m>>>1]|=E.charCodeAt(m)<<16-m%2*16;return S.create(s,I*2)}};l.Utf16LE={stringify:function(E){for(var I=E.words,s=E.sigBytes,m=[],T=0;T<s;T+=2){var M=b(I[T>>>2]>>>16-T%4*8&65535);m.push(String.fromCharCode(M))}return m.join("")},parse:function(E){for(var I=E.length,s=[],m=0;m<I;m++)s[m>>>1]|=b(E.charCodeAt(m)<<16-m%2*16);return S.create(s,I*2)}};function b(E){return E<<8&4278255360|E>>>8&16711935}}(),u.enc.Utf16})},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(28))})(this,function(u){return function(o){var g=u,S=g.lib,l=S.CipherParams,d=g.enc,b=d.Hex,E=g.format,I=E.Hex={stringify:function(s){return s.ciphertext.toString(b)},parse:function(s){var m=b.parse(s);return l.create({ciphertext:m})}}}(),u.format.Hex})},function(i,r,n){(function(u,o){i.exports=r=o(n(6),n(13),n(61),n(27),n(28))})(this,function(u){return function(){var o=u,g=o.lib,S=g.BlockCipher,l=o.algo,d=[],b=[],E=[],I=[],s=[],m=[],T=[],M=[],C=[],y=[];(function(){for(var v=[],h=0;h<256;h++)h<128?v[h]=h<<1:v[h]=h<<1^283;for(var A=0,f=0,h=0;h<256;h++){var O=f^f<<1^f<<2^f<<3^f<<4;O=O>>>8^O&255^99,d[A]=O,b[O]=A;var P=v[A],L=v[P],V=v[L],H=v[O]*257^O*16843008;E[A]=H<<24|H>>>8,I[A]=H<<16|H>>>16,s[A]=H<<8|H>>>24,m[A]=H;var H=V*16843009^L*65537^P*257^A*16843008;T[O]=H<<24|H>>>8,M[O]=H<<16|H>>>16,C[O]=H<<8|H>>>24,y[O]=H,A?(A=P^v[v[v[V^P]]],f^=v[v[f]]):A=f=1}})();var R=[0,1,2,4,8,16,32,64,128,27,54],c=l.AES=S.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var h=this._keyPriorReset=this._key,A=h.words,f=h.sigBytes/4,O=this._nRounds=f+6,P=(O+1)*4,L=this._keySchedule=[],V=0;V<P;V++)V<f?L[V]=A[V]:(v=L[V-1],V%f?f>6&&V%f==4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[v&255]):(v=v<<8|v>>>24,v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[v&255],v^=R[V/f|0]<<24),L[V]=L[V-f]^v);for(var H=this._invKeySchedule=[],D=0;D<P;D++){var V=P-D;if(D%4)var v=L[V];else var v=L[V-4];D<4||V<=4?H[D]=v:H[D]=T[d[v>>>24]]^M[d[v>>>16&255]]^C[d[v>>>8&255]]^y[d[v&255]]}}},encryptBlock:function(v,h){this._doCryptBlock(v,h,this._keySchedule,E,I,s,m,d)},decryptBlock:function(v,h){var A=v[h+1];v[h+1]=v[h+3],v[h+3]=A,this._doCryptBlock(v,h,this._invKeySchedule,T,M,C,y,b);var A=v[h+1];v[h+1]=v[h+3],v[h+3]=A},_doCryptBlock:function(v,h,A,f,O,P,L,V){for(var H=this._nRounds,D=v[h]^A[0],_=v[h+1]^A[1],x=v[h+2]^A[2],k=v[h+3]^A[3],W=4,K=1;K<H;K++){var $=f[D>>>24]^O[_>>>16&255]^P[x>>>8&255]^L[k&255]^A[W++],Y=f[_>>>24]^O[x>>>16&255]^P[k>>>8&255]^L[D&255]^A[W++],G=f[x>>>24]^O[k>>>16&255]^P[D>>>8&255]^L[_&255]^A[W++],N=f[k>>>24]^O[D>>>16&255]^P[_>>>8&255]^L[x&255]^A[W++];D=$,_=Y,x=G,k=N}var $=(V[D>>>24]<<24|V[_>>>16&255]<<16|V[x>>>8&255]<<8|V[k&255])^A[W++],Y=(V[_>>>24]<<24|V[x>>>16&255]<<16|V[k>>>8&255]<<8|V[D&255])^A[W++],G=(V[x>>>24]<<24|V[k>>>16&255]<<16|V[D>>>8&255]<<8|V[_&255])^A[W++],N=(V[k>>>24]<<24|V[D>>>16&255]<<16|V[_>>>8&255]<<8|V[x&255])^A[W++];v[h]=$,v[h+1]=Y,v[h+2]=G,v[h+3]=N},keySize:256/32});o.AES=S._createHelper(c)}(),u.AES})},function(i,r,n){(function(u,o){i.exports=r=o(n(6))})(this,function(u){return function(o){var g=u,S=g.lib,l=S.WordArray,d=S.Hasher,b=g.algo,E=[];(function(){for(var C=0;C<64;C++)E[C]=o.abs(o.sin(C+1))*4294967296|0})();var I=b.MD5=d.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,y){for(var R=0;R<16;R++){var c=y+R,v=C[c];C[c]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var h=this._hash.words,A=C[y+0],f=C[y+1],O=C[y+2],P=C[y+3],L=C[y+4],V=C[y+5],H=C[y+6],D=C[y+7],_=C[y+8],x=C[y+9],k=C[y+10],W=C[y+11],K=C[y+12],$=C[y+13],Y=C[y+14],G=C[y+15],N=h[0],F=h[1],j=h[2],z=h[3];N=s(N,F,j,z,A,7,E[0]),z=s(z,N,F,j,f,12,E[1]),j=s(j,z,N,F,O,17,E[2]),F=s(F,j,z,N,P,22,E[3]),N=s(N,F,j,z,L,7,E[4]),z=s(z,N,F,j,V,12,E[5]),j=s(j,z,N,F,H,17,E[6]),F=s(F,j,z,N,D,22,E[7]),N=s(N,F,j,z,_,7,E[8]),z=s(z,N,F,j,x,12,E[9]),j=s(j,z,N,F,k,17,E[10]),F=s(F,j,z,N,W,22,E[11]),N=s(N,F,j,z,K,7,E[12]),z=s(z,N,F,j,$,12,E[13]),j=s(j,z,N,F,Y,17,E[14]),F=s(F,j,z,N,G,22,E[15]),N=m(N,F,j,z,f,5,E[16]),z=m(z,N,F,j,H,9,E[17]),j=m(j,z,N,F,W,14,E[18]),F=m(F,j,z,N,A,20,E[19]),N=m(N,F,j,z,V,5,E[20]),z=m(z,N,F,j,k,9,E[21]),j=m(j,z,N,F,G,14,E[22]),F=m(F,j,z,N,L,20,E[23]),N=m(N,F,j,z,x,5,E[24]),z=m(z,N,F,j,Y,9,E[25]),j=m(j,z,N,F,P,14,E[26]),F=m(F,j,z,N,_,20,E[27]),N=m(N,F,j,z,$,5,E[28]),z=m(z,N,F,j,O,9,E[29]),j=m(j,z,N,F,D,14,E[30]),F=m(F,j,z,N,K,20,E[31]),N=T(N,F,j,z,V,4,E[32]),z=T(z,N,F,j,_,11,E[33]),j=T(j,z,N,F,W,16,E[34]),F=T(F,j,z,N,Y,23,E[35]),N=T(N,F,j,z,f,4,E[36]),z=T(z,N,F,j,L,11,E[37]),j=T(j,z,N,F,D,16,E[38]),F=T(F,j,z,N,k,23,E[39]),N=T(N,F,j,z,$,4,E[40]),z=T(z,N,F,j,A,11,E[41]),j=T(j,z,N,F,P,16,E[42]),F=T(F,j,z,N,H,23,E[43]),N=T(N,F,j,z,x,4,E[44]),z=T(z,N,F,j,K,11,E[45]),j=T(j,z,N,F,G,16,E[46]),F=T(F,j,z,N,O,23,E[47]),N=M(N,F,j,z,A,6,E[48]),z=M(z,N,F,j,D,10,E[49]),j=M(j,z,N,F,Y,15,E[50]),F=M(F,j,z,N,V,21,E[51]),N=M(N,F,j,z,K,6,E[52]),z=M(z,N,F,j,P,10,E[53]),j=M(j,z,N,F,k,15,E[54]),F=M(F,j,z,N,f,21,E[55]),N=M(N,F,j,z,_,6,E[56]),z=M(z,N,F,j,G,10,E[57]),j=M(j,z,N,F,H,15,E[58]),F=M(F,j,z,N,$,21,E[59]),N=M(N,F,j,z,L,6,E[60]),z=M(z,N,F,j,W,10,E[61]),j=M(j,z,N,F,O,15,E[62]),F=M(F,j,z,N,x,21,E[63]),h[0]=h[0]+N|0,h[1]=h[1]+F|0,h[2]=h[2]+j|0,h[3]=h[3]+z|0},_doFinalize:function(){var C=this._data,y=C.words,R=this._nDataBytes*8,c=C.sigBytes*8;y[c>>>5]|=128<<24-c%32;var v=o.floor(R/4294967296),h=R;y[(c+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,y[(c+64>>>9<<4)+14]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,C.sigBytes=(y.length+1)*4,this._process();for(var A=this._hash,f=A.words,O=0;O<4;O++){var P=f[O];f[O]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}return A},clone:function(){var C=d.clone.call(this);return C._hash=this._hash.clone(),C}});function s(C,y,R,c,v,h,A){var f=C+(y&R|~y&c)+v+A;return(f<<h|f>>>32-h)+y}function m(C,y,R,c,v,h,A){var f=C+(y&c|R&~c)+v+A;return(f<<h|f>>>32-h)+y}function T(C,y,R,c,v,h,A){var f=C+(y^R^c)+v+A;return(f<<h|f>>>32-h)+y}function M(C,y,R,c,v,h,A){var f=C+(R^(y|~c))+v+A;return(f<<h|f>>>32-h)+y}g.MD5=d._createHelper(I),g.HmacMD5=d._createHmacHelper(I)}(Math),u.MD5})},function(i,r,n){"use strict";var u;r.__esModule=!0;var o=n(1),g=o.__importDefault(n(0)),S=o.__importStar(n(2)),l=o.__importDefault(n(8)),d=o.__importDefault(n(5)),b=o.__importDefault(n(17)),E=o.__importDefault(n(15)),I=o.__importDefault(n(20)),s=o.__importDefault(n(3)),m=n(29);function T(y){var R=y.statusCode;return R===408&&!y.code||R===400&&!y.code||R>=500&&R<=504}function M(y){var R=y.connection,c=R&&R.connectionManager.host;return c?[c].concat(l.default.getFallbackHosts(y.options)):l.default.getHosts(y.options)}var C=(u=function(){function y(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=M,g.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(R,c,v,h,A,f,O){var P=E.default.createRequest(v,h,A,f,I.default.REQ_SEND,c&&c.options.timeouts,R);return P.once("complete",O),P.exec(),P},this.checkConnectivity=function(R){var c=l.default.internetUpUrl;s.default.logAction(s.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+c),this.doUri(b.default.Get,null,c,null,null,null,function(v,h){var A,f=!v&&((A=h)===null||A===void 0?void 0:A.replace(/\n/,""))=="yes";s.default.logAction(s.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+f),R(null,f)})}):g.default.Config.jsonpSupported&&(this.Request=function(R,c,v,h,A,f,O){var P=m.createRequest(v,h,A,f,I.default.REQ_SEND,c&&c.options.timeouts,R);return P.once("complete",O),g.default.Config.nextTick(function(){P.exec()}),P},this.checkConnectivity=function(R){var c=this,v=l.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(R);return}this.checksInProgress=[R],s.default.logAction(s.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+v);var h=new m.Request("isTheInternetUp",v,null,null,null,I.default.REQ_SEND,l.default.TIMEOUTS);h.once("complete",function(A,f){var O=!A&&f;s.default.logAction(s.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+O);for(var P=0;P<c.checksInProgress.length;P++)c.checksInProgress[P](null,O);c.checksInProgress=null}),g.default.Config.nextTick(function(){h.exec()})})}return y.prototype.do=function(R,c,v,h,A,f,O){var P=this,L=typeof v=="function"?v:function(_){return c.baseUri(_)+v},V=c._currentFallback;if(V)if(V.validUntil>S.now()){if(!this.Request){O==null||O(new d.default("Request invoked before assigned to",null,500));return}this.Request(R,c,L(V.host),h,f,A,function(_){for(var x=[],k=1;k<arguments.length;k++)x[k-1]=arguments[k];if(_&&T(_)){c._currentFallback=null,P.do(R,c,v,h,A,f,O);return}O==null||O.apply(void 0,o.__spreadArray([_],x))});return}else c._currentFallback=null;var H=M(c);if(H.length===1){this.doUri(R,c,L(H[0]),h,A,f,O);return}var D=function(_,x){var k=_.shift();P.doUri(R,c,L(k),h,A,f,function(W){for(var K=[],$=1;$<arguments.length;$++)K[$-1]=arguments[$];if(W&&T(W)&&_.length){D(_,!0);return}x&&(c._currentFallback={host:k,validUntil:S.now()+c.options.timeouts.fallbackRetryTimeout}),O==null||O.apply(void 0,o.__spreadArray([W],K))})};D(H)},y.prototype.doUri=function(R,c,v,h,A,f,O){if(!this.Request){O(new d.default("Request invoked before assigned to",null,500));return}this.Request(R,c,v,h,f,A,O)},y}(),u.methods=[b.default.Get,b.default.Delete,b.default.Post,b.default.Put,b.default.Patch],u.methodsWithoutBody=[b.default.Get,b.default.Delete],u.methodsWithBody=[b.default.Post,b.default.Put,b.default.Patch],u);r.default=C},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(40)),g=u.__importStar(n(2)),S=g.getGlobalObject();function l(){var I=S.location;return!S.WebSocket||!I||!I.origin||I.origin.indexOf("http")>-1}var d=S.navigator&&S.navigator.userAgent.toString(),b=S.location&&S.location.href,E={agent:"browser",logTimestamps:!0,userAgent:d,currentUrl:b,noUpgrade:d&&!!d.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:S.WebSocket,xhrSupported:S.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:l(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!S.TextDecoder,preferBinary:!1,ArrayBuffer:S.ArrayBuffer,atob:S.atob,nextTick:typeof S.setImmediate!="undefined"?S.setImmediate.bind(S):function(I){setTimeout(I,0)},addEventListener:S.addEventListener,inspect:JSON.stringify,stringByteSize:function(I){return S.TextDecoder&&new S.TextEncoder().encode(I).length||I.length},TextEncoder:S.TextEncoder,TextDecoder:S.TextDecoder,Promise:S.Promise,getRandomValues:function(I){if(I!==void 0)return function(s,m){I.getRandomValues(s),m&&m(null)}}(S.crypto||msCrypto)};r.default=E},function(i,r,n){"use strict";(function(u){r.__esModule=!0;var o=n(1),g=o.__importStar(n(2)),S="ablyjs-storage-test",l=function(){function d(){try{u.sessionStorage.setItem(S,S),u.sessionStorage.removeItem(S),this.sessionSupported=!0}catch(b){this.sessionSupported=!1}try{u.localStorage.setItem(S,S),u.localStorage.removeItem(S),this.localSupported=!0}catch(b){this.localSupported=!1}}return d.prototype.get=function(b){return this._get(b,!1)},d.prototype.getSession=function(b){return this._get(b,!0)},d.prototype.remove=function(b){return this._remove(b,!1)},d.prototype.removeSession=function(b){return this._remove(b,!0)},d.prototype.set=function(b,E,I){return this._set(b,E,I,!1)},d.prototype.setSession=function(b,E,I){return this._set(b,E,I,!0)},d.prototype._set=function(b,E,I,s){var m={value:E};return I&&(m.expires=g.now()+I),this.storageInterface(s).setItem(b,JSON.stringify(m))},d.prototype._get=function(b,E){if(E&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!E&&!this.localSupported)throw new Error("Local Storage not supported");var I=this.storageInterface(E).getItem(b);if(!I)return null;var s=JSON.parse(I);return s.expires&&s.expires<g.now()?(this.storageInterface(E).removeItem(b),null):s.value},d.prototype._remove=function(b,E){return this.storageInterface(E).removeItem(b)},d.prototype.storageInterface=function(b){return b?u.sessionStorage:u.localStorage},d}();r.default=new l}).call(this,n(12))},function(i,r,n){"use strict";r.__esModule=!0;var u=n(1),o=u.__importDefault(n(66)),g={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};r.default=g},function(i,r,n){"use strict";r.__esModule=!0;var u;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(u||(u={})),r.default=u},function(i,r,n){"use strict";n.r(r);var u=n(29),o=n.n(u),g=n(2),S=n(0),l=n.n(S),d=n(11),b=n.n(d),E=n(15),I=n.n(E),s=function(y){var R="xhr_polling";function c(v,h,A){A.stream=!1,b.a.call(this,v,h,A),this.shortName=R}return g.inherits(c,b.a),c.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.allowComet},c.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},c.prototype.createRequest=function(v,h,A,f,O){return I.a.createRequest(v,h,A,f,O,this.timeouts)},typeof y!="undefined"&&c.isAvailable()&&(y.supportedTransports[R]=c),c},m=s,T=function(y){var R="xhr_streaming";function c(v,h,A){b.a.call(this,v,h,A),this.shortName=R}return g.inherits(c,b.a),c.isAvailable=function(){return l.a.Config.xhrSupported&&l.a.Config.streamingSupported&&l.a.Config.allowComet},c.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},c.prototype.createRequest=function(v,h,A,f,O){return I.a.createRequest(v,h,A,f,O,this.timeouts)},typeof y!="undefined"&&c.isAvailable()&&(y.supportedTransports[R]=c),c},M=T,C=r.default=[o.a,m,M]}]).default})});var Hi=We((lO,wl)=>{oe();function wb(i){var r=typeof i;return i!=null&&(r=="object"||r=="function")}wl.exports=wb});var Ll=We((fO,xl)=>{oe();var xb=typeof global=="object"&&global&&global.Object===Object&&global;xl.exports=xb});var wo=We((dO,Bl)=>{oe();var Lb=Ll(),Bb=typeof self=="object"&&self&&self.Object===Object&&self,Db=Lb||Bb||Function("return this")();Bl.exports=Db});var Nl=We((hO,Dl)=>{oe();var Nb=wo(),Fb=function(){return Nb.Date.now()};Dl.exports=Fb});var Ul=We((AO,Fl)=>{oe();var Ub=/\s/;function Gb(i){for(var r=i.length;r--&&Ub.test(i.charAt(r)););return r}Fl.exports=Gb});var Hl=We((pO,Gl)=>{oe();var Hb=Ul(),Wb=/^\s+/;function kb(i){return i&&i.slice(0,Hb(i)+1).replace(Wb,"")}Gl.exports=kb});var xo=We((gO,Wl)=>{oe();var Vb=wo(),Qb=Vb.Symbol;Wl.exports=Qb});var zl=We((vO,Ql)=>{oe();var kl=xo(),Vl=Object.prototype,zb=Vl.hasOwnProperty,jb=Vl.toString,Mr=kl?kl.toStringTag:void 0;function Jb(i){var r=zb.call(i,Mr),n=i[Mr];try{i[Mr]=void 0;var u=!0}catch(g){}var o=jb.call(i);return u&&(r?i[Mr]=n:delete i[Mr]),o}Ql.exports=Jb});var Jl=We((mO,jl)=>{oe();var Kb=Object.prototype,Zb=Kb.toString;function Yb(i){return Zb.call(i)}jl.exports=Yb});var ql=We((yO,Yl)=>{oe();var Kl=xo(),qb=zl(),Xb=Jl(),$b="[object Null]",eC="[object Undefined]",Zl=Kl?Kl.toStringTag:void 0;function tC(i){return i==null?i===void 0?eC:$b:Zl&&Zl in Object(i)?qb(i):Xb(i)}Yl.exports=tC});var $l=We((bO,Xl)=>{oe();function nC(i){return i!=null&&typeof i=="object"}Xl.exports=nC});var tf=We((CO,ef)=>{oe();var rC=ql(),iC=$l(),aC="[object Symbol]";function oC(i){return typeof i=="symbol"||iC(i)&&rC(i)==aC}ef.exports=oC});var of=We((OO,af)=>{oe();var sC=Hl(),nf=Hi(),uC=tf(),rf=0/0,cC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,fC=/^0o[0-7]+$/i,dC=parseInt;function hC(i){if(typeof i=="number")return i;if(uC(i))return rf;if(nf(i)){var r=typeof i.valueOf=="function"?i.valueOf():i;i=nf(r)?r+"":r}if(typeof i!="string")return i===0?i:+i;i=sC(i);var n=lC.test(i);return n||fC.test(i)?dC(i.slice(2),n?2:8):cC.test(i)?rf:+i}af.exports=hC});var cf=We((EO,uf)=>{oe();var AC=Hi(),Lo=Nl(),sf=of(),pC="Expected a function",gC=Math.max,vC=Math.min;function mC(i,r,n){var u,o,g,S,l,d,b=0,E=!1,I=!1,s=!0;if(typeof i!="function")throw new TypeError(pC);r=sf(r)||0,AC(n)&&(E=!!n.leading,I="maxWait"in n,g=I?gC(sf(n.maxWait)||0,r):g,s="trailing"in n?!!n.trailing:s);function m(A){var f=u,O=o;return u=o=void 0,b=A,S=i.apply(O,f),S}function T(A){return b=A,l=setTimeout(y,r),E?m(A):S}function M(A){var f=A-d,O=A-b,P=r-f;return I?vC(P,g-O):P}function C(A){var f=A-d,O=A-b;return d===void 0||f>=r||f<0||I&&O>=g}function y(){var A=Lo();if(C(A))return R(A);l=setTimeout(y,M(A))}function R(A){return l=void 0,s&&u?m(A):(u=o=void 0,S)}function c(){l!==void 0&&clearTimeout(l),b=0,u=d=o=l=void 0}function v(){return l===void 0?S:R(Lo())}function h(){var A=Lo(),f=C(A);if(u=arguments,o=this,d=A,f){if(l===void 0)return T(d);if(I)return clearTimeout(l),l=setTimeout(y,r),m(d)}return l===void 0&&(l=setTimeout(y,r)),S}return h.cancel=c,h.flush=v,h}uf.exports=mC});var ff=We((SO,lf)=>{oe();var yC=cf(),bC=Hi(),CC="Expected a function";function OC(i,r,n){var u=!0,o=!0;if(typeof i!="function")throw new TypeError(CC);return bC(n)&&(u="leading"in n?!!n.leading:u,o="trailing"in n?!!n.trailing:o),yC(i,r,{leading:u,maxWait:r,trailing:o})}lf.exports=OC});var Af=We((WO,hf)=>{oe();hf.exports={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}});var gf=We((kO,pf)=>{oe();var{webm:IC,mp4:RC}=Af(),Go=()=>typeof navigator!="undefined"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,Ho=()=>"wakeLock"in navigator,Wo=class{constructor(){if(this.enabled=!1,Ho()){this._wakeLock=null;let r=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",r),document.addEventListener("fullscreenchange",r)}else Go()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",IC),this._addSourceToVideo(this.noSleepVideo,"mp4",RC),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(r,n,u){var o=document.createElement("source");o.src=u,o.type=`video/${n}`,r.appendChild(o)}get isEnabled(){return this.enabled}enable(){return Ho()?navigator.wakeLock.request("screen").then(r=>{this._wakeLock=r,this.enabled=!0,this._wakeLock.addEventListener("release",()=>{})}).catch(r=>{throw this.enabled=!1,r}):Go()?(this.disable(),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(n=>(this.enabled=!0,n)).catch(n=>{throw this.enabled=!1,n})}disable(){Ho()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):Go()?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}};pf.exports=Wo});var bf=We((nE,_C)=>{_C.exports={name:"@superviz/sdk",version:"0.0.0-development",description:"SuperViz SDK",main:"dist/index.js",scripts:{prepare:"husky install",build:"node ./.esbuild/build.js",postbuild:"tsc --emitDeclarationOnly --declaration",watch:'concurrently -n code,types "yarn watch:code" "yarn watch:types"',"watch:code":"node ./.esbuild/watch.js","watch:types":"tsc --watch",test:"jest","test:e2e":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright test ./e2e","test:e2e:pt-br":"E2E_LOCALE=pt-BR yarn test:e2e","test:e2e:en":"E2E_LOCALE=en yarn test:e2e","test:e2e:all":"yarn test:e2e:pt-br && yarn test:e2e:en","test:e2e:install":"PLAYWRIGHT_BROWSERS_PATH=$HOME/pw-browsers npx playwright install","test:e2e:generate":"eval $(cat .env | xargs) && npx playwright codegen $E2E_BASE_URL","test:e2e:debug":"eval $(cat .env | xargs) && PWDEBUG=1 yarn test:e2e","test:e2e:headed":"eval $(cat .env | xargs) && yarn test:e2e --headed","semantic-release":"semantic-release",commit:"git-cz"},publishConfig:{access:"public",scope:"@superviz"},repository:{type:"git",url:"https://github.com/SuperViz/sdk.git"},author:"",license:"ISC",bugs:{url:"https://github.com/SuperViz/sdk/issues"},homepage:"https://github.com/SuperViz/sdk#readme",devDependencies:{"@commitlint/cli":"^17.4.2","@commitlint/config-conventional":"^17.4.2","@playwright/test":"^1.28.1","@typescript-eslint/eslint-plugin":"^5.27.0","@typescript-eslint/parser":"^5.27.0",concurrently:"^7.2.2","cz-conventional-changelog":"^3.3.0",dotenv:"^16.0.1",esbuild:"^0.14.48",eslint:"^7.32.0 || ^8.2.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.25.2",husky:"^8.0.3",jest:"^28.1.2","jest-environment-jsdom":"^28.1.2","semantic-release":"19.0.5","ts-jest":"^28.0.5",tsc:"^2.0.4",typescript:"^4.7.4",yargs:"^17.5.1"},dependencies:{"@superviz/immersive-core":"^0.3.1","@types/jest":"^28.1.3","@types/lodash.isequal":"^4.5.6","@types/node":"^18.7.15",ably:"^1.2.29",bowser:"^2.11.0","bowser-jr":"^1.0.4",debug:"^4.3.4",lodash:"^4.17.21","lodash.debounce":"^4.0.8","lodash.isequal":"^4.5.0","nosleep.js":"^0.12.0","semantic-release-version-file":"^1.0.2"},config:{commitizen:{path:"./node_modules/cz-conventional-changelog"}},husky:{hooks:{"pre-commit":"lint-staged","commit-msg":"commitlint -E HUSKY_GIT_PARAMS"}}}});oe();oe();var mr=(L=>(L.FRAME_LOAD="frame.load",L.FRAME_SIZE_UPDATE="frame.size-update",L.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",L.FRAME_PARENT_SIZE_UPDATE="frame.parante-window-size-update",L.FRAME_LOCALE_UPDATE="frame.locales-update",L.MEETING_START="meeting.start",L.MEETING_LEAVE="meeting.leave",L.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",L.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",L.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",L.MEETING_PARTICIPANT_LEFT="meeting.participant-left",L.MEETING_JOIN="meeting.join",L.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",L.MEETING_HOST_CHANGE="meeting.host-change",L.MEETING_GRID_MODE_CHANGE="meeting.grid-mode-change",L.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",L.MEETING_DEVICES_CHANGE="meeting.devices-change",L.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",L.MEETING_STATE_UPDATE="meeting.state-update",L.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",L.MEETING_AVATAR_LIST_UPDATE="meeting.avatar-list-update",L.MY_PARTICIPANT_UPDATED="my-participant.update",L.MY_PARTICIPANT_LEFT="my-participant.left",L.MY_PARTICIPANT_JOINED="my-participant.joined",L.HEARTBEAT="heartbeat",L.DESTROY="destroy",L))(mr||{}),mi=(S=>(S.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",S.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",S.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",S.TOGGLE_CAM="meeting-controls.toggle-cam",S.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",S.HANG_UP="hang-up",S))(mi||{}),Vn=(E=>(E.REALTIME_JOIN="realtime.join",E.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",E.REALTIME_HOST_CHANGE="realtime.host-change",E.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",E.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",E.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",E.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",E.REALTIME_GATHER="realtime.gather",E.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",E.REALTIME_SET_AVATAR="realtime.set-avatar",E))(Vn||{}),yi=(E=>(E[E.MEETING_FAILED=-1]="MEETING_FAILED",E[E.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",E[E.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",E[E.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",E[E.MEETING_CONNECTING=3]="MEETING_CONNECTING",E[E.MEETING_CONNECTED=4]="MEETING_CONNECTED",E[E.MEETING_RECONNECT=5]="MEETING_RECONNECT",E[E.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",E[E.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",E[E.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",E))(yi||{}),yr=(l=>(l[l.NOT_AVAILABLE=0]="NOT_AVAILABLE",l[l.GOOD=1]="GOOD",l[l.BAD=2]="BAD",l[l.POOR=3]="POOR",l[l.DISCONNECTED=4]="DISCONNECTED",l[l.RECONNECTING=5]="RECONNECTING",l[l.LOST_CONNECTION=6]="LOST_CONNECTION",l))(yr||{}),fo=(S=>(S.NO_CAM="devices.no-cam",S.NO_DEVICES="devices.no-devices",S.DEVICES_BLOCKED="devices.blocked",S.DEVICES_CAM_BLOCKED="devices.cam-blocked",S.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",S.DEVICES_UNKNOWN_ERROR="devices.unknown-error",S))(fo||{});oe();var ho=(u=>(u.HOST="host",u.GUEST="guest",u.AUDIENCE="audience",u))(ho||{});oe();oe();oe();var Qn=(i,r,n)=>qe(void 0,null,function*(){let u=yield fetch(i,{method:r,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):null});if(!u.ok)throw u;return u.json()});oe();var Vc=xt(zn()),Ei=xt(kc()),vo=class extends Vc.Logger{constructor(n){super(n);this.disable(),this.debug=(0,Ei.default)(n)}log(n,...u){this.debug(n,...u)}enable(n="*"){Ei.default.enable(n)}disable(){Ei.default.disable()}},me=new vo("@superviz/sdk");oe();var Sn=class{static createUrl(r,n){return`${r}${n}`}static validateApiKey(r,n){let u="/user/checkapikey",o=this.createUrl(r,u);return Qn(o,"POST",{apiKey:n})}static fetchConfig(r,n){let u="/immersive-config",o=this.createUrl(r,u);return Qn(o,"POST",{apiKey:n})}};oe();var Qc=(i,r)=>qe(void 0,null,function*(){try{return(yield Sn.validateApiKey(i,r))===!0}catch(n){if(n.status===404)return!1;throw new Error("Unable to validate API key")}});oe();var Wt=xt(zc()),Cr=class{constructor(){this.browser=Wt.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(Wt.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(Wt.default.PLATFORMS_MAP.mobile)||this.browser.is(Wt.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(Wt.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};oe();oe();var Cf=xt(zn()),Of=xt(Rl());oe();var Tl=xt(zn());var Di=class{constructor(){this.connectionStatusObserver=new Tl.ObserverHelper({logger:me});this.updateMeetingConnectionStatus=r=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=r,this.connectionStatusObserver.publish(r),me.log("CONNECTION STATUS CHANGE",r)};this.onUpdateBrowserOnlineStatus=r=>{let{type:n}=r;if(n==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.connectionStatus=0}addListerners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};oe();var _l=xt(Ml());oe();var Ni=class{constructor({isAvatarsEnabled:r,isMouseEnabled:n,isLaserEnabled:u,isNameEnabled:o,renderLocalAvatar:g,plugin:S,RealtimeService:l,localParticipant:d}){this.enableAvatars=()=>{this._isAvatarsEnabled=!0};this.disableAvatars=()=>{this._isAvatarsEnabled=!1};this.enableMouse=()=>{this._isMouseEnabled=!0};this.disableMouse=()=>{this._isMouseEnabled=!1};this.enableLaser=()=>{this._isLaserEnabled=!0};this.disableLaser=()=>{this._isLaserEnabled=!1};this.createAvatar=r=>qe(this,null,function*(){if(!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled)return;this.destroyAvatar(r);let u=yield this.plugin.createAvatar(r);this._isNameEnabled&&this.plugin.createName&&this.plugin.createName(r,u)});this.destroyAvatar=r=>{this.plugin.destroyAvatar(r)};this.createMouse=r=>{!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled||!this._isMouseEnabled||(this.destroyMouse(r),this.plugin.createMouse(r))};this.destroyMouse=r=>{this.plugin.destroyMouse(r)};this.createLaser=r=>{!r.avatarConfig||r.id===this._localParticipant.id&&!this._renderLocalAvatar||!this._isAvatarsEnabled||!this._isLaserEnabled||(this.destroyLaser(r),this.plugin.createLaser(r))};this.destroyLaser=r=>{this.plugin.destroyLaser(r)};this.goToParticipant=r=>{this.plugin.goToParticipant(r)};this._isAvatarsEnabled=r,this._isMouseEnabled=n,this._isLaserEnabled=u,this._renderLocalAvatar=g,this._isNameEnabled=o,this.plugin=S,this._localParticipant=d,this.RealtimeService=l,this.plugin.init({setSyncProperty:(b,E)=>{l.setSyncProperty(b,E)},subscribeToParticipantUpdate:(b,E)=>{l.subscribeToParticipantUpdate(b,E)},unsubscribeToParticipantUpdate:(b,E)=>{l.unsubscribeFromParticipantUpdate(b,E)},updateMyProperties:b=>{l.updateMyProperties(b)},subscribe:l.syncPropertiesObserver.subscribe,unsubscribe:l.syncPropertiesObserver.unsubscribe,getParticipantSlot:l.getParticipantSlot},d)}get isAvatarsEnabled(){return this._isAvatarsEnabled}get isMouseEnabled(){return this._isMouseEnabled}get isLaserEnabled(){return this._isLaserEnabled}};oe();var Fi=class{constructor(){this.addParticipantToList=r=>{this._participants||(this._participants=[]),this._participants=[...this._participants,r]};this.setLocalParticipant=r=>{this._participant=r};this.createParticipantOn3D=({id:r,name:n,avatar:u,avatarConfig:o,isAudience:g})=>({id:r,name:n,avatar:u,isAudience:g,avatarConfig:o,position:{x:0,y:0,z:0},rotation:{x:0,y:0}});this.removeParticipant=r=>{this._participants=this._participants.filter(n=>n.id!==r.id)}}get participant(){return this._participant}get participants(){return this._participants}};var Ui=class extends Ni{constructor({isAvatarsEnabled:n,isMouseEnabled:u,isLaserEnabled:o,isNameEnabled:g,renderLocalAvatar:S,plugin:l,RealtimeService:d,avatarConfig:b,localParticipant:E,participantList:I}){let s=n!=null?n:!0,m=u!=null?u:!0,T=o!=null?o:!0;super({plugin:l,RealtimeService:d,isAvatarsEnabled:s,isMouseEnabled:m,isLaserEnabled:T,isNameEnabled:g,renderLocalAvatar:S,localParticipant:E,avatarConfig:b});this.followParticipantId=null;this.addParticipant=n=>{if(!n||!n.id||n.isAudience)return;let u=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.addParticipantToList(u),this.RealtimeService.subscribeToParticipantUpdate(u.id,this.onParticipantUpdated),this.createAvatar(u),this.createMouse(u),this.createLaser(u)};this.removeParticipant=(n,u)=>{this.IntegrationParticipantsService.removeParticipant(n),this.destroyAvatar(n),this.destroyMouse(n),this.destroyLaser(n),u&&this.RealtimeService.unsubscribeFromParticipantUpdate(n.id,this.onParticipantUpdated)};this.updateParticipant=n=>{var g,S;if(!this.participants||this.participants.length===0||!n||!n.id)return;let u=this.participants.find(l=>l.id===n.id);if(!u){this.addParticipant(n);return}let o=!1;if((((g=u.avatar)==null?void 0:g.model)!==((S=n.avatar)==null?void 0:S.model)||!(0,_l.isEqual)(u.avatarConfig,n.avatarConfig))&&(o=!0),o){this.removeParticipant(n,!1);let l=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.addParticipantToList(l),this.createAvatar(l),this.createMouse(l),this.createLaser(l)}else{let l=this.IntegrationParticipantsService.participants.findIndex(d=>d.id===n.id);l!==-1&&(this.IntegrationParticipantsService.participants[l]=n)}};this.createLocalParticipant=n=>{let u=this.IntegrationParticipantsService.createParticipantOn3D(n);this.IntegrationParticipantsService.setLocalParticipant(u)};this.createParticipantList=n=>{n.map(o=>this.IntegrationParticipantsService.createParticipantOn3D(o)).forEach(o=>{this.addParticipant(o)})};this.onParticipantJoined=n=>{let{participantId:u,name:o,avatar:g,avatarConfig:S,isAudience:l}=n.data;this.addParticipant({id:u,name:o,avatar:g,avatarConfig:S,isAudience:l})};this.onParticipantLeave=n=>{var o;if(!((o=this.participants)!=null&&o.length))return;let u=this.participants.find(g=>g.id===n.clientId);!u||this.removeParticipant(u,!0)};this.onParticipantUpdated=n=>{let{participantId:u,name:o,avatar:g,avatarConfig:S,position:l,rotation:d}=n.data;this.updateParticipant({position:l,rotation:d,id:u,name:o,avatar:g,avatarConfig:S}),this.followParticipantId&&this.plugin.goToParticipant(this.followParticipantId)};this.onRoomInfoUpdate=n=>{if(!n)return;let{gather:u,hostClientId:o,followParticipantId:g}=n;this.followParticipantId=g,u&&this.plugin.goToParticipant(o)};this.IntegrationParticipantsService=new Fi,this.createLocalParticipant(E),this.createParticipantList(I),this.RealtimeService.participantJoinedObserver.subscribe(this.onParticipantJoined),this.RealtimeService.participantLeaveObserver.subscribe(this.onParticipantLeave),this.RealtimeService.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdate),this.onRoomInfoUpdate(this.RealtimeService.roomProperties)}get participants(){return this.IntegrationParticipantsService.participants}get getAvatars(){var n;return(n=this.plugin)==null?void 0:n.getAvatars()}get localParticipant(){return this.IntegrationParticipantsService.participant}};oe();oe();var Uo=xt(Pl()),$n=xt(ff());oe();var Bo=(d=>(d[d.DISCONNECTED=0]="DISCONNECTED",d[d.INITIALIZING=1]="INITIALIZING",d[d.READY_TO_JOIN=2]="READY_TO_JOIN",d[d.CONNECTING=3]="CONNECTING",d[d.CONNECTED=4]="CONNECTED",d[d.JOINED=5]="JOINED",d[d.FAILED=-1]="FAILED",d[d.RETRYING=-2]="RETRYING",d))(Bo||{});oe();var gt=xt(zn());oe();var Do=(y=>(y[y.yellow=0]="yellow",y[y.turquoise=1]="turquoise",y[y.orange=2]="orange",y[y.blue=3]="blue",y[y.pink=4]="pink",y[y.purple=5]="purple",y[y.green=6]="green",y[y.red=7]="red",y[y.bluedark=8]="bluedark",y[y.pinklight=9]="pinklight",y[y.purplelight=10]="purplelight",y[y.greenlight=11]="greenlight",y[y.orangelight=12]="orangelight",y[y.bluelight=13]="bluelight",y[y.redlight=14]="redlight",y[y.brown=15]="brown",y[y.gray=16]="gray",y))(Do||{}),No=(i=>(i[i["#FFEF33"]=0]="#FFEF33",i[i["#31E0B0"]=1]="#31E0B0",i[i["#FF5E10"]=2]="#FF5E10",i[i["#00ABF7"]=3]="#00ABF7",i[i["#FF00BB"]=4]="#FF00BB",i[i["#9C29FF"]=5]="#9C29FF",i[i["#6FDD00"]=6]="#6FDD00",i[i["#E30000"]=7]="#E30000",i[i["#304AFF"]=8]="#304AFF",i[i["#FF89C4"]=9]="#FF89C4",i[i["#D597FF"]=10]="#D597FF",i[i["#C6EC5C"]=11]="#C6EC5C",i[i["#FFA115"]=12]="#FFA115",i[i["#75DEFE"]=13]="#75DEFE",i[i["#FAA291"]=14]="#FAA291",i[i["#BB813F"]=15]="#BB813F",i[i["#878291"]=16]="#878291",i))(No||{});var Wi=class{constructor(){this.participantObservers=[],this.participantsObserver=new gt.ObserverHelper({logger:me}),this.participantJoinedObserver=new gt.ObserverHelper({logger:me}),this.participantLeaveObserver=new gt.ObserverHelper({logger:me}),this.joinRoomObserver=new gt.ObserverHelper({logger:me}),this.syncPropertiesObserver=new gt.ObserverHelper({logger:me}),this.reconnectObserver=new gt.ObserverHelper({logger:me}),this.roomInfoUpdatedObserver=new gt.ObserverHelper({logger:me}),this.roomListUpdatedObserver=new gt.ObserverHelper({logger:me}),this.masterParticipantObserver=new gt.ObserverHelper({logger:me}),this.realtimeStateObserver=new gt.ObserverHelper({logger:me}),this.kickAllParticipantsObserver=new gt.ObserverHelper({logger:me}),this.authenticationObserver=new gt.ObserverHelper({logger:me})}subscribeToParticipantUpdate(r,n){this.participantObservers[r]||(this.participantObservers[r]=new gt.ObserverHelper({logger:me})),this.participantObservers[r].subscribe(n)}unsubscribeFromParticipantUpdate(r,n){this.participantObservers[r]&&this.participantObservers[r].unsubscribe(n)}getSlotColor(r){let n=r!=null?r:16;return{color:No[n],name:Do[n]}}};var EC=1e3*60,SC=2e3,df=1e3,Fo=null,er=class extends Wi{constructor(n,u){super();this.participants={};this.hostParticipantId=null;this.myParticipant=null;this.localParticipantId=null;this.isBroadcast=!1;this.roomChannel=null;this.roomSyncChannel=null;this.roomBroadcastChannel=null;this.isReconnecting=!1;this.isJoinedRoom=!1;this.currentReconnecAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFreezed=!1;this.left=!1;this.state=0;this.setHost=n=>qe(this,null,function*(){if(!n)return;let u=this.participants[n];yield this.updateRoomProperties({hostClientId:u.clientId})});this.setSyncProperty=(0,$n.default)((n,u)=>{this.isMessageTooBig(u)||this.isSyncFreezed||this.roomSyncChannel.publish(n,u,o=>{!o||me.log(`publish failed with error ${o}`)})},df);this.freezeSync=n=>{var u,o;if(this.isSyncFreezed=n,n){this.roomChannel.detach(),this.roomSyncChannel.detach(),(u=this.roomBroadcastChannel)==null||u.detach(),this.roomChannel.unsubscribe(),this.roomSyncChannel.unsubscribe(),(o=this.roomBroadcastChannel)==null||o.unsubscribe();return}this.join(this.myParticipant.data)};this.setParticipantData=n=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,n)};this.updateLocalRoomState=n=>{this.localRoomProperties=Object.assign({},this.localRoomProperties,n),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),n.hostClientId?this.updateHostInfo(n.hostClientId):this.hostPassingHandle(),this.updateParticipants()};this.updateMyProperties=(0,$n.default)(n=>{let u=n;if(!(this.isMessageTooBig(n)||this.left||!this.enableSync||this.isSyncFreezed)&&(u.avatar===void 0&&delete u.avatar,this.myParticipant.data=Ht(Ht({},this.myParticipant.data),n),!!this.isJoinedRoom))return this.roomChannel.presence.update(this.myParticipant.data)},df);this.updateRoomProperties=n=>qe(this,null,function*(){if(this.isMessageTooBig(n)||this.isSyncFreezed||this.left)return;let u=Ht(Ht({},this.localRoomProperties),n);yield this.roomChannel.publish("update",u)});this.updateParticipants=()=>qe(this,null,function*(){let n={};yield this.roomChannel.presence.get((u,o)=>{o.forEach(g=>{n[g.clientId]=Ht({},g)}),this.participants=n,this.checkBroadcast(),this.participantsObserver.publish(this.participants)})});this.updateHostInfo=n=>qe(this,null,function*(){let u=[];if(yield this.roomChannel.presence.get((g,S)=>{S.forEach(l=>{g||u.push(l.clientId)})}),!n||!u.includes(n)){this.hostPassingHandle();return}Fo&&clearTimeout(Fo);let o=this.hostParticipantId;this.hostParticipantId=n,this.masterParticipantObserver.publish({oldMasterParticipantParticipantId:o,newMasterParticipantParticipantId:this.hostParticipantId}),me.log("RELTIME",`Master participant has been changed. New Master Participant: ${this.hostParticipantId}`)});this.initializeRoomProperties=(o,...g)=>qe(this,[o,...g],function*(n,u={}){var l;let S=Ht({isGridModeEnable:!1},u);(l=this.myParticipant)!=null&&l.data.type&&(S.hostClientId=this.myParticipant.data.participantId),yield this.updateParticipants(),yield this.updateRoomProperties(S)});this.hostPassingHandle=(0,$n.default)(()=>qe(this,null,function*(){this.localRoomProperties=yield this.fetchRoomProperties(),this.roomChannel.presence.get((n,u)=>{let o=u.filter(S=>S.data.type==="host").map(S=>S.clientId);if(this.shouldKickParticipantsOnHostLeave&&o.length===0){Fo=setTimeout(()=>{this.kickAllParticipantsObserver.publish(!0)},EC);return}let g=o[0];g===this.localParticipantId&&this.setHost(g)})}),1e3);this.findSlotIndex=n=>qe(this,null,function*(){let u=n,o=Array.apply(null,{length:15}).map(Number.call,Number);if(yield this.roomChannel.presence.get((l,d)=>{l||d.forEach(b=>{b.connectionId===u.connectionId&&(u=b),b.connectionId!==u.connectionId&&b.data.hasOwnProperty("slotIndex")&&o.splice(o.indexOf(b.data.slotIndex),1)})}),o.length===0)return;let g=o[0];this.myParticipant.data.slotIndex=g,yield this.updateMyProperties({slotIndex:o[0]});let S=Math.floor(Math.random()*500);setTimeout(()=>{this.confirmSlot(u)},S)});this.confirmSlot=(0,$n.default)(n=>qe(this,null,function*(){let u=[],o=n;if(yield this.roomChannel.presence.get((g,S)=>{S.forEach(l=>{l.connectionId===o.connectionId&&(o=l),l.connectionId!==o.connectionId&&l.data.slotIndex!==void 0&&u.push(l.data.slotIndex)})}),this.myParticipant.data.slotIndex===void 0||u.includes(this.myParticipant.data.slotIndex))this.findSlotIndex(o);else{let g=yield this.fetchRoomProperties();this.updateRoomProperties(g)}}),1e3);this.onParticipantJoin=n=>qe(this,null,function*(){this.participantJoinedObserver.publish(n),yield this.updateParticipants(),this.updateMyProperties({})});this.syncBroadcast=(0,$n.default)(()=>{let n=btoa(this.ablyKey),u=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(u,{headers:{Authorization:`Basic ${n}`}}).then(o=>o.json()).then(o=>{this.roomBroadcastChannel.publish("update",o)})},1e3);this.isMessageTooBig=n=>{let u=JSON.stringify(n);return new TextEncoder().encode(u).length>SC};this.ablyKey=u,this.apiUrl=n,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onAblySyncChannelUpdate=this.onAblySyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get getMyParticipant(){return this.myParticipant}get hostClientId(){var n;return(n=this.roomProperties)==null?void 0:n.hostClientId}get getParticipants(){return this.participants}get participant(){return this.myParticipant}start({initialParticipantData:n,roomId:u,apiKey:o,shouldKickParticipantsOnHostLeave:g,isBroadcast:S}){this.myParticipant={data:n,timestamp:null,action:null,clientId:n.participantId,connectionId:null,encoding:null,id:null},this.isBroadcast=S,this.enableSync=n.type!=="audience",this.roomId=`superviz:${u.toLowerCase()}-${o}`,this.localParticipantId=this.myParticipant.data.participantId,this.shouldKickParticipantsOnHostLeave=g,this.apiKey=o,this.client||this.buildClient()}auth(n,u){let o=new Uo.default.Rest({key:this.ablyKey}),{origin:g}=window.location;o.auth.requestToken(n,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:g,apiKey:this.apiKey}},(S,l)=>{S&&this.authenticationObserver.publish("realtime.authentication-failed"),u(S,l)})}join(n){me.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(n),this.roomSyncChannel=this.client.channels.get(`${this.roomId}:sync`),this.roomSyncChannel.subscribe(this.onAblySyncChannelUpdate),this.roomBroadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.roomBroadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.roomChannel=this.client.channels.get(this.roomId),this.roomChannel.on(this.onAblyChannelStateChange),this.roomChannel.subscribe("update",this.onAblyRoomUpdate),this.roomChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.roomChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.roomChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.roomChannel.presence.enter(this.myParticipant.data)}leave(){me.log("REALTIME","Disconnecting from ably servers"),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.roomChannel=null,this.roomSyncChannel=null,this.client=null,this.left=!0}setGridMode(n){let u=this.localRoomProperties;this.updateRoomProperties(Object.assign({},u,{isGridModeEnable:n}))}setFollowParticipant(n){this.updateRoomProperties({followParticipantId:n})}setGather(n){this.updateRoomProperties({gather:n})}getParticipantSlot(n){var u,o;if(n){let g=n.toString();return this.participants&&this.participants[g]?(o=(u=this.participants[n])==null?void 0:u.data)==null?void 0:o.slotIndex:16}return 16}onAblyPresenceEnter(n){n.clientId===this.myParticipant.data.participantId?this.onJoinRoom(n):this.onParticipantJoin(n)}onAblyPresenceUpdate(n){if(!this.isJoinedRoom)return;let{clientId:u}=n,o=Object.assign({},n,{participantId:n.clientId});this.publishParticipantUpdate(o),this.participants&&this.participants[u]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(n){this.onParticipantLeave(n)}onAblySyncChannelUpdate(n){let{name:u,data:o}=n,g={};g[u]=o,this.syncPropertiesObserver.publish(g)}onReceiveBroadcastSync(n){n.data.forEach(o=>{var S;let g=o.clientId;this.participants[g]=o,(S=o.data)!=null&&S.isAudience||(this.participants[g].data=JSON.parse(this.participants[g].data),this.publishParticipantUpdate(this.participants[g]))})}onAblyRoomUpdate(n){this.updateLocalRoomState(n.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let n={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Uo.default.Realtime(n),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(n){this.participants[n.clientId]=n,this.participantsObserver.publish(this.participants),this.participantObservers[n.clientId]&&this.participantObservers[n.clientId].publish(n)}checkBroadcast(){this.isBroadcast=Object.values(this.participants).some(n=>n.data.type==="audience")}forceReconnect(){if(me.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnecAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){me.log("REALTIME","Rejoining room since client aready connected to ably servers."),this.join(this.myParticipant.data);return}me.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(n){throw me.log(n),new Error(n)}publishStateUpdate(n){this.state!==n&&(this.state=n,me.log("REALTIME",`Realtime state did change. New state: ${Bo[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((n,u)=>{this.roomChannel.history((o,g)=>{var l;o&&u(o);let S=(l=g.items[0])==null?void 0:l.data;n(S||null)})})}onStateChange(){var E,I,s;let n=(E=this.roomChannelState)==null?void 0:E.current,u=(I=this.connectionState)==null?void 0:I.current,o=u==="connected",g=["initialized","connecting"].includes(u),S=["closed","closing"].includes(u)||["detaching","detached"].includes(n),l={[0]:S,[1]:g,[2]:!n&&o,[3]:n==="attaching",[4]:n==="attached"&&o,[-1]:n==="failed"||u==="failed",[-2]:u==="suspended"||n==="suspended"},d=Object.entries(l).find(([m,T])=>T&&m)[0],b=Number(d);b===2&&(this.currentReconnecAttempt=0),o&&this.isReconnecting&&this.onJoinRoom(this.getMyParticipant),(b===-2||b===-1)&&this.forceReconnect(),(s=this.connectionState)!=null&&s.retryIn&&(this.currentReconnecAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnecAttempt)),this.publishStateUpdate(b)}onAblyConnectionStateChange(n){this.connectionState=n,this.onStateChange()}onAblyChannelStateChange(n){this.roomChannelState=n,this.onStateChange()}onJoinRoom(n){return qe(this,null,function*(){var o,g;this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.enableSync&&(yield this.findSlotIndex(n)),!this.localRoomProperties?yield this.initializeRoomProperties(n):(yield this.updateParticipants(),(o=this.localRoomProperties)!=null&&o.hostClientId?yield this.updateHostInfo((g=this.localRoomProperties)==null?void 0:g.hostClientId):this.myParticipant.data.type==="host"&&(yield this.setHost(this.myParticipant.data.participantId)),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)),this.isReconnecting=!1,this.joinRoomObserver.publish(this.roomChannel),this.publishStateUpdate(4),me.log("REALTIME","Joined realtime room")})}onParticipantLeave(n){if(this.state===2)return;let u=n.data.participantId===this.hostParticipantId;this.participantLeaveObserver.publish(n),u&&this.onHostLeft(n),this.updateParticipants()}onHostLeft(n){this.updateRoomProperties({hostClientId:null})}};oe();oe();var Ke=xt(zn()),yf=xt(gf());oe();var TC=`
  html, body { 
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  #sv-video-wrapper iframe {
    position: fixed;
    
    border: none;

    margin: 0; 
    padding: 0; 
    overflow: hidden;
  }

  #sv-video-wrapper iframe.sv-video-frame--right { 
    top: var(--superviz-offset-top);
    right: var(--superviz-offset-right);
  }

  #sv-video-wrapper iframe.sv-video-frame--left { 
    top: var(--superviz-offset-top);
    left: var(--superviz-offset-left);
  }

  #sv-video-wrapper iframe.sv-video-frame--bottom { 
    bottom: var(--superviz-offset-bottom);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--expansive-mode {
    bottom: var(--superviz-offset-bottom); 
    right: var(--superviz-offset-right);
    width: 100%;
  }

  #sv-video-wrapper iframe.sv-video-frame--settings-view {
    width: 370px;
  }
`,vf=TC;oe();var ki=(n=>(n.SMALL="SMALL",n.LARGE="LARGE",n))(ki||{});var ko="sv-video-frame",mf="sv-video-frame--expansive-mode",_r=class{constructor(r){this.frameStateObserver=new Ke.ObserverHelper({logger:me});this.frameSizeObserver=new Ke.ObserverHelper({logger:me});this.realtimeObserver=new Ke.ObserverHelper({logger:me});this.hostChangeObserver=new Ke.ObserverHelper({logger:me});this.gridModeChangeObserver=new Ke.ObserverHelper({logger:me});this.followParticipantObserver=new Ke.ObserverHelper({logger:me});this.goToParticipantObserver=new Ke.ObserverHelper({logger:me});this.gatherParticipantsObserver=new Ke.ObserverHelper({logger:me});this.sameAccountErrorObserver=new Ke.ObserverHelper({logger:me});this.devicesObserver=new Ke.ObserverHelper({logger:me});this.meetingStateObserver=new Ke.ObserverHelper({logger:me});this.meetingConnectionObserver=new Ke.ObserverHelper({logger:me});this.participantAmountUpdateObserver=new Ke.ObserverHelper({logger:me});this.participantJoinedObserver=new Ke.ObserverHelper({logger:me});this.participantAvatarObserver=new Ke.ObserverHelper({logger:me});this.participantLeftObserver=new Ke.ObserverHelper({logger:me});this.participantListObserver=new Ke.ObserverHelper({logger:me});this.frameState=0;this.onFrameLoad=()=>{if(this.messageBridge=new Ke.MessageBridge({logger:me,contentWindow:this.bricklayer.element.contentWindow}),this.browserService.isMobileDevice){let r=new yf.default,n=()=>{r.enable(),this.bricklayer.element.removeEventListener("click",n,!1)};this.bricklayer.element.addEventListener("click",n,!1)}this.messageBridge.listen("meeting.amount-of-participants-update",this.onParticipantAmountUpdate),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("frame.size-update",this.updateFrameSize),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.join",this.realtimeJoin),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.set-avatar",this.onParticipantAvatarChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize()};this.setFrameOffset=r=>{let n=r!=null?r:{};["top","bottom","left","right"].forEach(u=>{Object.keys(n).includes(u)||(n[u]=0)}),this.frameOffset=n};this.setFrameStyle=r=>{let n=document.createElement("style"),{bottom:u,left:o,right:g,top:S}=this.frameOffset;if(n.innerHTML=`
    :root {
      --superviz-offset-top: ${S}px;
      --superviz-offset-right: ${g}px;
      --superviz-offset-left: ${o}px;
      --superviz-offset-bottom: ${u}px;
    } 
    ${vf}    
    `,document.head.appendChild(n),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${r}`)};this.onFrameDimensionsUpdate=({width:r,height:n})=>{let u=document.getElementById(ko),{bottom:o,right:g,left:S,top:l}=this.frameOffset,d=r!==null,b=r===0,E=!!n,I=n===0||n>window.innerHeight,s="100%",m,T;d&&(m=`${r}px`),b&&(m=`calc(${s} - ${g}px - ${S}px)`),E&&(T=`${n}px`),I&&(T=`calc(${s} - ${l}px - ${o}px)`),u.style.width=m,u.style.height=T,this.frameSizeObserver.publish({width:m,height:T})};this.updateFrameSize=r=>{let n=document.getElementById(ko),u=n.classList.contains(mf);r==="LARGE"&&u||r==="SMALL"&&!u||n.classList.toggle(mf)};this.onWindowResize=()=>{let{bottom:r,left:n,right:u,top:o}=this.frameOffset,{innerHeight:g,innerWidth:S}=window;g=g-r-o,S=S-n-u,this.messageBridge.publish("frame.parante-window-size-update",{height:g,width:S})};this.updateFrameLocale=()=>{let{language:r,locales:n}=this.frameLocale,u=n.map(g=>g==null?void 0:g.language),o=["en",...u];if(r&&!o.includes(r))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("meeting.avatar-list-update",this.meetingAvatars)};this.onParticipantAmountUpdate=r=>{this.participantAmountUpdateObserver.publish(r)};this.onParticipantJoined=r=>{this.participantJoinedObserver.publish(r)};this.onParticipantLeft=r=>{this.participantLeftObserver.publish(r)};this.onParticipantListUpdate=r=>{this.participantListObserver.publish(r)};this.onParticipantAvatarChange=r=>{this.participantAvatarObserver.publish(r)};this.realtimeJoin=(r={})=>{this.realtimeObserver.publish(r)};this.onMeetingHostChange=r=>{this.hostChangeObserver.publish(r)};this.onFollowParticipantDidChange=r=>{this.followParticipantObserver.publish(r)};this.onGoToDidChange=r=>{this.goToParticipantObserver.publish(r)};this.onGather=()=>{this.gatherParticipantsObserver.publish()};this.onGridModeChange=r=>{this.gridModeChangeObserver.publish(r)};this.onSameAccountError=r=>{this.sameAccountErrorObserver.publish(r)};this.onDevicesChange=r=>{this.devicesObserver.publish(r)};this.meetingStateUpdate=r=>{this.meetingStateObserver.publish(r)};this.onConnectionStatusChange=r=>{this.meetingConnectionObserver.publish(r)};this.waitForHostDidChange=r=>{this.messageBridge.publish("realtime.wait-for-host",r)};this.gridModeDidChange=r=>{this.messageBridge.publish("realtime.grid-mode-change",r)};this.participantsListDidChange=r=>{this.messageBridge.publish("realtime.participant-list-update",r)};this.onMasterParticipantDidChange=r=>{this.messageBridge.publish("realtime.host-change",r)};this.followParticipantDidChange=r=>{this.messageBridge.publish("realtime.follow-participant",r)};let{conferenceLayerUrl:n,apiKey:u,debug:o,language:g,roomId:S,canUseCams:l,canUseScreenshare:d,canUseDefaultAvatars:b,canUseFollow:E,canUseGoTo:I,canUseGather:s,position:m,browserService:T,offset:M,canUseDefaultToolbar:C,locales:y,avatars:R}=r;this.browserService=T;let c=document.createElement("div"),v=["right","left"].includes(m)&&!this.browserService.isMobileDevice?"vertical":"horizontal",h={apiKey:u,debug:o,canUseFollow:E,canUseGoTo:I,canUseCams:l,canUseGather:s,canUseScreenshare:d,canUseDefaultAvatars:b,camerasOrientation:v,canUseDefaultToolbar:C,roomId:S};c.classList.add("sv_video_wrapper"),c.id="sv-video-wrapper",document.body.appendChild(c),this.updateFrameState(1),this.bricklayer=new Ke.FrameBricklayer,this.bricklayer.build(c.id,n,ko,h,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(M),this.setFrameStyle(m),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:g,locales:y},this.meetingAvatars=R,window.addEventListener("resize",this.onWindowResize)}updateFrameState(r){r!==this.frameState&&(this.frameState=r,this.frameStateObserver.publish(this.frameState));let n={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(n[r])}start(r){this.messageBridge.publish("meeting.start",r)}leave(){this.messageBridge.publish("meeting.leave",{}),this.destroy()}destroy(){this.messageBridge.destroy(),this.bricklayer.destroy(),this.frameStateObserver.destroy(),this.realtimeObserver.destroy(),this.hostChangeObserver.destroy(),this.gridModeChangeObserver.destroy(),this.followParticipantObserver.destroy(),this.bricklayer=null,this.frameState=null}toggleChat(){this.messageBridge.publish("meeting-controls.toggle-chat")}toggleMeetingSetup(){this.messageBridge.publish("meeting-controls.toggle-setup")}toggleMicrophone(){this.messageBridge.publish("meeting-controls.toggle-microphone")}toggleScreenShare(){this.messageBridge.publish("meeting-controls.toggle-screenshare")}hangUp(){this.messageBridge.publish("hang-up")}toggleCam(){this.messageBridge.publish("meeting-controls.toggle-cam")}};var PC=bf(),Vo=class{constructor({conferenceLayerUrl:r,apiUrl:n,apiKey:u,debug:o=!1,language:g,roomId:S,ablyKey:l,group:d,participant:b,shouldKickParticipantsOnHostLeave:E,camsOff:I,screenshareOff:s,defaultAvatars:m,offset:T,enableFollow:M,enableGoTo:C,enableGather:y,defaultToolbar:R,locales:c,avatars:v}){this.integrationManager=null;this.observerHelpers={};this.hasJoined=!1;this.participantList=[];this.isBroadcast=!1;this.setSyncProperty=(r,n)=>{this.realtime.setSyncProperty(r,n)};this.subscribe=(r,n)=>{this.observerHelpers[r]||(this.observerHelpers[r]=new Cf.ObserverHelper),this.observerHelpers[r].subscribe(n)};this.unsubscribe=r=>{this.observerHelpers[r]&&(this.observerHelpers[r].reset(),delete this.observerHelpers[r])};this.startVideo=r=>{this.videoManager=new _r(r),this.videoManager.frameStateObserver.subscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.subscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.subscribe(this.onHostDidChange),this.videoManager.followParticipantObserver.subscribe(this.onFollowParticipantDidChange),this.videoManager.goToParticipantObserver.subscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.subscribe(this.onGatherDidChange),this.videoManager.gridModeChangeObserver.subscribe(this.onGridModeDidChange),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange),this.videoManager.participantAmountUpdateObserver.subscribe(this.onParticipantAmountUpdate),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.participantAvatarObserver.subscribe(this.onParticipantAvatarUpdate),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus)};this.publish=(r,n)=>{r in this.observerHelpers&&this.observerHelpers[r].publish(n)};this.onSyncPropertiesDidChange=r=>{Object.entries(r).forEach(([n,u])=>{this.publish(n,u)})};this.onKickAllParticipantsDidChange=r=>{this.publish("meeting.kick-all-participants",r),this.destroy()};this.onRealtimeJoin=r=>{this.realtime.join(r)};this.onHostDidChange=r=>{let n=this.participantList.find(u=>u.id===r);this.realtime.setHost(r),this.setSyncProperty("meeting.host-change",n)};this.onFollowParticipantDidChange=r=>{this.realtime.setFollowParticipant(r),this.setSyncProperty("realtime.follow-participant",r)};this.onGoToParticipantDidChange=r=>{var n;(n=this.integrationManager)==null||n.goToParticipant(r),this.publish("realtime.go-to-participant",r)};this.onGatherDidChange=()=>{this.realtime.setGather(!0),this.setSyncProperty("realtime.gather")};this.onFrameStateDidChange=r=>{r===2&&this.start()};this.onFrameSizeDidChange=r=>{this.publish("frame.dimensions-update",r)};this.onRoomInfoUpdated=r=>{let{isGridModeEnable:n,followParticipantId:u,gather:o}=r;this.videoManager.gridModeDidChange(n),this.videoManager.followParticipantDidChange(u),this.realtime.hostClientId===this.participant.id&&o&&this.realtime.setGather(!1)};this.onParticipantsDidChange=r=>{r[this.participant.id]&&!this.hasJoined&&(this.publish("my-participant.joined",this.participant),this.hasJoined=!0);let n=Object.values(r).map(u=>({timestamp:u.timestamp,connectionId:u.connectionId,participantId:u.clientId,color:this.realtime.getSlotColor(u.data.slotIndex).name}));this.participantList=this.updateParticipantListFromParticipants(r),this.publish("meeting.participant-list-update",this.participantList),this.videoManager.participantsListDidChange(n)};this.onMasterParticipantDidChange=r=>{this.videoManager.onMasterParticipantDidChange(r==null?void 0:r.newMasterParticipantParticipantId)};this.onGridModeDidChange=r=>{this.realtime.setGridMode(r)};this.updateParticipantListFromParticipants=r=>{let n=[];return Object.values(r).forEach(u=>{var o;n.push({id:u.clientId,color:this.realtime.getSlotColor((o=u.data)==null?void 0:o.slotIndex).color,avatarConfig:u.data.avatarConfig,avatar:u.data.avatar,type:u.data.type,name:u.data.name,isHost:this.realtime.hostClientId===u.clientId})}),n};this.onSameAccountError=r=>{this.publish("meeting.same-participant-error",r),this.destroy()};this.onDevicesChange=r=>{this.publish("meeting.devices-change",r)};this.onParticipantAmountUpdate=r=>{this.publish("meeting.amount-of-participants-update",r)};this.onParticipantJoined=r=>{this.checkBroadcastMode(),this.publish("meeting.participant-joined",r)};this.onParticipantLeft=r=>{r.id===this.participant.id&&this.publish("my-participant.left",r),this.publish("meeting.participant-left",r),this.destroy()};this.onParticipantAvatarUpdate=r=>{this.participant.avatar.model=r};this.onParticipantListUpdate=r=>{let n=r.find(u=>u.id===this.participant.id);(0,Of.default)(n,this.participant)||(this.participant=Object.assign({},this.participant,n),this.publish("my-participant.update",this.participant))};this.onAuthenticationFailed=r=>{this.publish("realtime.authentication-failed",r),this.destroy()};this.onMeetingStateUpdate=r=>{me.log("MEETING STATE",r),this.publish("meeting.state-update",r)};this.onConnectionStatusChange=r=>{let n=[2,4,3,6];n.includes(r)&&this.realtime.freezeSync(!0),n.includes(this.connectionService.oldConnectionStatus)&&!n.includes(r)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",r)};var D;this.roomId=S,this.group=d,this.participant=b,this.realtime=new er(n,l),this.browserService=new Cr;let h=!I,A=!s,f=!!m&&!((D=b==null?void 0:b.avatar)!=null&&D.model),O=R!=null?R:!0,P=!!M,L=!!C,V=!!y;(b==null?void 0:b.avatar)===void 0&&(this.participant=Object.assign({},this.participant,{avatar:{model:""}}));let H="right";this.connectionService=new Di,this.connectionService.addListerners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange),this.startVideo({conferenceLayerUrl:r,canUseCams:h,canUseScreenshare:A,canUseDefaultAvatars:f,canUseFollow:P,canUseGoTo:L,canUseGather:V,canUseDefaultToolbar:O,apiKey:u,debug:o,language:g,roomId:S,position:H,browserService:this.browserService,offset:T,locales:c!=null?c:[],avatars:v!=null?v:[]}),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onParticipantsDidChange),this.realtime.masterParticipantObserver.subscribe(this.onMasterParticipantDidChange),this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.authenticationObserver.subscribe(this.onAuthenticationFailed),this.realtime.start({initialParticipantData:Ht({participantId:this.participant.id},this.participant),roomId:this.roomId,apiKey:u,shouldKickParticipantsOnHostLeave:E!=null?E:!0,isBroadcast:this.isBroadcast})}get isIntegrationManagerInitializated(){return!!this.integrationManager}checkBroadcastMode(){this.isBroadcast=this.participantList.some(r=>r.type==="audience")}start(){me.log("SUPERVIZ SDK VERSION",PC.version),this.videoManager.start({roomId:this.roomId,participant:this.participant,group:this.group})}destroy(){this.publish("destroy",void 0),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateDidChange),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.realtimeObserver.unsubscribe(this.onRealtimeJoin),this.videoManager.hostChangeObserver.unsubscribe(this.onHostDidChange),this.videoManager.followParticipantObserver.unsubscribe(this.onFollowParticipantDidChange),this.videoManager.gridModeChangeObserver.unsubscribe(this.onGridModeDidChange),this.videoManager.goToParticipantObserver.unsubscribe(this.onGoToParticipantDidChange),this.videoManager.gatherParticipantsObserver.unsubscribe(this.onGatherDidChange),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange),this.videoManager.participantAmountUpdateObserver.unsubscribe(this.onParticipantAmountUpdate),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.participantAvatarObserver.unsubscribe(this.onParticipantAvatarUpdate),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateUpdate),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onParticipantsDidChange),this.realtime.masterParticipantObserver.unsubscribe(this.onMasterParticipantDidChange),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesDidChange),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.authenticationObserver.unsubscribe(this.onAuthenticationFailed),this.connectionService.connectionStatusObserver.unsubscribe(this.onConnectionStatusChange),Object.keys(this.observerHelpers).forEach(r=>this.unsubscribe(r)),this.videoManager.leave(),this.realtime.leave(),this.connectionService.removeListeners(),this.hasJoined=!1,this.unloadPlugin()}toggleChat(){this.videoManager.toggleChat()}toggleMeetingSetup(){this.videoManager.toggleMeetingSetup()}toggleCam(){this.videoManager.toggleCam()}toggleMicrophone(){this.videoManager.toggleMicrophone()}toggleScreenShare(){this.videoManager.toggleScreenShare()}hangUp(){this.videoManager.hangUp()}follow(r){this.videoManager.followParticipantDidChange(r),this.realtime.setFollowParticipant(r)}gather(){this.realtime.setGather(!0)}goTo(r){this.integrationManager.goToParticipant(r)}loadPlugin(r,n){var o,g,S,l,d,b;if(this.isIntegrationManagerInitializated)throw new Error("the 3D plugin has already been started");n.avatarConfig&&this.realtime.setParticipantData({avatarConfig:n.avatarConfig}),this.participant.avatar&&this.participant.avatar.model&&this.realtime.setParticipantData({avatar:{model:this.participant.avatar.model}});let u=[];return this.realtime.getParticipants&&(u=Object.values(this.realtime.getParticipants)),this.integrationManager=new Ui(Oc(Ht({plugin:r},n),{localParticipant:{id:this.participant.id,name:this.participant.name,avatar:this.participant.avatar,avatarConfig:n.avatarConfig},participantList:u.map(E=>{let I=E.clientId,{name:s,avatar:m,avatarConfig:T,slotIndex:M,isAudience:C}=E.data;return{id:I,name:s,avatar:m,avatarConfig:T,slotIndex:M,isAudience:C}}),RealtimeService:this.realtime})),{enableAvatars:(o=this.integrationManager)==null?void 0:o.enableAvatars,disableAvatars:(g=this.integrationManager)==null?void 0:g.disableAvatars,enableMouse:(S=this.integrationManager)==null?void 0:S.enableMouse,disableMouse:(l=this.integrationManager)==null?void 0:l.disableMouse,enableLaser:(d=this.integrationManager)==null?void 0:d.enableLaser,disableLaser:(b=this.integrationManager)==null?void 0:b.disableLaser,getParticipantsOn3D:()=>{var E;return(E=this.integrationManager)!=null&&E.participants?this.integrationManager.participants:[]},getAvatars:()=>{var E;return(E=this.integrationManager)==null?void 0:E.getAvatars}}}unloadPlugin(){this.integrationManager&&(this.integrationManager.plugin.destroy(),this.integrationManager=null)}},Ef=i=>{let r=new Vo(i);return{setSyncProperty:(n,u)=>r.setSyncProperty(n,u),subscribe:(n,u)=>r.subscribe(n,u),unsubscribe:n=>r.unsubscribe(n),destroy:()=>r.destroy(),follow:n=>r.follow(n),gather:()=>r.gather(),goTo:n=>r.goTo(n),toggleMeetingSetup:()=>r.toggleMeetingSetup(),toggleMicrophone:()=>r.toggleMicrophone(),toggleCam:()=>r.toggleCam(),toggleScreenShare:()=>r.toggleScreenShare(),hangUp:()=>r.hangUp(),toggleChat:()=>r.toggleChat(),loadPlugin:(n,u)=>r.loadPlugin(n,u),unloadPlugin:()=>r.unloadPlugin()}};oe();oe();oe();oe();oe();var Sf="3.2.2";var tr=class{static getRemoteConfig(){return qe(this,arguments,function*(r="prod"){let n={version:Sf,environment:r},u=this.createUrl(n);return Qn(u,"GET",null)})}static createUrl({version:r,environment:n}){return`${this.REMOTE_CONFIG_BASE_URL}/${r}?env=${n}`}};tr.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";var wC=({group:i,participant:r,roomId:n})=>{if(!i||!i.name||!i.id)throw new Error("group fields is required");if(!r||!r.id)throw new Error("participant fields is required");if(!n)throw new Error("room id is required")},If=(i,r)=>qe(void 0,null,function*(){wC(r),r.debug&&me.enable("@superviz/*");let{apiUrl:n,conferenceLayerUrl:u}=yield tr.getRemoteConfig(r.environment);if(!(yield Qc(n,i)))throw new Error("Failed to validate API key");let g=yield Sn.fetchConfig(n,i);if(!g||!g.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:S}=g;return Ef(Object.assign({},r,{apiKey:i,ablyKey:S,conferenceLayerUrl:u,apiUrl:n}))});window&&(window.SuperVizSdk={init:If,MeetingEvent:mr,FrameSize:ki,DeviceEvent:fo,RealtimeEvent:Vn,MeetingState:yi,MeetingConnectionStatus:yr,MeetingControlsEvent:mi});var JE={init:If};export{Cr as BrowserService,fo as DeviceEvent,ki as FrameSize,yr as MeetingConnectionStatus,mi as MeetingControlsEvent,mr as MeetingEvent,yi as MeetingState,ho as ParticipantType,Vn as RealtimeEvent,JE as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 *
 * Ably JavaScript Library v1.2.29
 * https://github.com/ably/ably-js
 *
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
